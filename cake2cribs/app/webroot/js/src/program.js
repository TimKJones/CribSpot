(function(){var P,Q,z=[].indexOf||function(b){for(var a=0,c=this.length;a<c;a++)if(a in this&&this[a]===b)return a;return-1},A={}.hasOwnProperty,x=function(b,a){function c(){this.constructor=b}for(var d in a)A.call(a,d)&&(b[d]=a[d]);c.prototype=a.prototype;b.prototype=new c;b.__super__=a.prototype;return b},B=function(b,a){return function(){return b.apply(a,arguments)}};window.A2Cribs={};A2Cribs.Object=function(){function b(a,c){var d,e;this.class_name=null!=a?a:"object";for(d in c)e=c[d],null!=e&&
(this[d]=e)}b.prototype.Update=function(a){var c,d;for(c in a)d=a[c],null!=d&&(this[c]=d);return this};b.prototype.GetId=function(a){return parseInt(this[""+this.class_name+"_id"],10)};b.prototype.GetObject=function(){var a,c,d;c={};for(a in this)d=this[a],"function"!==typeof d&&("boolean"===typeof d&&(d=+d),c[a]=d);return c};b.prototype.IsComplete=function(){return!0};return b}();A2Cribs.MixPanel=function(){function b(){}var a,c;c=function(a){if(null!=a)return Math.min.apply(null,a)};a=function(a){if(null!=
a)return Math.min.apply(null,a)};b.Click=function(d,e){var g,b,h,k,l,m,n,p,q,r,s,u,v,t,w,N,x,D,H,I,E,F,C,J,K,L,y,G;if(!(void 0===d||null===d)){k=0;g=null;if("listing"===d.class_name)l=d,k=1*(q=parseInt(l.listing_id),0<=z.call(A2Cribs.FeaturedListings.FLListingIds,q)),g=l.available,m=A2Cribs.UserCache.Get("marker",l.marker_id);else if("marker"===d.class_name){m=d;g=A2Cribs.UserCache.GetAllAssociatedObjects("listing","marker",m.marker_id);q=0;for(u=g.length;q<u;q++)if(l=g[q],t=parseInt(l.listing_id),
0<=z.call(A2Cribs.FeaturedListings.FLListingIds,t)){k=1;break}g=m.available}else if("rental"===d.class_name)l=A2Cribs.UserCache.Get("listing",d.listing_id),k=1*(u=parseInt(l.listing_id),0<=z.call(A2Cribs.FeaturedListings.FLListingIds,u));else return!1;k={"listing type":null!=m?m.GetBuildingType():void 0,"display type":e,"is featured":k,listing_id:null!=l?l.GetId():void 0,marker_id:null!=m?m.GetId():void 0,available:g,university_id:null!=(F=A2Cribs.Map)?F.CurentSchoolId:void 0,"filter minimum beds":c(null!=
(C=A2Cribs.RentalFilter.FilterData)?C.Beds:void 0),"filter maximum beds":a(null!=(J=A2Cribs.RentalFilter.FilterData)?J.Beds:void 0),"filter minimum rent":null!=(K=A2Cribs.RentalFilter.FilterData)?null!=(L=K.Rent)?L.min:void 0:void 0,"filter maximum rent":null!=(y=A2Cribs.RentalFilter.FilterData)?null!=(G=y.Rent)?G.max:void 0:void 0,"filter start year":null!=(h=A2Cribs.RentalFilter.FilterData)?null!=(b=h.Dates)?b.year:void 0:void 0,"filter minimum lease length":null!=(r=A2Cribs.RentalFilter.FilterData)?
null!=(v=r.LeaseRange)?v.min:void 0:void 0,"filter maximum lease length":null!=(w=A2Cribs.RentalFilter.FilterData)?null!=(N=w.LeaseRange)?N.max:void 0:void 0,"filter building_type min":c,"filter building_type":c,"filter pets allowed":null!=(x=A2Cribs.RentalFilter.FilterData)?x.PetsAllowed:void 0,"filter parking available":null!=(D=A2Cribs.RentalFilter.FilterData)?D.ParkingAvailable:void 0,"filter air conditioning":null!=(H=A2Cribs.RentalFilter.FilterData)?H.Air:void 0,"filter utilities included":null!=
(I=A2Cribs.RentalFilter.FilterData)?I.UtilitiesIncluded:void 0};if(null!=(null!=(E=A2Cribs.RentalFilter.FilterData)?E.Beds:void 0)){w=A2Cribs.RentalFilter.FilterData.Beds;h=r=0;for(v=w.length;r<v;h=++r)b=w[h],k["filter bed "+h]=b}if(null!=(null!=(n=A2Cribs.RentalFilter.FilterData)?null!=(s=n.Dates)?s.months:void 0:void 0)){r=A2Cribs.RentalFilter.FilterData.Dates.months;h=s=0;for(b=r.length;s<b;h=++s)n=r[h],k["filter month "+h]=n}if(null!=(null!=(p=A2Cribs.RentalFilter.FilterData)?p.UnitTypes:void 0)){b=
A2Cribs.RentalFilter.FilterData.UnitTypes;h=n=0;for(s=b.length;n<s;h=++n)p=b[h],k["filter unit_type "+h]=p}return mixpanel.track("Listing Click",k)}};b.PostListing=function(a,c){return mixpanel.track("Post Listing - "+a,c)};b.AuthEvent=function(a,c){return mixpanel.track(a,c)};b.Event=function(a,c){return mixpanel.track(a,c)};$(document).ready(function(){return $(".mark_leased").click(function(a){var c;c=$(a.currentTarget).data("listing-id");$(a.currentTarget).button("loading");return b.Event("marked leased",
{listing_id:c})})});$(document).on("logged_in",function(a,c){return b.Event("Logged In",{name:null!=c?c.name:void 0,email:null!=c?c.email:void 0})});return b}.call(this);A2Cribs.User=function(b){function a(c){a.__super__.constructor.call(this,"user",c)}x(a,b);a.prototype.GetId=function(){return this.id};return a}(A2Cribs.Object);A2Cribs.Favorite=function(){return function(b,a,c){this.FavoriteId=b;this.ListingId=a;this.UserId=c}}();A2Cribs.Listing=function(b){function a(c){a.__super__.constructor.call(this,
"listing",c)}x(a,b);a.LISTING_TYPES=["Rental","Sublet"];a.prototype.IsVisible=function(a){null==a&&(a=null);"boolean"===typeof a&&(this.visible=a);return!1===this.visible?!1:!0};a.prototype.InSidebar=function(a){null==a&&(a=null);"boolean"===typeof a&&(this.in_sidebar=a);return!0===this.in_sidebar?!0:!1};a.prototype.IsFeatured=function(a){null==a&&(a=null);"boolean"===typeof a&&(this.is_featured=a);return!0===this.is_featured?!0:!1};a.prototype.GetListingType=function(){return A2Cribs.Listing.LISTING_TYPES[parseInt(this.listing_type,
10)]};a.prototype.GetConnectedObject=function(){var a,d,e,g,b,h;d=["Listing","Image",A2Cribs.Listing.LISTING_TYPES[parseInt(this.listing_type,10)]];g={};b=0;for(h=d.length;b<h;b++)a=d[b],e=A2Cribs.UserCache.Get(a.toLowerCase(),this.GetId()),null!=e&&(g[a]=e.GetObject());return g};return a}(A2Cribs.Object);A2Cribs.Marker=function(b){function a(c){this.MarkerClicked=B(this.MarkerClicked,this);a.__super__.constructor.call(this,"marker",c)}var c,d;x(a,b);a.BuildingType="House Apartment Duplex Condo Townhouse Co-Op Dorm Greek Other".split(" ");
a.TYPE={UNKNOWN:0,LEASED:1,AVAILABLE:2};a.prototype.GetName=function(){return null!=this.alternate_name&&this.alternate_name.length?this.alternate_name:this.street_address};a.prototype.GetBuildingType=function(){return isNaN(parseInt(this.building_type_id,10))?this.building_type_id:A2Cribs.Marker.BuildingType[this.building_type_id]};a.prototype.GetType=function(){return this._type};a.prototype.SetType=function(a){var c,d;this._type=a;switch(this._type){case A2Cribs.Marker.TYPE.UNKNOWN:c="unknown";
break;case A2Cribs.Marker.TYPE.LEASED:c="leased";break;case A2Cribs.Marker.TYPE.AVAILABLE:c="available"}return null!=(d=this.GMarker)?d.setIcon("/img/dots/dot_"+c+".png"):void 0};a.prototype.IsVisible=function(a){var c,d;null==a&&(a=null);"boolean"===typeof a&&null!=(c=this.GMarker)&&c.setVisible(a);return null==this.GMarker?!1:null!=(d=this.GMarker)?d.getVisible():void 0};a.prototype.Init=function(){this.GMarker=new google.maps.Marker({position:new google.maps.LatLng(this.latitude,this.longitude),
icon:"/img/dots/dot_leased.png",id:this.GetId()});return google.maps.event.addListener(this.GMarker,"click",this.MarkerClicked)};a.prototype.GetObject=function(){var c;c=a.__super__.GetObject.call(this);c.GMarker=null;return c};a.prototype.MarkerClicked=function(a){A2Cribs.MixPanel.Click(this,"small popup");return $("#map_region").trigger("marker_clicked",[this])};c=function(a){var c,d,b,k,l,m,n,p,q,r,s,u,v,t,w,x,z,D,H,I,E,F,C,J,K,L,y,G,A,B,M,O;if(void 0===a)return null;v=$("#houseCheck").is(":checked");
c=$("#aptCheck").is(":checked");I=$("#otherCheck").is(":checked");w=$("#maleCheck").is(":checked");m=$("#femaleCheck").is(":checked");F=$("#studentsOnlyCheck").is(":checked");n=$("#gradCheck").is(":checked");L=$("#undergradCheck").is(":checked");$("#acCheck").is(":checked");$("#parkingCheck").is(":checked");G=$("#utilitiesCheck").is(":checked");D=$("#noSecurityDepositCheck").is(":checked");z=A2Cribs.FilterManager.MinRent;x=A2Cribs.FilterManager.MaxRent;k=$("#bedsSelect").val();"2+"===k&&(k="2");k=
parseInt(k);E=new Date(A2Cribs.FilterManager.DateBegin);l=new Date(A2Cribs.FilterManager.DateEnd);d=$("#bathSelect").val();B=[];M=0;for(O=a.length;M<O;M++)C=a[M],t=A2Cribs.Cache.IdToSubletMap[C],y=t.BuildingType,K=new Date(t.StartDate),J=new Date(t.EndDate),p=A2Cribs.Cache.SubletIdToHousemateIdsMap[C],b=A2Cribs.Cache.IdToHousematesMap[p],u=q=p=r=!0,s=!1,void 0!==b&&null!==b&&(r="Male"===b.Gender||"Mix"===b.Gender||void 0===b.Gender||null===b.Gender,p="Female"===b.Gender||"Mix"===b.Gender||void 0===
b.Gender||null===b.Gender,q="Graduate"===b.GradType||"Mix"===b.GradType||void 0===b.GradType||null===b.GradType,u="Undergraduate"===b.GradType||"Mix"===b.GradType||void 0===b.GradType||null===b.GradType,s=!0===b.Enrolled||void 0===b.Enrolled||null===b.Enrolled),b=t.BathroomType===d||"Private"!==d&&"Shared"!==d,A=!G||G&&0===t.UtilityCost,H=!D||D&&0===t.DepositAmount,(("House"===y||null===y)&&v||("Apartment"===y||null===y)&&c||("Duplex"===y||null===y)&&I||"House"!==y&&"Duplex"!==y&&"Apartment"!==y)&&
(t.PricePerBedroom>=z&&t.PricePerBedroom<=x&&t.Bedrooms>=k&&(E>=K||!A2Cribs.Marker.IsValidDate(E))&&(J>=l||!A2Cribs.Marker.IsValidDate(l))&&(m&&p||w&&r)&&(L&&u||n&&q)&&(!F||F&&s)&&b&&A&&H)&&B.push(C);return B};d=function(a){var c,d;if(!this.Clicked){c=0;for(d=a.length;c<d;c++)A2Cribs.UserCache.Set(A2Cribs.Listing(JSON.parse(a)));a=A2Cribs.UserCache.Get("marker",this.MarkerId);a.GMarker.setIcon("/img/dots/clicked_dot.png")}this.Clicked=!0;return this.FilterVisibleListingsAndOpenPopup()};a.prototype.LoadMarkerData=
function(){this.CorrectTooltipLocation();return this.Clicked?this.FilterVisibleListingsAndOpenPopup():$.ajax({url:myBaseUrl+"Listings/LoadMarkerData/"+this.MarkerId,type:"GET",context:this,success:d})};a.prototype.FilterVisibleListingsAndOpenPopup=function(){var a;a=c(A2Cribs.Cache.MarkerIdToSubletIdsMap[this.MarkerId]);return A2Cribs.Map.ClickBubble.Open(this,a)};a.GetMarkerPixelCoordinates=function(a){var c,d,b;c=A2Cribs.Map.GMap;b=Math.pow(2,c.getZoom());d=new google.maps.LatLng(c.getBounds().getNorthEast().lat(),
c.getBounds().getSouthWest().lng());d=c.getProjection().fromLatLngToPoint(d);a=c.getProjection().fromLatLngToPoint(a);return new google.maps.Point(Math.floor((a.x-d.x)*b),Math.floor((a.y-d.y)*b))};a.prototype.CorrectTooltipLocation=function(){var a,c,d,b;d=A2Cribs.Map.Bounds.CONTROL_BOX_LEFT;b=A2Cribs.Marker.GetMarkerPixelCoordinates(this.GMarker.position);c=a=0;b.x+A2Cribs.MarkerTooltip.Width-A2Cribs.MarkerTooltip.ArrowOffset+A2Cribs.MarkerTooltip.Padding>A2Cribs.Map.Bounds.RIGHT&&(a=b.x+A2Cribs.MarkerTooltip.Width-
A2Cribs.MarkerTooltip.ArrowOffset+A2Cribs.MarkerTooltip.Padding-A2Cribs.Map.Bounds.RIGHT);b.x-A2Cribs.MarkerTooltip.ArrowOffset-A2Cribs.MarkerTooltip.Padding<d&&(a=b.x-A2Cribs.MarkerTooltip.ArrowOffset-A2Cribs.MarkerTooltip.Padding-d);0>b.y-A2Cribs.MarkerTooltip.Height-A2Cribs.MarkerTooltip.ArrowHeight&&(c=b.y-A2Cribs.MarkerTooltip.Height-A2Cribs.MarkerTooltip.ArrowHeight);b.y>A2Cribs.Map.Bounds.BOTTOM-A2Cribs.MarkerTooltip.Padding&&(c=b.y-A2Cribs.Map.Bounds.BOTTOM+A2Cribs.MarkerTooltip.Padding);
return A2Cribs.Map.GMap.panBy(a,c)};a.IsValidDate=function(a){return"Invalid Date"!==a.toString()};return a}(A2Cribs.Object);A2Cribs.FavoritesManager=function(){function b(){}b.FavoritesListingIds=[];b.FavoritesVisible=!1;$(document).ready(function(){return $("body").on("click",".favorite_listing",function(a){var c;if(!1===(null!=(c=A2Cribs.Login)?c.logged_in:void 0))return $("#signup_modal").modal("show").find(".signup_message").text("Please signup to favorite this listing."),!1;c=$(a.currentTarget).data("listing-id");
-1===b.FavoritesListingIds.indexOf(parseInt(c,10))?b.AddFavorite(c,a.currentTarget):b.DeleteFavorite(c,a.currentTarget);return $(a.currentTarget).toggleClass("active")})});b.AddFavorite=function(a,c){return $.ajax({url:myBaseUrl+"Favorites/AddFavorite/"+a,type:"POST",context:this,success:function(d){return A2Cribs.FavoritesManager.AddFavoriteCallback(d,a,c)}})};b.AddFavoriteCallback=function(a,c,d){a=JSON.parse(a);if(void 0===a.success)return void 0!==a.error.message?A2Cribs.UIManager.Error(a.error.message):
A2Cribs.UIManager.Error("There was an error adding your favorite. Contact help@cribspot.com if the error persists.");this.FavoritesListingIds.push(parseInt(c,10));a=$("#fl-sb-item-"+c);1===a.length&&(a.find(".favorite").attr("title","Delete from Favorites"),a.find(".favorite").addClass("active"));null!=d&&($(d).attr("title","Delete from Favorites"),$(d).addClass("active"));return this._setFavoriteCount()};b.DeleteFavorite=function(a,c){return $.ajax({url:myBaseUrl+"Favorites/DeleteFavorite/"+a,type:"POST",
context:this,success:function(d){return A2Cribs.FavoritesManager.DeleteFavoriteCallback(d,a,c)}})};b.DeleteFavoriteCallback=function(a,c,d){a=JSON.parse(a);if(void 0!==a.error)return A2Cribs.UIManager.Error(a.error.message);a=A2Cribs.FavoritesManager.FavoritesListingIds.indexOf(parseInt(c,10));-1!==a&&A2Cribs.FavoritesManager.FavoritesListingIds.splice(a,1);c=$("#fl-sb-item-"+c);1===c.length&&(c.find(".favorite").attr("title","Add to Favorites"),c.find(".favorite").removeClass("active"));if(null!=
d)return $(d).attr("title","Add to Favorites"),$(d).removeClass("active"),this._setFavoriteCount()};b.InitializeFavorites=function(a){var c,d,e;d=0;for(e=a.length;d<e;d++)c=a[d],A2Cribs.FavoritesManager.FavoritesListingIds.push(parseInt(c,10));return this._setFavoriteCount()};b.ToggleFavoritesVisibility=function(){if(A2Cribs.Map.ToggleListingVisibility(b.FavoritesListingIds,"favorites"))return A2Cribs.Map.IsCluster(!0),$(".favorite_button").removeClass("active");A2Cribs.Map.IsCluster(!1);return $(".favorite_button").addClass("active")};
b.FavoritesVisibilityIsOn=function(){return $("#FavoritesHeaderIcon").hasClass("pressed")};b.setFavoriteButton=function(a,c){return-1===b.FavoritesListingIds.indexOf(parseInt(c,10))?a.removeClass("active"):a.addClass("active")};b._setFavoriteCount=function(){return 0===this.FavoritesListingIds.length?$(".favorite_count").hide():$(".favorite_count").show().text(this.FavoritesListingIds.length)};b._removeFromFavoriteDiv=function(a){$("#personalFavoritesList").find("#favoriteDiv"+a).remove();if(0===
this.FavoritesCache.size)return $("#noFavorites").show()};b._insertFavoriteCache=function(a){this.FavoritesCache[a]=!0;++this.FavoritesCache.size;return $("#numFavorites").html(this.FavoritesCache.size)};b._removeFavoriteCache=function(a){this.FavoritesCache[a]=null;--this.FavoritesCache.size;return $("#numFavorites").html(this.FavoritesCache.size)};return b}.call(this);A2Cribs.FacebookManager=function(){function b(){}b.FacebookLogin=function(){var a;a="https://www.facebook.com/dialog/oauth?client_id=450938858319396&redirect_uri=https://www.cribspot.com/login";
a+="&scope=email";A2Cribs.MixPanel.AuthEvent("login",{source:"facebook"});return window.location.href=a};b.FacebookJSLogin=function(){return FB.getLoginStatus(function(a){return"connected"===a.status?null!=a&&null!=a.authResponse?A2Cribs.FacebookManager.AttemptLogin(a.authResponse):A2Cribs.UIManager.Error("We're having trouble logging you in with facebook, but don't worry!\t\t\t\t\tYou can still create an account with our regular login."):FB.login(function(a){return null!=a&&null!=a.authResponse?
A2Cribs.FacebookManager.AttemptLogin(a.authResponse):A2Cribs.UIManager.Error("We're having trouble logging you in with facebook, but don't worry!\t\t\t\t\t\tYou can still create an account with our regular login.")},{scope:"email"})})};b.AttemptLogin=function(a){return $.ajax({url:myBaseUrl+"Users/AttemptFacebookLogin",data:a,type:"POST",success:function(a){return console.log(a)},error:function(a){return console.log(a)}})};b.Logout=function(){alert("logging out");return $.ajax({url:myBaseUrl+"Users/Logout",
type:"GET"})};b.Login=function(){return alert("logging in")};b.JSLogin=function(){return FB.login(A2Cribs.FacebookManager.JSLoginCallback)};b.JSLoginCallback=function(a){return a.authResponse?(FB.api("/me",A2Cribs.FacebookManager.APICallback),$.ajax({url:myBaseUrl+"Verify/FacebookVerify",type:"POST"})):alert("failed")};b.FindMutualFriends=function(){var a;a="SELECT uid, first_name, last_name, pic_small FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = me()) AND uid IN (SELECT uid2 FROM friend WHERE uid1 = "+
$("#userid_input").val()+")";return FB.api({method:"fql.query",query:a},A2Cribs.FacebookManager.FindMutualFriendsCallback)};b.FindMutualFriendsCallback=function(a){return $("#numMutualFriendsVal").html(a.length)};b.APICallback=function(a){console.log(a);$(".facebook.unverified").toggleClass("unverified verified");return $(".facebook.verified").html(a.name+" is now verified.")};b.UpdateLinkedinLogin=function(a){$(".linkedin.unverified").toggleClass("unverified verified");$(".linkedin.verified").html(a.values[0].firstName+
" "+a.values[0].lastName+" is now verified.");return $.ajax({url:myBaseUrl+"Verify/LinkedinVerify",type:"POST"})};b.SubmitEmail=function(){var a,c;a=$("#emailInput").val();if(-1===a.search(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i))alert("Email address is invalid");else if(a=a.substring(a.indexOf("@")+1),c=a.substring(a.indexOf(".")+1),"edu"===c.toLowerCase())return $("#emailEduVerified").toggleClass("unverified verified"),$("#emailEduVerified").html("Verified edu email ("+a.substring(0,a.length-
4).toLowerCase()+")")};return b}();A2Cribs.UtilityFunctions=function(){function b(){}b.getPosition=function(a){var c,d;for(d=c=0;a;)c+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent;return{x:c,y:d}};b.GetFormattedDate=function(a){var c,d;d=a.getUTCFullYear();c=a.getMonth()+1;a=a.getDate();return d+"-"+c+"-"+a};b.getDateRange=function(a,c){Date.prototype.addDays=function(a){var c=new Date(this.valueOf());c.setDate(c.getDate()+a);return c};var d,e;e=[];for(d=a;d<=c;)e.push(d),d=d.addDays(1);return e};
return b}();A2Cribs.PhotoPicker=function(){function b(){}var a;b.MAX_CAPTION_LENGTH=25;b.MAX_PHOTOS=24;b.MAX_FILE_SIZE=5E6;a=function(){function a(c,e,g){this.index=c;null==g&&(g=null);this.Resolve=B(this.Resolve,this);null!=g?(this.SetPreview(e),g.done(this.Resolve)):(this._image_id=e.image_id,this.SaveCaption(e.caption),this._is_primary=e.is_primary,this._path=e.image_path,this._listing_id=e.listing_id)}a.prototype.SetPreview=function(a){this.preview=a};a.prototype.Resolve=function(a){console.log(a.result);
this._image_id=a.result.image_id;this._path=a.result.image_path;return this._listing_id=a.result.listing_id};a.prototype.Edit=function(){return $(".image-row").trigger("edit_image",[this.index])};a.prototype.Delete=function(){this.DeleteDeferred=null;null!=this._image_id&&(this.DeleteDeferred=$.ajax({url:myBaseUrl+"images/delete/"+this._image_id,type:"GET"}));return $(".image-row").trigger("delete_image",[this.index])};a.prototype.MakePrimary=function(){this._is_primary=!0;return this.div.find(".primary").addClass("cur-primary")};
a.prototype.UnsetPrimary=function(){this._is_primary=!1;return this.div.find(".primary").removeClass("cur-primary")};a.prototype.IsPrimary=function(){return null!=this._is_primary?this._is_primary:!1};a.prototype.GetPreview=function(){var a,c;if(null!=this.preview)return c=document.createElement("canvas"),a=c.getContext("2d"),c.width=this.preview.width,c.height=this.preview.height,a.drawImage(this.preview,0,0),c;a=this._path.split("/");return $("<img src='/"+a[0]+"/"+a[1]+"/med_"+a[2]+"'>")};a.prototype.GetCaption=
function(){return null!=this._caption?this._caption:""};a.prototype.SaveCaption=function(a){this._caption=a};a.prototype.GetObject=function(){return{image_id:this._image_id,caption:this.GetCaption(),is_primary:+this.IsPrimary(),image_path:this._path,listing_id:this._listing_id}};a.prototype.GetHtml=function(){var a,c=this;null==this.div&&(this.div=$('<div id="prev_'+this.index+'" class="imageContainer span6">\n\t<div class="imageContent imageThumb"></div>\n\t<div class = \'image-actions-container\'>\n\t\t<i class="delete icon-trash"></i>\n\t\t<i class="edit icon-edit"></i>\n\t\t<i class="primary icon-asterisk"></i>\n\t</div>\n</div>'),
null!=this.preview?this.div.find(".imageContent").html(this.preview):(a=this._path.split("/"),this.div.find(".imageContent").html("<img src='/"+a[0]+"/"+a[1]+"/med_"+a[2]+"'>")),this.div.find(".delete").click(function(){return c.Delete()}),this.div.find(".edit, .imageContent").click(function(){return c.Edit()}),this.div.find(".primary").click(function(){return $(".image-row").trigger("set_primary",[c.index])}),this.div.find(".delete").tooltip({selector:"",placement:"bottom",title:"Delete"}),this.div.find(".edit").tooltip({selector:"",
placement:"bottom",title:"Edit"}),this.div.find(".primary").tooltip({selector:"",placement:"bottom",title:"Make Primary"}));return this.div};return a}();b.SetupUI=function(c){var d=this;this.div=c;this.Reset();this.div.find(".image-row").on("delete_image",function(a,c){return d.Delete(c)});this.div.find(".image-row").on("edit_image",function(a,c){return d.Edit(c)});this.div.find(".image-row").on("set_primary",function(a,c){return d.MakePrimary(c)});this.div.find("#upload_image").click(function(){return d.div.find("#real-file-input").click()});
this.div.find("#captionInput").keyup(function(){var a;a=d.div.find("#captionInput").val();a.length>=d.MAX_CAPTION_LENGTH?d.div.find("#charactersLeft").css("color","red"):d.div.find("#charactersLeft").css("color","black");d.div.find("#charactersLeft").html(d.MAX_CAPTION_LENGTH-a.length);return d._photos[d.CurrentPreviewImage].SaveCaption(a)});return this.div.find("#ImageAddForm").fileupload({url:myBaseUrl+"images/AddImage",dataType:"json",acceptFileTypes:/(\.|\/)(jpeg|jpg|png)$/i,singleFileUploads:!0,
maxFileSize:this.MAX_FILE_SIZE,loadImageMaxFileSize:this.MAX_FILE_SIZE,disableImageResize:!1,previewMaxWidth:300,previewMaxHeight:300,previewCrop:!0}).on("fileuploadadd",function(a,c){if(24===d._photos.size)return A2Cribs.UIManager.Error("Sorry but Cribspot only allows for 24 pictures!"),!1}).on("fileuploadprocessalways",function(c,g){var b;b=g.files[g.index];if(null!=b.error)return A2Cribs.UIManager.Error("Sorry - "+b.error),!1;if(null!=b.preview)return d.CurrentUploadDeferred=$.Deferred(),d.div.find("#upload_image").button("loading"),
d.CurrentUploadDeferred.always(function(){return d.div.find("#upload_image").button("reset")}),d.AddPhoto(new a(d._photos.next_id,b.preview,d.CurrentUploadDeferred))}).on("fileuploaddone",function(a,c){var b;return null!=(null!=(b=c.result)?b.error:void 0)?(A2Cribs.UIManager.Error(c.result.error),d.CurrentUploadDeferred.reject()):d.CurrentUploadDeferred.resolve(c)}).on("fileuploadfail",function(a,c){A2Cribs.UIManager.Error("Sorry something went wrong. Please retry photo upload.");return d.CurrentUploadDeferred.reject()})};
b.Open=function(a){this.Load(a);this.div.modal("show");this.PhotoPickerDeferred=$.Deferred();return this.PhotoPickerDeferred.promise()};b.Load=function(c){var d,e,g,b,h=this;this.Reset();if(null!=(null!=c?c.length:void 0)){g=0;for(b=c.length;g<b;g++)d=c[g],this.AddPhoto(new a(this._photos.next_id,d));d=this._photos;for(e in d)c=d[e],null!=c.IsPrimary&&c.IsPrimary()&&$(".image-row").trigger("set_primary",[c.index])}return this.div.find("#finish_photo").unbind("click").click(function(){var a;"pending"===
(null!=(a=h.CurrentUploadDeferred)?a.state():void 0)&&A2Cribs.UIManager.Success("Cribspot is still uploading your images. We'll be done in just a moment.");return $.when(h.CurrentUploadDeferred).then(function(a){h.div.modal("hide");return h.PhotoPickerDeferred.resolve(h.GetPhotos())})})};b.Edit=function(a){this.CurrentPreviewImage=a;this.div.find("#imageContent0").html(this._photos[a].GetPreview());this.div.find("#captionInput").val(this._photos[a].GetCaption());return this.div.find("#charactersLeft").html(this.MAX_CAPTION_LENGTH-
this._photos[a].GetCaption().length)};b.Reset=function(){this.ResetMainPhoto();this.div.find(".image-row").empty();this.CurrentPrimaryImage=null;return this._photos={size:0,next_id:0}};b.MakePrimary=function(a){null!=this.CurrentPrimaryImage&&this._photos[this.CurrentPrimaryImage].UnsetPrimary();return this._photos[this.CurrentPrimaryImage=a].MakePrimary()};b.Delete=function(a){var d,e=this;d=this._photos[a];this.RemovePhoto(a);$.when(d.DeleteDeferred).done(function(a){return null==a||null!=a.error?
(A2Cribs.UIManager.Error("Photo could not be deleted!"),e.AddPhoto(d)):A2Cribs.UIManager.Success("Photo was successfully deleted!")}).fail(function(a){A2Cribs.UIManager.Error("Photo could not be deleted!");return e.AddPhoto(d)});if(this.CurrentPrimaryImage===a)return this.DefaultPrimaryPhoto()};b.AddPhoto=function(a){this._photos[this._photos.next_id]=a;this._photos.size+=1;this._photos.next_id+=1;this.div.find(".image-row").append(a.GetHtml());if(null==this.CurrentPrimaryImage)return this.DefaultPrimaryPhoto()};
b.RemovePhoto=function(a){this._photos.size-=1;this.CurrentPreviewImage===a&&(this.div.find("#imageContent0").html("<div class = 'img-place-holder'></div>"),this.div.find("#captionInput").val(""),this.div.find("#charactersLeft").text(this.MAX_CAPTION_LENGTH));delete this._photos[a];return this.div.find("#prev_"+a).fadeOut()};b.ResetMainPhoto=function(){this.div.find("#imageContent0").html("<div class = 'img-place-holder'></div>");this.div.find("#captionInput").val("");this.div.find("#charactersLeft").text(this.MAX_CAPTION_LENGTH);
return this.CurrentPreviewImage=null};b.DefaultPrimaryPhoto=function(){var a,d,e,g;this.CurrentPrimaryImage=null;e=this._photos;g=[];for(a in e)if(d=e[a],null!=d.MakePrimary){this.CurrentPrimaryImage=parseInt(a,10);d.MakePrimary();break}else g.push(void 0);return g};b.GetPhotos=function(){var a,d,e,g;e=[];g=this._photos;for(a in g)d=g[a],null!=d.GetObject&&e.push(d.GetObject());return e};$(document).ready(function(){if($("#picture-modal").length)return b.SetupUI($("#picture-modal"))});return b}.call(this);
A2Cribs.ShareManager=function(){function b(){}b.GetShareUrl=function(a,c,d,e,g){if(null===a||null===c||null===d||null===e||null===g)return null;c.split(" ").join("-");d.split(" ").join("-");a="https://cribspot.com/listing/"+a;A2Cribs.MixPanel.Event("Share",{type:"copy listing url"});return a};b.ShareListingOnFacebook=function(a,c,d,e,g,b,h){null==b&&(b=null);null==h&&(h=null);d=this.GetShareUrl(a,c,d,e,g);a="Check out this listing on Cribspot!";null===h?h=c:a=c;A2Cribs.MixPanel.Event("Share",{type:"listing on fb"});
c={method:"feed",link:d,picture:"https://s3-us-west-2.amazonaws.com/cribspot-img/upright_logo.png",name:h,caption:a};null!==b&&(c.description=b);return FB.ui(c)};b.ShareSubletOnFB=function(a,c,d){d="https://cribspot.com/listing/"+c.listing_id;A2Cribs.MixPanel.Event("Social share",{type:"facebook",element:"sublet",promotion:"completed sublet"});a={method:"feed",link:d,picture:"https://s3-us-west-2.amazonaws.com/cribspot-img/upright_logo.png",name:""+a.GetName()+" - Check out my sublet on Cribspot!",
caption:"I am subletting my place on Cribspot. Message me if you are interested.",description:c.description};return FB.ui(a,function(a){if(null!=a&&a.post_id)return A2Cribs.MixPanel.Event("Social share complete",{type:"facebook",element:"sublet",promotion:"completed sublet",post_id:a.post_id})})};b.ShareOnFacebook=function(){A2Cribs.MixPanel.Event("Social share",{type:"facebook",element:"header",promotion:"tell my friends"});return FB.ui({method:"feed",link:"https://cribspot.com/",picture:"https://s3-us-west-2.amazonaws.com/cribspot-img/upright_logo.png",
name:"Join Cribspot",caption:"It's a party!",description:"Make your life easier...use Cribspot. Search off-campus houses and apartments quickly."},function(a){if(null!=a&&a.post_id)return A2Cribs.MixPanel.Event("Social share complete",{type:"facebook",element:"header",promotion:"tell my friends",post_id:a.post_id})})};b.FBPromotion=function(){A2Cribs.MixPanel.Event("Social share",{type:"facebook",element:"header",promotion:"wisconsin sunglasses"});return FB.ui({method:"feed",link:"https://cribspot.com/",
picture:"https://lh4.googleusercontent.com/-JCwU1KBqw1I/UnAMzgSnPeI/AAAAAAAAAIA/ySQHQfwYGFA/w726-h545-no/sunglasses.jpg",name:"Free Shades for Wisconsin Students!",caption:"You're gonna need to protect your eyes - your off-campus housing search is now looking pretty bright.",description:"To celebrate our recent launch at University of Wisconsin-Madison, we're giving away 5 pairs of these awesome sunglasses! Offer only valid for Wisconsin students - just share this post to qualify! We'll notify the winners on Thursday, October 31st."},
function(a){if(null!=a&&a.post_id)return A2Cribs.MixPanel.Event("Social share complete",{type:"facebook",element:"header",promotion:"wisconsin sunglasses",post_id:a.post_id})})};b.CopyListingUrl=function(a,c,d,e,g){a=this.GetShareUrl(a,c,d,e,g);return window.prompt("Copy to clipboard: Ctrl+C, Enter",a)};b.ShareSubletOnTwitter=function(a){a=this.GetTwitterShareUrl(a);A2Cribs.MixPanel.Event("Social share",{type:"twitter",element:"sublet",promotion:"completed sublet"});return window.open(a,"winname",
"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=600,height=350,top="+(screen.height/2-175)+",left="+(screen.width/2-300))};b.ShareListingOnTwitter=function(a,c,d,e,g){a=this.GetTwitterShareUrl(a);A2Cribs.MixPanel.Event("Share",{type:"listing on twitter"});return window.open(a,"winname","directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=600,height=350,top="+(screen.height/2-175)+",left="+
(screen.width/2-300))};b.GetTwitterShareUrl=function(a){return"https://twitter.com/share?url="+encodeURIComponent("https://cribspot.com/listing/"+a)+"&text="+encodeURIComponent("Check out this listing on Cribspot!")+"&via=TheCribspot"};b.InitTweetButton=function(a,c,d,e,g){if(null===a||null===c||null===d||null===e||null===g)return null;a=this.GetShareUrl(a,c,d,e,g);$("#twitterDiv iframe").remove();a=$("<a></a>").addClass("twitter-share-button").attr("href","https://twitter.com/share").attr("data-url",
a).attr("data-text","Check out this awesome property on Cribspot.com! "+a).attr("data-via","TheCribspot");$("#twitterDiv").append(a);return twttr.widgets.load()};b.EmailInvite=function(a){return $.ajax({url:myBaseUrl+"Invitations/InviteFriends",type:"POST",data:{emails:a}})};b.ShowShareModal=function(a,c,d){var e=this;A2Cribs.MixPanel.Event("Invite Friends started",null);return"undefined"!==typeof FB&&null!==FB?FB.getLoginStatus(function(g){return"unknown"===g.status?($("#email_invite").modal("show"),
$("#email_invite").find(".modal_subject").text(a),$("#email_invite").find(".modal_message").text(c),$("#send_email_invite").unbind("click").click(function(a){var c;$("#send_email_invite").button("loading");c=[];$(".completed_roommate").find(".roommate_email").each(function(a,d){return c.push($(d).val())});e.EmailInvite(c).always(function(){$("#email_invite").modal("hide");return $("#send_email_invite").button("reset")});return A2Cribs.MixPanel.Event("Invite Friends completed",{"number of people":null!=
c?c.length:void 0,action:d,type:"email"})})):FB.ui({method:"apprequests",message:c},function(a){var c;return A2Cribs.MixPanel.Event("Invite Friends completed",{"number of people":null!=(c=a.to)?c.length:void 0,action:d,type:"facebook",fb_ids:JSON.stringify(a.to)})})}):void 0};$("#header").ready(function(){$(".share_on_fb").click(function(){return b.ShareOnFacebook()});return $(".promotion_on_fb").click(function(){return b.FBPromotion()})});$("#email_invite").ready(function(){$("#email_invite").on("keyup",
".roommate_email",function(a){if(/\S+@\S+\.\S+/.test($(a.currentTarget.parentElement).find(".roommate_email").val()))$(a.currentTarget.parentElement).addClass("completed_roommate");else return $(a.currentTarget.parentElement).removeClass("completed_roommate")});return $(".add_roommate").click(function(){var a;a=$("#email_invite").find(".roommate_email").last().data("roommate-count");a=$("<div class='roommate_row'><input data-roommate-count='"+(a+1)+"' class='roommate_email' type='email' placeholder='E.g. myhousem@te.com'><i class='icon-ok-sign'></i></div>");
return $("#email_invite").find(".email_invite_list").append(a)})});return b}.call(this);(function(){function b(){}$(document).ready(function(){return $("#map_region").on("map_initialized",function(a,c){return b.Init(c)})});b.Init=function(a){var c=this;this.template=$(".small-bubble:first").parent();this.InfoBubble=new InfoBubble({map:a,arrowStyle:0,arrowPosition:20,shadowStyle:0,borderRadius:5,arrowSize:17,borderWidth:0,disableAutoPan:!0,padding:0,disableAnimation:!0});this.InfoBubble.hideCloseButton();
this.InfoBubble.setBackgroundClassName("map_bubble");$("#map_region").on("marker_clicked",function(a,e){return c.Open(e)});$("#map_region").on("close_bubbles",function(){return c.Close()});return this.template.find(".close_button").attr("onclick","$('#map_region').trigger('close_bubbles');")};b.Open=function(a){$("#map_region").trigger("close_bubbles");if(null!=a)return a.IsVisible(!0),this.SetContent(a),this.InfoBubble.open(A2Cribs.Map.GMap,a.GMarker)};b.Refresh=function(){return this.InfoBubble.open()};
b.Close=function(){return this.InfoBubble.close()};b.SetContent=function(a){var c,d,e,g,b,h,k,l,m,n;h=A2Cribs.UserCache.GetAllAssociatedObjects("listing","marker",a.GetId());this.template.find(".building_type").text(a.GetBuildingType());this.template.find(".unit_div").empty();k=h.sort(function(a,c){var d,e;d=A2Cribs.UserCache.Get(A2Cribs.Map.ACTIVE_LISTING_TYPE,a.GetId());e=A2Cribs.UserCache.Get(A2Cribs.Map.ACTIVE_LISTING_TYPE,c.GetId());return null==d.rent&&null==e.rent?0:null!=d.rent&&null==e.rent?
1:null==d.rent&&null!=e.rent?-1:parseInt(d.rent,10)-parseInt(e.rent,10)});m=0;for(n=k.length;m<n;m++)if(a=k[m],a.InSidebar()||a.IsVisible())b=A2Cribs.UserCache.Get(A2Cribs.Map.ACTIVE_LISTING_TYPE,a.GetId()),c=function(){var a;a=[];for(g in h)a.push(g);return a}(),c.sort(function(a,c){return h[c]-h[a]}),d=b.beds,e="Beds",null==b.beds?d="??":0===parseInt(b.beds,10)?(d="Studio",e=""):1===parseInt(b.beds,10)&&(e="Bed"),c="unknown",null!=a.available&&!0===a.available?c="available":null!=a.available&&!0!==
a.available&&(c="leased"),l=$("<div />",{"class":"unit"}),l.attr("onclick","$('#map_region').trigger('listing_click', ["+a.GetId()+"])"),$("<div />",{"class":"dot "+c}).appendTo(l),$("<div />",{"class":"beds",text:d}).appendTo(l),$("<div />",{"class":"bed_desc",text:e}).appendTo(l),$("<div />",{"class":"rent",text:null!=b.rent&&0!==parseInt(b.rent,10)?"$"+b.rent:"Contact"}).appendTo(l),this.template.find(".unit_div").append(l);return this.InfoBubble.setContent(this.template.html())};b.resolveDate=
function(a,c){var d,e;e=a.split("-");d=c.split("-");return+e[1]+"/"+ +e[2]+"-"+ +d[1]+"/"+ +d[2]};return b}).call(this);(function(){function b(){}var a;b.OFFSET={TOP:-190,LEFT:140};b.PADDING=50;b.IsOpen=!1;$(document).ready(function(){return $("#map_region").on("map_initialized",function(a,d){return b.Init(d)})});a=function(a){var d;a=A2Cribs.UserCache.Get("listing",a);a=A2Cribs.UserCache.Get("marker",a.marker_id);d=null;null!=a&&null!=a.GMarker?d=a.GMarker.getPosition():null!=a&&new google.maps.LatLng(a.latitude,
a.longitude);if(null!==d)return a=b.ConvertLatLongToPixels(d),b.div.css("left",a.x+b.OFFSET.LEFT),b.div.css("top",a.y+b.OFFSET.TOP)};b.ConvertLatLongToPixels=function(a){var d,e,b;e=Math.pow(2,this.map.getZoom());d=new google.maps.LatLng(this.map.getBounds().getNorthEast().lat(),this.map.getBounds().getSouthWest().lng());d=this.map.getProjection().fromLatLngToPoint(d);b=this.map.getProjection().fromLatLngToPoint(a);a={};a.x=Math.floor((b.x-d.x)*e);a.y=Math.floor((b.y-d.y)*e);return a};b.Init=function(a){var d=
this;this.map=a;this.div=$(".large-bubble:first");google.maps.event.addListener(this.map,"center_changed",function(){return d.Close()});this.div.find(".close_button").click(function(){return d.Close()});$("#map_region").on("close_bubbles",function(){return d.Close()});$("#map_region").on("marker_clicked",function(a,c){var b;b=d.ConvertLatLongToPixels(c.GMarker.getPosition());b=d.GetAdjustedLargeBubblePosition(b.x,b.y);return d.map.panBy(b.x,b.y)});$("#map_region").on("listing_click",function(a,c){return d.Open(c)});
return this.div.draggable({revert:!0,opacity:0.7,cursorAt:{top:-12,right:-20},helper:function(a){a=$(this).find(".building_name").html()||"this listing";return $("<div class='listing-drag-helper'>Share "+a+"</div>")},start:function(a){var c;if(null!=(c=A2Cribs.Login)&&c.logged_in)return $("ul.friends, #hotlist").addClass("dragging"),A2Cribs.HotlistObj.startedDragging()},stop:function(a){$("ul.friends, #hotlist").removeClass("dragging");return A2Cribs.HotlistObj.stoppedDragging()},appendTo:"body"})};
b.Open=function(a){var d,e=this;this.IsOpen=!0;$("#map_canvas").trigger("click_bubble_open",[a]);d=new $.Deferred;null!=a&&($("#loader").show(),A2Cribs.UserCache.GetListing(A2Cribs.Map.ACTIVE_LISTING_TYPE,a).done(function(b){A2Cribs.MixPanel.Click(b,"large popup");e.SetContent(b.GetObject());e.Show(a);return d.resolve(a)}).fail(function(){return A2Cribs.UIManager.Error("Sorry - We could not find this listing!")}).always(function(){return $("#loader").hide()}));return d.promise()};b.Show=function(c){this.IsOpen=
!0;a(c);return this.div.show("fade")};b.Refresh=function(){return this.div.show("fade")};b.Close=function(){this.IsOpen=!1;return this.div.hide("fade")};b.Clear=function(){return this.div.find(".clear_field").text("?").html("?").val("?")};b.SetContent=function(a){var d,e,b;this.Clear();this.div.data("listing_id",a.listing_id);for(d in a)b=a[d],this.div.find("."+d).text(b);this.div.find(".start_date").text(this.resolveDateRange(a.start_date));null!=a.end_date?(this.div.find(".lease_length").text(this.resolveDateRange(a.end_date)),
this.div.find(".lease_box").hide(),this.div.find(".end_date_box").show()):(this.div.find(".end_date_box").hide(),this.div.find(".lease_box").show());e=A2Cribs.UserCache.Get("marker",A2Cribs.UserCache.Get("listing",a.listing_id).marker_id);this.div.find(".building_name").text(e.GetName());this.div.find(".unit_type").text(e.GetBuildingType());d="";null!=a.unit_style_options&&null!=a.unit_style_description?d=a.unit_style_options+"-"+a.unit_style_description:"Entire House"===a.unit_style_options&&(d=
"Entire House");this.div.find(".unit_style_description").text(d);this.setBeds(a.beds);this.linkWebsite(".website_link",a.website,a.listing_id);this.setRent(a.rent);this.setAvailability("available",a.available);this.setOwnerName("property_manager",a.listing_id);this.setPrimaryImage("property_image",a.listing_id);this.setFullPage("full_page_link",a.listing_id);this.setFullPageContact("full_page_contact",a.listing_id);this.setFullPageSchedule("schedule_tour",a.listing_id);this.div.find(".share_btn").unbind("click");
this.div.find(".facebook_share").click(function(){return A2Cribs.ShareManager.ShareListingOnFacebook(a.listing_id,e.street_address,e.city,e.state,e.zip,a.description,a.building_type_id)});this.div.find(".link_share").click(function(){return A2Cribs.ShareManager.CopyListingUrl(a.listing_id,e.street_address,e.city,e.state,e.zip)});this.div.find(".twitter_share").click(function(){return A2Cribs.ShareManager.ShareListingOnTwitter(a.listing_id,e.street_address,e.city,e.state,e.zip)});this.div.find(".hotlist_share").popover({content:function(){return A2Cribs.HotlistObj.getHotlistForPopup(a.listing_id)},
html:!0,trigger:"manual",container:"body",title:"Share this listing"}).click(function(a){a.preventDefault();$(this).popover("show");return $(".popover a").on("click",function(){$(".popover").popover("hide").hide();return $(".popover").off("click")}).find("#share-to-email").keyup(function(a){if(13===a.keyCode)return $(".share-to-email-btn").click()})});this.div.find(".favorite_listing").data("listing-id",a.listing_id);return A2Cribs.FavoritesManager.setFavoriteButton(this.div.find(".favorite_listing"),
a.listing_id)};b.resolveDateRange=function(a){var d;d="Unknown Start Date";null!=a&&(d="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),a=a.split("-"),d=""+d[+a[1]-1]+" "+parseInt(a[2],10)+", "+a[0]);return d};b.setAvailability=function(a,d){if(null==d)return this.div.find("."+a).hide();if(d)return this.div.find("."+a).show().text("Available"),this.div.find("."+a).removeClass("leased");this.div.find("."+a).show().text("Leased");return this.div.find("."+a).addClass("leased")};b.linkWebsite=
function(a,d,e){var b,f;b=A2Cribs.UserCache.Get("listing",e);null==b&&(b={});b.logged_in=null!=(f=A2Cribs.Login)?f.logged_in:void 0;return null!=d?this.div.find(a).unbind("click").click(function(){var a;if(!0===(null!=(a=A2Cribs.Login)?a.logged_in:void 0))return A2Cribs.MixPanel.Click(b,"go to realtor's website"),window.open("/listings/website/"+e,"_blank");$("#signup_modal").modal("show").find(".signup_message").text("Please signup to view this website");return A2Cribs.MixPanel.Event("login required",
{listing_id:e,action:"go to realtor's website"})}):this.div.find(a).unbind("click").click(function(){return A2Cribs.UIManager.Error("This owner does not have a website for this listing")})};b.setRent=function(a){if(null==a)return this.div.find(".rent").text("Ask for Rent"),this.div.find(".per_month").text(""),this.div.find(".price_label").text("");if(0!==parseInt(a,10))return this.div.find(".rent").text(a),this.div.find(".per_month").text("/m"),this.div.find(".price_label").text("$");this.div.find(".rent").text("Call for Rent");
this.div.find(".per_month").text("");return this.div.find(".price_label").text("")};b.setOwnerName=function(a,d){var e;e=A2Cribs.UserCache.Get("listing",d);e=A2Cribs.UserCache.Get("user",e.user_id);null!=(null!=e?e.company_name:void 0)?$("."+a).show().text(e.company_name):null!=(null!=e?e.first_name:void 0)&&e.last_name?$("."+a).show().text(""+e.first_name):$("."+a).hide();return null!=e&&e.verified?this.div.find(".verified").show():this.div.find(".verified").hide()};b.setPrimaryImage=function(a,
d){var e;if(null!=A2Cribs.UserCache.Get("image",d)){if(e=A2Cribs.UserCache.Get("image",d).GetPrimary(),null!=e&&null!=a)return e=this._processImagePath(e),$("."+a).css("background-image","url(/"+e+")")}else if(null!=a)return $("."+a).css("background-image","url(/img/tooltip/no_photo.jpg)")};b._processImagePath=function(a){var d;d=a.substr(0,a.lastIndexOf("/"));a="med_"+a.substr(a.lastIndexOf("/")+1);return d+"/"+a};b.setFullPage=function(a,d){$("."+a).unbind("click");return $("."+a).click(function(){A2Cribs.MixPanel.Click(A2Cribs.UserCache.Get("listing",
d),"full page");return window.open("/listings/view/"+d,"_blank").focus()})};b.setFullPageContact=function(a,d){$("."+a).unbind("click");return $("."+a).click(function(){return window.open("/messages/contact/"+d,"_blank").focus()})};b.setFullPageSchedule=function(a,d){var e;e=A2Cribs.UserCache.Get("listing",d);!0===(null!=e?e.available:void 0)?$("."+a).show():$("."+a).hide();$("."+a).unbind("click");return $("."+a).click(function(){return window.open("/tours/schedule/"+d,"_blank").focus()})};b.setBeds=
function(a){if(null==a||NaN===parseInt(a,10))return this.div.find(".beds").text("??"),this.div.find(".bed_desc").text("Beds");if(0===parseInt(a,10))return this.div.find(".beds").text("Studio"),this.div.find(".bed_desc").text("");if(1===parseInt(a,10))return this.div.find(".bed_desc").text(a),this.div.find(".bed_desc").text("Bed");this.div.find(".bed_desc").text(a);return this.div.find(".bed_desc").text("Beds")};b.GetAdjustedLargeBubblePosition=function(a,d){var e,b,f,h,k,l,m;l=d+this.OFFSET.TOP;m=
d+this.OFFSET.TOP+$(".large-bubble").height();k=a+this.OFFSET.LEFT+$(".large-bubble").width();h={x:0,y:0};b=$("#map_region").width();e=$(window).height()-5;f=$("#map_filter").offset().top;l<f+this.PADDING&&(h.y=l-(f+this.PADDING));m>e-this.PADDING&&(h.y=m-(e-this.PADDING));k>b-this.PADDING&&(h.x=k-(b-this.PADDING));return h};return b}).call(this);A2Cribs.Cache=function(){function b(){}b.IdToSubletMap=[];b.IdToMarkerMap=[];b.IdToUniversityMap=[];b.IdToHousematesMap=[];b.SubletIdToHousemateIdsMap=[];
b.SubletIdToOwnerMap=[];b.SubletIdToImagesMap=[];b.MarkerIdToHoverDataMap=[];b.MarkerIdToSubletIdsMap=[];b.IdToMarkerMap=[];b.AddressToMarkerIdMap=[];b.BuildingIdToNameMap=[];b.BathroomIdToNameMap=[];b.GenderIdToNameMap=[];b.StudentTypeIdToNameMap=[];b.FavoritesSubletIdsList=[];b.FavoritesMarkerIdsList=[];b.IdToRentalMap=[];b.IdToParkingMap=[];b.ListingIdToUserMap=[];b.SubletEditInProgress=null;b.CacheSublet=function(a){var c,d;a.id=parseInt(a.id);a.marker_id=parseInt(a.marker_id);this.MarkerIdToSubletIdsMap[parseInt(a.marker_id)].push(a.id);
a.number_bedrooms=parseInt(a.number_bedrooms);a.price_per_bedroom=parseInt(a.price_per_bedroom);a.number_bedrooms=parseInt(a.number_bedrooms);a.utility_cost=parseInt(a.utility_cost);a.deposit_amount=parseInt(a.deposit_amount);a.additional_fees_amount=parseInt(a.additional_fees_amount);a.marker_id=parseInt(a.marker_id);a.furnished_type_id=parseInt(a.furnished_type_id);d=this.IdToMarkerMap[a.marker_id].UnitType;a.bathroom_type_id=parseInt(a.bathroom_type_id);c=this.BathroomIdToNameMap[a.bathroom_type_id];
a.university_id=parseInt(a.university_id);return this.IdToSubletMap[a.id]=new A2Cribs.Sublet(a.id,a.university_id,d,a.name,a.street_address,a.city,a.state,a.date_begin,a.date_end,a.number_bedrooms,a.price_per_bedroom,a.short_description,c,a.utility_cost,a.deposit_amount,a.additional_fees_description,a.additional_fees_amount,a.marker_id,a.flexible_dates,a.furnished_type_id,a.created,a.ac,a.parking)};b.CacheMarkerIdToSubletsList=function(a){var c,d,e,b;A2Cribs.Map.MarkerIdToSubletIdsMap[parseInt(a[0].Sublet.marker_id)]=
[];b=[];d=0;for(e=a.length;d<e;d++)c=a[d],void 0!==c&&b.push(this.MarkerIdToSubletIdsMap[parseInt(c.Sublet.marker_id)].push(parseInt(c.Sublets.sublet_id)));return b};b.CacheUniversity=function(a){var c;if(null!==a)return c=parseInt(a.id),this.IdToUniversityMap[c]=new A2Cribs.University(a.city,a.domain,a.name,a.state)};b.CacheHoverData=function(a){var c,d,e,b,f,h,k,l,m,n,p,q,r,s;d=[];b=0;for(f=a.length;b<f;b++)c=a[b],e=null,null!==c&&(e=parseInt(c.Sublet.marker_id),void 0!==this.IdToMarkerMap[e]&&
(void 0===d[e]&&(d[e]=[]),d[e].push(c)));for(e in d){a=d[e];n=a.length;p=a[0].Sublet;if(void 0===p||null===p)break;q=this.IdToMarkerMap[e].UnitType;k=parseInt(p.number_bedrooms);b=parseInt(p.number_bedrooms);m=parseInt(p.price_per_bedroom);h=parseInt(p.price_per_bedroom);l=p.date_begin;f=p.date_end;r=0;for(s=a.length;r<s;r++)c=a[r],p=c.Sublet,parseInt(p.building_type_id),c=parseInt(p.number_bedrooms),p=parseInt(p.price_per_bedroom),c<k&&(k=c),c>b&&(b=c),p<m&&(m=p),p>h&&(h=p);c=new A2Cribs.HoverData(n,
q,k,b,m,h,l,f);this.MarkerIdToHoverDataMap[e]=c}};b.CacheHousemates=function(a){var c,d,e,b,f;if(null!=a&&null!=a.sublet_id)return f=parseInt(a.sublet_id),this.SubletIdToHousemateIdsMap[f]=[],e=parseInt(a.id),d=this.StudentTypeIdToNameMap[parseInt(a.student_type_id)],c=this.GenderIdToNameMap[parseInt(a.gender_type_id)],f=parseInt(a.sublet_id),b=parseInt(a.quantity),this.IdToHousematesMap[e]=new A2Cribs.Housemate(f,a.enrolled,a.major,a.seeking,d,c,b),this.SubletIdToHousemateIdsMap[f].push(e)};b.CacheImages=
function(a){var c,d,e,b,f,h,k;if(!(void 0===a||null===a||void 0===a[0]))if(d=a[0],!(void 0===d||void 0===d.sublet_id)){b=parseInt(d.sublet_id);A2Cribs.Cache.SubletIdToImagesMap[b]=[];k=[];f=0;for(h=a.length;f<h;f++)c=a[f],b=parseInt(c.sublet_id),e="/"+c.image_path,d=c.is_primary,c=c.caption,k.push(A2Cribs.Cache.SubletIdToImagesMap[b].push(new A2Cribs.Image(b,e,d,c)));return k}};b.CacheMarker=function(a,c){var d;d=this.BuildingIdToNameMap[parseInt(c.building_type_id)];return this.IdToMarkerMap[a]=
new A2Cribs.Marker(parseInt(a),c.street_address,c.alternate_name,d,c.latitude,c.longitude,c.city,c.state)};b.CacheSubletOwner=function(a,c){var d;d=new A2Cribs.SubletOwner(c);return this.SubletIdToOwnerMap[a]=d};b.CacheMarkerData=function(a){var c,d,e,b,f;void 0!==a[0]&&void 0!==a[0].Sublet&&(c=parseInt(a[0].Sublet.marker_id),this.MarkerIdToSubletIdsMap[c]=[]);f=[];e=0;for(b=a.length;e<b;e++)c=a[e],d=c.Sublet,A2Cribs.Cache.CacheSublet(d),A2Cribs.Cache.CacheHousemates(c.Housemate),A2Cribs.Cache.CacheSubletOwner(parseInt(d.id),
c.User),f.push(A2Cribs.Cache.CacheImages(c.Image));return f};b.CacheSubletAddStep1=function(a){return A2Cribs.Cache.Step1Data=a};b.CacheSubletAddStep2=function(a){return A2Cribs.Cache.Step2Data=a};b.CacheSubletAddStep3=function(a){return A2Cribs.Cache.Step3Data=a};b.AddRental=function(a){a.air=parseInt(a.air);a.beds=parseInt(a.beds);a.baths=parseInt(a.baths);a.building_type=parseInt(a.building_type);a.cable=parseInt(a.cable);a.deposit=parseInt(a.deposit);a.electric=parseInt(a.electric);a.furnished_type=
parseInt(a.furnished_type);a.gas=parseInt(a.gas);a.heat=parseInt(a.heat);a.internet=parseInt(a.internet);a.listing_id=parseInt(a.listing_id);a.min_occupancy=parseInt(a.min_occupancy);a.max_occupancy=parseInt(a.max_occupancy);a.parking_spots=parseInt(a.parking_spots);a.parking_type=parseInt(a.parking_type);a.pets_type=parseInt(a.pets_type);a.rent=parseInt(a.rent);a.rental_id=parseInt(a.rental_id);a.sewage=parseInt(a.sewage);a.square_feet=parseInt(a.square_feet);a.trash=parseInt(a.trash);a.unit_style_options=
parseInt(a.unit_style_options);a.utility_estimate_summer=parseInt(a.utility_estimate_summer);a.utility_estimate_winter=parseInt(a.utility_estimate_winter);a.water=parseInt(a.water);a.year_built=parseInt(a.year_built);return this.IdToRentalMap[a.rental_id]=a};b.AddParking=function(a){return this.IdToParkingMap[parseInt(a.parking_id)]=a};b.AddUser=function(a,c){return this.ListingIdToUserMap[a]=c};b.AddListing=function(a){if(!(void 0===a||null===a))return void 0!==a.Rental?this.AddRental(a.Rental):
void 0!==a.Parking&&this.AddParking(a.Parking),this.AddUser(parseInt(a.Listing.listing_id),a.User)};b.GetListing=function(a){var c;if(0<=z.call(this.IdToRentalMap,a))return this.IdToRentalMap[a];c=null;$.ajax({url:myBaseUrl+"Listings/GetListing/"+a,type:"GET",context:this,async:!1,success:function(a){c=JSON.parse(a);return this.AddListing(c[0])}});return null!==c?c[0]:null};b.GetListingsByLoggedInUser=function(){var a;a=null;$.ajax({url:myBaseUrl+"Listings/GetListingsByLoggedInUser",type:"GET",context:this,
async:!1,success:function(c){var d,e,b;a=JSON.parse(c);b=[];d=0;for(e=a.length;d<e;d++)c=a[d],b.push(this.AddListing(c));return b}});return a};return b}();A2Cribs.Housemate=function(){return function(b,a,c,d,e,g,f){this.SubletId=b;this.Enrolled=a;this.Major=c;this.Seeking=d;this.GradType=e;this.Gender=g;this.Quantity=f}}();A2Cribs.UIManager=function(){function b(){}b._num_loaders=0;b.ShowLoader=function(a){this._num_loaders++;return $("#loader").show()};b.HideLoader=function(a){if(0===--this._num_loaders)return $("#loader").hide()};
b.Alert=function(a){return alertify.alert(a)};b.Error=function(a){return alertify.error(a,7E3)};b.Success=function(a){return alertify.success(a)};b.CloseLogs=function(){return $(".alertify-log").remove()};b.FlashMessage=function(){if("undefined"!==typeof flash_message&&null!==flash_message)return this[flash_message.method](flash_message.message,flash_message.callback)};b.Confirm=function(a,c){alertify.set({buttonFocus:"cancel"});return alertify.confirm(a,c)};b.ConfirmBox=function(a,c,d){alertify.set({labels:c,
buttonFocus:"cancel"});return alertify.confirm(a,d)};return b}();$(document).ready(function(){return setTimeout(function(){return A2Cribs.UIManager.FlashMessage()},2E3)});A2Cribs.Image=function(b){function a(a,d){var e,b,f,h,k;null==d&&(d=null);null!=d&&(this.listing_id=d,this.class_name="image",this.image_array=a);if(0!==a.length){this.class_name="image";k=this.image_array=a;e=f=0;for(h=k.length;f<h;e=++f)b=k[e],b.is_primary&&(this.primary=e);this.listing_id=this.image_array[0].listing_id}}x(a,b);
a.prototype.GetId=function(){return this.listing_id};a.prototype.GetPrimary=function(a){null==a&&(a="image_path");if(null!=this.primary)return this.image_array[this.primary][a];if(0!==this.image_array.length)return this.image_array[0][a]};a.prototype.GetImages=function(){return this.image_array};a.prototype.GetObject=function(){var a,d,e,b,f,h,k,l;b=[];l=this.image_array;h=0;for(k=l.length;h<k;h++){a=l[h];d={};for(e in a)f=a[e],"function"!==typeof f&&("boolean"===typeof f&&(f=+f),d[e]=f);b.push(d)}return b};
return a}(A2Cribs.Object);A2Cribs.Rental=function(b){function a(c){var d,e,b,f;a.__super__.constructor.call(this,"rental",c);d=["start_date","end_date","alternate_start_date"];b=0;for(f=d.length;b<f;b++)if(c=d[b],this[c]&&-1!==(e=this[c].indexOf(" ")))this[c]=this[c].substring(0,e)}x(a,b);a.UNIT_STYLE=["Unit","Layout","Entire House"];a.prototype.GetUnitStyle=function(){return A2Cribs.Rental.UNIT_STYLE[this.unit_style_options]};a.prototype.GetId=function(){return parseInt(this.listing_id,10)};a.prototype.IsComplete=
function(){return null!=this.rental_id?!0:!1};a.Required_Fields={};return a}(A2Cribs.Object);A2Cribs.FilterManager=function(){function b(){}b.UpdateListings=function(a){var c,d,e,b,f;d=JSON.parse(a);a=[];$("#map_region").trigger("close_bubbles");c=A2Cribs.UserCache.Get("listing");b=0;for(f=c.length;b<f;b++)e=c[b],e.visible=!1;c={};b=0;for(f=d.length;b<f;b++)e=d[b],e=A2Cribs.UserCache.Get("listing",e),null!=e&&(e.visible=!0,a.push(e.listing_id),c[+e.marker_id]=!0);d=A2Cribs.UserCache.Get("marker");
b=0;for(f=d.length;b<f;b++)e=d[b],c[+e.marker_id]?e.GMarker.setVisible(!0):e.GMarker.setVisible(!1);A2Cribs.FeaturedListings.UpdateSidebar(a);return A2Cribs.Map.Repaint()};b.InitAddressSearch=function(){return A2Cribs.FilterManager.Geocoder=new google.maps.Geocoder};b.SearchForAddress=function(a){var c;null==A2Cribs.FilterManager.Geocoder&&(A2Cribs.FilterManager.Geocoder=new google.maps.Geocoder);c=$(a).val();A2Cribs.Map.GMap.getCenter();return A2Cribs.FilterManager.Geocoder.geocode({address:c+" "+
A2Cribs.FilterManager.CurrentCity+", "+A2Cribs.FilterManager.CurrentState},function(c,e){return e===google.maps.GeocoderStatus.OK&&"postal_code"!==c[0].types[0]?($(a).effect("highlight",{color:"#5858FA"},2E3),A2Cribs.Map.GMap.panTo(c[0].geometry.location),A2Cribs.Map.GMap.setZoom(18)):$(a).effect("highlight",{color:"#FF0000"},2E3)})};return b}();A2Cribs.RentalFilter=function(b){function a(){return P=a.__super__.constructor.apply(this,arguments)}var c;x(a,b);a.FilterData={};c=function(a,c){var b;b=
$(a).closest(".filter_content").attr("data-link");return $(b).find(".filter_preview").html(c)};a.CreateListeners=function(){var a=this;$("#filter_search_content").keyup(function(a){if(13===a.keyCode)return A2Cribs.FilterManager.SearchForAddress(a.delegateTarget),$(a.delegateTarget).select()});this.div.find(".lease_slider").on("slideStop",function(c){return a.ApplyFilter("LeaseRange",{min:parseInt(c.value[0],10),max:parseInt(c.value[1],10)})});this.div.find(".rent_slider").on("slideStop",function(c){return a.ApplyFilter("Rent",
{min:parseInt(c.value[0],10),max:parseInt(c.value[1],10)})});this.div.find("#bed_filter").find(".btn").click(function(e){var b,f,h;h=[];f=1E3;b=-1;$(e.delegateTarget).toggleClass("active");$(e.delegateTarget).parent().find(".btn.active").each(function(){var a;a=parseInt($(this).val(),10);h.push(a);f=Math.min(f,a);return b=Math.max(b,a)});if(0===h.length)return c(e.delegateTarget,""),a.ApplyFilter("Beds",null);a.ApplyFilter("Beds",h);return 1===h.length?c(e.delegateTarget,0===f?"<div class='filter_data'>Studio</div>":
1===f?"<div class='filter_data'>"+f+"</div><div class='filter_label'>&nbsp;bed</div>":"<div class='filter_data'>"+f+"</div><div class='filter_label'>&nbsp;beds</div>"):c(e.delegateTarget,"<div class='filter_data'>"+f+"-"+b+"</div><div class='filter_label'>&nbsp;beds</div>")});this.div.find("#year_filter").change(function(c){var b;b=a.FilterData.Dates;c=$(c.delegateTarget).val();return null!=b?(b.year=c,a.ApplyFilter("Dates",b)):a.ApplyFilter("Dates",{months:[],year:c})});this.div.find("#start_filter").find(".btn").click(function(e){var b,
f,h;h=[];$(e.delegateTarget).toggleClass("active");b=$(e.delegateTarget).parent();f="";b.find(".btn.active").each(function(){h.push($(this).attr("data-month"));return f=$(this).text()});if(0===h.length)return c(e.delegateTarget,""),a.ApplyFilter("Dates",null);a.ApplyFilter("Dates",{months:h,year:a.div.find("#year_filter").val()});return 1===h.length?c(e.delegateTarget,"<div class='filter_data'>"+f+"</div><div class='filter_label'>&nbsp;start</div>"):c(e.delegateTarget,"<div class='filter_data'>"+
h.length+"</div><div class='filter_label'>&nbsp;starts</div>")});this.div.find("input[type='checkbox']").change(function(e){var b,f,h;f=$(e.target).closest(".filter_content");b=$(e.delegateTarget).attr("data-filter");h=[];f.find("input[type='checkbox']").each(function(){if(this.checked)return h.push($(this).attr("data-value"))});"UnitTypes"===b?a.ApplyFilter(b,h):a.ApplyFilter(b,+e.delegateTarget.checked);return 0===h.length?c(e.delegateTarget,""):-1===f.attr("id").indexOf("more")?1===h.length?c(e.delegateTarget,
"<div class='filter_data'>"+h.length+"</div><div class='filter_label'>&nbsp;type</div>"):c(e.delegateTarget,"<div class='filter_data'>"+h.length+"</div><div class='filter_label'>&nbsp;types</div>"):c(e.delegateTarget,"<div class='filter_data'>"+h.length+"</div><div class='filter_label'>&nbsp;more</div>")});return this.div.find(".hidden_input").change(function(c){var b,f;console.log(c.currentTarget.value);b=a.GetBackendDateFormat(c.currentTarget.value);f=$(c.currentTarget).data("filter");a.ApplyFilter(f,
b);b=c.currentTarget.value.split("/");if(-1!==f.indexOf("Start"))return $(c.currentTarget).parent().find(".filter_title").text("Starts: "+b[0]+"/"+b[1]);if(-1!==f.indexOf("End"))return $(c.currentTarget).parent().find(".filter_title").text("Ends: "+b[0]+"/"+b[1])})};a.SetupUI=function(){var a=this;this.div=$("#map_filter");$(".hidden_input").datepicker({onClose:function(a){return $(".filter_link").removeClass("active")}});$("#start_date_filter_link, #end_date_filter_link").click(function(a){return $(a.currentTarget).find(".hidden_input").datepicker("show")});
$("#filter_search_btn").click(function(){if($("#filter_search_content").is(":visible"))return $("#filter_search_content").hide("slide",{direction:"left"},300);$("#filter_search_content").show("slide",{direction:"left"},300);return $("#filter_search_content").focus()});this.div.find(".lease_slider").slider({min:0,max:12,step:1,value:[0,12],tooltip:"hide"}).on("slide",function(e){var b;b=1<e.value[1]?"&nbsp;months":"&nbsp;month";a.div.find("#lease_min").text(e.value[0]);a.div.find("#lease_min_desc").html(1<
e.value[0]?"&nbsp;months":"&nbsp;month");a.div.find("#lease_max").text(e.value[1]);a.div.find("#lease_max_desc").html(b);return e.value[0]===e.value[1]?c(e.delegateTarget,"<div class='filter_data'>"+e.value[0]+"</div><div class='filter_label'>"+b+"</div>"):c(e.delegateTarget,"<div class='filter_data'>"+e.value[0]+"-"+e.value[1]+"</div><div class='filter_label'>"+b+"</div>")});this.div.find(".rent_slider").slider({min:0,max:5E3,step:100,value:[0,5E3],tooltip:"hide"}).on("slide",function(e){var b,f;
f="$"+e.value[0];b=5E3===e.value[1]?"$"+e.value[1]+"+":"$"+e.value[1];a.div.find("#rent_min").text(f);a.div.find("#rent_max").text(b);return c(e.delegateTarget,"<div class='filter_data'>"+f+"-"+b+"</div>")});this.div.find(".filter_link").click(function(c){var b,f;b=$(c.delegateTarget).attr("data-filter");f=a.div.find(".filter_link.active");a.div.find(".filter_link").removeClass("active");f.length&&f.find(".filter_preview").html().length&&(f.find(".filter_title").hide(),f.find(".filter_preview").show());
$(f).attr("id")!==$(c.delegateTarget).attr("id")&&($(c.delegateTarget).addClass("active"),$(c.delegateTarget).find(".filter_preview").hide(),$(c.delegateTarget).find(".filter_title").show());return a.div.find("#filter_dropdown").slideUp("fast",function(){a.div.find(".filter_content").hide();if($(f).attr("id")!==$(c.delegateTarget).attr("id"))return a.div.find(b).show(),a.div.find("#filter_dropdown").slideDown()})});this.div.find("#rentals-filter-label").click(function(c){c=a.div.find(".filter_link.active");
a.div.find("#filter_dropdown").slideUp("fast");c.length&&c.find(".filter_preview").html().length&&(c.find(".filter_title").hide(),c.find(".filter_preview").show());return a.div.find(".filter_link").removeClass("active")});return this.CreateListeners()};a.ApplyFilter=function(a,c){var b,f,h,k;null!=c?this.FilterData[a]=c:delete this.FilterData[a];b="";f=!0;k=this.FilterData;for(h in k)c=k[h],f||(b+="&"),f=!1,b+=h+"="+JSON.stringify(c);$("#loader").show();return $.ajax({url:myBaseUrl+("Listings/ApplyFilter/"+
A2Cribs.FilterManager.ActiveListingType),data:b,type:"GET",context:this,success:A2Cribs.FilterManager.UpdateListings,complete:function(){return $("#loader").hide()}})};a.FilterVisibleListings=function(a){var c,b,f,h,k,l,m,n,p,q,r,s,u,v,t,w;l=A2Cribs.UserCache.GetAllAssociatedObjects("listing","marker",a);u=[];t=0;for(w=l.length;t<w;t++)k=l[t],p=FilterRent(k),b=FilterBeds(k),c=FilterBaths(k),f=FilterBuildingType(k),h=FilterDates(k),r=FilterUnitFeatures(k),m=FilterParking(k),n=FilterPets(k),a=FilterAmenities(k),
q=FilterSquareFeet(k),v=FilterYearBuilt(k),s=FilterUtilities(k),p&&(b&&c&&f&&h&&r&&m&&n&&a&&q&&v&&s)&&u.push(k);return u};a.GetBackendDateFormat=function(a){var c,b;a=new Date(a);b=a.getMonth()+1;10>b&&(b="0"+b);c=a.getDate();10>c&&(c="0"+c);return a.getUTCFullYear()+"-"+b+"-"+c};return a}(A2Cribs.FilterManager);A2Cribs.FLDash=function(){function b(a){var c=this;this.uiWidget=a;this.OrderStates={};this.ListingUniPricing={};this.FL_Order=null;this.uiFL_Form=$(".featured-listing-order-item").first();
this.uiListingsList=this.uiWidget.find("#listings_list");this.uiOrderItemsList=this.uiWidget.find("#orderItems_list");this.uiErrorsList=this.uiWidget.find("#validation-error-list");this.initTemplates();this.setupEventHandlers();$.when(A2Cribs.Dashboard.GetListings().then(function(){return c.loadListings()}))}b.prototype.setupEventHandlers=function(){var a=this;this.uiListingsList.on("mouseenter",".listing-item",function(a){$(a.currentTarget).find(".feature-star").removeClass("icon-star-empty");return $(a.currentTarget).find(".feature-star").addClass("icon-star")}).on("mouseleave",
".listing-item",function(a){$(a.currentTarget).find(".feature-star").removeClass("icon-star");return $(a.currentTarget).find(".feature-star").addClass("icon-star-empty")}).on("click",".listing-item",function(c){c=$(c.currentTarget).data("id");null==a.OrderStates[c]&&a.addOrderItem(c);return a.editOrderItem(c)}).on("click",".marker-info",function(a){a=$(a.currentTarget);a.siblings("ul").slideToggle("fast");return a.find("i").toggleClass("icon-plus").toggleClass("icon-minus")});this.uiOrderItemsList.on("click",
"a",function(c){var d;d=$(c.currentTarget);c=d.data("id");if(d.hasClass("edit"))return a.editOrderItem(c);if(d.hasClass("remove"))return a.removeOrderItem(c)});this.uiErrorsList.on("click",".icon-remove",function(c){c=$(c.currentTarget).parent().data("id");return a.removeErrors(c)});this.uiWidget.find("#buyNow").click(function(){return a.buy()});this.uiWidget.find(".feature-listing").click(function(){return a.featureListing()});this.uiFL_Form.on("orderItemChanged",function(c,d){var e;a.uiOrderItemsList.find(".orderItem[data-id="+
d.listing_id+"] .price").html(""+d.getPrice().toFixed(2));e=0;a.uiOrderItemsList.find(".price").each(function(a,c){return e+=Number($(c).html())});return a.uiOrderItemsList.siblings("tfoot").find(".total").html(""+e.toFixed(2))});return $("#fl-list-input").keyup(function(a){return $("#listings_list .marker-item").show().filter(function(){return-1===$(this).find(".marker-info").text().toLowerCase().indexOf($("#fl-list-input").val().toLowerCase())?!0:!1}).hide()})};b.prototype.loadListings=function(){var a,
c,d,e,b,f,h,k,l,m,n,p,q,r;b="";n={};l=A2Cribs.UserCache.Get("listing");a=0;for(k=l.length;a<k;a++)f=l[a],null==n[f.marker_id]&&(n[f.marker_id]=[]),n[f.marker_id].push(f.listing_id);for(p in n)if(A.call(n,p)){k=n[p];m=A2Cribs.UserCache.Get("marker",p);l="";a=m.street_address;q=0;for(r=k.length;q<r;q++){h=k[q];f=A2Cribs.UserCache.Get("listing",h);c="";switch(parseInt(f.listing_type)){case 0:c="icon-home";break;case 1:c="icon-lemon";break;case 2:c="icon-truck"}d=A2Cribs.UserCache.GetAllAssociatedObjects("rental",
"listing",f.listing_id);f="";null!=d&&void 0!==d[0]&&(e=d[0]);d="Listing "+h;null!=e&&(void 0!==e.unit_style_options&&void 0!==e.unit_style_description)&&(0===parseInt(e.unit_style_options)&&(f="Unit"),1===parseInt(e.unit_style_options)&&(f="Layout"),2===parseInt(e.unit_style_options)&&(f="Entire House"),d+=f,"Entire House"!==f&&(d+=" - "+e.unit_style_description));c={icon:c,address:a,description:d,listing_id:h};c=this.ListingTemplate(c);l+=c}c={marker:m,num_listings:k.length,listing_list:l};a=this.MarkerTemplate(c);
b+=a;$("#listings_list_content").append(a)}return this.uiListingsList.html(b)};b.prototype.getUniData=function(a){var c;null==a&&(a=null);null==this.ListingUniPricing[a]&&(c=new $.Deferred,$.ajax({url:"/featuredListings/getUniDataForListing/"+a,type:"GET",success:function(a){return c.resolve(JSON.parse(a))}}),this.ListingUniPricing[a]=c.promise());return this.ListingUniPricing[a]};b.prototype.addOrderItem=function(a){var c;c=A2Cribs.UserCache.Get("listing",a);c={address:A2Cribs.UserCache.Get("marker",
c.marker_id).street_address,price:0,id:c.listing_id};this.OrderStates[a]={};return this.uiOrderItemsList.append(this.OrderItemTemplate(c))};b.prototype.editOrderItem=function(a){var c,d,e,b,f=this;e=A2Cribs.UserCache.Get("listing",a);null!=this.FL_Order&&(b=this.FL_Order.listing_id,this.uiOrderItemsList.find(".orderItem[data-id="+b+"]").removeClass("editing"),this.OrderStates[b]=this.FL_Order.getState(),this.FL_Order.reset(!1));d=null!=this.OrderStates[a]?this.OrderStates[a]:null;c=A2Cribs.UserCache.Get("marker",
e.marker_id).street_address;$.when(this.getUniData(a)).then(function(a){return f.FL_Order=new A2Cribs.Order.FeaturedListing(f.uiFL_Form,e.listing_id,c,a,d)});this.uiOrderItemsList.find(".orderItem[data-id="+a+"]").addClass("editing");return this.toggleOrderDetailsUI(!0)};b.prototype.removeOrderItem=function(a){var c;null==a&&(a=null);if(null===a)this.uiOrderItemsList.find(".orderItem").remove(),this.OrderStates={},this.FL_Order.reset(),this.FL_Order=null;else if(this.uiOrderItemsList.find(".orderItem[data-id="+
a+"]").remove(),this.removeErrors(a),delete this.OrderStates[a],parseInt(null!=(c=this.FL_Order)?c.listing_id:void 0,10)===a)this.FL_Order.reset(),this.FL_Order=null;if(0===this.uiOrderItemsList.find(".orderItem").length)return this.toggleOrderDetailsUI(!1);a=this.uiOrderItemsList.find(".orderItem").first().data("id");return this.editOrderItem(a)};b.prototype.initTemplates=function(){this.ListingTemplate=_.template("<li class = 'listing-item' data-id='<%= listing_id %>'>\n    <i class = 'icon-large <%= icon %> listing-icon'></i><strong><%= description %></strong>\n    <i class = 'pull-right feature-star icon-star-empty'></i>\n</li>");
this.MarkerTemplate=_.template("<div class = 'marker-item' data-id='<%= marker.marker_id %>'>\n    <div class = 'marker-info'><i class = 'icon-plus'></i><strong><%= marker.street_address %></strong>  <%= marker.alternate_name %> (<%=num_listings%>)</div>\n    <ul><%= listing_list %></ul>\n</div>");return this.OrderItemTemplate=_.template("<tr class = 'orderItem' data-id = '<%= id %>'>\n    <td><span  class = 'address'><%= address %></span></td>\n    <td>$<span class = 'price'?><%= price %></span></td>\n    <td class = 'actions'>\n        <a href = '#' class = 'edit' data-id = '<%= id %>'><i class = 'icon-edit'></i></a>   \n        <a href = '#' class = 'remove' data-id = '<%= id %>'><i class = 'icon-remove-circle'></i></a>\n    </td>\n</tr>\n")};
b.prototype.showErrors=function(a){var c,d,e,b,f,h,k;e="";for(b in a)if(A.call(a,b)){d=a[b];c=this.uiOrderItemsList.find(".orderItem[data-id="+b+"]");c.addClass("error");c=c.find(".address").html();e+="<dt data-id='"+b+"'>Validation Errors for "+c+"<i class = 'icon-remove'></i></dt>";c=h=0;for(k=d.length;h<k;c=++h)f=d[c],e+="<dd data-id='"+b+"' class = 'validation-error'>"+(c+1)+". "+f+"</dd>"}return this.uiErrorsList.html(e)};b.prototype.removeErrors=function(a){null==a&&(a=null);if(null!=a)return this.uiOrderItemsList.find(".orderItem[data-id="+
a+"]").removeClass("error"),this.uiErrorsList.children("[data-id="+a+"]").remove();this.uiOrderItemsList.find(".orderItem").removeClass("error");return this.uiErrorsList.html("")};b.prototype.buy=function(){var a,c,d,e=this;this.removeErrors();this.FL_Order&&(this.OrderStates[this.FL_Order.listing_id]=this.FL_Order.getState());c=[];d=this.OrderStates;for(a in d)A.call(d,a)&&c.push(this.getUniData(a));return $.when.apply($,c).then(function(){var a,c,d,b,l,m,n,p,q;d=[];b=_.zip(arguments,_.values(e.OrderStates));
m=0;for(p=b.length;m<p;m++)if(a=b[m],l=a[0],a=a[1],!(1>a.selectedDates.length)){n=0;for(q=l.length;n<q;n++)c=l[n],c.enabled&&(c=A2Cribs.Order.FeaturedListing.GenerateOrderItem(a,c),d.push(c))}if(0===d.length)A2Cribs.UIManager.Alert("You haven't select any dates to feature listings");else return A2Cribs.Order.BuyItems(d,0,function(a){if(null!=a.error_type&&"NO_LISTINGS_SELECTED"===a.error_type)A2Cribs.UIManager.Alert("You haven't selected any dates to feature your listings.");else return e.showErrors(a)},
function(){return e.removeOrderItem()})})};b.prototype.toggleOrderDetailsUI=function(a){if(a)return $("#noListingSelected").fadeOut("fast"),this.uiWidget.find(".orderingInfo").slideDown();this.uiWidget.find(".orderingInfo").slideUp();return $("#noListingSelected").fadeIn("fast")};return b}();A2Cribs.Register=function(){function b(){}b.RedirectUrl=null;b.setupUI=function(){var a=this;return $("#registerForm").submit(function(c){c.preventDefault();return a.cribspotRegister()})};b.InitRegister=function(a){$("#signupModal").modal("show");
return A2Cribs.Register.RedirectUrl="/dashboard?post_redirect=true"};b.cribspotRegister=function(){var a;a=$("#registerForm").serializeArray();a={User:{email:$.trim(a[0].value),password:$.trim(a[1].value),first_name:$.trim(a[3].value),last_name:$.trim(a[4].value)}};return $.post("/users/AjaxRegister",a,function(a){a=JSON.parse(a);console.log(a);if(void 0!==a.success&&null!==a.success)return window.location.href="/users/login?register_success=true";if("EMAIL_EXISTS"===a.error_type)return A2Cribs.UIManager.Alert(a.error),
$("#inputEmail").val("");"undefined"!==typeof a.validation.email&&($("#inputEmail").effect("highlight",{color:"#FF0000"},3E3),$("#registerStatus").append("<p>"+a.email[0]+"<p>"));"undefined"!==typeof a.validation.first_name&&($("#inputFirstName").effect("highlight",{color:"#FF0000"},3E3),$("#registerStatus").append("<p>"+a.first_name[0]+"<p>"));"undefined"!==typeof a.validation.last_name&&($("#inputLastName").effect("highlight",{color:"#FF0000"},3E3),$("#registerStatus").append("<p>"+a.last_name[0]+
"<p>"));"undefined"!==typeof a.validation.password&&($("#registerStatus").append("<p>"+a.password[0]+"<p>"),$("#inputPassword").effect("highlight",{color:"#FF0000"},3E3),$("#confirmPassword").effect("highlight",{color:"#FF0000"},3E3));return $("#loginStatus").effect("highlight",{color:"#FF0000"},3E3)})};return b}();A2Cribs.Map=function(){function b(){}b.LISTING_TYPES=["rental","sublet","parking"];b.CLUSTER_SIZE=2;$(document).ready(function(){if($("#map_region").length)return b.Init($("#map_region").data("university-id"),
$("#map_region").data("latitude"),$("#map_region").data("longitude"),$("#map_region").data("city"),$("#map_region").data("state"),$("#map_region").data("university-name"),$("#map_region").data("listing-type"))});b.InitializeMarkers=function(a){var c,d,e,g;if(null!=a){a=JSON.parse(a);g=[];d=0;for(e=a.length;d<e;d++)c=a[d],c=new A2Cribs.Marker(c.Marker),c.Init(),A2Cribs.UserCache.Set(c),g.push(b.GMarkerClusterer.addMarker(c.GMarker));return g}};b.ShowMarkers=function(){return A2Cribs.Map.GMap.getBounds()};
b.InitBoundaries=function(){return this.Bounds={LEFT:0,RIGHT:window.innerWidth,BOTTOM:window.innerHeight,TOP:0,CONTROL_BOX_LEFT:95}};b.Init=function(a,c,d,e,b,f,h){this.CurentSchoolId=a;mixpanel.register({preferred_university:a});A2Cribs.FilterManager.CurrentCity=e;A2Cribs.FilterManager.CurrentState=b;A2Cribs.FilterManager.CurrentSchool=f;this.ACTIVE_LISTING_TYPE_ID=A2Cribs.FilterManager.ActiveListingType=h;this.ACTIVE_LISTING_TYPE=this.LISTING_TYPES[h];this.MapCenter=new google.maps.LatLng(c,d);
this.MapOptions={zoom:14,center:A2Cribs.Map.MapCenter,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:this.style,panControl:!1,streetViewControl:!1,mapTypeControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}};A2Cribs.Map.GMap=new google.maps.Map(document.getElementById("map_canvas"),A2Cribs.Map.MapOptions);google.maps.event.addListener(A2Cribs.Map.GMap,"idle",A2Cribs.Map.ShowMarkers);this.GMarkerClusterer=new MarkerClusterer(A2Cribs.Map.GMap,
[],{gridSize:60,maxZoom:15,styles:[{height:39,url:"/img/dots/dot_group.png",width:39,textColor:"#ffffff",textSize:13}]});this.GMarkerClusterer.setIgnoreHidden(!0);$("#map_region").trigger("map_initialized",[this.GMap]);A2Cribs.Map.InitBoundaries();this.LoadAllMapData();return A2Cribs.FilterManager.InitAddressSearch()};b.LoadBasicData=function(){var a=this;null==this.BasicDataDeferred&&(this.BasicDataDeferred=new $.Deferred);$.ajax({url:myBaseUrl+("Map/GetBasicData/"+this.ACTIVE_LISTING_TYPE_ID+"/"+
this.CurentSchoolId),type:"POST",success:function(c){return a.BasicDataDeferred.resolve(c)},error:function(){a.BasicDataDeferred.resolve(null);return a.BasicDataCached.resolve()}});return this.BasicDataDeferred.promise()};b.LoadBasicDataCallback=function(a){var c,d,e,g;if(!(null===a||void 0===a)){e=JSON.parse(a);for(d in e)for(c in a=e[d],a)g=a[c],A2Cribs.UserCache.Set(new A2Cribs[c](g));b.BasicDataCached.resolve();a=A2Cribs.UserCache.Get("marker");d=0;for(e=a.length;d<e;d++)c=a[d],c.Init(),b.GMarkerClusterer.addMarker(c.GMarker);
c=A2Cribs.UserCache.Get("listing");d=0;for(e=c.length;d<e;d++)a=c[d],a.visible=!0;"sublet"===b.ACTIVE_LISTING_TYPE&&b.IsCluster(!1);return b.Repaint()}};b.SetMarkerTypes=function(){var a,c,d,e,b,f;a=A2Cribs.UserCache.Get("marker");c=0;for(e=a.length;c<e;c++)d=a[c],d.SetType(A2Cribs.Marker.TYPE.LEASED);a=A2Cribs.UserCache.Get("listing");f=[];e=0;for(b=a.length;e<b;e++)c=a[e],c.InSidebar()||c.IsVisible()?(d=A2Cribs.UserCache.Get("marker",c.marker_id),null==c.available&&d.GetType()===A2Cribs.Marker.TYPE.LEASED?
f.push(d.SetType(A2Cribs.Marker.TYPE.UNKNOWN)):null!=c.available&&!0===c.available?f.push(d.SetType(A2Cribs.Marker.TYPE.AVAILABLE)):f.push(void 0)):f.push(void 0);return f};b.OpenMarker=function(a,c){if(-1===a)alert("This listing either has been removed or is invalid.");else if(-2!==a)return alert(a)};b.LoadAllMapData=function(){var a;$("#loader").show();a=this.LoadBasicData();this.BasicDataCached=new $.Deferred;A2Cribs.FeaturedListings.LoadFeaturedPMListings();a.done(this.LoadBasicDataCallback).always(function(){return $("#loader").hide()});
A2Cribs.FeaturedListings.InitializeSidebar(this.CurentSchoolId,this.ACTIVE_LISTING_TYPE,a,this.BasicDataCached);return A2Cribs.Hotlist.Initialize()};b.CenterMap=function(a,c){if(null!=this.GMap)return this.GMap.setCenter(new google.maps.LatLng(a,c))};b.ToggleListingVisibility=function(a,c){var d,e,b,f,h,k;$(".favorite_button").removeClass("active");$(".featured_pm").removeClass("active");$(document).trigger("close_bubbles");e=A2Cribs.UserCache.Get("marker");d=A2Cribs.UserCache.Get("listing");if(b=
this.CurrentToggle===c){h=0;for(k=e.length;h<k;h++)f=e[h],null!=f&&f.IsVisible(!0);h=0;for(f=d.length;h<f;h++)e=d[h],e.IsVisible(!0);this.CurrentToggle=null}else{h=0;for(k=e.length;h<k;h++)f=e[h],f.IsVisible(!1);f=0;for(h=d.length;f<h;f++)e=d[f],e.IsVisible(!1);d=0;for(h=a.length;d<h;d++)f=a[d],e=A2Cribs.UserCache.Get("listing",f),null!=e&&(f=A2Cribs.UserCache.Get("marker",e.marker_id),f.IsVisible(!0),e.IsVisible(!0));this.CurrentToggle=c}this.Repaint();return b};b.IsCluster=function(a){null==a&&
(a=null);"boolean"===typeof a&&(!0===a&&"sublet"!==this.ACTIVE_LISTING_TYPE?this.GMarkerClusterer.setMinimumClusterSize(this.CLUSTER_SIZE):this.GMarkerClusterer.setMinimumClusterSize(Number.MAX_VALUE),this.Repaint());return this.GMarkerClusterer.getMinimumClusterSize()===this.CLUSTER_SIZE};b.Repaint=function(){this.SetMarkerTypes();return this.GMarkerClusterer.repaint()};b.style=[{featureType:"road.highway",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ffffff"}]},{featureType:"road.arterial",
elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{elementType:"labels.text.fill",stylers:[{color:"#3b393a"}]},{featureType:"poi.sports_complex",elementType:"geometry",stylers:[{color:"#e9ddbc"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#868080"},{lightness:55}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{color:"#808080"},{lightness:53}]},{featureType:"poi.place_of_worship",
elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road"},{featureType:"transit.station.airport",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",
stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{lightness:23},{color:"#83b243"},{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.text.stroke",stylers:[{color:"#f4f6f1"},{visibility:"off"}]},{featureType:"poi.school",
elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.medical",stylers:[{color:"#ce979e"},{lightness:26}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit.station.rail",elementType:"labels.icon",stylers:[{lightness:39}]},{featureType:"poi.park",elementType:"geometry.fill",
stylers:[{color:"#d6e0c6"}]},{featureType:"water",stylers:[{color:"#c2d6ec"}]},{featureType:"landscape.man_made",stylers:[{color:"#efece2"}]},{featureType:"poi.medical",stylers:[{color:"#edcece"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{lightness:16}]},{featureType:"road.arterial",stylers:[{lightness:15}]},{featureType:"landscape.man_made",elementType:"geometry.stroke",stylers:[{visibility:"on"},
{lightness:78},{color:"#b8b7b8"}]},{featureType:"poi.business",elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:25},{saturation:-17}]}];return b}.call(this);A2Cribs.MarkerModal=function(){function b(){}b.Clear=function(){this.modal.find("#marker_select_container").show();this.modal.find("input").val("");this.modal.find("select option:first-child").attr("selected","selected");return this.MiniMap.SetMarkerVisible(!1)};b.MarkerValidate=function(){var a,c,d,e,b,f;e=!0;a=["street_address",
"city","state"];c=!0;b=0;for(f=a.length;b<f;b++)if(d=a[b],null==this.modal.find("#Marker_"+d).val()||0===this.modal.find("#Marker_"+d).val().length)this.modal.find("#Marker_"+d).parent().addClass("error"),c=!1;c||(A2Cribs.UIManager.Error("Fill in the full address please."),e=!1);0===this.modal.find("#Marker_building_type_id").val().length&&(A2Cribs.UIManager.Error("You need to select a building type."),this.modal.find("#Marker_building_type_id").parent().addClass("error"),e=!1);249<=this.modal.find("#Marker_alternate_name").val().length&&
(A2Cribs.UIManager.Error("Your building name is too long."),this.modal.find("#Marker_alternate_name").parent().addClass("error"),e=!1);return e};b.Save=function(a){var c,d,e,b=this;if(this.MarkerValidate()){if(this.modal.find("#Marker_latitude").val()){d=this.modal.find("#Marker_marker_id").val();c=this.MiniMap.GetMarkerPosition();e={alternate_name:this.modal.find("#Marker_alternate_name").val(),building_type_id:this.modal.find("#Marker_building_type_id").val(),street_address:this.modal.find("#Marker_street_address").val(),
city:this.modal.find("#Marker_city").val(),state:this.modal.find("#Marker_state").val(),zip:this.modal.find("#Marker_zip").val(),latitude:c.latitude,longitude:c.longitude};A2Cribs.MixPanel.PostListing("Marker Save",e);if(0!==(null!=d?d.length:void 0))e.marker_id=d;return $.ajax({url:"/Markers/Save/",type:"POST",data:e,success:function(c){if(c.error)return UIManager.Error(c.error);b.modal.modal("hide");e.marker_id=c;A2Cribs.MixPanel.PostListing("Marker Save Complete",{"marker id":e.marker_id});A2Cribs.UserCache.Set(new A2Cribs.Marker(e));
return a(e.marker_id)}})}A2Cribs.UIManager.Error("Please place your street address on the map using the Place On Map button.")}};b.SetupUI=function(){var a=this;this.modal.on("shown",function(){return a.MiniMap.Resize()});this.modal.find(".required").keydown(function(){return $(this).parent().removeClass("error")});this.modal.find("#place_map_button").click(function(){var c;c=a.modal.find("#marker_select").val();A2Cribs.MixPanel.PostListing("Marker Selected",{"new marker":!1,marker_id:c});return a.FindAddress(a.modal)});
this.modal.find("#marker_select").change(function(){var c;c=a.modal.find("#marker_select").val();"0"===c?a.modal.find("#continue-button").addClass("disabled"):a.modal.find("#continue-button").removeClass("disabled");return"new_marker"===c?(a.modal.find("#marker_add").show(),a.MiniMap.Resize()):a.modal.find("#marker_add").hide()});this.modal.find("#continue-button").click(function(){var c,d;d=a.modal.find("#marker_select").val();if("new_marker"===d)return A2Cribs.MixPanel.PostListing("Marker Selected",
{"new marker":!0}),a.Save();if("0"!==d)return c=A2Cribs.UserCache.Get("marker",d),A2Cribs.MixPanel.PostListing("Marker Selected",{"new marker":!1,"marker id":d,"marker name":null!=c?c.GetName():void 0,"marker address":null!=c?c.street_address:void 0,"marker city":null!=c?c.city:void 0,"marker state":null!=c?c.state:void 0}),a.modal.modal("hide"),a.TriggerMarkerAdded(d)});return this.MiniMap=new A2Cribs.MiniMap(this.modal)};b.Open=function(a,c){null==c&&(c=null);null!=a&&(this.ListingType=a);null==
c&&this.NewMarker();return this.modal.modal("show")};b.OpenLocation=function(a,c,d,e){var b=this;null!=a&&(this.ListingType=a);this.Clear();this.modal.find(".title").text("Create a New "+(this.ListingType.charAt(0).toUpperCase()+this.ListingType.slice(1)));this.modal.find("#marker_add").show();this.modal.find("#marker_select_container").hide();this.modal.find("#Marker_street_address").val(c);this.modal.find("#Marker_city").val(d);this.modal.find("#Marker_state").val(e);this.modal.find("#continue-button").unbind("click").click(function(){return b.Save(b.TriggerMarkerUpdated)});
return this.modal.modal("show")};b.NewMarker=function(){var a,c,d,e,b,f=this;this.Clear();this.modal.find("#marker_add").hide();this.modal.find("#continue-button").addClass("disabled").text("Continue");this.modal.find(".title").text("Create a New "+(this.ListingType.charAt(0).toUpperCase()+this.ListingType.slice(1)));c=A2Cribs.UserCache.Get("marker");this.modal.find("#marker_select").empty().append('<option value="0">--</option>\t\t\t<option value="new_marker"><strong>New Location</strong></option>');
this.modal.find("#continue-button").unbind("click").click(function(){var a;a=f.modal.find("#marker_select").val();if("new_marker"===a)return f.Save(f.TriggerMarkerAdded);if("0"!==a)return f.modal.modal("hide"),f.TriggerMarkerAdded(a)});if(null!=c){e=0;for(b=c.length;e<b;e++)a=c[e],d=null!=a.alternate_name&&a.alternate_name.length?a.alternate_name:a.street_address,a=$("<option />",{text:d,value:a.marker_id}),this.modal.find("#marker_select").append(a)}return this.modal.find("#marker_select").val("0")};
b.LoadMarker=function(a){var c,d,e=this;this.Clear();this.modal.find("#marker_add").show();this.modal.find("#marker_select_container").hide();a=A2Cribs.UserCache.Get("marker",a);this.modal.find("#continue-button").removeClass("disabled");this.modal.find("#continue-button").text("Save");this.modal.find(".title").text("Edit Listing Address");this.modal.find("#marker_select").val("new_marker");for(c in a)d=a[c],this.modal.find("#Marker_"+c).val(d);this.modal.find("#continue-button").unbind("click");
this.modal.find("#continue-button").click(function(){return e.Save(e.TriggerMarkerUpdated)});c=new google.maps.LatLng(this.modal.find("#Marker_latitude").val(),this.modal.find("#Marker_longitude").val());return this.MiniMap.SetMarkerPosition(c)};b.TriggerMarkerAdded=function(a){return $("#"+b.ListingType+"_list_content").trigger("marker_added",[a])};b.TriggerMarkerUpdated=function(a){return $("#"+b.ListingType+"_list_content").trigger("marker_updated",[a])};b.FindAddress=function(a){var c=this;if(this.MarkerValidate())return a.find("#Marker_street_address").val(),
a.find("#Marker_city").val(),a.find("#Marker_state").val(),A2Cribs.Geocoder.FindAddress(a.find("#Marker_street_address").val(),a.find("#Marker_city").val(),a.find("#Marker_state").val()).done(function(d){var e,b,f,h;f=d[0];e=d[1];b=d[2];h=d[3];d=d[4];c.MiniMap.SetMarkerPosition(d);a.find("#Marker_street_address").val(f);a.find("#Marker_latitude").val(d.lat());a.find("#Marker_longitude").val(d.lng());a.find("#Marker_city").val(e);a.find("#Marker_state").val(b);return a.find("#Marker_zip").val(h)}).fail(function(){A2Cribs.UIManager.Alert("Entered street address is not valid.");
return $("#Marker_street_address").text("")})};$(document).ready(function(){if($("#marker-modal").length)return b.modal=$("#marker-modal"),b.SetupUI()});return b}.call(this);window.A2Cribs.UILayer={};A2Cribs.UILayer.Rentals=function(){function b(){}b.rental_id=function(){return""};b.listing_id=function(){return 2};b.street_address=function(){return"521 Linden St"};b.city=function(){return"Ann Arbor"};b.state=function(){return"MI"};b.zipcode=function(){return"48104"};b.unit_style_options=function(){return 2};
b.unit_style_type=function(){return"NA"};b.unit_style_description=function(){return"NA"};b.building_name=function(){return""};b.beds=function(){return 6};b.min_occupancy=function(){return 1};b.max_occupancy=function(){return 6};b.building_type=function(){return 2};b.rent=function(){return 3600};b.rent_negotiable=function(){return 0};b.unit_count=function(){return 1};b.start_date=function(){return A2Cribs.UtilityFunctions.GetFormattedDate(new Date("09-02-2013"))};b.alternate_start_date=function(){return""};
b.end_date=function(){return A2Cribs.UtilityFunctions.GetFormattedDate(new Date("08-17-2014"))};b.available=function(){return 1};b.baths=function(){return 2};b.air=function(){return 1};b.parking_type=function(){return 1};b.parking_spots=function(){return 6};b.street_parking=function(){return 0};b.furnished_type=function(){return 0};b.pets_type=function(){return 1};b.smoking=function(){return 1};b.square_feet=function(){return 2E3};b.year_built=function(){return 1944};b.electric=function(){return 1};
b.water=function(){return 1};b.gas=function(){return 1};b.heat=function(){return 1};b.sewage=function(){return 1};b.trash=function(){return 1};b.cable=function(){return 1};b.internet=function(){return 1};b.utility_total_flat_rate=function(){return 0};b.utility_estimate_winter=function(){return 250};b.utility_estimate_summer=function(){return 200};b.deposit=function(){return 900};b.highlights=function(){return"Its a really fun place"};b.description=function(){return"This is a longer description about the place"};
b.waitlist=function(){return 1};b.waitlist_open_date=function(){return""};b.lease_office_address=function(){return"Jonah Copi's place"};b.contact_email=function(){return"email@address.com"};b.contact_phone=function(){return"5555555555"};b.website=function(){return"www.cribspot.com"};return b}();A2Cribs.UILayer.Fees=function(){function b(){}b.GetFees=function(){var a;a=[];a.push({fee_id:160,description:"Admin",amount:69});a.push({fee_id:161,description:"Parking",amount:25});a.push({fee_id:162,description:"Furniture",
amount:45});a.push({fee_id:163,description:"Pets",amount:50});a.push({fee_id:164,description:"Upper Floor",amount:66});a.push({fee_id:165,description:"Cleaning",amount:50});return a};return b}();(function(){function b(){}var a,c;b.Filter=function(a){return b.div.find(".rental_preview").each(function(c,b){-1!==$(b).find(".building_name").text().toLowerCase().indexOf($(a.currentTarget).val().toLowerCase())?$(b).is(":visible")||$(b).fadeIn():-1!==$(b).find(".street_address").text().toLowerCase().indexOf($(a.currentTarget).val().toLowerCase())?
$(b).is(":visible")||$(b).fadeIn():$(b).fadeOut()})};b.SortAvailability=function(a){return this.div.find(".rental_preview").each(function(c,b){return null==a?$(b).fadeIn():$(b).find(".available_listing_count").hasClass("leased")?a?$(b).fadeOut():$(b).fadeIn():a?$(b).fadeIn():$(b).fadeOut()})};a=function(a){var c,b,f;b=parseInt(null!=(f=a.val())?f.replace(/\D/g,""):void 0,10);isNaN(b)&&(b=0);b=b.toString();a.data("value",b);c=3<(c=b.length)?c%3:0;f="$"+(c?b.substr(0,c)+",":"");f+=b.substr(c).replace(/(\d{3})(?=\d)/g,
"$1,");return a.val("0"!==b&&0!==b.length?f:"")};c=function(a){var c,b,f,h;a.addClass("error");c=a.val().split("-");if(3!==c.length)return!1;f=0;for(h=c.length;f<h;f++)if(b=c[f],isNaN(b))return!1;if(1>c[0]||12<c[0]||(1>c[1]||31<c[1])||2E3>c[2])return!1;1===c[0].length&&(c[0]="0"+c[0]);1===c[1].length&&(c[1]="0"+c[1]);a.data("value",""+c[2]+"-"+c[0]+"-"+c[1]);a.removeClass("error");return!0};b.CheckMarkerAvailabilty=function(a){var c,b,f,h,k;f=A2Cribs.UserCache.GetAllAssociatedObjects("listing","marker",
a.data("marker-id"));h=c=0;for(k=f.length;h<k;h++)b=f[h],b.available&&c++;return 0===c?a.find(".available_listing_count").text("Leased").addClass("leased"):a.find(".available_listing_count").text(""+c+" of "+f.length+" Available").removeClass("leased")};b.CreateListeners=function(){var d=this;this.rent_timeouts={};this.div.on("click",".btn-group .btn",function(a){if($(a.currentTarget).parent().data("value")!==$(a.currentTarget).data("value"))return $(a.currentTarget).parent().data("value",$(a.currentTarget).data("value")),
$(a.currentTarget).closest(".rental_edit").trigger("save_rental",[$(a.currentTarget).parent()]),d.CheckMarkerAvailabilty($(a.currentTarget).closest(".rental_preview"))});this.div.on("keyup",".rent",function(c){var b;a($(c.currentTarget));b=$(c.currentTarget).parent().data("listing-id");clearTimeout(d.rent_timeouts[b]);$(c.currentTarget).parent().find(".save-note").hide();$(c.currentTarget).parent().find(".not-saved").show();return d.rent_timeouts[b]=setTimeout(function(){return $(c.currentTarget).closest(".rental_edit").trigger("save_rental",
[$(c.currentTarget)])},1E3)});this.div.on("keyup",".start_date",function(a){var d;d=$(a.currentTarget).data("value");if(c($(a.currentTarget))&&d!==$(a.currentTarget).data("value"))return $(a.currentTarget).closest(".rental_edit").trigger("save_rental",[$(a.currentTarget)])});this.div.on("save_rental",".rental_edit",function(a,c){var b;b=$(a.currentTarget).data("listing-id");A2Cribs.UserCache.Get(c.data("object"),b)[c.data("field")]=c.data("value");$(a.currentTarget).find(".save-note").hide();$(a.currentTarget).find(".not-saved").show();
return d.Save(b).always(function(){$(a.currentTarget).find(".save-note").hide();return $(a.currentTarget).find(".saved").show()})});this.div.on("keyup",".search_rentals",this.Filter);this.div.on("click",".label_explained",function(a){a.preventDefault();a.stopPropagation();return!1});this.div.on("click",".open_photos",function(a){var c,b,h;b=$(a.currentTarget).parent().data("listing-id");c=null!=(h=A2Cribs.UserCache.Get("image",b))?h.GetObject():void 0;return A2Cribs.PhotoPicker.Open(c).done(function(c){var g,
h,n;h=0;for(n=c.length;h<n;h++)g=c[h],g.listing_id=b;A2Cribs.UserCache.Set(new A2Cribs.Image(c,b));$(a.currentTarget).parent().find(".save-note").hide();$(a.currentTarget).parent().find(".not-saved").show();return d.Save(b).done(function(){$(a.currentTarget).parent().find(".save-note").hide();return $(a.currentTarget).parent().find(".saved").show()})})});this.div.find(".toggle_all_listings").click(this.ToggleCollapse);return this.div.find("#sort_availablity").change(function(a){a=parseInt($(a.currentTarget).val(),
10);isNaN(a)&&(a=null);return d.SortAvailability(a)})};b.Save=function(a){a=A2Cribs.UserCache.Get("listing",a).GetConnectedObject();return $.ajax({url:myBaseUrl+"listings/Save/",type:"POST",data:a,success:function(a){return console.log(a)}})};b.ToggleCollapse=function(){A2Cribs.UIManager.ShowLoader();return $.when(b.BackgroundLoadRentals()).done(function(){if(b.div.find(".unit_list:visible").length===b.div.find(".rental_preview").length)return b.div.find(".unit_list").slideUp(),b.div.find(".toggle_text").hide(),
b.div.find(".show_listings").show(),b.div.find(".toggle_all_listings").text("Open all listings");b.div.find(".unit_list").slideDown();b.div.find(".toggle_text").hide();b.div.find(".hide_listings").show();return b.div.find(".toggle_all_listings").text("Collapse all listings")}).always(function(){return A2Cribs.UIManager.HideLoader()})};b.ToggleShowListings=function(a){var c,g,f;if($(a.currentTarget).parent().find(".unit_list").is(":visible"))$(a.currentTarget).parent().find(".unit_list").slideUp(),
$(a.currentTarget).parent().find(".toggle_text").hide(),$(a.currentTarget).parent().find(".show_listings").show(),$(a.currentTarget).one("click",b.ToggleShowListings),b.div.find(".toggle_all_listings").text("Open all listings");else{A2Cribs.UIManager.ShowLoader();c=$.Deferred();c.done(function(c){A2Cribs.UIManager.HideLoader();c.find(".unit_list").slideDown();$(a.currentTarget).parent().find(".toggle_text").hide();$(a.currentTarget).parent().find(".hide_listings").show();c.find(".rental_expand_toggle").one("click",
b.ToggleShowListings);if(b.div.find(".unit_list:visible").length===b.div.find(".rental_preview").length)return b.div.find(".toggle_all_listings").text("Collapse all listings")});if("resolved"===b.BackgroundLoadRentals().state())return c.resolve($(a.currentTarget).parent());g=$(a.currentTarget).parent().data("marker-id");f=""+myBaseUrl+"Listings/GetOwnedListingsByMarkerId/"+g;return $.ajax({url:f,type:"GET",success:function(b){var f;A2Cribs.UserCache.CacheData(JSON.parse(b));null!=(f=A2Cribs.UserCache.Get("marker",
g))&&f.listings_loaded.resolve(g,$(a.currentTarget).parent());return c.resolve($(a.currentTarget).parent())}})}};b.LoadAllMarkers=function(){var a,c,b,f,h;c=A2Cribs.UserCache.Get("marker");h=[];b=0;for(f=c.length;b<f;b++)a=c[b],h.push(this.AddMarker(a));return h};b.LoadAllRentals=function(){return this.div.find(".rental_preview").each(function(a,c){var b,f;b=$(c).data("marker-id");return null!=(f=A2Cribs.UserCache.Get("marker",b))?f.listings_loaded.resolve(b,c):void 0})};b.BackgroundLoadRentals=function(){var a=
this;if(null!=this.LoadRentalsDeferred)return this.LoadRentalsDeferred;this.LoadRentalsDeferred=$.Deferred();$.ajax({url:myBaseUrl+"Listings/GetListing",type:"GET",success:function(c){A2Cribs.UserCache.CacheData(JSON.parse(c));return a.LoadRentalsDeferred.resolve()},error:function(){return a.LoadRentalsDeferred.reject()}});return this.LoadRentalsDeferred.promise()};b.AddMarker=function(a){var c,b,f,h=this;c=A2Cribs.UserCache.GetAllAssociatedObjects("listing","marker",a.GetId());b="<div class='rental_preview' data-marker-id='"+
a.GetId()+"' data-visible-state=\"hidden\">\n\t<div class='rental_title rental_expand_toggle'>\n\t\t<span>\n\t\t\t<span class='building_name'>"+a.GetName()+"</span>\n\t\t</span>\n\t\t<span class='separator'>|</span>\n\t\t<span class='street_address'>"+a.street_address+"</span>\n\t\t<span class='separator'>|</span>\n\t\t<span class='building_type'>"+a.GetBuildingType()+"</span>\n\t\t<span class='pull-right available_listing_count'></span>\n\t</div>\n\t<div class='unit_list hide'>\n\t\t<div class='fields_label'>\n\t\t\t<div class='pull-left text-center listing_label'>Listing</div>\n\t\t\t<div class='pull-left text-center available_label'>Availablity</div>\n\t\t\t<div class='pull-left text-center rent_label'>Rent</div>\n\t\t\t<div class='pull-left text-center start_date_label'>Start Date</div>\n\t\t\t<a href=\"#\" class='pull-right label_explained' data-toggle='popover' data-content=\"We have simplified things a bit. If you would like to update a field that is not listed below, please click on the rentals or sublet tab on the left.\">Where's the rest? <i class='icon-info-sign'></i></a>\n\t\t</div>\n\t</div>\n\t<div class='rental_expand_toggle rental_expand_toggle_div'>\n\t\t<div class='show_listings toggle_text'>\n\t\t\t<span><i class='icon-chevron-sign-down'></i> Click to view</span>\n\t\t\t<span class='unit_count'>"+
c.length+"</span>\n\t\t\t<span> Listings</span>\n\t\t</div>\n\t\t<div class='hide_listings hide toggle_text'>\n\t\t\t<span><i class='icon-chevron-sign-up'></i> Hide these Listings</span>\n\t\t</div>\n\t</div>\n</div>";f=$(b);f.find(".rental_expand_toggle").one("click",this.ToggleShowListings);f.find(".label_explained").popover();this.div.find("#rental_preview_list").append(f);a.listings_loaded=$.Deferred();a.listings_loaded.promise();return a.listings_loaded.done(function(a,d){var b,g,p;c=A2Cribs.UserCache.GetAllAssociatedObjects("listing",
"marker",a);g=0;for(p=c.length;g<p;g++)b=c[g],h.AddRental(b,$(d));return h.CheckMarkerAvailabilty(f)})};b.AddRental=function(c,b){var g,f,h;h=c.GetListingType();h=A2Cribs.UserCache.Get(h.toLowerCase(),c.GetId());if(null!=h)return g=null!=(f=h.start_date)?f.split("-"):void 0,f=3===(null!=g?g.length:void 0)?""+g[1]+"-"+g[2]+"-"+g[0]:"",g=null!=h.GetUnitStyle?""+h.GetUnitStyle()+" "+h.unit_style_description+" - "+h.beds+"Br":""+h.beds+"Br - "+h.baths+"Bath",h='<div class="rental_edit" data-listing-id="'+
c.GetId()+'">\n\t<a href="/listing/'+c.GetId()+'" target="_blank" class="unit_description pull-left">'+g+'</a>\n\t<div class="btn-group pull-left" data-toggle="buttons-radio" data-object="listing" data-field="available" data-value="'+(c.available?"1":"0")+'">\n\t\t<button type="button" class="btn btn-available '+(c.available?"active":"")+'" data-value="1">Available</button>\n\t\t<button type="button" class="btn btn-leased '+(!c.available?"active":"")+'" data-value="0">Leased</button>\n\t</div>\n\t<input type="text" class="rent pull-left" placeholder="Rent" data-object="'+
h.class_name+'" data-field="rent" data-value="'+h.rent+'" value="'+h.rent+'">\n\t<input type="text" class="start_date pull-left" maxlength="10" value="'+f+'" data-object="'+h.class_name+'" data-field="start_date" data-value="'+h.start_date+'" placeholder="MM-DD-YYYY">\n\t<button type="button pull-left" class="open_photos btn btn-primary">Add Photos</button>\n\t<span class="not-saved save-note hide"><i class=\'icon-spinner icon-spin\'></i> Saving...</span>\n\t<span class="saved save-note hide"><i class=\'icon-ok-sign\'></i> Saved</span>\n</div>',
h=$(h),a(h.find(".rent")),b.find(".unit_list").append(h)};$(document).ready(function(){if($("#rental_quickedit").length)return b.div=$("#rental_quickedit"),b._markers_loaded=$.Deferred(),b._markers_loaded.promise(),b.BackgroundLoadRentals(),A2Cribs.Dashboard.GetUserMarkerData().done(function(){b.LoadAllMarkers();return b._markers_loaded.resolve()}),$.when(b._markers_loaded,b.BackgroundLoadRentals()).done(function(){return b.LoadAllRentals()}),b.CreateListeners()});return b}).call(this);A2Cribs.RentalSave=
function(){function b(a,c,d){this.user_email=c;this.user_phone=d;this.SaveImages=B(this.SaveImages,this);this.div=$(".rental-content");this.EditableRows=[];this.Editable=!1;this.VisibleGrid="overview_grid";this.SetupUI(a);this.NextListing}b.prototype.SetupUI=function(a){$("#middle_content").height();this.div.find("grid-pane").height;$(".create-listing").find("a").click(function(a){a=$(a.currentTarget).data("listing-type");if("rental"===a)return A2Cribs.MarkerModal.Open(a)});this.CreateCallbacks();
return this.CreateGrids(a)};b.prototype.CreateCallbacks=function(){var a=this;$("#rental_list_content").on("marker_added",function(c,d){A2Cribs.Dashboard.Direct({classname:"rental",data:!0});return a.Open(d).done(function(){return a.AddNewUnit()})});$("body").on("click",".show_photo_picker",function(c){return a.LoadImages($(c.currentTarget).data("row"))});$("body").on("Rental_marker_updated",function(c,d){var b,g;if(1===$("#rental_list_content").find("#"+d).length)return b=$("#rental_list_content").find("#"+
d),g=A2Cribs.UserCache.Get("marker",d).GetName(),b.text(g),a.CreateListingPreview(d)});$("body").on("click",".rental_list_item",function(c){return a.Editable?A2Cribs.UIManager.ConfirmBox("By selecting a new address, all unsaved changes will be lost.",{ok:"Abort Changes",cancel:"Return to Editor"},function(d){if(d)return a.CancelEditing(),a.Open(c.target.id)}):a.Open(c.target.id)});this.div.find(".edit_marker").click(function(){A2Cribs.MixPanel.PostListing("Started",{});A2Cribs.MarkerModal.Open("rental");
return A2Cribs.MarkerModal.LoadMarker(a.CurrentMarker)});$("#rentals_edit").click(function(c){c=a.GridMap[a.VisibleGrid].getSelectedRows();if(a.Editable)a.FinishEditing();else{if(0===(null!=c?c.length:void 0)){A2Cribs.UIManager.CloseLogs();A2Cribs.UIManager.Error("Please select the row you wish to edit!");return}a.Edit(c)}return a.GridMap[a.VisibleGrid].setSelectedRows(c)});$("#rentals_delete").click(function(){var c,d,b,g,f,h;g=a.GridMap[a.VisibleGrid].getSelectedRows();if(g.length){a.GridMap[a.VisibleGrid].getEditorLock().isActive()&&
(c=a.GridMap[a.VisibleGrid].getActiveCell().row);if(-1!==g.indexOf(c))return a.GridMap[a.VisibleGrid].getEditorLock().cancelCurrentEdit();c=[];f=0;for(h=g.length;f<h;f++)b=g[f],null!=a.GridMap[a.VisibleGrid].getDataItem(b).listing_id&&c.push(a.GridMap[a.VisibleGrid].getDataItem(b).listing_id),-1!==(d=a.EditableRows.indexOf(b))&&a.EditableRows.splice(d,1);a.Delete(g,c);if(0===a.EditableRows.length)return a.FinishEditing()}});$(".rentals_tab").click(function(c){var d,b,g,f;if(a.CommitSlickgridChanges()){d=
a.GridMap[a.VisibleGrid].getSelectedRows();a.VisibleGrid=$(c.target).attr("data-target").substring(1);A2Cribs.MixPanel.PostListing(""+a.VisibleGrid+" selected",{"marker id":a.CurrentMarker});a.GridMap[a.VisibleGrid].setSelectedRows(d);f=a.EditableRows;b=0;for(g=f.length;b<g;b++)d=f[b],a.Validate(d);$(c.target).removeClass("highlight-tab");return $(c.delegateTarget).tab("show")}});return $(".rental-content").on("shown",function(c){var d,b,g;b=$("#"+a.VisibleGrid).width();c=$("#add_new_unit").position().top-
$("#"+a.VisibleGrid).position().top;null!=(g=a.Map)&&g.Resize();g=[];for(d in a.GridMap)$("#"+d).css("width",""+b+"px"),$("#"+d).css("height",""+c+"px"),g.push(a.GridMap[d].init());return g})};b.prototype.CommitSlickgridChanges=function(){var a;return null!=(a=this.GridMap[this.VisibleGrid].getEditorLock())?a.commitCurrentEdit():void 0};b.prototype.Edit=function(a){var c,d,b;this.EditableRows=a;$("#rentals_edit").text("Finish Editing");d=0;for(b=a.length;d<b;d++)c=a[d],c=this.GridMap[this.VisibleGrid].getDataItem(c),
null!=c&&(c.editable=!0);return this.Editable=!0};b.prototype.CancelEditing=function(){var a,c,d,b,g;null!=(a=this.GridMap[this.VisibleGrid].getEditorLock())&&a.cancelCurrentEdit();g=this.EditableRows;d=0;for(b=g.length;d<b;d++)c=g[d],a=this.GridMap[this.VisibleGrid].getDataItem(c),a.editable=!1,null==(null!=a?a.listing_id:void 0)&&this.GridMap[this.VisibleGrid].getData().splice(c,1);this.GridMap[this.VisibleGrid].updateRowCount();this.GridMap[this.VisibleGrid].render();this.GridMap[this.VisibleGrid].getSelectionModel().setSelectedRanges([]);
this.EditableRows=[];this.Editable=!1;$("#rentals_edit").text("Edit");return $(".rentals_tab").removeClass("highlight-tab")};b.prototype.FinishEditing=function(){var a,c,d,b,g;if(this.CommitSlickgridChanges()){c=!0;g=this.EditableRows;d=0;for(b=g.length;d<b;d++)a=g[d],c=c&&this.Validate(a);if(c){$("#rentals_edit").text("Edit");$(".rentals_tab").removeClass("highlight-tab");b=this.EditableRows;c=0;for(d=b.length;c<d;c++)a=b[c],a=this.GridMap[this.VisibleGrid].getDataItem(a),a.editable=!1;this.GridMap[this.VisibleGrid].setSelectedRows(this.EditableRows);
this.EditableRows=[];return this.Editable=!1}A2Cribs.UIManager.CloseLogs();return A2Cribs.UIManager.Error("Please complete all required fields to finish editing!")}};b.prototype.Open=function(a){var c,b=this;$("#loader").show();c=new $.Deferred;$.ajax({url:myBaseUrl+"listings/GetOwnedListingsByMarkerId/"+a,type:"GET",success:function(e){var g,f,h,k,l,m,n,p;e=JSON.parse(e);l=0;for(n=e.length;l<n;l++)for(h in f=e[l],f)if(k=f[h],null!=A2Cribs[h])A2Cribs.UserCache.Set(new A2Cribs[h](k));else if(null!=
A2Cribs[h]&&null!=k.length){m=0;for(p=k.length;m<p;m++)g=k[m],A2Cribs.UserCache.Set(new A2Cribs[h](g))}b.ClearGrids();b.CurrentMarker=a;b.CreateListingPreview(a);A2Cribs.Dashboard.ShowContent($(".rental-content"),!0);b.PopulateGrid(a);c.resolve();return $("#loader").hide()}});return c.promise()};b.prototype.CreateListingPreview=function(a){var c;a=A2Cribs.UserCache.Get("marker",a);c=a.GetName();$("#rentals_address").html("<strong>"+c+"</strong><br>");null==this.Map&&(this.Map=new A2Cribs.MiniMap($("#rentals_preview")));
if(null!=a.latitude&&null!=a.longitude)return this.Map.SetMarkerPosition(new google.maps.LatLng(a.latitude,a.longitude))};b.prototype.Validate=function(a){var c,b,e,g,f;g=A2Cribs.Rental.Required_Fields;a=this.GridMap[this.VisibleGrid].getDataItem(a);c={};b=!0;for(e in g)f=g[e],null==a[e]&&(b=!1,c[f]=!0);$(".rentals_tab").removeClass("highlight-tab");for(f in c)$("a[data-target='#"+f+"']").addClass("highlight-tab");$("a[data-target='#"+this.VisibleGrid+"']").removeClass("highlight-tab");return b};
b.prototype.GetObjectByRow=function(a){var c,b,e;a=this.GridMap[this.VisibleGrid].getDataItem(a);null!=a.listing_id&&(c=null!=(b=A2Cribs.UserCache.Get("image",a.listing_id))?b.GetObject():void 0);null==c&&(c=[]);c={Rental:a,Listing:null!=a.listing_id?A2Cribs.UserCache.Get("listing",a.listing_id).GetObject():void 0,Image:c};null==c.Listing&&(c.Listing={listing_type:0,marker_id:this.CurrentMarker});c.Listing.available=a.available;if(0===(null!=(e=c.Image)?e.length:void 0)&&null!=a.Image)c.Image=a.Image;
return c};b.prototype.Save=function(a){var c,b=this;if(this.Validate(a))return c=this.GetObjectByRow(a),A2Cribs.MixPanel.PostListing("Listing Save",{"save type":null!=c.listing_id?"edit":"save","marker id":this.CurrentMarker,"listing id":c.listing_id}),$("#loader").show(),$.ajax({url:myBaseUrl+"listings/Save/",type:"POST",data:c,success:function(a){var g,f,h,k,l;a=JSON.parse(a);if(null!=a.listing_id){A2Cribs.MixPanel.PostListing("Listing Save Completed",{"listing id":a.listing_id,"marker id":b.CurrentMarker});
A2Cribs.UIManager.Success("Save successful!");c.Listing.listing_id=a.listing_id;c.Rental.listing_id=a.listing_id;l=c.Image;h=0;for(k=l.length;h<k;h++)g=l[h],g.listing_id=a.listing_id;for(f in c)g=c[f],null!=A2Cribs[f]&&A2Cribs.UserCache.Set(new A2Cribs[f](g))}else A2Cribs.UIManager.Error(a.error.message);console.log(a);return $("#loader").hide()}})};b.prototype.GetListing=function(a){var c;null==a&&(a=null);c=myBaseUrl+"listings/GetListing/";null!==a&&(c+=a);return $.ajax({url:c,type:"POST",success:function(a){return console.log(JSON.parse(a))}})};
b.prototype.Copy=function(a){};b.prototype.Delete=function(a,c){var b=this;return $.ajax({url:myBaseUrl+"listings/Delete/"+JSON.stringify(c),type:"POST",success:function(e){var g,f,h,k,l,m,n;e=JSON.parse(e);if(null!==e.success&&void 0!==e.success){A2Cribs.UIManager.Success("Listings deleted!");e=b.GridMap[b.VisibleGrid].getData();k=0;for(m=c.length;k<m;k++){g=c[k];h=A2Cribs.UserCache.GetAllAssociatedObjects("rental","listing",g);l=0;for(n=h.length;l<n;l++)f=h[l],A2Cribs.UserCache.Remove(f.class_name,
f.GetId());A2Cribs.UserCache.Remove("listing",g)}f=0;for(h=a.length;f<h;f++)g=a[f],e.splice(g,1);b.GridMap[b.VisibleGrid].updateRowCount();return b.GridMap[b.VisibleGrid].render()}A2Cribs.UIManager.Error("Delete unsuccessful");return console.log(e)}})};b.prototype.Create=function(a){var c,b;this.CurrentMarker=a;A2Cribs.Dashboard.ShowContent($(".rentals-content"),!0);b=this.GridMap;for(c in b)a=b[c],a.init();return this.GridMap.overview_grid.getData()};b.prototype.LoadImages=function(a){var c,b,e=
this;c=this.GridMap[this.VisibleGrid].getDataItem(a);c=null!=c.listing_id?null!=(b=A2Cribs.UserCache.Get("image",c.listing_id))?b.GetImages():void 0:c.Image;A2Cribs.MixPanel.PostListing("Start Photo Editing",{"marker id":this.CurrentMarker,"number of images":null!=c?c.length:void 0});return A2Cribs.PhotoPicker.Open(c).done(function(c){return e.SaveImages(c,a)})};b.prototype.SaveImages=function(a,c){var b,e,g,f;b=this.GridMap[this.VisibleGrid].getDataItem(c);if(null!=b.listing_id){g=0;for(f=a.length;g<
f;g++)e=a[g],e.listing_id=b.listing_id;A2Cribs.UserCache.Set(new A2Cribs.Image(a,b.listing_id))}else b.Image=a;return this.Save(c)};b.prototype.AddNewUnit=function(){var a,c,b,e;A2Cribs.MixPanel.PostListing("Add New Unit",{"marker id":this.CurrentMarker});c=this.GridMap[this.VisibleGrid].getData();b=c.length;this.EditableRows.push(b);c.push({editable:!0,contact_email:this.user_email,contact_phone:this.user_phone,unit_style_description:b+1});this.GridMap[this.VisibleGrid].setSelectedRows(this.EditableRows);
$("#rentals_edit").text("Finish Editing");this.Editable=!0;this.Validate(b);b=this.GridMap;e=[];for(a in b)c=b[a],c.updateRowCount(),e.push(c.render());return e};b.prototype.PopulateGrid=function(a){var c,b,e,g,f,h;this.GridMap[this.VisibleGrid].getSelectionModel().setSelectedRanges([]);g=A2Cribs.UserCache.Get("rental");a=[];if(g.length){f=0;for(h=g.length;f<h;f++)e=g[f],c=A2Cribs.UserCache.Get("listing",e.listing_id),c.marker_id===this.CurrentMarker&&a.push(e.GetObject())}e=this.GridMap;g=[];for(b in e)c=
e[b],c.setData(a),c.updateRowCount(),g.push(c.render());return g};b.prototype.ClearGrids=function(){var a,c,b,e,g;e=this.GridMap;g=[];for(a in e)b=e[a],c=[],b.setData(c),g.push(b.render());return g};b.prototype.CreateGrids=function(a){var c,b,e,g,f,h,k,l,m,n=this;g="overview_grid features_grid amenities_grid utilities_grid buildingamenities_grid fees_grid description_grid picture_grid contact_grid".split(" ");this.GridMap={};h={editable:!0,enableCellNavigation:!0,asyncEditorLoading:!1,enableAddRow:!1,
autoEdit:!0,forceFitColumns:!0,explicitInitialization:!0,rowHeight:35};f=[];m=[];k=0;for(l=g.length;k<l;k++)e=g[k],b=this.GetColumns(e,a),c=new Slick.CheckboxSelectColumn({cssClass:"grid_checkbox"}),b[0]=c.getColumnDefinition(),this.GridMap[e]=new Slick.Grid("#"+e,f,b,h),this.GridMap[e].setSelectionModel(new Slick.RowSelectionModel({selectActiveRow:!1})),this.GridMap[e].registerPlugin(c),new Slick.Controls.ColumnPicker(b,this.GridMap[e],h),this.GridMap[e].onBeforeEditCell.subscribe(function(a,c){return-1!==
n.EditableRows.indexOf(c.row)?!0:!1}),this.GridMap[e].onCellChange.subscribe(function(a,c){return n.Save(c.row)}),m.push(this.GridMap[e].onValidationError.subscribe(function(a,c){A2Cribs.UIManager.CloseLogs();return A2Cribs.UIManager.Error(c.validationResults.msg)}));return m};b.prototype.GetColumns=function(a,c){var b,e,g,f,h,k,l,m,n;l=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185,headerCssClass:"slickgrid_header"},
{id:"beds",name:"Beds",field:"beds",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.RequiredText},{id:"occupancy",name:"Occupancy",field:"occupancy",formatter:A2Cribs.Formatters.Range,editor:A2Cribs.Editors.Range},{id:"rent",name:"Total Rent",field:"rent",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.RequiredMoney},{id:"rent_negotiable",cssClass:"grid_checkbox",name:"(Neg.)",field:"rent_negotiable",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"start_date",
name:"Start Date",field:"start_date",editor:Slick.Editors.Date,formatter:A2Cribs.Formatters.Date(!0)},{id:"alternate_start_date",name:"Alt. Start Date",field:"alternate_start_date",editor:Slick.Editors.Date,formatter:A2Cribs.Formatters.Date()},{id:"lease_length",name:"Lease Length",field:"lease_length",editor:A2Cribs.Editors.Dropdown([null,"1 month","2 months","3 months","4 months","5 months","6 months","7 months","8 months","9 months","10 months","11 months","12 months"]),formatter:A2Cribs.Formatters.Dropdown(";1 month;2 months;3 months;4 months;5 months;6 months;7 months;8 months;9 months;10 months;11 months;12 months".split(";"),
!0)},{id:"available",name:"Availability",field:"available",editor:A2Cribs.Editors.Dropdown(["Leased","Available"]),formatter:A2Cribs.Formatters.Dropdown(["Leased","Available"],!0)},{id:"unit_count",name:"Unit Count",field:"unit_count",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Text}]};h=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"baths",name:"Baths",field:"baths",editor:A2Cribs.Editors.Float,
formatter:A2Cribs.Formatters.RequiredText},{id:"parking_type",name:"Parking",field:"parking_type",editor:A2Cribs.Editors.Dropdown(c.parking),formatter:A2Cribs.Formatters.Dropdown(c.parking)},{id:"parking_spots",name:"Spots",field:"parking_spots",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Text},{id:"street_parking",cssClass:"grid_checkbox",name:"Street Parking",field:"street_parking",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"furnished_type",name:"Furnished",
field:"furnished_type",editor:A2Cribs.Editors.Dropdown(c.furnished),formatter:A2Cribs.Formatters.Dropdown(c.furnished)},{id:"pets_type",name:"Pets",field:"pets_type",editor:A2Cribs.Editors.Dropdown(c.pets),formatter:A2Cribs.Formatters.Dropdown(c.pets)},{id:"smoking",name:"Smoking",field:"smoking",editor:A2Cribs.Editors.Dropdown(["Prohibited","Allowed"]),formatter:A2Cribs.Formatters.Dropdown(["Prohibited","Allowed"])},{id:"square_feet",name:"SQ Feet",field:"square_feet",editor:Slick.Editors.Integer,
formatter:A2Cribs.Formatters.Text},{id:"year_built",name:"Year Built",field:"year_built",editor:A2Cribs.Editors.Year,formatter:A2Cribs.Formatters.Text}]};b=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"air",cssClass:"grid_checkbox",name:"A/C",field:"air",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"washer_dryer",name:"Washer/Dryer",field:"washer_dryer",editor:A2Cribs.Editors.Dropdown(c.washer_dryer),
formatter:A2Cribs.Formatters.Dropdown(c.washer_dryer)},{id:"fridge",cssClass:"grid_checkbox",name:"Fridge",field:"fridge",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"balcony",cssClass:"grid_checkbox",name:"Balcony",field:"balcony",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"tv",cssClass:"grid_checkbox",name:"TV",field:"tv",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"storage",cssClass:"grid_checkbox",name:"Storage",field:"storage",
editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"security_system",cssClass:"grid_checkbox",name:"Security System",field:"security_system",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check}]};e=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"pool",cssClass:"grid_checkbox",name:"Pool",field:"pool",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},
{id:"hot_tub",cssClass:"grid_checkbox",name:"Hot Tubs",field:"hot_tub",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"fitness_center",cssClass:"grid_checkbox",name:"Fitness Center",field:"fitness_center",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"game_room",cssClass:"grid_checkbox",name:"Game Room",field:"game_room",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"front_desk",cssClass:"grid_checkbox",name:"Front Desk",field:"front_desk",
editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"tanning_beds",cssClass:"grid_checkbox",name:"Tanning Beds",field:"tanning_beds",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"study_lounge",cssClass:"grid_checkbox",name:"Study Lounge",field:"study_lounge",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"patio_deck",cssClass:"grid_checkbox",name:"Deck/Patio",field:"patio_deck",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},
{id:"yard_space",cssClass:"grid_checkbox",name:"Yard Space",field:"yard_space",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"elevator",cssClass:"grid_checkbox",name:"Elevator",field:"elevator",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check}]};n=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"electric",name:"Electricity",field:"electric",editor:A2Cribs.Editors.Dropdown(["Not Included",
"Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"water",name:"Water",field:"water",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"gas",name:"Gas",field:"gas",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"heat",name:"Heat",field:"heat",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),
formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"trash",name:"Trash",field:"trash",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"cable",name:"Cable",field:"cable",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"internet",name:"Internet",field:"internet",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),
formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"utility_total_flat_rate",name:"Total Flat Rate",field:"utility_total_flat_rate",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money}]};k=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"deposit_amount",name:"Deposit",field:"deposit_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"admin_amount",
name:"Admin",field:"admin_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"parking_amount",name:"Parking",field:"parking_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"furniture_amount",name:"Furniture",field:"furniture_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"pets_amount",name:"Pets",field:"pets_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"amenity_amount",name:"Amenity",
field:"amenity_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"upper_floor_amount",name:"Upper Floor",field:"upper_floor_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"extra_occupant_amount",name:"Cost for Extra Occupant",field:"extra_occupant_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money}]};f=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,
minWidth:185},{id:"highlights",name:"Highlights",field:"highlights",editor:A2Cribs.Editors.LongText(160,"Highlights"),formatter:A2Cribs.Formatters.Text},{id:"description",name:"Description",field:"description",editor:A2Cribs.Editors.LongText(1E3,"Description"),formatter:A2Cribs.Formatters.Text}]};m=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"pictures",name:"Pictures",formatter:A2Cribs.Formatters.Button}]};
g=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"waitlist",name:"Waitlist",field:"waitlist",editor:Slick.Editors.YesNoSelect,formatter:Slick.Formatters.YesNo},{id:"waitlist_open_date",name:"Waitlist Open Date",field:"waitlist_open_date",editor:Slick.Editors.Date,formatter:A2Cribs.Formatters.Date()},{id:"lease_office_address",name:"Leasing Office Address",field:"lease_office_address",editor:Slick.Editors.Text,
formatter:A2Cribs.Formatters.Text},{id:"contact_email",name:"Contact Email",field:"contact_email",editor:A2Cribs.Editors.Email,formatter:A2Cribs.Formatters.RequiredText},{id:"contact_phone",name:"Contact Phone",field:"contact_phone",editor:A2Cribs.Editors.Phone,formatter:A2Cribs.Formatters.RequiredText},{id:"website",name:"Website",field:"website",editor:Slick.Editors.Text,formatter:A2Cribs.Formatters.Text}]};switch(a){case "overview_grid":return l();case "features_grid":return h();case "amenities_grid":return b();
case "utilities_grid":return n();case "fees_grid":return k();case "description_grid":return f();case "picture_grid":return m();case "contact_grid":return g();case "buildingamenities_grid":return e()}};return b}();A2Cribs.MiniMap=function(){function b(a,c,b,e,g){null==c&&(c=39.8282);null==b&&(b=-98.5795);null==e&&(e=!1);null==g&&(g=!0);a=a.find("#correctLocationMap")[0];this.center=new google.maps.LatLng(c,b);this.Map=new google.maps.Map(a,{zoom:2,center:this.center,mapTypeId:google.maps.MapTypeId.ROADMAP,
mapTypeControl:!1,panControl:!1,zoomControl:!1,streetViewControl:!1,draggable:g});this.Marker=new google.maps.Marker({draggable:g,position:this.center,map:this.Map,visible:e});this.Resize()}b.prototype.Reset=function(){this.SetZoom(2);this.CenterMap(39.8282,-98.5795);return this.SetMarkerVisible(!1)};b.prototype.CenterMap=function(a,c){this.center=new google.maps.LatLng(a,c);return this.Resize()};b.prototype.Resize=function(){google.maps.event.trigger(this.Map,"resize");return this.Map.setCenter(this.center)};
b.prototype.SetMarkerVisible=function(a){if(null!=this.Marker)return this.Marker.setVisible(!1)};b.prototype.SetMarkerPosition=function(a){this.center=a;this.Map.panTo(a);this.SetZoom(18);this.Marker.setPosition(a);return this.Marker.setVisible(!0)};b.prototype.SetZoom=function(a){return this.Map.setZoom(a)};b.prototype.GetMarkerPosition=function(){return{latitude:this.Marker.position.lat(),longitude:this.Marker.position.lng()}};b.prototype.SetEnabled=function(a){null==a&&(a=!0);null!=this.Map&&this.Map.setOptions({draggable:a,
zoomControl:a,scrollwheel:a,disableDoubleClickZoom:a});null!=this.Marker&&this.Marker.setOptions({draggable:a});return this.Enabled=a};return b}();A2Cribs.PageHeader=function(){function b(){}b.renderUnreadConversationsCount=function(){return $.get(myBaseUrl+"messages/getUnreadCount",function(a){var c,b;try{b=JSON.parse(a)}catch(e){return}a=b.unread_conversations;c=$(".message_count");if(0===a)return c.hide();c.html(b.unread_conversations);return c.show()})};return b}();A2Cribs.ShoppingCart=function(){function b(a){var c=
this;this.Widget=a;this.Widget.on("click",".edit",function(a){a=$(a.currentTarget).attr("id");return c.edit(a)}).on("click",".remove",function(a){a=$(a.currentTarget).attr("id");return c.remove(a)});this.Widget.find(".buy").click(function(){return A2Cribs.Order.BuyCart()});this.Widget.find(".hide-edit").click(function(){$(".fl-cart-item").removeClass("editing");return $(".edit-form").fadeOut()});this.Widget.find(".save").click(function(){return c.save(c.EditingIndex)});this.Editing=!1;this.EditingIndex=
-1;this.orderItem=null;this.ListItemTemplate=_.template("<tr class = 'fl-cart-item'>\n    <td><span  class = 'address'><%= address %></span></td>\n    <td><span class = 'price'?>$<%= price %></span></td>\n    <td class = 'actions'>\n        <a href = '#' class = 'edit' id = '<%= id %>'><i class = 'icon-edit'></i></a>   \n        <a href = '#' class = 'remove' id = '<%= id %>'><i class = 'icon-remove-circle'></i></a>\n    </td>\n</tr>");this.refresh()}b.prototype.remove=function(a){var c=this;return $.post(myBaseUrl+
"shoppingCart/remove",{index:a},function(b){return JSON.parse(b).success?c.refresh():alertify.error("Removing item "+(a+1)+" failed")})};b.prototype.refresh=function(){var a=this;return $.getJSON("/shoppingCart/get",function(c){var b,e,g,f,h;$(".orderItems > tbody").html("");e="";f=g=0;for(h=c.length;f<h;f++)b=c[f],b={price:b.price.toFixed(2),address:b.item.address,id:g++},e+=a.ListItemTemplate(b);$(".orderItems > tbody").html(e);$("table.orderItems").show();return a.orderItems=c})};b.prototype.edit=
function(a){var c,b;c=this.orderItems[a];null!=(b=this.orderItem)&&b.clear();this.orderItem=new A2Cribs.Order.FeaturedListing($(".featured-listing-order-item").first(),c.item.listing_id,c.item.address,{selected_dates:c.item.dates});$(".edit-form").fadeIn("fast");this.EditingIndex=a;return $(".fl-cart-item:eq("+a+")").addClass("editing").siblings().removeClass("editing")};b.prototype.save=function(){var a,c=this;if(0<=this.EditingIndex)return a={orderItem:JSON.stringify(this.orderItem.getOrderItem()),
index:this.EditingIndex},$.post("/shoppingCart/edit",a,function(b){a=JSON.parse(b);return a.success?(alertify.success("Save Successful"),c.Widget.find(".hide-edit").click(),c.refresh()):alertify.error(a.message)})};return b}();A2Cribs.Landing=function(){function b(){}var a,c;c=function(a){var c;c=$(".current_background");if(c.attr("data-university")!==a)return a=$("img[data-university='"+a+"'].school_background"),a.css("opacity","0.0").zIndex(-1).addClass("current_background"),c.zIndex(-2).removeClass("current_background"),
a.animate({opacity:1},1200,function(){return c.zIndex(-3)})};a=function(a){var b,g,f,h,k;f=a.University;for(b in f)g=f[b],$("#school_page").find("."+b).hide().text(g).fadeIn();c(a.University.id);b=a.University.name.split(" ").join("_");$("#map_link").attr("href","/rental/"+b);$(".background_source").attr("href",a.University.background_source);null!=(h=a.University.logo_path)&&h.length?$(".school_logo").show().css("background-image","url("+a.University.logo_path+")"):$(".school_logo").hide();return null!=
(k=a.University.founder_image)&&k.length?($(".founder_photo").attr("src",a.University.founder_image),$(".founder_title").text(""+a.University.name+" Founder"),$("#founder_box").fadeIn()):$("#founder_box").hide()};b.Init=function(c){var b,g=this;this.locations=c;$(window).scroll(function(){var a;a=$(window).scrollTop();return $(".current_background").css("top",0-0.25*a+"px")});$("#friends_invite").click(function(){return A2Cribs.ShareManager.ShowShareModal("","College housing sucks! Tell your friends how easy finding the perfect house can be. Share Cribspot!",
"landing page share")});if(null!=(null!=(b=this.locations)?b.length:void 0))c=Math.floor(Math.random()*this.locations.length),a(this.locations[c]);$(".mobile_selector").change(function(a){var c,b,d,e,n;a=$(a.currentTarget).val();e=g.locations;n=[];b=0;for(d=e.length;b<d;b++)c=e[b],c.University.id===a?(c=c.University.name.split(" ").join("_"),n.push(window.location.href="/rental/"+c)):n.push(void 0);return n});return $("#school_selector").change(function(c){var b,d,e,m,n;d=$(c.currentTarget).val();
n=g.locations;e=0;for(m=n.length;e<m;e++)if(c=n[e],c.University.id===d){b=c;g.Current_University=c;break}null!=b&&a(g.Current_University);return $("html, body").animate({scrollTop:$("#school_page").offset().top},1200)})};return b}();A2Cribs.Login=function(){function b(){}var a,c,d;b.LANDING_URL="cribspot.com";b.HTTP_PREFIX="https://";$(document).ready(function(){$.when(window.fbInit).then(function(){return b.CheckLoggedIn()});$("#signup_modal").length&&b.SignupModalSetupUI();$("#login_modal").length&&
b.LoginModalSetupUI();$("#login_signup").length&&b.LoginPageSetupUI();if($("#user_welcome_page").length)return $(document).on("logged_in",function(){return location.reload()})});c=function(a){$(".fb-name").text(a.first_name);$(".fb-image").attr("src",a.img_url);$("#signup_modal").find(".login-separator").fadeOut();$("#signup_modal").find(".fb-login").fadeOut("slow",function(){return $(".fb-signup-welcome").fadeIn()});$("#student_first_name").val(a.first_name);$("#student_last_name").val(a.last_name);
return $("#student_email").focus()};b.CheckLoggedIn=function(){var a,c=this;a=new $.Deferred;$.ajax({url:myBaseUrl+"Users/IsLoggedIn",success:function(b){var d;b=JSON.parse(b);if(null!=b.error)return a.reject();"LOGGED_IN"===b.success?(c.logged_in=!0,c.PopulateHeader(b.data),c.PopulateFavorites(null!=(d=b.data)?d.favorites:void 0),$(document).trigger("logged_in",[b.data])):"NOT_LOGGED_IN"===b.success&&(c.logged_in=!1,c.ResetHeader());$(document).trigger("checked_logged_in",[c.logged_in]);return a.resolve(b)},
error:function(c){console.log(c);return a.reject()}});return a.promise()};b.SignupModalSetupUI=function(){var a=this;$(".show_signup_modal").click(function(){$("#login_modal").modal("hide");return $("#signup_modal").modal("show").find(".signup_message").text("Sign up for Cribspot.")});$("#signup_modal").find("form").submit(function(c){$("#signup_modal").find(".signup-button").button("loading");a.CreateStudent(c.delegateTarget).always(function(){return $("#signup_modal").find(".signup-button").button("reset")});
return!1});return $("#signup_modal").find(".fb-login").click(function(){$(".fb-login").button("loading");return a.FacebookJSLogin().done(function(b){var d;if("NOT_LOGGED_IN"===b.success)return c(b.data);if("LOGGED_IN"===b.success)return $(".modal").modal("hide"),a.logged_in=!0,a.PopulateHeader(b.data),a.PopulateFavorites(null!=(d=b.data)?d.favorites:void 0),$(document).trigger("logged_in",[b.data])}).always(function(){return $(".fb-login").button("reset")})})};b.LoginModalSetupUI=function(){var a=
this;$(".show_login_modal").click(function(){$("#signup_modal").modal("hide");return $("#login_modal").modal("show")});$("#login_modal").find("form").submit(function(c){$("#login_modal").find(".signup-button").button("loading");a.cribspotLogin(c.delegateTarget).always(function(){return $("#login_modal").find(".signup-button").button("reset")});return!1});return $("#login_modal").find(".fb-login").click(function(){$(".fb-login").button("loading");return a.FacebookJSLogin().done(function(b){var d;if("NOT_LOGGED_IN"===
b.success)return $("#login_modal").modal("hide"),$("#signup_modal").modal("show"),c(b.data);if("LOGGED_IN"===b.success)return $(".modal").modal("hide"),a.logged_in=!0,a.PopulateHeader(b.data),a.PopulateFavorites(null!=(d=b.data)?d.favorites:void 0),$(document).trigger("logged_in",[b.data])}).always(function(){return $(".fb-login").button("reset")})})};b.LoginPageSetupUI=function(){var a=this;this.div=$("#login_signup");this.div.find(".show_signup").click(function(){a.div.find(".login_row").hide("fade");
return a.div.find(".signup_row").show("fade")});this.div.find(".show_login").click(function(){a.div.find(".signup_row").hide("fade");return a.div.find(".login_row").show("fade")});this.div.find(".show_pm").click(function(){a.div.find(".student_icon").removeClass("active");a.div.find(".pm_icon").addClass("active");a.div.find(".fb_box").hide();a.div.find(".student_signup").hide();return a.div.find(".pm_signup").show()});this.div.find(".show_student").click(function(){a.div.find(".pm_icon").removeClass("active");
a.div.find(".student_icon").addClass("active");a.div.find(".pm_signup").hide();a.div.find(".fb_box").show();return a.div.find(".student_signup").show()});this.div.find(".fb_login_btn").click(function(){$(".fb-login").button("loading");return a.FacebookJSLogin().done(function(c){if("NOT_LOGGED_IN"===c.success)return a.div.find("#student_first_name").val(c.data.first_name),a.div.find("#student_last_name").val(c.data.last_name),a.div.find(".fb-image").attr("src",c.data.img_url),$(".fb-name").text(c.data.first_name),
a.div.find(".show_signup").first().click(),a.div.find(".show_student").first().click(),a.div.find(".email_login_message").fadeOut("slow",function(){return a.div.find(".fb-signup-welcome").fadeIn()}),a.div.find("#student_email").focus();if("LOGGED_IN"===c.success)return a.logged_in=!0,$(document).trigger("logged_in",[c.data]),location.reload()}).always(function(){return $(".fb-login").button("reset")})});this.div.find("#login_content").submit(function(c){a.cribspotLogin(c.delegateTarget).done(function(){return location.reload()});
return!1});this.div.find("#student_signup").submit(function(){a.CreateStudent().done(function(){return location.reload()});return!1});return this.div.find("#pm_signup").submit(function(){a.CreatePropertyManager().done(function(){return location.reload()});return!1})};b.ResetHeader=function(){$(".personal_menu").hide();$(".personal_buttons").hide();$(".signup_btn").show();return $(".nav-text").show()};b.PopulateHeader=function(a){$(".signup_btn").hide();$(".nav-text").hide();$(".personal_buttons").show();
A2Cribs.FavoritesManager.InitializeFavorites(a.favorites);$(".personal_menu").find(".user_name").text(a.name);$(".personal_menu").find("img").attr("src",a.img_url);0!==a.num_messages&&$(".personal_buttons").find(".message_count").show().text(a.num_messages);$(".personal_menu_"+a.user_type).show();return $(".user_email").text(a.email)};b.PopulateFavorites=function(a){var c,b,d,k;k=[];b=0;for(d=a.length;b<d;b++)c=a[b],k.push($(".favorite_listing*[data-listing-id='"+c+"']").addClass("active"));return k};
b.FacebookJSLogin=function(){var a=this;this.fb_login_deferred=new $.Deferred;FB.getLoginStatus(function(c){if("connected"===c.status){if(null!=c&&null!=c.authResponse)return a.AttemptFacebookLogin(c.authResponse);A2Cribs.UIManager.Error("We're having trouble logging you in with facebook, but don't worry!\t\t\t\t\tYou can still create an account with our regular login.");return a.fb_login_deferred.reject()}return FB.login(function(c){if(null!=c&&null!=c.authResponse)return a.AttemptFacebookLogin(c.authResponse);
A2Cribs.UIManager.Error("We're having trouble logging you in with facebook, but don't worry!\t\t\t\t\t\tYou can still create an account with our regular login.");return a.fb_login_deferred.reject()},{scope:"email"})});return this.fb_login_deferred.promise()};b.AttemptFacebookLogin=function(a){var c=this;return $.ajax({url:myBaseUrl+"Users/AttemptFacebookLogin",data:a,type:"POST",success:function(a){a=JSON.parse(a);return null!=a.error?c.fb_login_deferred.reject():c.fb_login_deferred.resolve(a)},error:function(a){console.log(a);
return c.fb_login_deferred.reject()}})};b.cribspotLogin=function(a){var c,b=this;this._login_deferred=new $.Deferred;c=myBaseUrl+"users/AjaxLogin";a={User:{email:$(a).find("#inputEmail").val(),password:$(a).find("#inputPassword").val()}};null!=a.User.email&&null!=a.User.password&&$.post(c,a,function(a){var c;a=JSON.parse(a);console.log(a);if(null!=a.error)return"EMAIL_UNVERIFIED"===a.error_type?A2Cribs.UIManager.Confirm("Your email address has not yet been confirmed. \t\t\t\t\t\t\tPlease click the link provided in your confirmation email. \t\t\t\t\t\t\tDo you want us to resend you the email?",
function(a){if(a)return b.ResendConfirmationEmail()}):(A2Cribs.UIManager.CloseLogs(),A2Cribs.UIManager.Error(a.error)),b._login_deferred.reject();A2Cribs.MixPanel.AuthEvent("login",{source:"cribspot"});$(".modal").modal("hide");b.PopulateHeader(a.data);b.PopulateFavorites(null!=(c=a.data)?c.favorites:void 0);b.logged_in=!0;$(document).trigger("logged_in",[a.data]);return b._login_deferred.resolve()});return this._login_deferred.promise()};b.ResendConfirmationEmail=function(a){null==a&&(a=!1);if(!a)return $.ajax({url:myBaseUrl+
"users/ResendConfirmationEmail",type:"POST",success:function(a){a=JSON.parse(a);return null!=a.error?A2Cribs.UIManager.Alert(a.error.message):A2Cribs.UIManager.Success("Email has been sent! Click the link to verify.")}})};d=function(a,c,b){var d,k,l,m,n;l=0===a?"student_":"pm_";A2Cribs.UIManager.CloseLogs();k=!0;m=0;for(n=c.length;m<n;m++)d=c[m],0===b.find("#"+l+d).val().length&&(k=!1);k||A2Cribs.UIManager.Error("Please fill in all of the fields!");if(1===a&&(a=b.find("#"+l+"phone").val().split("-").join(""),
10!==a.length||isNaN(a)))k=!1,A2Cribs.UIManager.Error("Please enter a valid phone number");6>b.find("#"+l+"password").val().length&&(k=!1,A2Cribs.UIManager.Error("Please enter a password of 6 or more characters"));return k};a=function(a,c,f,h){var k,l,m,n;b._create_user_deferred=new $.Deferred;l=0===a?"student_":"pm_";if(d(a,c,h)){if(null!=h.find("#"+l+"confirm_password").val()&&h.find("#"+l+"password").val()!==h.find("#"+l+"confirm_password").val()){A2Cribs.UIManager.Error("Make sure passwords match!");
return}k={User:{user_type:a}};m=0;for(n=f.length;m<n;m++)c=f[m],0!==h.find("#"+l+c).val().length&&(k.User[c]=h.find("#"+l+c).val());$.post("/users/AjaxRegister",k,function(c){var d,f,g;d=JSON.parse(c);if(null!=d.error)return A2Cribs.UIManager.CloseLogs(),A2Cribs.UIManager.Error(d.error),b._create_user_deferred.reject();f=0===a?$("#student_email").val():$("#pm_email").val();A2Cribs.MixPanel.AuthEvent("signup",{user_id:c.success,user_type:a,email:f,source:"cribspot",user_data:k});mixpanel.people.set({user_id:c.success,
user_type:a,email:f,user_data:k});b.PopulateHeader(d.data);b.PopulateFavorites(null!=(g=d.data)?g.favorites:void 0);b.logged_in=!0;$(document).trigger("logged_in",[d.data]);$(".modal").modal("hide");return b._create_user_deferred.resolve()});return b._create_user_deferred.promise()}return b._create_user_deferred.reject()};b.CreateStudent=function(c){var b,d;c=null==c?this.div:$(c);d=["email","password","first_name","last_name"];b=d.slice(0);return a(0,d,b,c)};b.CreatePropertyManager=function(){var c,
b;b="email password company_name street_address phone city state".split(" ");c=b.slice(0);c.push("website");return a(1,b,c,this.div)};return b}.call(this);A2Cribs.FeaturedListings=function(){function b(){}var a;b.FeaturedPMIdToListingIdsMap=[];b.FeaturedPMListingsVisible=!1;b.resizeHandler=function(){var a;a=$(window).height()-$("#listings-list").offset().top-$(".legal-bar").height();$("#listings-list").height(a);return 900>$(window).width()?$(".fl-sb-item").draggable("disable"):$(".fl-sb-item").draggable("enable")};
b.SetupResizing=function(){this.resizeHandler();return $(window).on("resize",this.resizeHandler)};b.GetFlIds=function(a){var b;b=new $.Deferred;$.get("/featuredListings/cycleIds/"+a+"/"+this.FL_LIMIT,function(a){a=JSON.parse(a);return null!=a?b.resolve(a):b.resolve(null)});return b.promise()};b.FL_LIMIT=5;b.GetListingDeferred=function(a,b){var e;e=new $.Deferred;$.ajax({url:myBaseUrl+"Listings/GetListing/"+a,type:"GET",success:function(g){var f,h,k,l,m;g=JSON.parse(g);l=0;for(m=g.length;l<m;l++)for(h in f=
g[l],f)k=f[h],null!=A2Cribs[h]&&A2Cribs.UserCache.Set(new A2Cribs[h](k));A2Cribs.UserCache.Get(b,a);return e.resolve(f)},error:function(){return e.resolve(null)}});return e.promise()};b.FetchListingsByIds=function(a,b){var e,g,f,h,k;e=new $.Deferred;if(!a||1>a.length)return e.resolve(null),e;f=[];h=0;for(k=a.length;h<k;h++)g=a[h],f.push(A2Cribs.FeaturedListings.GetListingDeferred(g,b));$.when.apply($,f).then(function(){return e.resolve(arguments)});return e.promise()};b.GetRandomListingsFromMap=function(a,
b){return _.shuffle(b).slice(0,a)};b.SetupListingItemEvents=function(){var a;a=$(".fl-sb-item");a.unbind();return a.draggable({revert:!0,opacity:0.7,cursorAt:{top:-12,right:-20},helper:function(a){a=$(this).find(".name").html()||"this listing";return $("<div class='listing-drag-helper'>Share "+a+"</div>")},start:function(a){var c;if(null!=(c=A2Cribs.Login)&&c.logged_in)return $("ul.friends, #hotlist").addClass("dragging"),A2Cribs.HotlistObj.startedDragging()},stop:function(a){$("ul.friends, #hotlist").removeClass("dragging");
return A2Cribs.HotlistObj.stoppedDragging()},appendTo:"body"})};b.GetListingObjects=function(a){var b,e,g,f,h,k,l,m;h=[];l=0;for(m=a.length;l<m;l++)b=a[l],g={},e=A2Cribs.UserCache.Get("listing",b),k=f=null,null!=e&&(e.InSidebar(!0),k=A2Cribs.UserCache.Get("marker",e.marker_id),f=A2Cribs.UserCache.Get(A2Cribs.Map.ACTIVE_LISTING_TYPE,b),null!=f[0]&&(f=f[0])),null!=e&&(null!=k&&null!=f)&&(g.Listing=e,g.Marker=k,g.ListingObject=f,h.push(g));return h};b.BuildListingIds=function(a){var b,e,g,f,h;g=A2Cribs.UserCache.Get("listing");
b=[];f=0;for(h=g.length;f<h;f++)e=g[f],null!=e&&e.listing_id&&b.push(parseInt(e.listing_id));e=null;0<b.length&&(e=this.GetRandomListingsFromMap(2500,b));if(null==a&&null==e)return null;g=[];f=0;for(h=a.length;f<h;f++)b=a[f],b=parseInt(b),this.FLListingIds.push(b),g.push(b);if(null!=e){a=0;for(f=e.length;a<f;a++)b=e[a],g.push(b)}return g};b.SetupScrollEvents=function(){$(window).scroll(function(){if(!$(".fl-sb-item").hasClass("no-listings")&&$(this).scrollTop()+$(this).innerHeight()>=$(".featured-listings-wrapper").height())return A2Cribs.FeaturedListings.LoadMoreListings()});
return $("#listings-list").scroll(function(){if(!$(".fl-sb-item").hasClass("no-listings")&&$(this).scrollTop()+$(this).innerHeight()>=$("#ran-listings").height())return A2Cribs.FeaturedListings.LoadMoreListings()})};b.LoadMoreListings=function(){this.GetSidebarImagePathsDeferred=new $.Deferred;$("#loading-spinner").show();null!=this.current_index&&null!=this.listing_ids?(this.listingObjects=this.GetListingObjects(this.listing_ids.slice(this.current_index,+(this.current_index+24)+1||9E9)),this.GetSidebarImagePaths(this.listing_ids.slice(this.current_index,
+(this.current_index+24)+1||9E9)),this.sidebar.addListings(this.listingObjects,"ran"),this.current_index+=25):console.log("warning: no listing ids or current index found.");this.SetupListingItemEvents();return $.when(this.GetSidebarImagePathsDeferred).then(function(a){var b,e,g;a=JSON.parse(a);e=0;for(g=a.length;e<g;e++)b=a[e],null!=b&&null!=b.Image&&$("#fl-sb-item-"+b.Image.listing_id+" .img-wrapper").css("background-image","url(/"+b.Image.image_path+")");return $("#loading-spinner").hide()})};b.UpdateSidebar=
function(a){this.GetSidebarImagePathsDeferred=new $.Deferred;this.listing_ids=a;this.current_index=0;null!=this.listing_ids&&(this.listingObjects=this.GetListingObjects(this.listing_ids.slice(0,25)),this.sidebar.addListings(this.listingObjects,"ran",!0),this.GetSidebarImagePaths(this.listing_ids.slice(0,25)),this.SetupListingItemEvents());return $.when(this.GetSidebarImagePathsDeferred).then(function(a){var c,b,f;a=JSON.parse(a);b=0;for(f=a.length;b<f;b++)c=a[b],null!=c&&null!=c.Image&&$("#fl-sb-item-"+
c.Image.listing_id+" .img-wrapper").css("background-image","url(/"+c.Image.image_path+")");return $("#loading-spinner").hide()})};b.InitializeSidebar=function(c,b,e,g){var f=this;null==this.SidebarListingCache&&(this.SidebarListingCache={});null==this.FLListingIds&&(this.FLListingIds=[]);this.sidebar=new a($("#fl-side-bar"));this.current_index=0;c=this.GetFlIds(c);this.GetSidebarImagePathsDeferred=new $.Deferred;this.SetupResizing();this.SetupScrollEvents();$.when(c,g).then(function(a){a=f.BuildListingIds(a);
return null!=a?(f.sidebar.addListings(f.GetListingObjects(a.slice(0,25)),"ran",!0),f.listing_ids=a,f.GetSidebarImagePaths(a.slice(0,25)),f.SetupListingItemEvents(),$("#listings-list").on("click",".fl-sb-item",function(a){var c,b,d,e;c=$("#map_region");if(c.is(":visible"))return d=parseInt($(this).attr("marker_id")),b=parseInt($(this).attr("listing_id")),d=A2Cribs.UserCache.Get("marker",d),b=A2Cribs.UserCache.Get("listing",b),e=d.GMarker.getPosition(),A2Cribs.Map.GMap.setZoom(16),A2Cribs.MixPanel.Click(b,
"sidebar listing"),A2Cribs.Map.CenterMap(e.lat(),e.lng()),c.trigger("marker_clicked",[d]);if($(this).hasClass("expanded"))return $(this).removeClass("expanded");$(this).addClass("expanded");return setTimeout(function(){return $(".fl-sb-item.expanded").not(a.currentTarget).removeClass("expanded")},200)})):f.listing_ids=[]});$.when(this.GetSidebarImagePathsDeferred).then(function(a){var c,b,d,e;a=JSON.parse(a);e=[];b=0;for(d=a.length;b<d;b++)c=a[b],null!=c&&null!=c.Image?e.push($("#fl-sb-item-"+c.Image.listing_id+
" .img-wrapper").css("background-image","url(/"+c.Image.image_path+")")):e.push(void 0);return e});return $("#loading-spinner").hide()};b.GetSidebarImagePaths=function(a){return $.ajax({url:myBaseUrl+"Images/GetPrimaryImages/"+JSON.stringify(a),type:"GET",success:function(a){return b.GetSidebarImagePathsDeferred.resolve(a)},error:function(){return b.GetSidebarImagePathsDeferred.resolve(null)}})};b.LoadFeaturedPMListings=function(){return $.ajax({url:myBaseUrl+"Listings/GetFeaturedPMListings/"+A2Cribs.Map.CurentSchoolId,
type:"GET",success:function(a){b.FeaturedPMIdToListingIdsMap=JSON.parse(a);return $(".featured_pm").click(function(a){var c,g;g=$(a.delegateTarget).data("user-id");if(null!=b.FeaturedPMIdToListingIdsMap[g]){c=b.FeaturedPMIdToListingIdsMap[g];if(A2Cribs.Map.ToggleListingVisibility(c,"PM_"+g))return A2Cribs.Map.IsCluster(!0);A2Cribs.Map.IsCluster(!1);$(a.delegateTarget).addClass("active");return A2Cribs.MixPanel.Event("Sidebar Featured PM",{pm_id:g})}})},error:function(){return b.FeaturedPMIdToListingIdsMap=
[]}})};a=function(){function a(c){this.SidebarUI=c;this.ListItemTemplate=_.template(A2Cribs.FeaturedListings.ListItemHTML);this.EmptyListingsTemplate=_.template(A2Cribs.FeaturedListings.EmptyListingsHTML)}a.prototype.addListings=function(a,c,b){null==b&&(b=!1);a=null===a||0===a.length?$(this.EmptyListingsTemplate({clear:b})):this.getListHtml(a);return b?this.SidebarUI.find("#"+c+"-listings").html(a):this.SidebarUI.find("#"+c+"-listings").append(a)};a.prototype.getDateString=function(a){var c;null==
this.MonthArray&&(this.MonthArray="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "));c=this.MonthArray[a.getMonth()];a=a.getFullYear();return""+c+" "+a};a.prototype.getListHtml=function(a){var c,b,f,h,k,l,m,n,p,q,r,s,u,v,t,w;k=$("<div />");w=[];r=0;for(u=a.length;r<u;r++){l=a[r];p=m=c=h=q=null;p=null!=l.ListingObject.rent?parseFloat(l.ListingObject.rent).toFixed(0):" --";m=null!=l.Marker.alternate_name?l.Marker.alternate_name:l.Marker.street_address;h=null!=l.ListingObject.lease_length?
l.ListingObject.lease_length:"-- ";c=1<l.ListingObject.beds?""+l.ListingObject.beds+" beds":null!=l.ListingObject.beds?""+l.ListingObject.beds+" bed":"?? beds";null!=l.ListingObject.start_date?(q=l.ListingObject.start_date.toString().replace(" ","T"),q=this.getDateString(new Date(q))):q="Start Date --";null!=l.ListingObject.end_date&&(b=l.ListingObject.end_date.toString().replace(" ","T"),b=this.getDateString(new Date(b)));n="/img/sidebar/no_photo_small.jpg";if(null!=l.Image){t=l.Image;s=0;for(v=
t.length;s<v;s++)f=t[s],f.is_primary&&(n="/"+f.image_path)}c={rent:p,beds:c,building_type:l.Marker.building_type_id,start_date:q,end_date:b,lease_length:h,name:m,img:n,listing_id:l.Listing.listing_id,marker_id:l.Marker.marker_id,available:"undefined"===typeof l.Listing.available?"unknown":l.Listing.available?"available":"unavailable"};c=$(this.ListItemTemplate(c));A2Cribs.FavoritesManager.setFavoriteButton(c.find(".favorite"),l.Listing.listing_id,A2Cribs.FavoritesManager.FavoritesListingIds);c.find(".hotlist_share a").popover({content:function(){return A2Cribs.HotlistObj.getHotlistForPopup($(this).data("listing"))},
html:!0,trigger:"manual",placement:"left",container:"body",title:"Share this listing"}).click(function(a){a.preventDefault();$(this).popover("show");return $(".popover a").on("click",function(){$(".popover").popover("hide").hide();return $(".popover").off("click")})});c.find("#share-to-email").keyup(function(a){if(13===a.keyCode)return $(".share-to-email-btn").click()});w.push(k.append(c))}return w};return a}();b.EmptyListingsHTML="<div class='fl-sb-item no-listings'>\n    <% if (clear) { %>\n        <span class='no-listings-text'>No listings found for these filter settings. Try adjusting the filter for more results.</span>\n    <% } else { %>\n        <span class='no-listings-text'>No more listings found for these filter settings.</span>\n    <% } %>\n</div>";
b.ListItemHTML="<div id = 'fl-sb-item-<%= listing_id %>' class = 'fl-sb-item' listing_id=<%= listing_id %> marker_id=<%= marker_id %>>\n    <div class='listing-content'>\n        <div class = 'img-wrapper' style='background-image:url(\"<%=img%>\")'> </div>\n        <div class = 'info-wrapper'>\n            <div class = 'info-row'>\n                <span class = 'rent price-text'><%= \"$\" + rent %></span>\n                <span class = 'divider'>|</span>\n                <span class = 'beds'><%= beds %> </span>\n                <span class = 'favorite pull-right'><i class = 'icon-heart fav-icon share_btn favorite_listing' id='<%= listing_id %>' data-listing-id='<%= listing_id %>'></i></span>    \n                <span class = 'hotlist_share pull-right'><a href='#' data-listing=\"<%=listing_id%>\"><i class='fav-icon icon-user'></i></a></span>\n                <span class = 'hotlist-share-grab grab pull-right'><i class='icon-reorder'></i><i class='icon-reorder'></i><i class=\"icon-reorder\"></i></span>\n            </div>\n            <div class = 'info-row'>\n                <span class = 'building-type'><%= building_type %></span>\n                <span class = 'divider'>|</span>\n                <% if (typeof(end_date) != \"undefined\") { %>\n                <span class = 'lease-start'><%= start_date %></span> - <span class = 'lease_length'><%= end_date %></span>\n                <% } else { %>\n                <span class = 'lease-start'><%= start_date %></span> | <span class = 'lease_length'><%= lease_length %> mo.</span>\n                <% } %>\n            </div>\n            <div class = 'info-row'>\n                <i class = 'icon-map-marker <%= available %>'></i><span class = 'name'><%=name%></span>\n            </div>\n        </div>   \n    </div>\n    <div class='listing-actions'>\n        <ul class='action-row'>\n            <li class='hotlist-share'><a href='#'><i class=\"action-icon icon-heart favorite_listing\" data-listing-id='<%=listing_id%>'></i></a></li>\n            <li class='hotlist-share'><a href='/listing/<%=listing_id%>'><i class=\"action-icon icon-share\"></i></a></li>\n        </ul>\n    </div>\n</div>";
return b}.call(this);A2Cribs.Order=function(){function b(){}b.BuyItems=function(a,c,b,e,g){null==e&&(e=null);null==g&&(g=null);a={orderItems:JSON.stringify(a),order_type:c};return $.post(""+myBaseUrl+"order/buy",a,function(a){a=JSON.parse(a);if(a.success){if(null!=a.jwt)return google.payments.inapp.buy({parameters:{},jwt:a.jwt,success:function(){return alert("success")},failture:function(){return alert("fail")}});A2Cribs.UIManager.Alert(a.msg);return e()}b(a.errors)})};b.BuyCart=function(a,c){null==
a&&(a=null);null==c&&(c=null);return $.post(""+myBaseUrl+"order/buyCart",function(a){a=JSON.parse(a);a.success||console.log(a.message);return google.payments.inapp.buy({parameters:{},jwt:a.jwt,success:function(){return alert("success")},failture:function(){return alert("fail")}})})};b.AddToCart=function(a){a={orderItems:JSON.stringify(a)};return $.post(myBaseUrl+"shoppingCart/add",a,function(a){return JSON.parse(a).success?alertify.success("Added to cart",1500):alertify.error("Adding to cart failed",
1500)})};return b}();A2Cribs.FullListing=function(){function b(){}b.SetupUI=function(a){var c=this;this.listing_id=a;this.div=$(".full_page");this.div.find(".show_scheduling").click(function(b){var e;!0===(null!=(e=A2Cribs.Login)?e.logged_in:void 0)?null==$(b.currentTarget).attr("href")?$("#scheduling_tour_tab").click():($(b.currentTarget).tab("show"),A2Cribs.MixPanel.Event("Listing Click",{"display type":"full page schedule tour",listing_id:a})):($("#signup_modal").modal("show").find(".signup_message").text("Please sign in to schedule a tour."),
A2Cribs.MixPanel.Event("login required",{listing_id:c.listing_id,action:"full page schedule tour"}));return b.preventDefault()});this.div.find(".image_preview").click(function(a){var b;b=$(a.delegateTarget).css("background-image");c.div.find(".image_preview.active").removeClass("active");$(a.delegateTarget).addClass("active");return c.div.find("#main_photo").css("background-image",b)});this.div.find(".page_right").click(function(a){if(c.div.find(".image_preview.active").next().length)return a=c.div.find(".image_preview.active").next(),
c.div.find(".image_preview.active").removeClass("active"),a.addClass("active"),c.div.find("#main_photo").css("background-image",a.css("background-image"))});this.div.find(".page_left").click(function(a){if(c.div.find(".image_preview.active").prev().length)return a=c.div.find(".image_preview.active").prev(),c.div.find(".image_preview.active").removeClass("active"),a.addClass("active"),c.div.find("#main_photo").css("background-image",a.css("background-image"))});this.div.find("#contact_owner").click(function(){var b;
if(!0===(null!=(b=A2Cribs.Login)?b.logged_in:void 0))return A2Cribs.MixPanel.Event("Listing Click",{"display type":"full page contact user",listing_id:a}),c.div.find("#contact_owner").hide(),c.div.find("#contact_message").slideDown();$("#signup_modal").modal("show").find(".signup_message").text("Please sign in to contact the owner.");return A2Cribs.MixPanel.Event("login required",{listing_id:c.listing_id,action:"full page contact user"})});this.div.find("#message_cancel").click(function(){return c.div.find("#contact_message").slideUp("fast",
function(){return c.div.find("#contact_owner").show()})});return this.div.find("#message_send").click(function(){$("#message_send").button("loading");$("#loader").show();return $.ajax({url:myBaseUrl+"Messages/messageSublet",type:"POST",data:{listing_id:c.listing_id,message_body:$("#message_area").val()},success:function(a){a=JSON.parse(a);a.success?($("#message_area").val(""),A2Cribs.UIManager.Success("Message Sent!"),A2Cribs.MixPanel.Event("message sent",{listing_id:c.listing_id})):null!=a.message?
A2Cribs.UIManager.Error(a.message):A2Cribs.UIManager.Error("Message Failed! Please Try Again.");return $("#message_send").button("reset")},complete:function(){return $("#loader").hide()}})})};b.Directive=function(a){if(null!=a.contact_owner)return this.div.find("#contact_owner").click();if(null!=a.schedule)return this.div.find("#scheduling_tour_tab").click()};return b}();A2Cribs.Dashboard=function(){function b(){}b.SetupUI=function(){var a,c=this;$(window).resize(function(){return c.SizeContent()});
this.SizeContent();$(".content-header").each(function(a,b){var g,f,h;h=$(b);g=h.attr("classname");f=$("."+g+"-content");$(b).click(function(a){var b;return null!=(b=A2Cribs.RentalSave)&&b.Editable?A2Cribs.UIManager.ConfirmBox("By leaving this page, all unsaved changes will be lost.",{ok:"Abort Changes & Continue",cancel:"Return to Editor"},function(b){if(b)return A2Cribs.RentalSave.CancelEditing(),c.ContentHeaderClick(a)}):c.ContentHeaderClick(a)});return"function"===typeof h.next?h.next(".drop-down").find(".drop-down-list").click(function(){return c.ShowContent(f)}):
void 0});$("#feature-btn").click(function(a){return c.Direct({classname:"featured-listing"})});$("body").on("click",".messages_list_item",function(a){return c.ShowContent($(".messages-content"))});a=$("#navigation-bar").parent().height()-$("#navigation-bar").height()-68;$(".list_content").css("height",a+"px");$(".dropdown-search").keyup(function(a){var c;c=$(a.delegateTarget).attr("data-filter-list");return $(""+c+" li").show().filter(function(){return-1===$(this).text().toLowerCase().indexOf($(a.delegateTarget).val().toLowerCase())?
!0:!1}).hide()});this.AttachListeners();return this.GetUserMarkerData()};b.AttachListeners=function(){return $(".list_content").on("marker_added",function(a,c){var b,e,g;g=$(a.currentTarget).data("listing-type");if(0===$(a.currentTarget).find("#"+c).length)return b=A2Cribs.UserCache.Get("marker",c).GetName(),e=$("<li />",{text:b,"class":""+g+"_list_item",id:c}),b=$("#"+g+"_count").text(),$("#"+g+"_count").text(parseInt(b,10)+1),$(a.currentTarget).append(e),$(a.currentTarget).slideDown()})};b.ContentHeaderClick=
function(a){var c,b,e;e=$(a.delegateTarget);c=e.attr("classname");b=$("."+c+"-content");$(".content-header.active").removeClass("active");$(a.delegateTarget).addClass("active");if(e.hasClass("list-dropdown-header")){if(!$("#"+c+"_list").is(":visible"))return 0!==$(".list-dropdown.active").size()?$(".list-dropdown.active").removeClass("active").slideUp("fast",function(){return $("#"+c+"_list").addClass("active").slideDown()}):$("#"+c+"_list").addClass("active").slideDown()}else return $(".list-dropdown").slideUp(),
this.ShowContent(b,!0)};b.GetUserMarkerData=function(){var a=this;if(null!=this.MarkerDataDeferred)return this.MarkerDataDeferred;$.ajax({url:myBaseUrl+"listings/GetMarkerDataByLoggedInUser",type:"GET",success:function(c){a.GetUserMarkerDataCallback(c);return a.MarkerDataDeferred.resolve(c)}});this.MarkerDataDeferred=new $.Deferred;return this.MarkerDataDeferred.promise()};b.GetUserMarkerDataCallback=function(a){var c,b,e,g,f,h,k;g=[0,0,0];b=["rental","sublet","parking"];A2Cribs.UserCache.CacheData(JSON.parse(a));
e=A2Cribs.UserCache.Get("listing");h=0;for(k=e.length;h<k;h++)a=e[h],f=A2Cribs.UserCache.Get("marker",a.marker_id),0===$("#"+b[a.listing_type]+"_list_content").find("#"+f.GetId()).length&&(c=$("<li />",{text:f.GetName(),"class":""+b[a.listing_type]+"_list_item",id:f.GetId()})),$("#"+b[a.listing_type]+"_list_content").append(c),g[a.listing_type]+=1;h=[];c=e=0;for(f=b.length;e<f;c=++e)a=b[c],h.push($("#"+a+"_count").text(g[c]));return h};b.GetListings=function(){if(null==this.DeferedListings)this.DeferedListings=
new $.Deferred;else return this.DeferedListings.promise();$.ajax({url:myBaseUrl+"listings/GetListing",type:"GET",success:this.GetListingsCallback});return this.DeferedListings.promise()};b.GetListingsCallback=function(a){var c,d,e,g,f,h,k,l,m,n,p,q,r,s;f=JSON.parse(a);r=0;for(s=f.length;r<s;r++)for(c in a=f[r],a)q=a[c],null!=A2Cribs[c]&&A2Cribs.UserCache.Set(new A2Cribs[c](q));f=A2Cribs.UserCache.Get("listing");c={};q=0;for(r=f.length;q<r;q++)a=f[q],null==c[a.listing_type]&&(c[a.listing_type]={}),
c[a.listing_type][a.marker_id]=!0;b.DeferedListings.resolve();h=[0,0,0];g=["rentals","sublet","parking"];a=[];for(e in c)m=c[e],a.push(function(){var a;a=[];for(l in m)k=A2Cribs.UserCache.Get("marker",l),n=k.GetName(),p=g[parseInt(e,10)],h[parseInt(e,10)]++,d=$("<li />",{text:n,"class":""+p+"_list_item",id:k.marker_id}),a.push($("#"+p+"_list_content").append(d));return a}());return a};b.SizeContent=function(){};b.SlideDropDown=function(a,c){var b,e;b=a.next(".drop-down");if(0!==b.length)return e=
a.children("i")[0],$(e).toggleClass("icon-caret-right",!c).toggleClass("icon-caret-down",c),$(a).toggleClass("shadowed",c).toggleClass("expanded",c).toggleClass("minimized",!c),c?b.slideDown("fast"):b.slideUp("fast")};b.ShowContent=function(a){a.siblings().addClass("hidden").hide();a.removeClass("hidden").hide().fadeIn();return a.trigger("shown")};b.HideContent=function(a){return $("."+a+"-content").addClass("hidden")};b.Direct=function(a){$("#"+a.classname+"-content-header").trigger("click");if(null!=
a.data)return this.ShowContent($("."+a.classname+"-content"))};return b}.call(this);A2Cribs.Account=function(){function b(){}b.setupUI=function(){var a,c,b=this;a=null!=(c=A2Cribs.VerifyManager)?c.getMyVerification():void 0;c=$("#my-verification-panel");null!=a&&(a.verified_email&&c.find("#veri-email i:last-child").removeClass("unverified icon-remove-sign").addClass("verified icon-ok-sign"),a.verified_edu&&c.find("#veri-edu i:last-child").removeClass("unverified icon-remove-sign").addClass("verified icon-ok-sign"),
a.verified_fb?c.find("#veri-fb  i:last-child").removeClass("unverified icon-remove-sign").addClass("verified icon-ok-sign"):$("#veri-fb").append("<a href = '#'>Verify?</a>").click(this.FacebookConnect));$(".veridd").each(function(a,c){return $(c).tooltip({title:"Verify?",trigger:"hover"})});$("#changePasswordButton").click(function(a){$(a.delegateTarget).button("loading");return b.ChangePassword($("#changePasswordButton"),$("#new_password").val(),$("#confirm_password").val(),$("#u_id").val(),$("#reset_token").val()).always(function(){return $(a.delegateTarget).button("reset")})});
$("#VerifyUniversityButton").click(function(a){return b.VerifyUniversity()});$("#changePhoneBtn").click(function(a){$(a.delegateTarget).button("loading");return b.SavePhone().always(function(){return $(a.delegateTarget).button("reset")})});$("#changeAddressBtn").click(function(a){$(a.delegateTarget).button("loading");return b.SaveAddress().always(function(){return $(a.delegateTarget).button("reset")})});$("#changeCompanyNameBtn").click(function(a){$(a.delegateTarget).button("loading");return b.SaveCompanyName().always(function(){return $(a.delegateTarget).button("reset")})});
$("#changeFirstLastNameButton").click(function(a){$(a.delegateTarget).button("loading");return b.SaveFirstLastName().always(function(){return $(a.delegateTarget).button("reset")})});return $("#changeEmailButton").click(function(a){$(a.delegateTarget).button("loading");return b.SaveEmail().always(function(){return $(a.delegateTarget).button("reset")})})};b.SaveFirstLastName=function(){var a;a={first_name:$("#first_name_input").val(),last_name:$("#last_name_input").val()};return this.SaveAccount(a,
$("#changeFirstLastNameButton"))};b.SaveEmail=function(){var a;a={email:$("#new_email").val()};return this.SaveAccount(a,$("#changeEmailButton"))};b.SaveCompanyName=function(){var a;a={company_name:$("#company_name_input").val()};return this.SaveAccount(a,$("#changeCompanyNameButton"))};b.SavePhone=function(){var a;a=$("#phone_input").val();if(this.ValidatePhone(a))return a={phone:a},this.SaveAccount(a,$("#changePhoneBtn"));A2Cribs.UIManager.Error("Invalid phone number");return(new $.Deferred).reject()};
b.ValidatePhone=function(a){a=a.replace(/[^0-9]/g,"");return 10===a.length};b.SaveAddress=function(){var a,c;c=$("#street_address_input").val();a=$("#city_address_input").val();return this.SaveAccount({street_address:c,city:a},$("#changeAddressBtn"))};b.Direct=function(a){};b.VerifyUniversity=function(){var a,c;$("#VerifyUniversityButton").attr("disabled","disabled");c=$("#university_email").val();a={university_email:c};return-1!==c.search(".edu")?$.post(myBaseUrl+"users/verifyUniversity",a,function(c){console.log(a);
c=JSON.parse(c);1===c.success?A2Cribs.UIManager.Error("Please check your email for a verification link."):A2Cribs.UIManager.Error("Verification not successful: "+c.message);return $("#VerifyUniversityButton").removeAttr("disabled")}):A2Cribs.UIManager.Error("Please enter a university email.")};b.ChangePassword=function(a,c,b,e,g,f){var h=this;null==e&&(e=null);null==g&&(g=null);null==f&&(f=null);this._change_password_deferred=new $.Deferred;a={new_password:c,confirm_password:b};null!==e&&null!==g&&
(a.id=e,a.reset_token=g);if(5>c.length)return A2Cribs.UIManager.Alert("Password must be at least 6 characters long."),this._change_password_deferred.reject();if(c!==b)return A2Cribs.UIManager.Alert("Passwords do not match."),this._change_password_deferred.reject();$.ajax({url:myBaseUrl+"users/AjaxChangePassword",data:a,type:"POST",success:function(a){a=JSON.parse(a);if(null!=a.error)return A2Cribs.UIManager.Alert(a.error),h._change_password_deferred.reject();null===e&&null===g?(alertify.success("Password Changed",
3E3),null!==f&&(window.location.href=f)):window.location.href="/dashboard";return h._change_password_deferred.resolve()},error:function(){return h._change_password_deferred.reject()}});return this._change_password_deferred.promise()};b.SaveAccount=function(a,c){null==a&&(a=null);null==c&&(c=null);return $.post(myBaseUrl+"users/AjaxEditUser",a,function(a){a=JSON.parse(a);void 0===a.error?alertify.success("Account Saved",3E3):A2Cribs.UIManager.Error("Account Failed to Save: "+a.error);if(null!=c)return c.removeAttr("disabled")})};
b.FacebookConnect=function(){return FB.login(function(a){$.ajax({url:myBaseUrl+"account/verifyFacebook",data:{signed_request:a.authResponse.signedRequest},type:"POST"});return document.location.href="/account"})};b.SubmitResetPassword=function(a){var c;c="email="+$("#UserEmail").val();return $.post("/users/AjaxResetPassword",c,function(a){c=JSON.parse(a);null!=c.success?A2Cribs.UIManager.Alert("Email sent to reset password!"):A2Cribs.UIManager.Error(c.error);return!1})};return b}();A2Cribs.Messages=
function(){function b(){}var a;b.setupUI=function(){var a=this;$("#send_reply").click(function(){return a.sendReply()});$("#view_unread_cb").change(function(){return a.toggleUnreadConversations()});$("#refresh_content").click(function(){return a.refresh()});$("#current_conversation").scroll(function(b){return a.MessageScrollingHandler(b)});$("#meaning").click(function(){return $("#hidden-meaning").fadeToggle()});$("#delete_conversation").click(function(){return a.DeleteConversation()});return this.refresh()};
b.ScrollMessagesTo=function(a){var b;b=$("#current_conversation");a=b.offset().top+b.innerHeight()-(a.offset().top+a.innerHeight()+10);return b.scrollTop(b.scrollTop()-a)};b.MessageScrollingHandler=function(a){if(!(20<$("#current_conversation").scrollTop()||0===this.NumMessagePages))return this.loadMessages(this.NumMessagePages+1)};b.refresh=function(){this.refreshUnreadCount();this.refreshConversations();if(-1!==this.CurrentConversation)return this.refreshParticipantInfo(),this.refreshMessages()};
b.refreshUnreadCount=function(){return $.get(myBaseUrl+"messages/getUnreadCount",function(a){a=JSON.parse(a);return $("#message_count").html(a.unread_messages)})};b.refreshConversations=function(){var a=this;return $.get(myBaseUrl+"messages/getConversations",function(b){var e,g,f,h,k,l;$("#messages_list_content").empty();b=JSON.parse(b);l=[];f=0;for(h=b.length;f<h;f++)e=b[f],g=null!=(k=e.Participant.first_name)&&k.length?e.Participant.first_name:e.Participant.company_name,g='<div class="message_title">'+
e.Conversation.title+'</div>\n<div class="message_desc">\n\t'+(e.Last_Message.user_id===e.Participant.id?g:"Me")+": "+e.Last_Message.body+"\n</div>",g=$("<li />",{html:g,"class":"messages_list_item",id:e.Conversation.conversation_id,"data-participant":e.Participant.id,"data-listing":e.Conversation.listing_id,"data-title":e.Conversation.title}),0<parseInt(e.Conversation.unread_message_count,10)&&g.addClass("unread"),$("#messages_list_content").append(g),l.push(a.attachConversationListItemHandler(g));
return l})};b.toggleUnreadConversations=function(){this.ViewOnlyUnread=$("#view_unread_cb").is(":checked");return this.refreshConversations()};b.refreshParticipantInfo=function(){var a,d;d=b.CurrentParticipantID;a=b.CurrentConversation;if(null!=b.ParticipantInfoCache[d])b.setParticipantInfoUI(b.ParticipantInfoCache[d]);else return a=a=myBaseUrl+"messages/getParticipantInfo/"+a+"/",$.ajax({url:a,type:"GET",success:function(a){a=JSON.parse(a);b.ParticipantInfoCache[a.id]=a;return b.setParticipantInfoUI(b.ParticipantInfoCache[d])}})};
b.setParticipantInfoUI=function(a){var b;b="";null!=a.first_name&&(b+=a.first_name,null!=a.last_name&&(b+=" "+a.last_name));$(".from_participant").html(b);b="img/head_large.jpg";null!=a.profile_img?b="/"+a.profile_img:null!=a.facebook_id&&(b="https://graph.facebook.com/"+a.facebook_id+"/picture?width=480");return $("#p_pic").attr("src",b)};b.loadConversation=function(a){var b,e;$(".messages_list_item").removeClass("selected");$(a.currentTarget).addClass("selected").removeClass("unread");e=parseInt($(a.currentTarget).find(".notification_count").text(),
10);0<e&&(b=parseInt($("#message_count").text(),10),$(a.currentTarget).find(".notification_count").text("0"),$("#message_count").text(b-e));this.CurrentConversation=parseInt($(a.delegateTarget).attr("id"));this.CurrentParticipantID=$(a.delegateTarget).attr("data-participant");$("#message_reply").show();$("#participant_info_short").show();e=$(a.delegateTarget).attr("data-title");b=$(a.delegateTarget).attr("data-listing");$("#listing_title").text(e).attr("href","/listings/view/"+b);this.refreshParticipantInfo();
this.refreshUnreadCount();return this.refreshMessages(a)};b.loadMessages=function(b,d,e){var g,f=this;null==d&&(d=!1);null==e&&(e=null);if("pending"!==(null!=(g=this.DeferredLoadMessages)?g.state():void 0))return this.DeferredLoadMessages=new $.Deferred,g=myBaseUrl+"messages/getMessages/"+this.CurrentConversation+"/"+b+"/",$.get(g,function(g,k){var l,m,n,p,q,r,s;q=JSON.parse(g);if(void 0!==q.error)f.DeferredLoadMessages.resolve();else{p=$("#message_list");l=p.innerHeight();n="";r=0;for(s=q.length;r<
s;r++)m=q[r],n+=a(m);$(n).hide().prependTo("#message_list").fadeIn();$(".mli").each(function(a,b){var c;c=$(this).find(".message_buble").height();return $(this).css("height",c+"px")});d?f.ScrollMessagesTo($("#mli_0")):(l=p.innerHeight()-l,$("#current_conversation").scrollTop($("#current_conversation").scrollTop()+l));$("#current_conversation").trigger("scroll");null!=e&&f.attachConversationListItemHandler(e.delegateTarget);f.NumMessagePages=b;return f.DeferredLoadMessages.resolve()}}).fail(function(){return f.NumMessagePages=
0}),this.DeferredLoadMessages.promise()};b.attachConversationListItemHandler=function(a){var b=this;return $(a).one("click",function(a){return b.loadConversation(a)})};b.refreshMessages=function(a){this.NumMessagePages=1;$("#message_list").empty();$("#loader").show();return this.loadMessages(this.NumMessagePages,!0,a).always(function(){return $("#loader").hide()})};b.sendReply=function(a){var b=this;a=$("#message_text textarea").val();if(0===a.length)return A2Cribs.UIManager.Error("Message can not be empty"),
!1;$("#send_reply").button("loading");a=$("#message_text textarea").val();$.post(myBaseUrl+"messages/newMessage/",{message_text:a,conversation_id:this.CurrentConversation},function(a){b.refreshMessages();b.refreshConversations();$("#message_text textarea").val("");JSON.parse(a);if(!1===(null!=a?a.success:void 0))return A2Cribs.UIManager.Error("Something went wrong while sending a reply, please refresh the page and try again")}).always(function(){return $("#send_reply").button("reset")});return!1};
b.DeleteConversation=function(){var a=this;return $.post(myBaseUrl+"messages/deleteConversation/",{conv_id:this.CurrentConversation},function(b){var e;try{e=JSON.parse(b)}catch(g){A2Cribs.UIManager.Error("Failed to delete the conversation");return}return 1===e.success?(alertify.success("Conversation deleted",3E3),a.CurrentConversation=-1,a.CurrentParticipantID=-1,A2Cribs.Dashboard.HideContent("messages"),a.refresh()):A2Cribs.UIManager.Error("Failed to delete the conversation")})};a=function(a){return"<div class = 'mli mli-"+
a.side+"-side row-fluid' id = 'mli_"+a.count+"' meta = '"+a.id+"'>\t\t\t<div class = 'span12'>\t\t\t\t<div class = 'participant_message_pic'>\t\t\t\t\t\t<img src = '"+a.pic+"'></img>\t\t\t\t</div>\t\t\t\t<img src = '/img/messages/arrow-"+a.side+".png' class = 'arrow-"+a.side+"'></img>\t\t\t\t<div class = 'message_bubble'>\t\t\t\t\t<div>\t\t\t\t\t\t<span class = 'bubble-top-row'>\t\t\t\t\t\t\t<strong>"+a.name+":</strong>\t\t\t\t\t\t\t<span class = 'time-ago'>"+a.time_ago+"</span>\t\t\t\t\t\t</span>\t\t\t\t\t\t<p class = 'message_body'>"+
a.body+"</p>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t</div>\t\t</div>"};b.Direct=function(a){var b;if(null!=a.data&&"messages"===a.classname)return this.CurrentConversation=b=parseInt(a.data.conversation_id),this.CurrentParticipantID=b=parseInt(a.data.participant_id),$("#listing_title").text(a.data.title)};b.init=function(a){this.me=a;this.ViewOnlyUnread=!1;null==this.CurrentConversation&&(this.CurrentConversation=-1);this.DropDownVisible=!1;this.NumMessagePages=-1;null==this.CurrentParticipantID&&(this.CurrentParticipantID=
-1);this.ParticipantInfoCache={};return this.LoadingMessages=!1};return b}.call(this);A2Cribs.PropertyManagement=function(){function b(){}b.removeSublet=function(a){return alertify.confirm("Are you sure you want to delete this property? This can't be undone.",function(b){if(b)return b=myBaseUrl+("sublets/remove/"+a),window.location.href=b})};return b}();A2Cribs.MobileFilter=function(b){function a(){return Q=a.__super__.constructor.apply(this,arguments)}x(a,b);a.FilterData={};a.SetupUI=function(){var a=
this;this.div=$("#mobile_filter");this.div.find("select#listing_type").change(function(b){var e;console.log($(b.target).val());e=a.div.data("university-name");switch($(b.target).val()){case "Rentals":return window.location.href="/rental/"+e;case "Sublets":return window.location.href="/sublet/"+e}});this.div.find("select#bedrooms").change(function(b){var e,g,f;b=$(b.target).find("option:selected");g=parseInt(b.data("min"),10);e=parseInt(b.data("max"),10);return a.ApplyFilter("Beds",function(){f=[];
for(var a=g;g<=e?a<=e:a>=e;g<=e?a++:a--)f.push(a);return f}.apply(this))});return this.div.find("select#rent").change(function(b){b=$(b.target).find("option:selected");return a.ApplyFilter("Rent",{min:parseInt(b.data("min"),10),max:parseInt(b.data("max"),10)})})};a.ApplyFilter=function(a,b){var e,g,f,h;null!=b?this.FilterData[a]=b:delete this.FilterData[a];e="";g=!0;h=this.FilterData;for(f in h)b=h[f],g||(e+="&"),g=!1,e+=f+"="+JSON.stringify(b);$("#loader").show();return $.ajax({url:myBaseUrl+("Listings/ApplyFilter/"+
A2Cribs.FilterManager.ActiveListingType),data:e,type:"GET",context:this,success:A2Cribs.FilterManager.UpdateListings,complete:function(){return $("#loader").hide()}})};a.GetBackendDateFormat=function(a){var b,e;a=new Date(a);e=a.getMonth()+1;10>e&&(e="0"+e);b=a.getDate();10>b&&(b="0"+b);return a.getUTCFullYear()+"-"+e+"-"+b};return a}(A2Cribs.FilterManager);A2Cribs.VerifyManager=function(){function b(){}b.init=function(a){null==a&&(a=null);this.me=a;return this.VerificationData={}};b.getVerificationFor=
function(a){var b;null==this.VerificationData[a.id]&&(b=new $.Deferred,this.VerificationData[a.id]=b,$.when(this.getTotalFriends(a),this.getMutalFriends(a),this.getTwitterFollowers(a)).done(function(d,e,g){return b.resolve({user_id:a.id,fb_id:a.facebook_id,verified_email:!0===a.verified,verified_edu:!0===a.university_verified,tw_id:a.twitter_userid,verified_fb:d,mut_friends:e,tot_friends:d,verified_tw:null!=g,tot_followers:g})}));return this.VerificationData[a.id]};b.getMutalFriends=function(a){var b,
d;b=new $.Deferred;return null!=(null!=(d=this.me)?d.facebook_id:void 0)&&null!=a.facebook_id?(a="SELECT uid FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = "+this.me.facebook_id+") AND uid IN (SELECT uid2 FROM friend WHERE uid1 = "+a.facebook_id+")",FB.api({method:"fql.query",query:a},function(a){null!=a.error_code&&(console.log("Error during verification fb error: "+a.error_code+"."),b.resolve(null));return b.resolve(a.length)}),b.promise()):b.resolve(null)};b.getTotalFriends=function(a){var b;
b=new $.Deferred;return null!=a.facebook_id?(a="SELECT friend_count FROM user WHERE uid = "+a.facebook_id,FB.api({method:"fql.query",query:a},function(a){null!=a.error_code&&(console.log("Error during verification fb error: "+a.error_code+"."),b.resolve(null));return b.resolve(parseInt(a[0].friend_count))}),b.promise()):b.resolve(null)};b.getTwitterFollowers=function(a){var b;b=new $.Deferred;return null!=a.twitter_userid?($.ajax({url:myBaseUrl+"Users/GetTwitterFollowers/"+a.id,type:"GET",success:function(a){a=
JSON.parse(a);return b.resolve(a.followers_count)}}),b.promise()):b.resolve(null)};b.getMyVerification=function(){return null==this.me?null:{user_id:parseInt(this.me.id),fb_id:parseInt(this.me.facebook_id),tw_id:this.me.twitter_userid,verified_email:!0===this.me.verified,verified_edu:!0===this.me.university_verified,verified_fb:null!=this.me.facebook_id,verified_tw:null!=this.me.twitter_userid}};return b}();A2Cribs.UserCache=function(){function b(){}var a,c;b.Cache={};c=function(a,b,c){var f;if("listing"===
a||"rental"===a)f=myBaseUrl+"Listings/GetListing/"+b;return $.ajax({url:f,type:"GET",success:function(a){return null!=c?c.success(JSON.parse(a)):void 0},error:function(){return null!=c?c.error():void 0}})};a=function(a){var c,g,f,h,k;k=[];for(g in a)h=a[g],null!=A2Cribs[g]?(c=new A2Cribs[g](h),f=b.Get(g.toLowerCase(),c.GetId()),null!=f&&null==f.length&&(c=f.Update(h)),k.push(b.Set(c))):k.push(void 0);return k};b.CacheData=function(b){var c,g,f,h;if(b instanceof Array){h=[];g=0;for(f=b.length;g<f;g++)c=
b[g],h.push(a(c));return h}return a(b)};b.GetListing=function(a,b){var c,f,h=this;c=new $.Deferred;if(null==a||null==b)return c.reject();f=A2Cribs.UserCache.Get(a,b);if(null!=f&&f.IsComplete())return c.resolve(f);$.ajax({url:myBaseUrl+"Listings/GetListing/"+b,type:"GET",success:function(k){k=JSON.parse(k);h.CacheData(k);f=h.Get(a,b);return c.resolve(f)},error:function(){return c.reject()}});return c.promise()};b.GetDiferred=function(a,b){var g,f,h=this;g=new $.Deferred;f=this.Get(a,b);return null==
f||!f.IsComplete()?(c(a,b,{success:function(c){var g,m,n,p,q;p=0;for(q=c.length;p<q;p++)for(g in m=c[p],m)n=m[g],null!=A2Cribs[g]&&h.Set(new A2Cribs[g](n));return f=h.Get(a,b)},error:function(){return g.resolve(null)}}),g.promise()):g.resolve(f)};b.Set=function(a){null==this.Cache[a.class_name]&&(this.Cache[a.class_name]={});return this.Cache[a.class_name][a.GetId()]=a};b.Get=function(a,b){var c,f;if(null!=this.Cache[a]){if(null!=b)return this.Cache[a][b];f=[];for(c in this.Cache[a])f.push(this.Cache[a][c]);
return f}return null!=b?null:[]};b.Remove=function(a,b){if(null!=this.Cache[a]&&null!=b)return delete this.Cache[a][b]};b.GetAllAssociatedObjects=function(a,b,c){var f,h,k,l;if(null!=a&&null!=b&&null!=c){h={};l=[];c=parseInt(c,10);for(f in this.Cache[a])null!=this.Cache[a][f][""+b+"_id"]&&(k=parseInt(this.Cache[a][f][""+b+"_id"],10),k===c&&(h[this.Cache[a][f].GetId()]=!0));for(f in h)l.push(this.Get(a,f));return l}};return b}.call(this);(function(){function b(){}var a,c,d,e;b.DATE_RANGE_SIZE=3;b.current_offset=
1;b.selected_timeslots={};e="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ");c="January February March April May June July August September October November December".split(" ");d=[9,10,11,12,13,14,15,16,17,18,19,20];a=function(a){null==a&&(a=0);a=new Date((new Date).getTime()+864E5*a);return{date:a.getDate(),day:e[a.getDay()],month:c[a.getMonth()],year:a.getYear()}};$(document).ready(function(){if($("#schedule_tour").length)return b.SetupCalendarUI(),b.SetDates(b.current_offset),
b.SetupInfoUI(),$(document).on("logged_in",function(a,b){if(null!=(null!=b?b.phone:void 0))return $("#phone_verified").val(b.phone),$("#verify_phone_number").val(b.phone),$("#verify_phone_btn").addClass("verified").text("Verified").prop("disabled",!0)})});b.SetupCalendarUI=function(){var a=this;$(".time_slot").mouseenter(function(a){var b;b=$(a.delegateTarget).find(".time_slot_filler");$(a.delegateTarget).hasClass("selected")&&b.find("i").removeClass("icon-ok-sign").addClass("icon-remove-sign");return b.show()}).mouseleave(function(a){var b;
b=$(a.delegateTarget).find(".time_slot_filler");return $(a.delegateTarget).hasClass("selected")?b.show().find("i").removeClass("icon-remove-sign").addClass("icon-ok-sign"):b.hide()}).click(function(b){var c;c=$(b.delegateTarget).find(".time_slot_filler");if($(b.delegateTarget).hasClass("selected"))return c.hide().find("i").removeClass("icon-remove-sign").addClass("icon-plus-sign"),$(b.delegateTarget).removeClass("selected"),c=parseInt($(b.delegateTarget).attr("data-dateoffset"),10),a.DeleteTimeSlot(a.current_offset+
c,$(b.delegateTarget).attr("data-timeslot"));c.show().find("i").removeClass("icon-plus-sign").addClass("icon-ok-sign");$(b.delegateTarget).addClass("selected");c=parseInt($(b.delegateTarget).attr("data-dateoffset"),10);return a.AddTimeSlot(a.current_offset+c,$(b.delegateTarget).attr("data-timeslot"))});$("#next_date").click(function(){a.current_offset+=a.DATE_RANGE_SIZE;a.SetDates(a.current_offset);if(a.current_offset>a.DATE_RANGE_SIZE)return $("#prev_date").removeClass("disabled")});$("#prev_date").click(function(){if(0<
a.current_offset-a.DATE_RANGE_SIZE&&(a.current_offset-=a.DATE_RANGE_SIZE,a.SetDates(a.current_offset),a.current_offset<a.DATE_RANGE_SIZE))return $("#prev_date").addClass("disabled")});return $("#request_times_btn").click(function(){if(3<=a.TimeSlotCount())return $("#calendar_picker").hide(),$("#schedule_info").show(),A2Cribs.MixPanel.Event("Request My Times",{success:!0});A2Cribs.UIManager.CloseLogs();A2Cribs.UIManager.Error("Please select at least three time slots that work for you!");return A2Cribs.MixPanel.Event("Request My Times",
{success:!1})})};b.SetupInfoUI=function(){var a=this;$("body").on("keyup",".roommate_input",function(a){var b;if(0!==(null!=(b=$(a.currentTarget.parentElement).find(".roommate_name").val())?b.length:void 0))if(b=/\S+@\S+\.\S+/,b.test($(a.currentTarget.parentElement).find(".roommate_email").val())){$(a.currentTarget.parentElement).addClass("completed_roommate");return}return $(a.currentTarget.parentElement).removeClass("completed_roommate")});$("#back_to_timeslots").click(function(){$("#schedule_info").hide();
return $("#calendar_picker").show()});$("#add_roommate_email").click(function(){var a;a=$(".email_row").last().data("email-row");a=$("<div data-email-row='"+(a+1)+"' class='row-fluid email_row'>\t\t\t\t<input class='roommate_input roommate_name' type='text' placeholder='Name'>\t\t\t\t<input class='roommate_input roommate_email' type='email' placeholder='Email'>\t\t\t\t<span class='complete_email'><i class='icon-ok-sign icon-large'></i></span>\t\t\t</div>");return $("#email_invite_list").append(a)});
$("#verify_phone_number").keyup(function(){var a;a=$("#verify_phone_number").val();return 0<(null!=a?a.length:void 0)&&a===$("#phone_verified").val()?$("#verify_phone_btn").addClass("verified").text("Verified").prop("disabled",!0):$("#verify_phone_btn").removeClass("verified").text("Click to Verify").prop("disabled",!1)});$("#verify_phone_btn").click(function(){var a;a=$("#verify_phone_number").val();if(10!==(null!=a?a.length:void 0)||isNaN(a))A2Cribs.UIManager.CloseLogs(),A2Cribs.UIManager.Error("Please enter a valid phone number");
else return $.ajax({url:myBaseUrl+"Users/SendPhoneVerificationCode",type:"POST",data:{phone:a},success:function(){return A2Cribs.MixPanel.Event("Send Verify Text",{success:!0})},error:function(){return A2Cribs.MixPanel.Event("Send Verify Text",{success:!1})}}),$("#verify_phone").modal("show")});$("#confirm_validation_code").click(function(){var a;a=$("#verification_code").val();return 5!==(null!=a?a.length:void 0)?(A2Cribs.UIManager.CloseLogs(),A2Cribs.UIManager.Error("Invalid Code!"),!1):$.ajax({url:myBaseUrl+
"Users/ConfirmPhoneVerificationCode",type:"POST",data:{code:a},success:function(a){a=JSON.parse(a);if(null!=a.error)return A2Cribs.UIManager.Error(a.error),A2Cribs.MixPanel.Event("Phone verify completed",{success:!1});A2Cribs.UIManager.Success("Phone Number Verified!");$("#verify_phone").modal("hide");$("#phone_verified").val($("#verify_phone_number").val());$("#verify_phone_btn").addClass("verified").text("Verified").prop("disabled",!0);return A2Cribs.MixPanel.Event("Phone verify completed",{success:!0})},
error:function(){A2Cribs.UIManager.CloseLogs();return A2Cribs.UIManager.Error("Invalid Code!")}})});return $("#complete_tour_request").click(function(){var b;b=$("#verify_phone_number").val();if(10!==(null!=b?b.length:void 0)||isNaN(b))A2Cribs.UIManager.CloseLogs(),A2Cribs.UIManager.Error("Please enter a valid phone number");else if(0===(null!=b?b.length:void 0)||b!==$("#phone_verified").val())A2Cribs.UIManager.CloseLogs(),A2Cribs.UIManager.Error("Please click the verify button to send verification text");
else return $("#complete_tour_request").button("loading"),a.RequestTourTimes($("#listing-data").data("listing-id"),$("#tour_notes").val(),a.GetHousematesList()).done(function(a){if(null!=a.error)A2Cribs.UIManager.Error(a.error);else return $(".schedule_page").hide(),$("#schedule_completed").show(),A2Cribs.UIManager.Success("Your tour times have been received"),A2Cribs.MixPanel.Event("Finished Tour",{success:!0})}).fail(function(){A2Cribs.UIManager.CloseLogs();A2Cribs.UIManager.Error("Failed to request tour times. Sorry. Please contact help@cribspot.com if this continues to be an issue");
return A2Cribs.MixPanel.Event("Finished Tour",{success:!1})}).always(function(){return $("#complete_tour_request").button("reset")})})};b.GetHousematesList=function(){var a;a=[];$(".completed_roommate").each(function(b,c){return a.push({name:$(c).find(".roommate_name").val(),email:$(c).find(".roommate_email").val()})});return a};b.AddTimeSlot=function(a,b){var c;c=new Date;return this.selected_timeslots[""+a+"-"+b]={date:new Date(c.getFullYear(),c.getMonth(),c.getDate()+a,b)}};b.DeleteTimeSlot=function(a,
b){var c;c=""+a+"-"+b;if(null!=this.selected_timeslots[c])return delete this.selected_timeslots[c]};b.TimeSlotCount=function(){var a,b;a=0;for(b in this.selected_timeslots)a++;return a};b.RequestTourTimes=function(a,b,c){var d,e,m,n;null==b&&(b="");m=[];n=this.selected_timeslots;for(d in n)e=n[d],null!=e.date&&m.push({date:e.date.toJSON()});return $.ajax({url:myBaseUrl+"Tours/RequestTourTimes",type:"POST",data:{times:m,listing_id:a,notes:b,housemates:c}})};b.SetCalendar=function(a){var b,c,e,l,m;
this.ClearCalendar();m=[];e=0;for(l=d.length;e<l;e++)c=d[e],m.push(function(){var d,e,k;k=[];b=d=a;for(e=a+this.DATE_RANGE_SIZE-1;a<=e?d<=e:d>=e;b=a<=e?++d:--d)null!=this.selected_timeslots[""+b+"-"+c]?(console.log("Timeslot : "+c+" "+b),k.push($("#ts_"+(b-a)+c).addClass("selected").find(".time_slot_filler").show().find("i").removeClass("icon-plus-sign").addClass("icon-ok-sign"))):k.push(void 0);return k}.call(this));return m};b.ClearCalendar=function(){$(".time_slot").removeClass("selected");return $(".time_slot_filler").hide().find("i").removeClass("icon-remove-sign").removeClass("icon-ok-sign").addClass("icon-plus-sign")};
b.SetDates=function(b){var c,d,e,l,m;null==b&&(b=0);d=[];c="<td></td>";e=l=0;for(m=this.DATE_RANGE_SIZE-1;0<=m?l<=m:l>=m;e=0<=m?++l:--l)d.push(a(e+b)),c+="<th>"+d[e].day+", "+d[e].month+" "+d[e].date+"</th>";$("#calendar_table_dates").empty().html(c);c=""+d[0].month.substring(0,3)+" "+d[0].date+"-";c+=""+d[2].month.substring(0,3)+" "+d[2].date;$(".date_range").html(c);return this.SetCalendar(b)};return b}).call(this);A2Cribs.Order.FeaturedListing=function(){function b(a,b,d,e,g){this.Widget=a;this.listing_id=
b;this.address=d;this.UniData=e;null==g&&(g=null);this.WE_price=this.WD_price=this.Price=this.Weekends=this.Weekdays=0;this.MIN_DAY_OFFSET=3;this.initMultiDatesPicker(g);this.initTemplates();this.PrevSelectedDate=null;this.RangeSelectEnabled=!0;this.Widget.find(".address").html(this.address);this.setupHandlers();this.setupUniPriceTable(g);this.refresh()}b.prototype.getPrice=function(){return this.Price};b.prototype.setupHandlers=function(){var a=this;this.Widget.on("click",".rst input",function(b){a.RangeSelectEnabled=
!a.RangeSelectEnabled;return a.PrevSelectedDate=null}).on("click",".rst .clear-selected-dates",function(b){return a.clear()});return this.Widget.on("click","input.uni-toggle",function(b){var d;d=$(b.currentTarget).parents().eq(1).index();a.UniData[d].enabled=$(b.currentTarget).prop("checked");return a.refresh()})};b.prototype.setupUniPriceTable=function(a){var b,d,e,g,f;a="";g=this.UniData;d=0;for(e=g.length;d<e;d++)b=g[d],null!=("undefined"!==typeof initialState&&null!==initialState?null!=(f=initialState.universities)?
f[b.university_id]:void 0:void 0)?b.enabled=initialState.universities[b.university_id]:b.enabled=!0,a+=this.UniPriceRow(b);return this.Widget.find(".uniPriceTable>tbody").html(a)};b.GenerateOrderItem=function(a,b){var d;d=_.without.apply(_,[a.selectedDates].concat(b.unavailable_dates));return{listing_id:a.listing_id,university_id:b.university_id,dates:d}};b.prototype.getState=function(){var a,b,d,e,g;b={};g=this.UniData;d=0;for(e=g.length;d<e;d++)a=g[d],b[a.university_id]=a.enabled;return{selectedDates:this.getDates("string"),
universities:b,listing_id:this.listing_id}};b.prototype.clear=function(){this.datepicker.multiDatesPicker("resetDates","picked");return this.refresh()};b.prototype.reset=function(a){null==a&&(a=!0);this.datepicker.multiDatesPicker("resetDates","picked");this.datepicker.multiDatesPicker("resetDates","disabled");this.Widget.off("click",".rst input");this.Widget.off("click",".rst .clear-selected-dates");return this.Widget.off("click","input.uni-toggle",a?this.refresh():void 0)};b.prototype.getDates=
function(a){null==a&&(a="object");return this.datepicker.multiDatesPicker("getDates",a)};b.prototype.updatePrice=function(){return this.Price=this.Weekdays*this.WD_price+this.Weekends*this.WE_price};b.prototype.updateRates=function(){var a,b,d,e;this.WD_price=this.WE_price=0;e=this.UniData;b=0;for(d=e.length;b<d;b++)a=e[b],a.enabled&&(this.WD_price+=a.weekday_price,this.WE_price+=a.weekend_price);this.Widget.find("#wd_rate").html(this.WD_price.toFixed(2));return this.Widget.find("#we_rate").html(this.WE_price.toFixed(2))};
b.prototype.updateDayCounts=function(){var a,b,d,e;this.Weekdays=this.Weekends=0;e=this.getDates();b=0;for(d=e.length;b<d;b++)a=e[b],a=a.getDay(),0===a||6===a?this.Weekends++:this.Weekdays++;return[this.Weekdays,this.Weekends]};b.prototype.initMultiDatesPicker=function(a){var b,d=this;b=new Date;b={dateFormat:"yy-mm-dd",minDate:new Date(b.setDate(b.getDate()+this.MIN_DAY_OFFSET)),onSelect:function(a,b){d.RangeSelectEnabled&&d.rangeSelect(a);return d.refresh()}};null!=a&&(b.addDates=a.selectedDates);
this.datepicker=$(this.Widget).find(".mdp").first().multiDatesPicker(b);return this.datepicker.click()};b.prototype.rangeSelect=function(a){var b,d;if(null!=this.PrevSelectedDate){a=new Date(a);a=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate());this.PrevSelectedDate>a&&(a=[a,this.PrevSelectedDate],this.PrevSelectedDate=a[0],a=a[1]);this.SelectedDateRange=A2Cribs.UtilityFunctions.getDateRange(this.PrevSelectedDate,a);for(b=d=this.SelectedDateRange.length-1;0<=d;b=d+=-1)a=this.SelectedDateRange[b],
!1!==this.datepicker.multiDatesPicker("gotDate",a,"disabled")&&this.SelectedDateRange.splice(b,1);this.PrevSelectedDate=null;return this.datepicker.multiDatesPicker("addDates",this.SelectedDateRange)}null!=this.SelectedDateRange&&this.datepicker.multiDatesPicker("removeDates",this.SelectedDateRange);this.SelectedDateRange=null;a=new Date(a);this.PrevSelectedDate=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate());return this.datepicker.multiDatesPicker("addDates",[this.PrevSelectedDate])};
b.prototype.initTemplates=function(){this.UniPriceRow=_.template("<tr data-university_id='<%= university_id %>' >\n    <td><%=name%></td>\n    <td class = 'rates'>$<%=weekday_price.toFixed(2)%></td>\n    <td class = 'rates'>$<%=weekend_price.toFixed(2)%></td>\n    <td><input class = 'uni-toggle' type='checkbox' <% if(enabled){print('checked');} %> />\n</tr>");return this.DateConflictNotice=_.template('<li><i class = \'icon-warning-sign\'></i> Listing already featured at <%=name%> on <%\n    $.each(dates, function(index, date){\n        d = new Date(date)\n        if(index != dates.length-1)\n            print(d.getMonth()+1 + "-" + d.getDate() +"-"+ d.getFullYear() + ", ");\n        else\n            print(d.getMonth()+1 + "-" + d.getDate()+"-"+ d.getFullYear());\n    });\n    %></li>')};
b.prototype.checkForDateConflicts=function(){var a,b,d,e,g,f,h,k,l,m,n,p;g=this.getDates("string");a="";e=0;n=this.UniData;h=0;for(l=n.length;h<l;h++)if(f=n[h],f.enabled){d=[];p=f.unavailable_dates;k=0;for(m=p.length;k<m;k++)b=p[k],-1!==$.inArray(b,g)&&(d.push(b),b=new Date(b),b=b.getDay(),null!=b&&(b=(b+1)%7,e=0===b||6===b?e+f.weekend_price:e+f.weekday_price));0<d.length&&(a+=this.DateConflictNotice({name:f.name,dates:d}))}this.Widget.find(".DateConflicts").html(a);return e};b.prototype.refresh=
function(){var a;this.updateDayCounts();this.updateRates();this.updatePrice();a=this.checkForDateConflicts();this.Price-=a;$(this.Widget).find(".price").html(" $"+this.Price.toFixed(2));$(this.Widget).find(".weekdays").html(this.Weekdays);$(this.Widget).find(".weekends").html(this.Weekends);return this.Widget.trigger("orderItemChanged",this)};return b}();A2Cribs.Sublet=function(b){function a(b){var d,e,g,f;a.__super__.constructor.call(this,"sublet",b);d=["start_date","end_date"];g=0;for(f=d.length;g<
f;g++)if(b=d[g],this[b]&&-1!==(e=this[b].indexOf(" ")))this[b]=this[b].substring(0,e)}x(a,b);a.prototype.GetId=function(a){return parseInt(this.listing_id,10)};a.prototype.IsComplete=function(){return null!=this.sublet_id?!0:!1};return a}(A2Cribs.Object);(function(){function b(){}b.SetupUI=function(a){var b=this;this.div=a;this.MiniMap=new A2Cribs.MiniMap(this.div.find(".mini_map"));$(".sublet-content").on("shown",function(){return b.MiniMap.Resize()});$("#sublet_list_content").on("click",".sublet_list_item",
function(a){return b.Open(a.currentTarget.id)});this.div.find("#sublet_save_button").click(function(){b.div.find("#sublet_save_button").button("loading");return b.Save().always(function(){return b.div.find("#sublet_save_button").button("reset")})});this.div.find(".btn-group.sublet_fields .btn").click(function(a){return $(a.currentTarget).parent().val($(a.currentTarget).val())});this.div.find("#find_address").click(function(){return b.FindAddress()});this.div.find(".date-field").datepicker();$(".create-listing").find("a").click(function(a){if("sublet"===
$(a.currentTarget).data("listing-type"))return A2Cribs.MixPanel.Event("Sublet Post",{stage:"started"}),b.Open()});$("#sublet_list_content").on("marker_updated",function(a,e){return b.PopulateMarker(A2Cribs.UserCache.Get("marker",e))});this.SetupShareButtons();this.div.find(".photo_adder").click(function(){var a,e;a=b.div.find(".listing_id").val();a=0!==(null!=a?a.length:void 0)?null!=(e=A2Cribs.UserCache.Get("image",a))?e.GetObject():void 0:b._temp_images;return A2Cribs.PhotoPicker.Open(a).done(b.PhotoAddedCallback)});
return this.div.find(".rent").keyup(function(a){return $(a.currentTarget).parent().removeClass("error")})};b.SetupShareButtons=function(){var a,b=this;a=this.div.find(".listing_id").val();this.div.find(".fb_sublet_share").click(function(){var d,e,g;g=A2Cribs.UserCache.Get("sublet",a);d=A2Cribs.UserCache.Get("image",a);e=A2Cribs.UserCache.Get("marker",b.div.find(".marker_id").val());return A2Cribs.ShareManager.ShareSubletOnFB(e,g,d)});this.div.find(".google_sublet_share").click(function(){var d,e,
g;g=A2Cribs.UserCache.Get("sublet",a);d=A2Cribs.UserCache.Get("image",a);e=A2Cribs.UserCache.Get("marker",b.div.find(".marker_id").val());return A2Cribs.ShareManager.ShareSubletOnFB(e,g,d)});this.div.find(".twitter_sublet_share").click(function(){return A2Cribs.ShareManager.ShareSubletOnTwitter(a)});return this.div.find(".sublet_link").attr("href","/listing/"+a)};b.PhotoAddedCallback=function(a){var c,d,e,g;d=b.div.find(".listing_id").val();if(0!==(null!=d?d.length:void 0)){e=0;for(g=a.length;e<g;e++)c=
a[e],c.listing_id=d;A2Cribs.UserCache.Set(new A2Cribs.Image(a,d));b._temp_images=a;return b.Save()}return b._temp_images=a};b.Validate=function(){var a,b;a=!0;b=this.div.find(".rent").val();null!=b&&b.length&&(b=b.replace(/[$,]/g,""),isNaN(b)?(a=!1,A2Cribs.UIManager.Error("Please only provide numbers for your rent."),this.div.find(".rent").focus().parent().addClass("error")):this.div.find(".rent").val(b));this.div.find(".btn-group").each(function(b,c){if(a&&0===$(c).find(".active").size())return a=
!1,A2Cribs.UIManager.Error($(c).data("error-message"))});this.div.find(".text-field").each(function(b,c){if(a&&0===$(c).val().length)return a=!1,A2Cribs.UIManager.Error($(c).data("error-message"))});return a};b.Reset=function(){this.div.find(".btn-group").each(function(a,b){return $(b).find(".active").removeClass("active")});this.div.find("input").val("");return this.div.find("textarea").val("")};b.Open=function(a){var b,d=this;null==a&&(a=null);this.div.find(".done_section").fadeOut("fast",function(){return d.div.find(".sublet_section").fadeIn()});
null!=a?(b=A2Cribs.UserCache.GetAllAssociatedObjects("listing","marker",a),A2Cribs.UserCache.GetListing("sublet",b[0].listing_id).done(function(e){d.Reset();d.div.find(".listing_id").val(b[0].listing_id);d.PopulateMarker(A2Cribs.UserCache.Get("marker",a));return d.Populate(e)})):(this.Reset(),this.MiniMap.Reset(),this.div.find(".more_info").slideUp(),this.div.find(".marker_card").fadeOut("fast",function(){return d.div.find(".marker_searchbox").fadeIn()}));return A2Cribs.Dashboard.Direct({classname:"sublet",
data:{}})};b.PopulateMarker=function(a){var b=this;$(".location_fields").each(function(b,c){var g;g=a[$(c).data("field-name")];"boolean"===typeof a[$(c).data("field-name")]&&(g=+g);return $(c).val(g)});this.div.find(".marker_id").val(a.GetId());this.MiniMap.SetMarkerPosition(new google.maps.LatLng(a.latitude,a.longitude));this.div.find(".building_name").text(a.GetName());this.div.find(".building_type").text(a.GetBuildingType());this.div.find(".full_address").html("<i class='icon-map-marker'></i> "+
a.street_address+", "+a.city+", "+a.state);return this.div.find(".marker_searchbox").fadeOut("fast",function(){b.div.find(".marker_card").fadeIn();return b.div.find(".more_info").slideDown()})};b.Populate=function(a){var b=this;return $(".sublet_fields").each(function(d,e){var g;g=a[$(e).data("field-name")];"boolean"===typeof a[$(e).data("field-name")]&&(g=+g);$(e).val(g);if($(e).hasClass("btn-group"))return $(e).find("button[value='"+g+"']").addClass("active");if($(e).hasClass("date-field"))return $(e).val(b.GetFormattedDate(a[$(e).data("field-name")]))})};
b.Save=function(){var a,b=this;return this.Validate()?(a=this.GetSubletObject(),$.ajax({url:myBaseUrl+"listings/Save/",type:"POST",data:a,success:function(d){var e;d=JSON.parse(d);if(null!=(null!=(e=d.error)?e.message:void 0))return A2Cribs.UIManager.Error(d.error.message);null==a.Listing.listing_id&&$("#sublet_list_content").trigger("marker_added",[a.Listing.marker_id]);b.div.find(".sublet_section").fadeOut("slow",function(){return b.div.find(".done_section").fadeIn()});A2Cribs.MixPanel.Event("Sublet Post",
{stage:"finish"});A2Cribs.UserCache.CacheData(d.listing);b.div.find(".listing_id").val(d.listing.Listing.listing_id);b.SetupShareButtons();return A2Cribs.UIManager.Success("Your listing has been saved!")}})):(new $.Deferred).reject()};b.GetSubletObject=function(){var a,b,d=this;b={};this.div.find(".sublet_fields").each(function(a,g){var f;f=$(g).val();$(g).hasClass("date-field")&&(f=d.GetBackendDateFormat(f));return b[$(g).data("field-name")]=f});a=0!==this.div.find(".listing_id").val().length?this.div.find(".listing_id").val():
void 0;b.listing_id=a;return{Listing:{listing_type:1,marker_id:this.div.find(".marker_id").val(),listing_id:a},Sublet:b,Image:this._temp_images}};b.FindAddress=function(){var a,b,d=this;b={};a=!0;$(".location_fields").each(function(d,g){0===$(g).val().length&&(a=!1);return b[$(g).data("field-name")]=$(g).val()});if(a)return A2Cribs.Geocoder.FindAddress(b.street_address,b.city,b.state).done(function(a){var b,c,h;h=a[0];b=a[1];c=a[2];return d.FindMarkerByAddress(h,b,c).done(function(a){return d.PopulateMarker(a)}).fail(function(){return A2Cribs.MarkerModal.OpenLocation("sublet",
h,b,c)})}).fail(function(){return A2Cribs.MarkerModal.OpenLocation("sublet",b.street_address,b.city,b.state)});A2Cribs.UIManager.Error("Please complete all fields to find address")};b.FindMarkerByAddress=function(a,b,d){var e;e=new $.Deferred;$.ajax({url:myBaseUrl+"Markers/FindMarkerByAddress/"+a+"/"+b+"/"+d,type:"GET",success:function(a){a=JSON.parse(a);return null!=a?(a=new A2Cribs.Marker(a),A2Cribs.UserCache.Set(a),e.resolve(a)):e.reject()}});return e.promise()};b.GetBackendDateFormat=function(a){var b,
d;a=new Date(a);d=a.getMonth()+1;10>d&&(d="0"+d);b=a.getDate();10>b&&(b="0"+b);return a.getUTCFullYear()+"-"+d+"-"+b};b.GetFormattedDate=function(a){a=a.split(" ");a=a[0].split("-");return""+a[1]+"/"+a[2]+"/"+a[0]};$(document).ready(function(){if($("#sublet_window").length)return b._temp_images=[],b.SetupUI($("#sublet_window"))});return b}).call(this);A2Cribs.Geocoder=function(){function b(){}b.FindAddress=function(a,b,d){var e;e=new $.Deferred;null==this._geocoder&&(this._geocoder=new google.maps.Geocoder);
this._geocoder.geocode({address:""+a+" "+b+", "+d},function(a,f){var h,k,l,m,n,p,q,r,s,u,v;if(f===google.maps.GeocoderStatus.OK&&2<=a[0].address_components.length){u=a[0].address_components;p=0;for(r=u.length;p<r;p++){h=u[p];v=h.types;q=0;for(s=v.length;q<s;q++)switch(m=v[q],m){case "street_number":l=h.short_name;break;case "route":k=h.short_name;break;case "locality":b=h.short_name;break;case "administrative_area_level_1":d=h.short_name;break;case "postal_code":n=h.short_name}}h=a[0].geometry.location;
return null==l?e.reject():e.resolve([""+l+" "+k,b,d,n,h])}return e.reject()});return e.promise()};return b}();(function(b){b.fn.removeStyle=function(a){var c;c=RegExp(a+"[^;]+;?","g");return this.each(function(){return b(this).attr("style",function(a,b){if(b)return b.replace(c,"")})})};return b.fn.animateHighlight=function(a,b){var d,e,g,f;e=a||"#FFFFFF";d=b||500;g=this.css("backgroundColor");f=this.css("color");return this.stop().css("background-color",e).css("color",e).animate({backgroundColor:g,
color:f},d)}})(jQuery);A2Cribs.Hotlist=function(){function b(a){this.DOMRoot=a;this.topSection=_.template(A2Cribs.Hotlist.topSectionTemplate);this.friendsList=_.template(A2Cribs.Hotlist.friendsListTemplate);this.notLoggedIn=_.template(A2Cribs.Hotlist.notLoggedInTemplate);this.friendsListPopup=_.template(A2Cribs.Hotlist.friendsListPopupTemplate);this.expandButton=_.template(A2Cribs.Hotlist.expandButtonTemplate);this.sources=[{name:"accounts",remote:{url:myBaseUrl+"users/getbyname?name=%QUERY",filter:function(a){return a.map(function(a){return{value:a.User.email,
name:""+a.User.first_name+" "+a.User.last_name}})}}}];this.setEditing(!1);this.isExpanded=!1}b.Initialize=function(){var a;a=$("#hotlist");A2Cribs.HotlistObj=new A2Cribs.Hotlist(a);return A2Cribs.HotlistObj.setup()};b.prototype.call=function(a,b,d){var e;e=new $.Deferred;$.ajax({url:myBaseUrl+a,data:d,type:b,success:function(a){try{return e.resolve(JSON.parse(a))}catch(b){return e.reject(a)}},error:function(a){return e.reject(a)}});return e.promise()};b.prototype.handleFBLoad=function(){var a=this;
this.sources.push({name:"facebook-friends",prefetch:{url:"https://graph.facebook.com/me/friends?access_token="+FB.getAccessToken()+"&fields=id,name,picture,first_name,last_name",ttl:0,filter:function(a){return a.data.map(function(a){return{value:a.name,tokens:a.name.split(" "),facebook_id:a.id,picture:a.picture.data.url,first_name:a.first_name,last_name:a.last_name}})}}});return this.DOMRoot.find("#add-field").typeahead(this.sources).on("typeahead:selected",function(b,d,e){return a.setAddIdField(b,
d,e)}).on("typeahead:autocompleted",function(b,d,e){return a.setAddIdField(b,d,e)}).on("typeahead:hinted",function(b,d,e){return a.setAddIdField(b,d,e)}).bind("change cut paste keyup",function(){if(""===$(this).val())return $(this).removeData("friend")})};b.prototype.setAddIdField=function(a,b,d){a=b.value.replace(/^\s+|\s+$/g,"").toLowerCase();d=$("#add-field").val().replace(/^\s+|\s+$/g,"").toLowerCase();return a===d?this.DOMRoot.find("#add-field").data("friend",b):this.DOMRoot.find("#add-field").removeData("friend")};
b.prototype.setup=function(){var a=this;return $(document).on("checked_logged_in logged_in",function(b){var d;b=null!=(d=A2Cribs.Login)?d.logged_in:void 0;a.renderTopSection(b);a.show();a.renderBottomSection();a.currentHotlist=a.get();return a.setHeight(!0)})};b.prototype.setupDroppables=function(){this.DOMRoot.find("li.friend").droppable({accept:".fl-sb-item, .large-bubble",hoverClass:"drop-hover",tolerance:"pointer",drop:function(a,b){var d;d=b.draggable.attr("listing_id")||b.draggable.data("listing_id");
$(this).data("facebook_id")?A2Cribs.HotlistObj.shareToFB(d,$(this).data("facebook_id")):A2Cribs.HotlistObj.shareToEmail(d,$(this).data("email"));$(this).find(".friend-abbr").animateHighlight();return b.helper.hide()}});return this.DOMRoot.find("ul.friends.no-friends").droppable({accept:".fl-sb-item, .large-bubble",hoverClass:"drop-hover",tolerance:"pointer",drop:function(a,b){var d;d=b.draggable.attr("listing_id")||b.draggable.data("listing_id");b.helper.hide();return FB.ui({method:"send",link:"http://www.cribspot.com/listing/"+
d,name:"Share this listing"},function(a){})}})};b.prototype.destroyDroppables=function(){this.DOMRoot.find("li.friend").droppable("destroy");return this.DOMRoot.find("ul.friends.no-friends").droppable("destroy")};b.prototype.renderTopSection=function(a){var b=this;this.DOMRoot.find("#top-section").html(this.topSection({loggedIn:a}));this.DOMRoot.find("#title").show();this.DOMRoot.find("#add-field").hide();this.DOMRoot.find("#btn-add").hide();$.when(window.fbInit).then(function(){return FB.getLoginStatus(function(a){if("connected"===
a.status)return b.handleFBLoad()})});this.DOMRoot.find(".twitter-typeahead").hide();this.DOMRoot.find("#link-info").popover({title:"What is this?",content:"You can share listings with your friends!<br/>Either click the <i class='icon-user'></i> icon on a listing or drag the listing to one of your friends on the hotlist.",html:!0,placement:"bottom"});return $("#add-field").keyup(function(a){if(13===a.keyCode)return $("#btn-add").click()})};b.prototype.renderFriendsList=function(a){A2Cribs.Login.logged_in?
(this.DOMRoot.find("#friends").html(this.friendsList(a)),this.DOMRoot.find("#add-field").val(""),this.DOMRoot.find(".tt-hint").val(""),this.DOMRoot.find(".btn-hotlist-remove").hide(),this.DOMRoot.find(".friend-name").hide(),$(document).on("mousedown mouseup",".grab, .grabbing",function(a){return $(this).toggleClass("grab").toggleClass("grabbing")}),this.setupDroppables(),this.DOMRoot.find("li.friend").tooltip({animated:"fade",container:"body"})):this.DOMRoot.find("#friends").html(this.notLoggedIn());
return this.setHeight(!0)};b.prototype.startedDragging=function(){var a;if(null!=(a=A2Cribs.Login)&&a.logged_in)return this.retract(),this.expand()};b.prototype.stoppedDragging=function(){var a;if(null!=(a=A2Cribs.Login)&&a.logged_in)return this.retract()};b.prototype.shareToAll=function(a,b){b.draggable.attr("listing_id")||b.draggable.data("listing_id");return $("ul.friends li").map(function(a){return $(this).data("facebook_id")})};b.prototype.renderBottomSection=function(){return this.DOMRoot.find("#bottom-section").html(this.expandButton())};
b.prototype.getHotlistForPopup=function(a){return this.friendsListPopup({friends:this.currentHotlist,listing_id:a})};b.prototype.get=function(){var a=this;if(A2Cribs.Login.logged_in)return $.when(this.call("friends/hotlist","GET",null)).then(function(b){return a.currentHotlist=b}).fail(function(a){})};b.prototype.show=function(){var a=this;return A2Cribs.Login.logged_in?$.when(this.call("friends/hotlist","GET",null)).then(function(b){return a.renderFriendsList({friends:b})}).fail(function(a){}):this.renderFriendsList(null)};
b.prototype.add=function(a){var b,d=this;if(A2Cribs.Login.logged_in)return null!=(null!=(b=$("#add-field").data("friend"))?b.facebook_id:void 0)?(b="invitations/invitefbfriend",a={friend:$("#add-field").data("friend")},this.showFBAddMessageModal($("#add-field").data("friend").facebook_id)):(b="invitations/invitefriends",a={emails:[$("#add-field").val()]}),$.when(this.call(b,"POST",a).then(function(a){return d.call("friends/hotlist","GET",null)}).then(function(a){d.currentHotlist=a;d.renderFriendsList({friends:a});
return d.expandForEdit()}).fail(function(a){}))};b.prototype.showFBAddMessageModal=function(a){return FB.ui({method:"send",link:"http://www.cribspot.com",to:a})};b.prototype.remove=function(a){var b=this;if(A2Cribs.Login.logged_in)return $.when(this.call("friends/hotlist/remove","POST",{friend:a}).then(function(a){b.renderFriendsList({friends:a});b.expandForEdit();return b.currentHotlist=a}).fail(function(a){}))};b.prototype.share=function(a,b){if(A2Cribs.Login.logged_in)return $.when(this.call("friends/share",
"POST",{friend:b,listing:a}).then(function(a){return!0===a.success?A2Cribs.UIManager.Success("Successfully Shared Listing"):A2Cribs.UIManager.Error("There was a problem sharing the listing.")}).fail(function(a){return A2Cribs.UIManager.Error("There was a problem sharing the listing.")}))};b.prototype.shareToEmail=function(a,b){return $.when(this.call("invitations/inviteFriends","POST",{emails:[b],listing:a}).then(function(a){return!0===a.success?A2Cribs.UIManager.Success("Successfully Shared Listing"):
A2Cribs.UIManager.Error("There was a problem sharing the listing.")}).fail(function(a){return A2Cribs.UIManager.Error("There was a problem sharing the listing.")}).always(function(a,b,c){return $("#share-to-email").val("")}))};b.prototype.shareToFB=function(a,b){return FB.ui({method:"send",link:"http://www.cribspot.com/listing/"+a,to:b,name:"Share this listing"})};b.prototype.retract=function(){this.DOMRoot.removeClass("expanded").removeClass("detailed");this.DOMRoot.find("#expand-button i").removeClass("icon-caret-up").addClass("icon-caret-down");
this.DOMRoot.find(".friend-abbr,#title").show();this.DOMRoot.find(".btn-hotlist-remove,.friend-name,#add-field,.twitter-typeahead,.tt-hint,#btn-add").hide();this.DOMRoot.find("#btn-edit").removeClass("editing").html('<i class="icon-edit"></i>');this.DOMRoot.find("ul.friends").removeStyle("height");this.setEditing(!1);this.isExpanded=!1;this.setHeight(!0);this.setupDroppables();return this.DOMRoot.find("li.friend").tooltip({animated:"fade",container:"body"})};b.prototype.expand=function(){this.DOMRoot.addClass("expanded");
this.DOMRoot.find("#expand-button i").removeClass("icon-caret-down").addClass("icon-caret-up");this.isExpanded=!0;return this.setHeight()};b.prototype.expandForEdit=function(){this.DOMRoot.addClass("expanded");this.DOMRoot.find("#expand-button i").removeClass("icon-caret-down").addClass("icon-caret-up");this.isExpanded=!0;this.DOMRoot.addClass("detailed");this.DOMRoot.find(".btn-hotlist-remove,.twitter-typeahead,.tt-hint,.friend-name,#add-field,#btn-add").show();this.DOMRoot.find(".friend-abbr,#title").hide();
this.DOMRoot.find("#btn-edit").addClass("editing").html("Done");this.DOMRoot.find("li.friend").tooltip("destroy");this.destroyDroppables();return this.setHeight(!1,!0)};b.prototype.showOrHideExpandArrow=function(){var a,b,d;a=this.DOMRoot.find("#bottom-section a");b=this.DOMRoot.find("ul.friends li").length?this.DOMRoot.find("ul.friends li:first").offset().top===this.DOMRoot.find("ul.friends li:last").offset().top:!0;if(null!=(d=A2Cribs.Login)&&d.logged_in)return this.isExpanded||!b?a.show():a.hide();
a.hide()};b.prototype.setHeight=function(a,b){var d,e;null==a&&(a=!1);null==b&&(b=!1);this.showOrHideExpandArrow();d=a?this.DOMRoot.find("ul.friends li:first-child"):this.DOMRoot.find("ul.friends li:last-child");d=d.length?d.offset().top+d.height()-$("ul.friends").offset().top:0;10>=d&&(d=70);$("#bottom-section a").is(":visible")&&(d=d+$("#bottom-section a").height()+20);if(!(null!=(e=A2Cribs.Login)&&e.logged_in))d+=25;300>d||!b?this.DOMRoot.find("ul.friends").height(d):this.DOMRoot.find("ul.friends").height(300);
return this.DOMRoot.find("ul.friends").on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){return A2Cribs.FeaturedListings.resizeHandler()})};b.prototype.toggleEdit=function(){if(this.isEditing())return this.setEditing(!1),this.retract();this.setEditing(!0);return this.expandForEdit()};b.prototype.toggleExpand=function(){return $("#hotlist").hasClass("expanded")?this.retract():this.expand(!1)};b.prototype.isEditing=function(){return this.DOMRoot.hasClass("editing")};
b.prototype.setEditing=function(a){return a?this.DOMRoot.addClass("editing"):this.DOMRoot.removeClass("editing")};b.friendsListPopupTemplate="<div id='shareto'>\n  <input type='email' id='share-to-email' placeholder='to email'></input>\n  <a class='share-to-email-btn' href='#' onClick='A2Cribs.HotlistObj.shareToEmail(<%=listing_id%>, $(\"#share-to-email\").val());'>\n    <i class=\"icon-share\"></i>\n  </a>\n</div>\n<ul class=\"friends-popup\">\n  <% _.each(friends, function(elem, idx, list) { %>\n    <li>\n      <% name = elem.first_name ? elem.first_name + ' ' + elem.last_name : elem.email %>\n      <% if(elem.facebook_id) { %>\n        <a href='#' onclick='A2Cribs.HotlistObj.shareToFB(<%=listing_id%>, <%=elem.facebook_id%>)'><%=name%></a>\n      <% } else { %>\n        <a href='#' onclick='A2Cribs.HotlistObj.share(<%=listing_id%>, <%=elem.id%>)'><%=name%></a>\n      <% } %>\n    </li>\n  <% }) %>\n</ul>";
b.topSectionTemplate="<div id='share-all'>\n  <span class='title'>Share with your Friends <a title='What is this?' href='#' id='link-info' class='icon icon-info-sign'></a></span>\n  <span class='share-text'>Share to All</span>\n</div>\n<input class='typeahead' type='text' autocomplete='off' id='add-field'></input>\n<div id='buttons' class='pull-right <%=loggedIn ? \"\" : \"hide\"%>'>\n  <a href='#' data-toggle='popover' id='btn-add' class='btn-hotlist btn-hotlist-add' onClick=\"A2Cribs.HotlistObj.add($('#add-field').val())\">+</a>\n  <a href='#' id='btn-edit' class='btn-hotlist btn-hotlist-edit' onClick='A2Cribs.HotlistObj.toggleEdit()'><i class='icon-edit'></i></a>\n</div>\n<div style='clear: both;'></div>";
b.friendsListTemplate="<ul class='friends <%=friends.length ? \"has-friends\" : \"no-friends\"%>'>\n  <% if(friends.length) { %>\n  <% _.each(friends, function(elem, idx, list) { %>\n    <% \n      var tooltitle = elem.email \n      if (elem.first_name) {\n        tooltitle = elem.first_name + ' ' + elem.last_name\n      }\n    %> \n    <li class='friend' data-id='<%=elem.id%>' data-toggle='tooltip' title='<%=tooltitle%>'' data-facebook_id='<%=elem.facebook_id || null%>' data-email='<%=elem.email%>'>\n      <% if (elem.facebook_id){ %>\n        <img class='friend-abbr hotlist-profile-img' src='https://graph.facebook.com/<%=elem.facebook_id%>/picture?width=80&height=80'></img>\n      <% } else if (elem.profile_img) { %>\n        <img class='friend-abbr otlist-profile-img' src='<%=elem.profile_img%>'></img>\n      <% } else if (typeof elem.first_name !== 'undefined' && elem.first_name !== null) { %>\n        <span class='friend-abbr'>\n          <%=elem.first_name[0].toUpperCase()%><%=elem.last_name[0].toUpperCase()%> \n        </span>\n      <% } else { %>\n        <span class='friend-abbr'>\n          <%=elem.email[0]%>@<%=elem.email.split('@')[1][0]%>\n        </span>\n      <% } %>\n      <span class='friend-name'>\n        <% if (typeof elem.first_name !== 'undefined' && elem.first_name !== null) { %>\n          <%=elem.first_name%> <%=elem.last_name%> \n        <% } else { %>\n          <%=elem.email%>\n        <% } %>\n      </span>\n      <a class='btn-hotlist-remove btn-hotlist pull-right' href='#' onClick='A2Cribs.HotlistObj.remove(<%=elem.id%>)'><i class='icon icon-remove-circle'></i></a>\n    </li>\n  <% }); %>\n  <% } else { %>\n    <li class='add-friends-notice'>No friends added yet.</li>\n    <li class='no-friends-notice'>Add friends by clicking here <i class='icon-reply icon-rotate'></i></li>\n    <li class='share-to-fb-notice'><i class='icon-facebook-sign'></i> Drag to Share</li>\n  <% } %>\n</ul>";
b.notLoggedInTemplate="<ul class='friends no-friends not-logged-in'>\n  <li class='not-logged-in-notice'>Log In to share</li>\n</ul>";b.expandButtonTemplate="<a href='#' onclick='A2Cribs.HotlistObj.toggleExpand()' id='expand-button'><i class='icon icon-caret-down'></i></a>";return b}()}).call(this);
