(function(){var y=[].indexOf||function(b){for(var a=0,c=this.length;a<c;a++)if(a in this&&this[a]===b)return a;return-1},B={}.hasOwnProperty,t=function(b,a){function c(){this.constructor=b}for(var d in a)B.call(a,d)&&(b[d]=a[d]);c.prototype=a.prototype;b.prototype=new c;b.__super__=a.prototype;return b},z=function(b,a){return function(){return b.apply(a,arguments)}};window.A2Cribs={};A2Cribs.Object=function(){function b(a,c){var d,e;this.class_name=null!=a?a:"object";for(d in c)e=c[d],null!=e&&(this[d]=
e)}b.prototype.GetId=function(a){return parseInt(this[""+this.class_name+"_id"],10)};b.prototype.GetObject=function(){var a,c,d;c={};for(a in this)d=this[a],"function"!==typeof d&&("boolean"===typeof d&&(d=+d),c[a]=d);return c};b.prototype.IsComplete=function(){return!0};return b}();A2Cribs.MixPanel=function(){function b(){}var a,c;c=function(a){if(null!=a)return Math.min.apply(null,a)};a=function(a){if(null!=a)return Math.min.apply(null,a)};b.Click=function(d,e){var b,f,h,k,l,m,n,p,r,q,s,v,x,u,A,
t,N,D,H,I,E,F,C,J,K,L,w,G;if(!(void 0===d||null===d)){h=0;if("listing"===d.class_name)k=d,h=1*(l=parseInt(k.listing_id),0<=y.call(A2Cribs.FeaturedListings.FLListingIds,l)),m=A2Cribs.UserCache.Get("marker",k.marker_id);else if("marker"===d.class_name){m=d;l=A2Cribs.UserCache.GetAllAssociatedObjects("listing","marker",m.marker_id);r=0;for(v=l.length;r<v;r++)if(k=l[r],u=parseInt(k.listing_id),0<=y.call(A2Cribs.FeaturedListings.FLListingIds,u)){h=1;break}}else if("rental"===d.class_name)k=A2Cribs.UserCache.Get("listing",
d.listing_id),h=1*(r=parseInt(k.listing_id),0<=y.call(A2Cribs.FeaturedListings.FLListingIds,r));else return!1;h={"listing type":null!=m?m.GetBuildingType():void 0,"display type":e,"is featured":h,listing_id:null!=k?k.GetId():void 0,marker_id:null!=m?m.GetId():void 0,university_id:null!=(F=A2Cribs.Map)?F.CurentSchoolId:void 0,"filter minimum beds":c(null!=(C=A2Cribs.RentalFilter.FilterData)?C.Beds:void 0),"filter maximum beds":a(null!=(J=A2Cribs.RentalFilter.FilterData)?J.Beds:void 0),"filter minimum rent":null!=
(K=A2Cribs.RentalFilter.FilterData)?null!=(L=K.Rent)?L.min:void 0:void 0,"filter maximum rent":null!=(w=A2Cribs.RentalFilter.FilterData)?null!=(G=w.Rent)?G.max:void 0:void 0,"filter start year":null!=(f=A2Cribs.RentalFilter.FilterData)?null!=(b=f.Dates)?b.year:void 0:void 0,"filter minimum lease length":null!=(q=A2Cribs.RentalFilter.FilterData)?null!=(x=q.LeaseRange)?x.min:void 0:void 0,"filter maximum lease length":null!=(A=A2Cribs.RentalFilter.FilterData)?null!=(t=A.LeaseRange)?t.max:void 0:void 0,
"filter building_type min":c,"filter building_type":c,"filter pets allowed":null!=(N=A2Cribs.RentalFilter.FilterData)?N.PetsAllowed:void 0,"filter parking available":null!=(D=A2Cribs.RentalFilter.FilterData)?D.ParkingAvailable:void 0,"filter air conditioning":null!=(H=A2Cribs.RentalFilter.FilterData)?H.Air:void 0,"filter utilities included":null!=(I=A2Cribs.RentalFilter.FilterData)?I.UtilitiesIncluded:void 0};if(null!=(null!=(E=A2Cribs.RentalFilter.FilterData)?E.Beds:void 0)){A=A2Cribs.RentalFilter.FilterData.Beds;
f=q=0;for(x=A.length;q<x;f=++q)b=A[f],h["filter bed "+f]=b}if(null!=(null!=(n=A2Cribs.RentalFilter.FilterData)?null!=(s=n.Dates)?s.months:void 0:void 0)){q=A2Cribs.RentalFilter.FilterData.Dates.months;f=s=0;for(b=q.length;s<b;f=++s)n=q[f],h["filter month "+f]=n}if(null!=(null!=(p=A2Cribs.RentalFilter.FilterData)?p.UnitTypes:void 0)){b=A2Cribs.RentalFilter.FilterData.UnitTypes;f=n=0;for(s=b.length;n<s;f=++n)p=b[f],h["filter unit_type "+f]=p}return mixpanel.track("Listing Click",h)}};b.PostListing=
function(a,c){return mixpanel.track("Post Listing - "+a,c)};b.AuthEvent=function(a,c){return mixpanel.track(a,c)};return b}();A2Cribs.User=function(b){function a(c){a.__super__.constructor.call(this,"user",c)}t(a,b);a.prototype.GetId=function(){return this.id};return a}(A2Cribs.Object);A2Cribs.Favorite=function(){return function(b,a,c){this.FavoriteId=b;this.ListingId=a;this.UserId=c}}();A2Cribs.Listing=function(b){function a(c){a.__super__.constructor.call(this,"listing",c)}t(a,b);return a}(A2Cribs.Object);
A2Cribs.Marker=function(b){function a(c){this.MarkerClicked=z(this.MarkerClicked,this);a.__super__.constructor.call(this,"marker",c)}var c,d;t(a,b);a.BuildingType=["House","Apartment","Duplex"];a.prototype.GetName=function(){return null!=this.alternate_name&&this.alternate_name.length?this.alternate_name:this.street_address};a.prototype.GetBuildingType=function(){return this.building_type_id};a.prototype.Init=function(){this.GMarker=new google.maps.Marker({position:new google.maps.LatLng(this.latitude,
this.longitude),icon:"/img/dots/available_dot.png",id:this.GetId()});return google.maps.event.addListener(this.GMarker,"click",this.MarkerClicked)};a.prototype.GetObject=function(){var c;c=a.__super__.GetObject.call(this);c.GMarker=null;return c};a.prototype.MarkerClicked=function(a){A2Cribs.MixPanel.Click(this,"small popup");return A2Cribs.HoverBubble.Open(this)};c=function(a){var c,d,b,k,l,m,n,p,r,q,s,v,x,u,A,t,y,D,H,I,E,F,C,J,K,L,w,G,B,z,M,O;if(void 0===a)return null;x=$("#houseCheck").is(":checked");
c=$("#aptCheck").is(":checked");I=$("#otherCheck").is(":checked");A=$("#maleCheck").is(":checked");m=$("#femaleCheck").is(":checked");F=$("#studentsOnlyCheck").is(":checked");n=$("#gradCheck").is(":checked");L=$("#undergradCheck").is(":checked");$("#acCheck").is(":checked");$("#parkingCheck").is(":checked");G=$("#utilitiesCheck").is(":checked");D=$("#noSecurityDepositCheck").is(":checked");y=A2Cribs.FilterManager.MinRent;t=A2Cribs.FilterManager.MaxRent;k=$("#bedsSelect").val();"2+"===k&&(k="2");k=
parseInt(k);E=new Date(A2Cribs.FilterManager.DateBegin);l=new Date(A2Cribs.FilterManager.DateEnd);d=$("#bathSelect").val();z=[];M=0;for(O=a.length;M<O;M++)C=a[M],u=A2Cribs.Cache.IdToSubletMap[C],w=u.BuildingType,K=new Date(u.StartDate),J=new Date(u.EndDate),p=A2Cribs.Cache.SubletIdToHousemateIdsMap[C],b=A2Cribs.Cache.IdToHousematesMap[p],v=r=p=q=!0,s=!1,void 0!==b&&null!==b&&(q="Male"===b.Gender||"Mix"===b.Gender||void 0===b.Gender||null===b.Gender,p="Female"===b.Gender||"Mix"===b.Gender||void 0===
b.Gender||null===b.Gender,r="Graduate"===b.GradType||"Mix"===b.GradType||void 0===b.GradType||null===b.GradType,v="Undergraduate"===b.GradType||"Mix"===b.GradType||void 0===b.GradType||null===b.GradType,s=!0===b.Enrolled||void 0===b.Enrolled||null===b.Enrolled),b=u.BathroomType===d||"Private"!==d&&"Shared"!==d,B=!G||G&&0===u.UtilityCost,H=!D||D&&0===u.DepositAmount,(("House"===w||null===w)&&x||("Apartment"===w||null===w)&&c||("Duplex"===w||null===w)&&I||"House"!==w&&"Duplex"!==w&&"Apartment"!==w)&&
(u.PricePerBedroom>=y&&u.PricePerBedroom<=t&&u.Bedrooms>=k&&(E>=K||!A2Cribs.Marker.IsValidDate(E))&&(J>=l||!A2Cribs.Marker.IsValidDate(l))&&(m&&p||A&&q)&&(L&&v||n&&r)&&(!F||F&&s)&&b&&B&&H)&&z.push(C);return z};d=function(a){var c,d;if(!this.Clicked){c=0;for(d=a.length;c<d;c++)A2Cribs.UserCache.Set(A2Cribs.Listing(JSON.parse(a)));a=A2Cribs.UserCache.Get("marker",this.MarkerId);a.GMarker.setIcon("/img/dots/clicked_dot.png")}this.Clicked=!0;return this.FilterVisibleListingsAndOpenPopup()};a.prototype.LoadMarkerData=
function(){this.CorrectTooltipLocation();return this.Clicked?this.FilterVisibleListingsAndOpenPopup():$.ajax({url:myBaseUrl+"Listings/LoadMarkerData/"+this.MarkerId,type:"GET",context:this,success:d})};a.prototype.FilterVisibleListingsAndOpenPopup=function(){var a;a=c(A2Cribs.Cache.MarkerIdToSubletIdsMap[this.MarkerId]);return A2Cribs.Map.ClickBubble.Open(this,a)};a.GetMarkerPixelCoordinates=function(a){var c,d,b;c=A2Cribs.Map.GMap;b=Math.pow(2,c.getZoom());d=new google.maps.LatLng(c.getBounds().getNorthEast().lat(),
c.getBounds().getSouthWest().lng());d=c.getProjection().fromLatLngToPoint(d);a=c.getProjection().fromLatLngToPoint(a);return new google.maps.Point(Math.floor((a.x-d.x)*b),Math.floor((a.y-d.y)*b))};a.prototype.CorrectTooltipLocation=function(){var a,c,d,b;d=A2Cribs.Map.Bounds.CONTROL_BOX_LEFT;b=A2Cribs.Marker.GetMarkerPixelCoordinates(this.GMarker.position);c=a=0;b.x+A2Cribs.MarkerTooltip.Width-A2Cribs.MarkerTooltip.ArrowOffset+A2Cribs.MarkerTooltip.Padding>A2Cribs.Map.Bounds.RIGHT&&(a=b.x+A2Cribs.MarkerTooltip.Width-
A2Cribs.MarkerTooltip.ArrowOffset+A2Cribs.MarkerTooltip.Padding-A2Cribs.Map.Bounds.RIGHT);b.x-A2Cribs.MarkerTooltip.ArrowOffset-A2Cribs.MarkerTooltip.Padding<d&&(a=b.x-A2Cribs.MarkerTooltip.ArrowOffset-A2Cribs.MarkerTooltip.Padding-d);0>b.y-A2Cribs.MarkerTooltip.Height-A2Cribs.MarkerTooltip.ArrowHeight&&(c=b.y-A2Cribs.MarkerTooltip.Height-A2Cribs.MarkerTooltip.ArrowHeight);b.y>A2Cribs.Map.Bounds.BOTTOM-A2Cribs.MarkerTooltip.Padding&&(c=b.y-A2Cribs.Map.Bounds.BOTTOM+A2Cribs.MarkerTooltip.Padding);
return A2Cribs.Map.GMap.panBy(a,c)};a.IsValidDate=function(a){return"Invalid Date"!==a.toString()};return a}(A2Cribs.Object);A2Cribs.FavoritesManager=function(){function b(){}b.FavoritesListingIds=[];b.FavoritesVisible=!1;b.AddFavorite=function(a,c){return $.ajax({url:myBaseUrl+"Favorites/AddFavorite/"+a,type:"POST",context:this,success:function(d){return A2Cribs.FavoritesManager.AddFavoriteCallback(d,a,c)}})};b.AddFavoriteCallback=function(a,c,d){a=JSON.parse(a);if(void 0===a.success)return void 0!==
a.error.message?A2Cribs.UIManager.Alert(a.error.message):A2Cribs.UIManager.Alert("There was an error adding your favorite. Contact help@cribspot.com if the error persists.");this.FavoritesListingIds.push(c);if(null!=d)return $(d).attr("onclick","A2Cribs.FavoritesManager.DeleteFavorite("+c+", this);"),$(d).attr("title","Delete from Favorites"),$(d).addClass("active"),this._setFavoriteCount()};b.DeleteFavorite=function(a,c){return $.ajax({url:myBaseUrl+"Favorites/DeleteFavorite/"+a,type:"POST",context:this,
success:function(d){return A2Cribs.FavoritesManager.DeleteFavoriteCallback(d,a,c)}})};b.DeleteFavoriteCallback=function(a,c,d){a=JSON.parse(a);if(void 0!==a.error)return A2Cribs.UIManager.Alert(a.error.message);a=A2Cribs.FavoritesManager.FavoritesListingIds.indexOf(c);-1!==a&&A2Cribs.FavoritesManager.FavoritesListingIds.splice(a);if(null!=d)return $(d).attr("onclick","A2Cribs.FavoritesManager.AddFavorite("+c+", this);"),$(d).attr("title","Add to Favorites"),$(d).removeClass("active"),this._setFavoriteCount()};
b.InitializeFavorites=function(a){var c,d,e;if(!(null===a||void 0===a)){c=JSON.parse(a);d=0;for(e=c.length;d<e;d++)a=c[d],A2Cribs.FavoritesManager.FavoritesListingIds.push(parseInt(a));return this._setFavoriteCount()}};b.LoadFavorites=function(){return $.ajax({url:myBaseUrl+"Favorites/LoadFavorites",type:"GET",context:this,success:A2Cribs.FavoritesManager.InitializeFavorites})};b.ToggleFavoritesVisibility=function(a){var c,d,e,b,f,h;$(a).toggleClass("active");null!=(e=A2Cribs.HoverBubble)&&e.Close();
null!=(c=A2Cribs.ClickBubble)&&c.Close();c=A2Cribs.UserCache.Get("marker");a=A2Cribs.UserCache.Get("listing");if(A2Cribs.FavoritesManager.FavoritesVisible){f=0;for(d=c.length;f<d;f++)e=c[f],null!=e&&null!=(b=e.GMarker)&&b.setVisible(!0);e=0;for(f=a.length;e<f;e++)d=a[e],d.visible=!0;$("#FavoritesHeaderIcon").removeClass("pressed")}else{$("#FavoritesHeaderIcon").addClass("pressed");b=0;for(h=c.length;b<h;b++)e=c[b],null!=(d=e.GMarker)&&d.setVisible(!1);e=0;for(b=a.length;e<b;e++)d=a[e],d.visible=!1;
c=A2Cribs.FavoritesManager.FavoritesListingIds;a=0;for(b=c.length;a<b;a++)e=c[a],d=A2Cribs.UserCache.Get("listing",e),e=A2Cribs.UserCache.Get("marker",d.marker_id),null!=(f=e.GMarker)&&f.setVisible(!0),d.visible=!0}A2Cribs.Map.GMarkerClusterer.repaint();return A2Cribs.FavoritesManager.FavoritesVisible=!A2Cribs.FavoritesManager.FavoritesVisible};b.FavoritesVisibilityIsOn=function(){return $("#FavoritesHeaderIcon").hasClass("pressed")};b.setFavoriteButton=function(a,c,d){var e;e="."+a;null===c&&(c=
parseInt(a),e="#"+(""+a+".favorite_listing"));if(-1===d.indexOf(parseInt(c,10)))return $(e).attr("onclick","A2Cribs.FavoritesManager.AddFavorite("+c+", this)"),$(e).removeClass("active");$(e).attr("onclick","A2Cribs.FavoritesManager.DeleteFavorite("+c+", this)");return $(e).addClass("active")};b._insertIntoFavoriteDiv=function(a){var c,d;1===this.FavoritesCache.size&&$("#noFavorites").hide();c=A2Cribs.Map.IdToMarkerMap[A2Cribs.Map.IdToSubletMap[a].MarkerId];d=c.Title?c.Title:c.Address;c=$("#favoriteTemplate");
c.find(".favoriteDiv").attr({id:"favoriteDiv"+a});c.find(".favoritesAddress").html(d);c.find(".removeButton").attr({onclick:"A2Cribs.FavoritesManager.DeleteFavorite("+a+")"});c.find("a").attr({href:listing.Url});c.find("#price").html(listing.Rent?"$"+listing.Rent:"???");c.find("#beds").html(listing.Beds+(1<listing.Beds?" Beds":" Bed"));c.find("#baths").html(listing.Baths+(1<listing.Baths?" Baths":" Bath"));c.find("#payMonth").html(listing.LeaseRange);c.find("#aptType").html(listing.UnitType);c.find("#electric").find("div").addClass(listing.Electric?
"electric_selected":"electric_unselected");c.find("#heat").find("div").addClass(listing.Heat?"heat_selected":"heat_unselected");c.find("#water").find("div").addClass(listing.Water?"water_selected":"water_unselected");c.find("#furnished").find("div").addClass(listing.Furnished?"furnished_selected":"furnished_unselected");c.find("#parking").find("div").addClass(listing.Parking?"parking_selected":"parking_unselected");c.find("#ac").find("div").addClass(listing.Air?"ac_selected":"ac_unselected");a=$("#favoriteTemplate").html();
return $("#personalFavoritesList").append(a)};b._setFavoriteCount=function(){return 0===this.FavoritesListingIds.length?$(".favorite_count").hide():$(".favorite_count").show().text(this.FavoritesListingIds.length)};b._removeFromFavoriteDiv=function(a){$("#personalFavoritesList").find("#favoriteDiv"+a).remove();if(0===this.FavoritesCache.size)return $("#noFavorites").show()};b._insertFavoriteCache=function(a){this.FavoritesCache[a]=!0;++this.FavoritesCache.size;return $("#numFavorites").html(this.FavoritesCache.size)};
b._removeFavoriteCache=function(a){this.FavoritesCache[a]=null;--this.FavoritesCache.size;return $("#numFavorites").html(this.FavoritesCache.size)};return b}();A2Cribs.FacebookManager=function(){function b(){}b.FacebookLogin=function(){var a;a="https://www.facebook.com/dialog/oauth?client_id=450938858319396&redirect_uri=http://www.cribspot.com/login";a+="&scope=email";A2Cribs.MixPanel.AuthEvent("login",{source:"facebook"});return window.location.href=a};b.Logout=function(){alert("logging out");return $.ajax({url:myBaseUrl+
"Users/Logout",type:"GET"})};b.Login=function(){return alert("logging in")};b.JSLogin=function(){return FB.login(A2Cribs.FacebookManager.JSLoginCallback)};b.JSLoginCallback=function(a){return a.authResponse?(FB.api("/me",A2Cribs.FacebookManager.APICallback),$.ajax({url:myBaseUrl+"Verify/FacebookVerify",type:"POST"})):alert("failed")};b.FindMutualFriends=function(){var a;a="SELECT uid, first_name, last_name, pic_small FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = me()) AND uid IN (SELECT uid2 FROM friend WHERE uid1 = "+
$("#userid_input").val()+")";return FB.api({method:"fql.query",query:a},A2Cribs.FacebookManager.FindMutualFriendsCallback)};b.FindMutualFriendsCallback=function(a){return $("#numMutualFriendsVal").html(a.length)};b.APICallback=function(a){console.log(a);$(".facebook.unverified").toggleClass("unverified verified");return $(".facebook.verified").html(a.name+" is now verified.")};b.UpdateLinkedinLogin=function(a){$(".linkedin.unverified").toggleClass("unverified verified");$(".linkedin.verified").html(a.values[0].firstName+
" "+a.values[0].lastName+" is now verified.");return $.ajax({url:myBaseUrl+"Verify/LinkedinVerify",type:"POST"})};b.SubmitEmail=function(){var a,c;a=$("#emailInput").val();if(-1===a.search(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i))alert("Email address is invalid");else if(a=a.substring(a.indexOf("@")+1),c=a.substring(a.indexOf(".")+1),"edu"===c.toLowerCase())return $("#emailEduVerified").toggleClass("unverified verified"),$("#emailEduVerified").html("Verified edu email ("+a.substring(0,a.length-
4).toLowerCase()+")")};return b}();A2Cribs.UtilityFunctions=function(){function b(){}b.getPosition=function(a){var c,d;for(d=c=0;a;)c+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent;return{x:c,y:d}};b.GetFormattedDate=function(a){var c,d;d=a.getUTCFullYear();c=a.getMonth()+1;a=a.getDate();return d+"-"+c+"-"+a};b.getDateRange=function(a,c){Date.prototype.addDays=function(a){var c=new Date(this.valueOf());c.setDate(c.getDate()+a);return c};var d,e;e=[];for(d=a;d<=c;)e.push(d),d=d.addDays(1);return e};
return b}();A2Cribs.CorrectMarker=function(){function b(){}b.Map=null;b.Marker=null;b.Geocoder=null;b.Enabled=!0;b.Init=function(){var a;this.LoadUniversities();a=$("#post-sublet-modal").find("#correctLocationMap")[0];this.CreateMap(a,42.2808256,-83.7430378);return this.Geocoder=new google.maps.Geocoder};b.CreateMap=function(a,c,d,e,b){null==e&&(e=!1);null==b&&(b=!0);c=new google.maps.LatLng(c,d);this.Map=new google.maps.Map(a,{zoom:15,center:c,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,
panControl:!1,zoomControl:!1,streetViewControl:!1});this.Marker=new google.maps.Marker({draggable:b,position:c,map:A2Cribs.CorrectMarker.Map,visible:e});b||this.Disable();return google.maps.event.trigger(this.Map,"resize")};b.Disable=function(){return null!=this.Map?this.Map.setOptions({draggable:!1,zoomControl:!1,scrollwheel:!1,disableDoubleClickZoom:!0}):this.Enabled=!1};b.Enable=function(){return null!=this.Map?this.Map.setOptions({draggable:!0,zoomControl:!0,scrollwheel:!0,disableDoubleClickZoom:!1}):
this.Enabled=!0};b.UpdateLatLong=function(a){$("#updatedLat").html(a.latLng.lat());return $("#updatedLong").html(a.latLng.lng())};b.AddressSearchCallback=function(a,c){var d,e,b,f,h,k,l,m,n,p,r,q,s;console.log(a);if(c===google.maps.GeocoderStatus.OK&&2<=a[0].address_components.length){b=d=f=h=null;l="00000";q=a[0].address_components;m=0;for(p=q.length;m<p;m++){e=q[m];s=e.types;n=0;for(r=s.length;n<r;n++)k=s[n],"street_number"===k?h=e.short_name:"route"===k?f=e.short_name:"locality"===k?d=e.short_name:
"administrative_area_level_1"===k?b=e.short_name:"postal_code"===k&&(l=e.short_name)}if(null===h)A2Cribs.UIManager.Alert("Entered street address is not valid."),$("#formattedAddress").text("");else return A2Cribs.CorrectMarker.Map.panTo(a[0].geometry.location),A2Cribs.CorrectMarker.Map.setZoom(18),$("#formattedAddress").val(h+" "+f),$("#city").val(d),$("#state").val(b),$("#postal").val(l),A2Cribs.CorrectMarker.Marker.setPosition(a[0].geometry.location),A2Cribs.CorrectMarker.Marker.setVisible(!0),
google.maps.event.addListener(A2Cribs.CorrectMarker.Marker,"dragend",A2Cribs.CorrectMarker.UpdateLatLong),$("#updatedLat").val(a[0].geometry.location.lat()),$("#updatedLong").val(a[0].geometry.location.lng())}};b.CenterMap=function(a,c){return this.Map.setCenter(new google.maps.LatLng(a,c))};b.SetMarkerAtPosition=function(a){return A2Cribs.CorrectMarker.Marker.setPosition(a)};b.FindAddress=function(){var a,c;a=$("#formattedAddress").val();A2Cribs.CorrectMarker.Map.getCenter();return void 0!==A2Cribs.CorrectMarker.SelectedUniversity?
(c=A2Cribs.CorrectMarker.SelectedUniversity,A2Cribs.CorrectMarker.Geocoder.geocode({address:a+" "+c.city+", "+c.state},A2Cribs.CorrectMarker.AddressSearchCallback)):A2Cribs.UIManager.Alert("Please select a university.")};b.FindSelectedUniversity=function(){var a,c;a=$("#universityName").val();a=this.SchoolList.indexOf(a);if(0<=a)return A2Cribs.CorrectMarker.SelectedUniversity=this.universitiesMap[a].University,A2Cribs.Cache.SelectedUniversity=this.universitiesMap[a].University,c=A2Cribs.CorrectMarker.SelectedUniversity,
A2Cribs.CorrectMarker.CenterMap(c.latitude,c.longitude),$("#universityId").val(A2Cribs.CorrectMarker.SchoolIDList[a])};b.LoadUniversities=function(){return $.ajax({url:"/University/getAll",success:function(a){var c,d,e;A2Cribs.CorrectMarker.universitiesMap=JSON.parse(a);A2Cribs.CorrectMarker.SchoolList=[];A2Cribs.CorrectMarker.SchoolIDList=[];e=A2Cribs.CorrectMarker.universitiesMap;c=0;for(d=e.length;c<d;c++)a=e[c],A2Cribs.CorrectMarker.SchoolList.push(a.University.name),A2Cribs.CorrectMarker.SchoolIDList.push(a.University.id);
return $("#universityName").typeahead({source:A2Cribs.CorrectMarker.SchoolList})}})};b.ClearMarker=function(){if(null!=A2Cribs.CorrectMarker.Marker)return A2Cribs.CorrectMarker.Marker.setVisible(!1)};return b}();A2Cribs.PhotoManager=function(){function b(c){var d=this;this.div=c;this.SetupUI();this.CurrentPrimaryImage=0;this.CurrentImageLoading=this.CurrentPreviewImage=null;this.Photos=[];this.div.find(".imageContainer").each(function(c,b){return d.Photos.push(new a($(b)))});this.MAX_CAPTION_LENGTH=
25;this.BACKSPACE=8}var a;a=function(){function a(c){this._div=c;this._imageId=-1;this._isEmpty=!0;this._isPrimary=!1;this._path=this._caption="";this._preview=null}a.prototype.LoadPhoto=function(d,e,b,f){this._imageId=d;this._path=e;this._caption=b;this._isEmpty=!1;this._preview="<img src='"+a.ProcessImagePath(this._path)+"'></img>";this._div.find(".imageContent").html(this._preview);return this.SetPrimary(f)};a.prototype.CreatePreview=function(d){var e=this;this._file=d;if(a.IsAcceptableFileType(this._file.name))return this._isEmpty=
!1,d=new FileReader,d.onloadend=function(a){"object"===typeof a&&(a=a.target.result);e._preview="<img src='"+a+"'></img>";return e._div.find(".imageContent").html(e._preview)},d.readAsDataURL(this._file)};a.prototype.GetPreview=function(){return this._preview};a.prototype.SaveCaption=function(a){return this._caption=a};a.prototype.GetCaption=function(){return this._caption};a.prototype.GetImageId=function(){return this._imageId};a.prototype.IsPrimary=function(){return this._isPrimary};a.prototype.SetPrimary=
function(a){return(this._isPrimary=a)?this._div.find(".primary").addClass("cur-primary"):this._div.find(".primary").removeClass("cur-primary")};a.prototype.SetId=function(a){return this._imageId=a};a.prototype.SetPath=function(a){return this._path=a};a.prototype.SetListingId=function(a){return this._listing_id=a};a.prototype.IsEmpty=function(){return this._isEmpty};a.prototype.Reset=function(){this._isEmpty=!0;this._div.find(".imageContent").html('<div class="img-place-holder"></div>');this._div.find(".image-actions-container").hide();
this._isPrimary=!1;this._path=this._caption="";return this._preview=null};a.prototype.GetObject=function(){return{image_id:this._imageId,caption:this._caption,is_primary:+this._isPrimary,image_path:this._path,listing_id:this._listing_id}};a.ProcessImagePath=function(a){var c;c=a.substr(0,a.lastIndexOf("/"));a="med_"+a.substr(a.lastIndexOf("/")+1);return c+"/"+a};a.IsAcceptableFileType=function(a){var c;c=a.indexOf(".",a.length-4);if(-1===c)return!1;a=a.substring(c+1).toLowerCase();if("jpg"===a||"jpeg"===
a||"png"===a)return!0;A2Cribs.UIManager.Alert("Not a valid file type. Valid file types include 'jpg', jpeg', or 'png'.");return!1};return a}();b.NUM_PREVIEWS=6;b.prototype.SetupUI=function(){var a=this;this.div.find(".imageContainer").hover(function(a){if(1===$(a.currentTarget).find("img").length)return"mouseenter"===a.type?$(a.currentTarget).find(".image-actions-container").show():$(a.currentTarget).find(".image-actions-container").hide()});this.div.find("#upload_image").click(function(){return a.div.find("#real-file-input").click()});
this.div.find(".imageContent").click(function(d){d=+d.currentTarget.id.match(/\d+/g)[0];return a.EditImage(d-1)});this.div.find(".edit").click(function(d){d=+d.currentTarget.id.match(/\d+/g)[0];return a.EditImage(d-1)});this.div.find(".delete").click(function(d){d=+d.currentTarget.id.match(/\d+/g)[0];return a.DeleteImage(d-1)});this.div.find(".primary").click(function(d){d=+d.currentTarget.id.match(/\d+/g)[0];return a.MakePrimary(d-1)});this.div.find("#captionInput").keyup(function(){var d;d=a.div.find("#captionInput").val();
d.length===a.MAX_CAPTION_LENGTH?a.div.find("#charactersLeft").css("color","red"):a.div.find("#charactersLeft").css("color","black");a.div.find("#charactersLeft").html(a.MAX_CAPTION_LENGTH-d.length);if(null!=a.CurrentPreviewImage)return a.Photos[a.CurrentPreviewImage].SaveCaption(a.div.find("#captionInput").val())});this.div.find(".delete").tooltip({selector:"",placement:"bottom",title:"Delete"});this.div.find(".edit").tooltip({selector:"",placement:"bottom",title:"Edit"});this.div.find(".primary").tooltip({selector:"",
placement:"bottom",title:"Make Primary"});return this.div.find("#ImageAddForm").fileupload({url:myBaseUrl+"images/AddImage",dataType:"json",acceptFileTypes:/(\.|\/)(jpeg|jpg|png)$/i,singleFileUploads:!0,maxFileSize:5E6,loadImageMaxFileSize:15E6,disableImageResize:!1,previewMaxWidth:100,previewMaxHeight:100,previewCrop:!0}).on("fileuploadadd",function(d,e){a.div.find("#upload_image").button("loading");if(0<=(a.CurrentImageLoading=a.NextAvailablePhoto())&&null!=e.files&&null!=e.files[0])return a.Photos[a.CurrentImageLoading].CreatePreview(e.files[0],
a.div.find("#imageContent"+(a.CurrentImageLoading+1)))}).on("fileuploaddone",function(d,e){a.div.find("#upload_image").button("reset");if(null!=e.result.errors&&e.result.errors.length)return A2Cribs.UIManager.Error("Failed to upload image!"),a.Photos[a.CurrentImageLoading].Reset();a.Photos[a.CurrentImageLoading].SetId(e.result.image_id);return a.Photos[a.CurrentImageLoading].SetPath(e.result.image_path)}).on("fileuploadfail",function(d,e){A2Cribs.UIManager.Error("Failed to upload image!");a.div.find("#upload_image").button("reset");
return a.Photos[a.CurrentImageLoading].Reset()})};b.prototype.LoadImages=function(a,d,e){var b,f,h,k=this;this.Reset();if(null!=(null!=a?a.length:void 0)){f=0;for(h=a.length;f<h;f++)b=a[f],this.Photos[this.NextAvailablePhoto()].LoadPhoto(b.image_id,b.image_path,b.caption,b.is_primary)}this.div.find("#finish_photo").unbind("click");return this.div.find("#finish_photo").click(function(){e(d,k.GetPhotos());return k.div.modal("hide")})};b.prototype.NextAvailablePhoto=function(){var a,d,e,b,f;f=this.Photos;
a=e=0;for(b=f.length;e<b;a=++e)if(d=f[a],d.IsEmpty())return a;return-1};b.prototype.DeleteImage=function(a){var d=this;return $.ajax({url:myBaseUrl+"images/delete/"+this.Photos[a].GetImageId(),type:"GET",success:function(){var e,b,f,h,k;d.Photos[a].Reset();if(a===d.CurrentPrimaryImage){k=d.Photos;e=f=0;for(h=k.length;f<h;e=++f)b=k[e],b.IsEmpty()||d.MakePrimary(e)}if(a===d.CurrentPreviewImage)return d.div.find("#imageContent0").html('<div class="img-place-holder"></div>')}})};b.prototype.EditImage=
function(a){if(!this.Photos[a].IsEmpty())return this.CurrentPreviewImage=a,this.div.find("#imageContent0").html(this.Photos[a].GetPreview()),this.div.find("#captionInput").val(this.Photos[a].GetCaption()),this.div.find("#charactersLeft").html(this.MAX_CAPTION_LENGTH-this.Photos[a].GetCaption().length)};b.prototype.MakePrimary=function(a){this.Photos[this.CurrentPrimaryImage].SetPrimary(!1);return this.Photos[this.CurrentPrimaryImage=a].SetPrimary(!0)};b.prototype.Reset=function(){var a,d,e,b,f;this.div.find("#imageContent0").html('<div class="img-place-holder"></div>');
this.div.find("#captionInput").val("");this.div.find("#charactersLeft").html(this.MAX_CAPTION_LENGTH);b=this.Photos;f=[];d=0;for(e=b.length;d<e;d++)a=b[d],f.push(a.Reset());return f};b.prototype.GetPhotos=function(){var a,d,e,b,f;d=[];f=this.Photos;e=0;for(b=f.length;e<b;e++)a=f[e],a.IsEmpty()||d.push(a.GetObject());return 0===d.length?null:d};b.SubmitPhoto=function(a,d){return $.ajax({url:myBaseUrl+"images/AddImage/"+a+"/"+d,type:"POST",success:function(a){a=JSON.parse(a);return console.log(a)}})};
return b}.call(this);A2Cribs.ShareManager=function(){function b(){}b.GetShareUrl=function(a,c,d,e,b){if(null===a||null===c||null===d||null===e||null===b)return null;c.split(" ").join("-");d.split(" ").join("-");return"http://cribspot.com/listing/"+a};b.ShareListingOnFacebook=function(a,c,d,e,b,f,h){null==f&&(f=null);null==h&&(h=null);d=this.GetShareUrl(a,c,d,e,b);a="Check out this listing on Cribspot!";null===h?h=c:a=c;c={method:"feed",link:d,picture:"http://www.cribspot.com/img/upright_logo.png",
name:h,caption:a};null!==f&&(c.description=f);return FB.ui(c)};b.CopyListingUrl=function(a,c,d,e,b){a=this.GetShareUrl(a,c,d,e,b);return window.prompt("Copy to clipboard: Ctrl+C, Enter",a)};b.ShareListingOnTwitter=function(a,c,d,e,b){a=this.GetTwitterShareUrl(a,c,d,e,b);return window.open(a,"winname","directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=600,height=350,top="+(screen.height/2-175)+",left="+(screen.width/2-300))};b.GetTwitterShareUrl=
function(a,c,d,e,b){if(null===a||null===c||null===d||null===e||null===b)return null;a=this.GetShareUrl(a,c,d,e,b);return"https://twitter.com/share?url="+encodeURIComponent(a)+"&text="+encodeURIComponent("Check out this listing on Cribspot!")+"&via=TheCribspot"};b.InitTweetButton=function(a,c,d,e,b){if(null===a||null===c||null===d||null===e||null===b)return null;a=this.GetShareUrl(a,c,d,e,b);$("#twitterDiv iframe").remove();a=$("<a></a>").addClass("twitter-share-button").attr("href","http://twitter.com/share").attr("data-url",
a).attr("data-text","Check out this awesome property on Cribspot.com! "+a).attr("data-via","TheCribspot");$("#twitterDiv").append(a);return twttr.widgets.load()};return b}();A2Cribs.HoverBubble=function(){function b(){}b.Init=function(a){this.template=$(".hover-bubble:first").parent();this.InfoBubble=new InfoBubble({map:a,arrowStyle:0,arrowPosition:20,shadowStyle:0,borderRadius:5,arrowSize:17,borderWidth:0,disableAutoPan:!0,padding:0,disableAnimation:!0});this.InfoBubble.hideCloseButton();this.InfoBubble.setBackgroundClassName("map_bubble");
return this.template.find(".close_button").attr("onclick","A2Cribs.HoverBubble.Close();")};b.Open=function(a){var c;this.Close();null!=(c=A2Cribs.ClickBubble)&&c.Close();if(a)return this.SetContent(a),c=A2Cribs.ClickBubble.ConvertLatLongToPixels(a.GMarker.getPosition()),c=A2Cribs.ClickBubble.GetAdjustedClickBubblePosition(c.x,c.y),A2Cribs.Map.GMap.panBy(c.x,c.y),this.InfoBubble.open(A2Cribs.Map.GMap,a.GMarker)};b.Refresh=function(){return this.InfoBubble.open()};b.Close=function(){return this.InfoBubble.close()};
b.SetContent=function(a){var c,d,e,b,f,h,k;b=A2Cribs.UserCache.GetAllAssociatedObjects("listing","marker",a.GetId());this.template.find(".building_type").text(a.GetBuildingType());this.template.find(".unit_div").empty();f=b.sort(function(a,c){var d,e;d=A2Cribs.UserCache.Get(A2Cribs.Map.ACTIVE_LISTING_TYPE,a.GetId());e=A2Cribs.UserCache.Get(A2Cribs.Map.ACTIVE_LISTING_TYPE,c.GetId());return null==d.rent&&null==e.rent?0:null!=d.rent&&null==e.rent?1:null==d.rent&&null!=e.rent?-1:parseInt(d.rent,10)-parseInt(e.rent,
10)});h=0;for(k=f.length;h<k;h++)if(a=f[h],null==a.visible||a.visible)e=A2Cribs.UserCache.Get(A2Cribs.Map.ACTIVE_LISTING_TYPE,a.GetId()),c=function(){var a;a=[];for(d in b)a.push(d);return a}(),c.sort(function(a,c){return b[c]-b[a]}),null==e.beds?(e.beds="??",e.bed_desc="Beds"):0===parseInt(e.beds,10)?(e.beds="Studio",e.bed_desc=""):1===parseInt(e.beds,10)?e.bed_desc="Bed":e.bed_desc="Beds",c=$("<div />",{"class":"unit"}),c.attr("onclick","A2Cribs.ClickBubble.Open("+a.GetId()+")"),$("<div />",{"class":"beds",
text:e.beds}).appendTo(c),$("<div />",{"class":"bed_desc",text:e.bed_desc}).appendTo(c),$("<div />",{"class":"rent",text:null!=e.rent?"$"+e.rent:"??"}).appendTo(c),this.template.find(".unit_div").append(c);return this.InfoBubble.setContent(this.template.html())};b.resolveDate=function(a,c){var d,e;e=a.split("-");d=c.split("-");return+e[1]+"/"+ +e[2]+"-"+ +d[1]+"/"+ +d[2]};return b}();A2Cribs.ClickBubble=function(){function b(){}var a;b.OFFSET={TOP:-190,LEFT:140};b.PADDING=50;b.IsOpen=!1;a=function(a){var d;
a=A2Cribs.UserCache.Get("listing",a);a=A2Cribs.UserCache.Get("marker",a.marker_id);d=null;null!=a&&null!=a.GMarker?d=a.GMarker.getPosition():null!=a&&new google.maps.LatLng(a.latitude,a.longitude);if(null!==d)return a=b.ConvertLatLongToPixels(d),b.div.css("left",a.x+b.OFFSET.LEFT),b.div.css("top",a.y+b.OFFSET.TOP)};b.ConvertLatLongToPixels=function(a){var d,e,b;e=Math.pow(2,this.map.getZoom());d=new google.maps.LatLng(this.map.getBounds().getNorthEast().lat(),this.map.getBounds().getSouthWest().lng());
d=this.map.getProjection().fromLatLngToPoint(d);b=this.map.getProjection().fromLatLngToPoint(a);a={};a.x=Math.floor((b.x-d.x)*e);a.y=Math.floor((b.y-d.y)*e);return a};b.Init=function(a){var d=this;this.map=a;this.div=$(".click-bubble:first");return this.div.find(".close_button").click(function(){return d.Close()})};b.Open=function(a){var d,e,b=this;this.IsOpen=!0;e=new $.Deferred;null!=a&&(d=A2Cribs.UserCache.Get(A2Cribs.Map.ACTIVE_LISTING_TYPE,a),A2Cribs.MixPanel.Click(d,"large popup"),null!=d.rental_id?
(this.SetContent(d.GetObject()),this.Show(a),e.resolve(a)):$.ajax({url:myBaseUrl+"Listings/GetListing/"+a,type:"GET",success:function(f){var h,k,l,m,n;k=JSON.parse(f);m=0;for(n=k.length;m<n;m++)for(h in f=k[m],f)l=f[h],"Marker"!==h&&null!=A2Cribs[h]&&A2Cribs.UserCache.Set(new A2Cribs[h](l));d=A2Cribs.UserCache.Get(A2Cribs.Map.ACTIVE_LISTING_TYPE,a);b.SetContent(d.GetObject());b.Show(a);return e.resolve(a)}}));return e.promise()};b.Show=function(c){this.IsOpen=!0;a(c);return this.div.show("fade")};
b.Refresh=function(){return this.div.show("fade")};b.Close=function(){this.IsOpen=!1;return this.div.hide("fade")};b.Clear=function(){return this.div.find(".clear_field").text("?").html("?").val("?")};b.SetContent=function(a){var d,e,b;this.Clear();for(d in a)b=a[d],this.div.find("."+d).text(b);this.div.find(".date_range").text(this.resolveDateRange(a.start_date));e=A2Cribs.UserCache.Get("marker",A2Cribs.UserCache.Get("listing",a.listing_id).marker_id);this.div.find(".building_name").text(e.GetName());
this.div.find(".unit_type").text(e.GetBuildingType());d="";null!=a.unit_style_options&&null!=a.unit_style_description?d=a.unit_style_options+"-"+a.unit_style_description:"Entire House"===a.unit_style_options&&(d="Entire House");this.div.find(".unit_style_description").text(d);this.div.find("unit_style_description").text;this.linkWebsite(".website_link",a.website);this.setAvailability("available",a.available);this.setOwnerName("property_manager",a.listing_id);this.setPrimaryImage("property_image",
a.listing_id);this.setFullPage("full_page_link",a.listing_id);this.setFullPageContact("full_page_contact",a.listing_id);this.div.find(".share_btn").unbind("click");this.div.find(".facebook_share").click(function(){return A2Cribs.ShareManager.ShareListingOnFacebook(a.listing_id,e.street_address,e.city,e.state,e.zip,a.description,a.building_type_id)});this.div.find(".link_share").click(function(){return A2Cribs.ShareManager.CopyListingUrl(a.listing_id,e.street_address,e.city,e.state,e.zip)});this.div.find(".twitter_share").click(function(){return A2Cribs.ShareManager.ShareListingOnTwitter(a.listing_id,
e.street_address,e.city,e.state,e.zip)});return A2Cribs.FavoritesManager.setFavoriteButton("favorite_listing",a.listing_id,A2Cribs.FavoritesManager.FavoritesListingIds)};b.resolveDateRange=function(a){var d;d="Unknown Start Date";null!=a&&(d="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),a=a.split("-"),d=""+d[+a[1]-1]+" "+parseInt(a[2],10)+", "+a[0]);return d};b.setAvailability=function(a,d){if(null==d)return $("."+a).hide();if(d)return $("."+a).show().text("Available"),$("."+a).removeClass("leased");
$("."+a).show().text("Leased");return $("."+a).addClass("leased")};b.linkWebsite=function(a,d){return null!=d?(-1===d.indexOf("http")&&(d="http://"+d),this.div.find(a).attr("href",d),this.div.find(a).attr("onclick","")):this.div.find(a).attr("onclick","A2Cribs.UIManager.Error('This owner does not have a website for this listing')")};b.setOwnerName=function(a,d){var e;e=A2Cribs.UserCache.Get("listing",d);e=A2Cribs.UserCache.Get("user",e.user_id);null!=(null!=e?e.company_name:void 0)?$("."+a).show().text(e.company_name):
null!=(null!=e?e.first_name:void 0)&&e.last_name?$("."+a).show().text(""+e.first_name+" "+e.last_name):$("."+a).hide();return null!=e&&e.verified?this.div.find(".verified").show():this.div.find(".verified").hide()};b.setPrimaryImage=function(a,d){var e;if(null!=A2Cribs.UserCache.Get("image",d)){if(e=A2Cribs.UserCache.Get("image",d).GetPrimary(),null!=e&&null!=a)return e=this._processImagePath(e),$("."+a).css("background-image","url(/"+e+")")}else if(null!=a)return $("."+a).css("background-image",
"url(/img/tooltip/no_photo.jpg)")};b._processImagePath=function(a){var d;d=a.substr(0,a.lastIndexOf("/"));a="med_"+a.substr(a.lastIndexOf("/")+1);return d+"/"+a};b.setFullPage=function(a,d){$("."+a).unbind("click");return $("."+a).click(function(){A2Cribs.MixPanel.Click(A2Cribs.UserCache.Get("listing",d),"full page");return window.open("/listings/view/"+d,"_blank").focus()})};b.setFullPageContact=function(a,d){$("."+a).unbind("click");return $("."+a).click(function(){A2Cribs.MixPanel.Click(A2Cribs.UserCache.Get("listing",
d),"full page contact user");return window.open("/messages/contact/"+d,"_blank").focus()})};b.GetAdjustedClickBubblePosition=function(a,d){var e,b,f,h,k,l,m;l=d+this.OFFSET.TOP;m=d+this.OFFSET.TOP+$(".click-bubble").height();k=a+this.OFFSET.LEFT+$(".click-bubble").width();h={x:0,y:0};b=$("#map_region").width();e=$(window).height()-5;f=$("#map_filter").offset().top;l<f+this.PADDING&&(h.y=l-(f+this.PADDING));m>e-this.PADDING&&(h.y=m-(e-this.PADDING));k>b-this.PADDING&&(h.x=k-(b-this.PADDING));return h};
return b}.call(this);A2Cribs.Cache=function(){function b(){}b.IdToSubletMap=[];b.IdToMarkerMap=[];b.IdToUniversityMap=[];b.IdToHousematesMap=[];b.SubletIdToHousemateIdsMap=[];b.SubletIdToOwnerMap=[];b.SubletIdToImagesMap=[];b.MarkerIdToHoverDataMap=[];b.MarkerIdToSubletIdsMap=[];b.IdToMarkerMap=[];b.AddressToMarkerIdMap=[];b.BuildingIdToNameMap=[];b.BathroomIdToNameMap=[];b.GenderIdToNameMap=[];b.StudentTypeIdToNameMap=[];b.FavoritesSubletIdsList=[];b.FavoritesMarkerIdsList=[];b.IdToRentalMap=[];
b.IdToParkingMap=[];b.ListingIdToUserMap=[];b.SubletEditInProgress=null;b.CacheSublet=function(a){var c,d;a.id=parseInt(a.id);a.marker_id=parseInt(a.marker_id);this.MarkerIdToSubletIdsMap[parseInt(a.marker_id)].push(a.id);a.number_bedrooms=parseInt(a.number_bedrooms);a.price_per_bedroom=parseInt(a.price_per_bedroom);a.number_bedrooms=parseInt(a.number_bedrooms);a.utility_cost=parseInt(a.utility_cost);a.deposit_amount=parseInt(a.deposit_amount);a.additional_fees_amount=parseInt(a.additional_fees_amount);
a.marker_id=parseInt(a.marker_id);a.furnished_type_id=parseInt(a.furnished_type_id);d=this.IdToMarkerMap[a.marker_id].UnitType;a.bathroom_type_id=parseInt(a.bathroom_type_id);c=this.BathroomIdToNameMap[a.bathroom_type_id];a.university_id=parseInt(a.university_id);return this.IdToSubletMap[a.id]=new A2Cribs.Sublet(a.id,a.university_id,d,a.name,a.street_address,a.city,a.state,a.date_begin,a.date_end,a.number_bedrooms,a.price_per_bedroom,a.short_description,c,a.utility_cost,a.deposit_amount,a.additional_fees_description,
a.additional_fees_amount,a.marker_id,a.flexible_dates,a.furnished_type_id,a.created,a.ac,a.parking)};b.CacheMarkerIdToSubletsList=function(a){var c,d,e,b;A2Cribs.Map.MarkerIdToSubletIdsMap[parseInt(a[0].Sublet.marker_id)]=[];b=[];d=0;for(e=a.length;d<e;d++)c=a[d],void 0!==c&&b.push(this.MarkerIdToSubletIdsMap[parseInt(c.Sublet.marker_id)].push(parseInt(c.Sublets.sublet_id)));return b};b.CacheUniversity=function(a){var c;if(null!==a)return c=parseInt(a.id),this.IdToUniversityMap[c]=new A2Cribs.University(a.city,
a.domain,a.name,a.state)};b.CacheHoverData=function(a){var c,d,e,b,f,h,k,l,m,n,p,r,q,s;d=[];b=0;for(f=a.length;b<f;b++)c=a[b],e=null,null!==c&&(e=parseInt(c.Sublet.marker_id),void 0!==this.IdToMarkerMap[e]&&(void 0===d[e]&&(d[e]=[]),d[e].push(c)));for(e in d){a=d[e];n=a.length;p=a[0].Sublet;if(void 0===p||null===p)break;r=this.IdToMarkerMap[e].UnitType;k=parseInt(p.number_bedrooms);b=parseInt(p.number_bedrooms);m=parseInt(p.price_per_bedroom);h=parseInt(p.price_per_bedroom);l=p.date_begin;f=p.date_end;
q=0;for(s=a.length;q<s;q++)c=a[q],p=c.Sublet,parseInt(p.building_type_id),c=parseInt(p.number_bedrooms),p=parseInt(p.price_per_bedroom),c<k&&(k=c),c>b&&(b=c),p<m&&(m=p),p>h&&(h=p);c=new A2Cribs.HoverData(n,r,k,b,m,h,l,f);this.MarkerIdToHoverDataMap[e]=c}};b.CacheHousemates=function(a){var c,d,e,b,f;if(null!=a&&null!=a.sublet_id)return f=parseInt(a.sublet_id),this.SubletIdToHousemateIdsMap[f]=[],e=parseInt(a.id),d=this.StudentTypeIdToNameMap[parseInt(a.student_type_id)],c=this.GenderIdToNameMap[parseInt(a.gender_type_id)],
f=parseInt(a.sublet_id),b=parseInt(a.quantity),this.IdToHousematesMap[e]=new A2Cribs.Housemate(f,a.enrolled,a.major,a.seeking,d,c,b),this.SubletIdToHousemateIdsMap[f].push(e)};b.CacheImages=function(a){var c,d,e,b,f,h,k;if(!(void 0===a||null===a||void 0===a[0]))if(d=a[0],!(void 0===d||void 0===d.sublet_id)){b=parseInt(d.sublet_id);A2Cribs.Cache.SubletIdToImagesMap[b]=[];k=[];f=0;for(h=a.length;f<h;f++)c=a[f],b=parseInt(c.sublet_id),e="/"+c.image_path,d=c.is_primary,c=c.caption,k.push(A2Cribs.Cache.SubletIdToImagesMap[b].push(new A2Cribs.Image(b,
e,d,c)));return k}};b.CacheMarker=function(a,c){var d;d=this.BuildingIdToNameMap[parseInt(c.building_type_id)];return this.IdToMarkerMap[a]=new A2Cribs.Marker(parseInt(a),c.street_address,c.alternate_name,d,c.latitude,c.longitude,c.city,c.state)};b.CacheSubletOwner=function(a,c){var d;d=new A2Cribs.SubletOwner(c);return this.SubletIdToOwnerMap[a]=d};b.CacheMarkerData=function(a){var c,d,e,b,f;void 0!==a[0]&&void 0!==a[0].Sublet&&(c=parseInt(a[0].Sublet.marker_id),this.MarkerIdToSubletIdsMap[c]=[]);
f=[];e=0;for(b=a.length;e<b;e++)c=a[e],d=c.Sublet,A2Cribs.Cache.CacheSublet(d),A2Cribs.Cache.CacheHousemates(c.Housemate),A2Cribs.Cache.CacheSubletOwner(parseInt(d.id),c.User),f.push(A2Cribs.Cache.CacheImages(c.Image));return f};b.CacheSubletAddStep1=function(a){return A2Cribs.Cache.Step1Data=a};b.CacheSubletAddStep2=function(a){return A2Cribs.Cache.Step2Data=a};b.CacheSubletAddStep3=function(a){return A2Cribs.Cache.Step3Data=a};b.AddRental=function(a){a.air=parseInt(a.air);a.beds=parseInt(a.beds);
a.baths=parseInt(a.baths);a.building_type=parseInt(a.building_type);a.cable=parseInt(a.cable);a.deposit=parseInt(a.deposit);a.electric=parseInt(a.electric);a.furnished_type=parseInt(a.furnished_type);a.gas=parseInt(a.gas);a.heat=parseInt(a.heat);a.internet=parseInt(a.internet);a.listing_id=parseInt(a.listing_id);a.min_occupancy=parseInt(a.min_occupancy);a.max_occupancy=parseInt(a.max_occupancy);a.parking_spots=parseInt(a.parking_spots);a.parking_type=parseInt(a.parking_type);a.pets_type=parseInt(a.pets_type);
a.rent=parseInt(a.rent);a.rental_id=parseInt(a.rental_id);a.sewage=parseInt(a.sewage);a.square_feet=parseInt(a.square_feet);a.trash=parseInt(a.trash);a.unit_style_options=parseInt(a.unit_style_options);a.utility_estimate_summer=parseInt(a.utility_estimate_summer);a.utility_estimate_winter=parseInt(a.utility_estimate_winter);a.water=parseInt(a.water);a.year_built=parseInt(a.year_built);return this.IdToRentalMap[a.rental_id]=a};b.AddParking=function(a){return this.IdToParkingMap[parseInt(a.parking_id)]=
a};b.AddUser=function(a,c){return this.ListingIdToUserMap[a]=c};b.AddListing=function(a){if(!(void 0===a||null===a))return void 0!==a.Rental?this.AddRental(a.Rental):void 0!==a.Parking&&this.AddParking(a.Parking),this.AddUser(parseInt(a.Listing.listing_id),a.User)};b.GetListing=function(a){var c;if(0<=y.call(this.IdToRentalMap,a))return this.IdToRentalMap[a];c=null;$.ajax({url:myBaseUrl+"Listings/GetListing/"+a,type:"GET",context:this,async:!1,success:function(a){c=JSON.parse(a);return this.AddListing(c[0])}});
return null!==c?c[0]:null};b.GetListingsByLoggedInUser=function(){var a;a=null;$.ajax({url:myBaseUrl+"Listings/GetListingsByLoggedInUser",type:"GET",context:this,async:!1,success:function(c){var d,e,b;a=JSON.parse(c);b=[];d=0;for(e=a.length;d<e;d++)c=a[d],b.push(this.AddListing(c));return b}});return a};return b}();A2Cribs.Housemate=function(){return function(b,a,c,d,e,g,f){this.SubletId=b;this.Enrolled=a;this.Major=c;this.Seeking=d;this.GradType=e;this.Gender=g;this.Quantity=f}}();A2Cribs.HoverData=
function(b){function a(c){a.__super__.constructor.call(this,"hoverData",c)}t(a,b);a.prototype.GetId=function(){return null!=this[0]&&null!=this[0].Listing&&null!=this[0].Listing.marker_id?parseInt(this[0].Listing.marker_id):null};return a}(A2Cribs.Object);A2Cribs.UIManager=function(){function b(){}b.Alert=function(a){return alertify.alert(a)};b.Error=function(a){return alertify.error(a,7E3)};b.Success=function(a){return alertify.success(a)};b.CloseLogs=function(){return $(".alertify-log").remove()};
b.FlashMessage=function(){if("undefined"!==typeof flash_message&&null!==flash_message)return this[flash_message.method](flash_message.message)};b.Confirm=function(a,c){alertify.set({buttonFocus:"cancel"});return alertify.confirm(a,c)};b.ConfirmBox=function(a,c,d){alertify.set({labels:c,buttonFocus:"cancel"});return alertify.confirm(a,d)};return b}();$(document).ready(function(){return setTimeout(function(){return A2Cribs.UIManager.FlashMessage()},2E3)});A2Cribs.Image=function(b){function a(a){var d,
e,b,f;if(0!==a.length){this.class_name="image";f=this.image_array=a;a=e=0;for(b=f.length;e<b;a=++e)d=f[a],d.is_primary&&(this.primary=a);this.listing_id=this.image_array[0].listing_id}}t(a,b);a.prototype.GetId=function(){return this.listing_id};a.prototype.GetPrimary=function(a){null==a&&(a="image_path");if(null!=this.primary)return this.image_array[this.primary][a]};a.prototype.GetImages=function(){return this.image_array};a.prototype.GetObject=function(){var a,d,e,b,f,h,k,l;b=[];l=this.image_array;
h=0;for(k=l.length;h<k;h++){a=l[h];d={};for(e in a)f=a[e],"function"!==typeof f&&("boolean"===typeof f&&(f=+f),d[e]=f);b.push(d)}return b};return a}(A2Cribs.Object);A2Cribs.Rental=function(b){function a(c){var d,e,b,f;a.__super__.constructor.call(this,"rental",c);d=["start_date","end_date","alternate_start_date"];b=0;for(f=d.length;b<f;b++)if(c=d[b],this[c]&&-1!==(e=this[c].indexOf(" ")))this[c]=this[c].substring(0,e)}t(a,b);a.prototype.GetId=function(a){return parseInt(this.listing_id,10)};a.prototype.IsComplete=
function(){return null!=this.rental_id?!0:!1};a.Required_Fields={unit_style_options:"overview_grid",beds:"overview_grid",baths:"features_grid",min_occupancy:"overview_grid",max_occupancy:"overview_grid",rent:"overview_grid",start_date:"overview_grid",lease_length:"overview_grid",available:"overview_grid",contact_email:"contact_grid",contact_phone:"contact_grid"};return a}(A2Cribs.Object);A2Cribs.FilterManager=function(){function b(){}b.MinRent=0;b.MaxRent=999999;b.MaxSliderRent=2E3;b.MinBeds=0;b.MaxBeds=
999999;b.MaxSliderBeds=10;b.DateBegin="NOT_SET";b.DateEnd="NOT_SET";b.Geocoder=null;b.UpdateListings=function(a){var c,d,e,b;a=JSON.parse(a);null!=(c=A2Cribs.HoverBubble)&&c.Close();null!=(d=A2Cribs.ClickBubble)&&d.Close();c=A2Cribs.UserCache.Get("listing");e=0;for(b=c.length;e<b;e++)d=c[e],d.visible=!1;c={};e=0;for(b=a.length;e<b;e++)d=a[e],d=A2Cribs.UserCache.Get("listing",d),null!=d&&(d.visible=!0,c[+d.marker_id]=!0);a=A2Cribs.UserCache.Get("marker");e=0;for(b=a.length;e<b;e++)d=a[e],c[+d.marker_id]?
d.GMarker.setVisible(!0):d.GMarker.setVisible(!1);return A2Cribs.Map.GMarkerClusterer.repaint()};b.WheneverButtonClicked=function(a){"Whenever"===$("#startDate").datepicker().valueOf()[0].value&&(A2Cribs.FilterManager.DateBegin="NOT_SET");"Whenever"===$("#endDate").datepicker().valueOf()[0].value&&(A2Cribs.FilterManager.DateEnd="NOT_SET");return A2Cribs.FilterManager.ApplyFilter()};b.ApplyFilter=function(a,c){var d,e;A2Cribs.Map.ClickBubble.Close();e="house="+$("#houseCheck").is(":checked");d=$("#aptCheck").is(":checked");
e+="&apt="+d;d=$("#otherCheck").is(":checked");e+="&unit_type_other="+d;d=$("#maleCheck").is(":checked");e+="&male="+d;d=$("#femaleCheck").is(":checked");e+="&female="+d;d=$("#studentsOnlyCheck").is(":checked");e+="&students_only="+d;d=$("#gradCheck").is(":checked");e+="&grad="+d;d=$("#undergradCheck").is(":checked");e+="&undergrad="+d;d=$("#acCheck").is(":checked");e+="&ac="+d;d=$("#parkingCheck").is(":checked");e+="&parking="+d;d=$("#utilitiesCheck").is(":checked");e+="&utilities_included="+d;d=
$("#noSecurityDepositCheck").is(":checked");e+="&no_security_deposit="+d;d=$("#bedsSelect").val();"2+"===d&&(d="2");e+="&beds="+d;d=$("#bathSelect").val();e+="&bathroom_type="+d;void 0!==a.target&&"slider"===a.target.id&&(A2Cribs.FilterManager.MinRent=a.value[0],A2Cribs.FilterManager.MaxRent=a.value[1],A2Cribs.FilterManager.MaxRent===A2Cribs.FilterManager.MaxSliderRent&&(A2Cribs.FilterManager.MaxRent=999999));if(void 0!==a.target&&"startDate"===a.target.id){d=a.valueOf().date;if("NOT_SET"!==A2Cribs.FilterManager.DateEnd&&
"Whenever"!==A2Cribs.FilterManager.DateEnd&&d>new Date(A2Cribs.FilterManager.DateEnd)){A2Cribs.UIManager.Alert("Start Date cannot occur after End Date.");A2Cribs.FilterManager.DateBegin=new Date(A2Cribs.FilterManager.DateEnd);A2Cribs.FilterManager.StartDateObject.setValue(A2Cribs.FilterManager.DateBegin);return}A2Cribs.FilterManager.DateBegin=A2Cribs.FilterManager.GetFormattedDate(d)}if(void 0!==a.target&&"endDate"===a.target.id){d=a.valueOf().date;if("NOT_SET"!==A2Cribs.FilterManager.DateBegin&&
"Whenever"!==A2Cribs.FilterManager.DateBegin&&d<new Date(A2Cribs.FilterManager.DateBegin)){A2Cribs.UIManager.Alert("End Date cannot occur before Start Date.");A2Cribs.FilterManager.DateEnd=new Date(A2Cribs.FilterManager.DateBegin);A2Cribs.FilterManager.EndDateObject.setValue(A2Cribs.FilterManager.DateEnd);return}A2Cribs.FilterManager.DateEnd=A2Cribs.FilterManager.GetFormattedDate(a.valueOf().date)}e+="&min_rent="+A2Cribs.FilterManager.MinRent;e+="&max_rent="+A2Cribs.FilterManager.MaxRent;e+="&start_date="+
A2Cribs.FilterManager.DateBegin;e+="&end_date="+A2Cribs.FilterManager.DateEnd;return $.ajax({url:myBaseUrl+"Sublets/ApplyFilter",type:"GET",data:e,context:this,success:A2Cribs.FilterManager.UpdateMarkers})};b.GetFormattedDate=function(a){var c,d;d=a.getUTCFullYear();c=a.getMonth()+1;a=a.getDate();return d+"-"+c+"-"+a};b.GetTodaysDate=function(){var a,c,d;d=new Date;a=d.getDate();c=d.getMonth()+1;d=d.getUTCFullYear();10>a&&(a="0"+a);10>c&&(c="0"+c);return new Date(c+"-"+a+"-"+d)};b.InitAddressSearch=
function(){return A2Cribs.FilterManager.Geocoder=new google.maps.Geocoder};b.SearchForAddress=function(a){var c;null==A2Cribs.FilterManager.Geocoder&&(A2Cribs.FilterManager.Geocoder=new google.maps.Geocoder);c=$(a).val();A2Cribs.Map.GMap.getCenter();return A2Cribs.FilterManager.Geocoder.geocode({address:c+" "+A2Cribs.FilterManager.CurrentCity+", "+A2Cribs.FilterManager.CurrentState},function(c,e){return e===google.maps.GeocoderStatus.OK&&"postal_code"!==c[0].types[0]?($(a).effect("highlight",{color:"#5858FA"},
2E3),A2Cribs.Map.GMap.panTo(c[0].geometry.location),A2Cribs.Map.GMap.setZoom(18)):$(a).effect("highlight",{color:"#FF0000"},2E3)})};return b}();A2Cribs.RentalFilter=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}var c;t(a,b);a.FilterData={};c=function(a,c){var b;b=$(a).closest(".filter_content").attr("data-link");return $(b).find(".filter_preview").html(c)};a.CreateListeners=function(){var a=this;$("#filter_search_content").keyup(function(a){if(13===a.keyCode)return A2Cribs.FilterManager.SearchForAddress(a.delegateTarget),
$(a.delegateTarget).select()});this.div.find(".lease_slider").on("slideStop",function(c){return a.ApplyFilter("LeaseRange",{min:parseInt(c.value[0],10),max:parseInt(c.value[1],10)})});this.div.find(".rent_slider").on("slideStop",function(c){return a.ApplyFilter("Rent",{min:parseInt(c.value[0],10),max:parseInt(c.value[1],10)})});this.div.find("#bed_filter").find(".btn").click(function(b){var g,f,h;h=[];f=1E3;g=-1;$(b.delegateTarget).toggleClass("active");$(b.delegateTarget).parent().find(".btn.active").each(function(){var a;
a=parseInt($(this).val(),10);h.push(a);f=Math.min(f,a);return g=Math.max(g,a)});if(0===h.length)return c(b.delegateTarget,""),a.ApplyFilter("Beds",null);a.ApplyFilter("Beds",h);return 1===h.length?c(b.delegateTarget,0===f?"<div class='filter_data'>Studio</div>":1===f?"<div class='filter_data'>"+f+"</div><div class='filter_label'>&nbsp;bed</div>":"<div class='filter_data'>"+f+"</div><div class='filter_label'>&nbsp;beds</div>"):c(b.delegateTarget,"<div class='filter_data'>"+f+"-"+g+"</div><div class='filter_label'>&nbsp;beds</div>")});
this.div.find("#year_filter").change(function(c){var b;b=a.FilterData.Dates;c=$(c.delegateTarget).val();return null!=b?(b.year=c,a.ApplyFilter("Dates",b)):a.ApplyFilter("Dates",{months:[],year:c})});this.div.find("#start_filter").find(".btn").click(function(b){var g,f,h;h=[];$(b.delegateTarget).toggleClass("active");g=$(b.delegateTarget).parent();f="";g.find(".btn.active").each(function(){h.push($(this).attr("data-month"));return f=$(this).text()});if(0===h.length)return c(b.delegateTarget,""),a.ApplyFilter("Dates",
null);a.ApplyFilter("Dates",{months:h,year:a.div.find("#year_filter").val()});return 1===h.length?c(b.delegateTarget,"<div class='filter_data'>"+f+"</div><div class='filter_label'>&nbsp;start</div>"):c(b.delegateTarget,"<div class='filter_data'>"+h.length+"</div><div class='filter_label'>&nbsp;starts</div>")});return this.div.find("input[type='checkbox']").change(function(b){var g,f,h;f=$(b.target).closest(".filter_content");g=$(b.delegateTarget).attr("data-filter");h=[];f.find("input[type='checkbox']").each(function(){if(this.checked)return h.push($(this).attr("data-value"))});
"UnitTypes"===g?a.ApplyFilter(g,h):a.ApplyFilter(g,+b.delegateTarget.checked);return 0===h.length?c(b.delegateTarget,""):-1===f.attr("id").indexOf("more")?1===h.length?c(b.delegateTarget,"<div class='filter_data'>"+h.length+"</div><div class='filter_label'>&nbsp;type</div>"):c(b.delegateTarget,"<div class='filter_data'>"+h.length+"</div><div class='filter_label'>&nbsp;types</div>"):c(b.delegateTarget,"<div class='filter_data'>"+h.length+"</div><div class='filter_label'>&nbsp;more</div>")})};a.SetupUI=
function(){var a=this;this.div=$("#map_filter");$("#filter_search_btn").click(function(){if($("#filter_search_content").is(":visible"))return $("#filter_search_content").hide("slide",{direction:"left"},300);$("#filter_search_content").show("slide",{direction:"left"},300);return $("#filter_search_content").focus()});this.div.find(".lease_slider").slider({min:0,max:12,step:1,value:[0,12],tooltip:"hide"}).on("slide",function(b){var g;g=1<b.value[1]?"&nbsp;months":"&nbsp;month";a.div.find("#lease_min").text(b.value[0]);
a.div.find("#lease_min_desc").html(1<b.value[0]?"&nbsp;months":"&nbsp;month");a.div.find("#lease_max").text(b.value[1]);a.div.find("#lease_max_desc").html(g);return b.value[0]===b.value[1]?c(b.delegateTarget,"<div class='filter_data'>"+b.value[0]+"</div><div class='filter_label'>"+g+"</div>"):c(b.delegateTarget,"<div class='filter_data'>"+b.value[0]+"-"+b.value[1]+"</div><div class='filter_label'>"+g+"</div>")});this.div.find(".rent_slider").slider({min:0,max:5E3,step:100,value:[0,5E3],tooltip:"hide"}).on("slide",
function(b){var g,f;f="$"+b.value[0];g=5E3===b.value[1]?"$"+b.value[1]+"+":"$"+b.value[1];a.div.find("#rent_min").text(f);a.div.find("#rent_max").text(g);return c(b.delegateTarget,"<div class='filter_data'>"+f+"-"+g+"</div>")});this.div.find(".filter_link").click(function(c){var b,f;b=$(c.delegateTarget).attr("data-filter");f=a.div.find(".filter_link.active");a.div.find(".filter_link").removeClass("active");f.length&&f.find(".filter_preview").html().length&&(f.find(".filter_title").hide(),f.find(".filter_preview").show());
$(f).attr("id")!==$(c.delegateTarget).attr("id")&&($(c.delegateTarget).addClass("active"),$(c.delegateTarget).find(".filter_preview").hide(),$(c.delegateTarget).find(".filter_title").show());return a.div.find("#filter_dropdown").slideUp("fast",function(){a.div.find(".filter_content").hide();if($(f).attr("id")!==$(c.delegateTarget).attr("id"))return a.div.find(b).show(),a.div.find("#filter_dropdown").slideDown()})});this.div.find("#rentals-filter-label").click(function(c){c=a.div.find(".filter_link.active");
a.div.find("#filter_dropdown").slideUp("fast");c.length&&c.find(".filter_preview").html().length&&(c.find(".filter_title").hide(),c.find(".filter_preview").show());return a.div.find(".filter_link").removeClass("active")});return this.CreateListeners()};a.ApplyFilter=function(a,c){var b,f,h,k;null!=c?this.FilterData[a]=c:delete this.FilterData[a];b="";f=!0;k=this.FilterData;for(h in k)c=k[h],f||(b+="&"),f=!1,b+=h+"="+JSON.stringify(c);return $.ajax({url:myBaseUrl+"Rentals/ApplyFilter",data:b,type:"GET",
context:this,success:A2Cribs.FilterManager.UpdateListings})};a.FilterVisibleListings=function(a){var c,b,f,h,k,l,m,n,p,r,q,s,v,x,u,t;l=A2Cribs.UserCache.GetAllAssociatedObjects("listing","marker",a);v=[];u=0;for(t=l.length;u<t;u++)k=l[u],p=FilterRent(k),b=FilterBeds(k),c=FilterBaths(k),f=FilterBuildingType(k),h=FilterDates(k),q=FilterUnitFeatures(k),m=FilterParking(k),n=FilterPets(k),a=FilterAmenities(k),r=FilterSquareFeet(k),x=FilterYearBuilt(k),s=FilterUtilities(k),p&&(b&&c&&f&&h&&q&&m&&n&&a&&r&&
x&&s)&&v.push(k);return v};a.GetBeds=function(){return JSON.stringify([3,5,6,10])};a.GetRent=function(){return this};a.GetMonths=function(){return{months:{1:1,2:0,3:1,4:0,5:1,6:0,7:1,8:0,9:1,10:0,11:1,12:0},curYear:[13,14],leaseLength:{min:2,max:4}}};a.GetUnitTypes=function(){return{house:0,apartment:1,duplex:1,other:0}};a.GetAmenities=function(){return{elevator:1}};a.prototype.FilterRent=function(a){return!0};a.prototype.FilterBeds=function(a){return!0};a.prototype.FilterBaths=function(a){return!0};
a.prototype.FilterBuildingType=function(a){return!0};a.prototype.FilterDates=function(a){return!0};a.prototype.FilterUnitFeatures=function(a){return!0};a.prototype.FilterParking=function(a){return!0};a.prototype.FilterPets=function(a){return!0};a.prototype.FilterAmenities=function(a){return!0};a.prototype.FilterSquareFeet=function(a){return!0};a.prototype.FilterYearBuilt=function(a){return!0};a.prototype.FilterUtilities=function(a){return!0};return a}(A2Cribs.FilterManager);A2Cribs.FLDash=function(){function b(a){var c=
this;this.uiWidget=a;this.OrderStates={};this.ListingUniPricing={};this.FL_Order=null;this.uiFL_Form=$(".featured-listing-order-item").first();this.uiListingsList=this.uiWidget.find("#listings_list");this.uiOrderItemsList=this.uiWidget.find("#orderItems_list");this.uiErrorsList=this.uiWidget.find("#validation-error-list");this.initTemplates();this.setupEventHandlers();$.when(A2Cribs.Dashboard.GetListings().then(function(){return c.loadListings()}))}b.prototype.setupEventHandlers=function(){var a=
this;this.uiListingsList.on("mouseenter",".listing-item",function(a){$(a.currentTarget).find(".feature-star").removeClass("icon-star-empty");return $(a.currentTarget).find(".feature-star").addClass("icon-star")}).on("mouseleave",".listing-item",function(a){$(a.currentTarget).find(".feature-star").removeClass("icon-star");return $(a.currentTarget).find(".feature-star").addClass("icon-star-empty")}).on("click",".listing-item",function(c){c=$(c.currentTarget).data("id");null==a.OrderStates[c]&&a.addOrderItem(c);
return a.editOrderItem(c)}).on("click",".marker-info",function(a){a=$(a.currentTarget);a.siblings("ul").slideToggle("fast");return a.find("i").toggleClass("icon-plus").toggleClass("icon-minus")});this.uiOrderItemsList.on("click","a",function(c){var d;d=$(c.currentTarget);c=d.data("id");if(d.hasClass("edit"))return a.editOrderItem(c);if(d.hasClass("remove"))return a.removeOrderItem(c)});this.uiErrorsList.on("click",".icon-remove",function(c){c=$(c.currentTarget).parent().data("id");return a.removeErrors(c)});
this.uiWidget.find("#buyNow").click(function(){return a.buy()});this.uiWidget.find(".feature-listing").click(function(){return a.featureListing()});this.uiFL_Form.on("orderItemChanged",function(c,d){var b;a.uiOrderItemsList.find(".orderItem[data-id="+d.listing_id+"] .price").html(""+d.getPrice().toFixed(2));b=0;a.uiOrderItemsList.find(".price").each(function(a,c){return b+=Number($(c).html())});return a.uiOrderItemsList.siblings("tfoot").find(".total").html(""+b.toFixed(2))});return $("#fl-list-input").keyup(function(a){return $("#listings_list .marker-item").show().filter(function(){return-1===
$(this).find(".marker-info").text().toLowerCase().indexOf($("#fl-list-input").val().toLowerCase())?!0:!1}).hide()})};b.prototype.loadListings=function(){var a,c,d,b,g,f,h,k,l,m,n,p,r,q;g="";n={};l=A2Cribs.UserCache.Get("listing");a=0;for(k=l.length;a<k;a++)f=l[a],null==n[f.marker_id]&&(n[f.marker_id]=[]),n[f.marker_id].push(f.listing_id);for(p in n)if(B.call(n,p)){k=n[p];m=A2Cribs.UserCache.Get("marker",p);l="";a=m.street_address;r=0;for(q=k.length;r<q;r++){h=k[r];f=A2Cribs.UserCache.Get("listing",
h);c="";switch(parseInt(f.listing_type)){case 0:c="icon-home";break;case 1:c="icon-lemon";break;case 2:c="icon-truck"}d=A2Cribs.UserCache.GetAllAssociatedObjects("rental","listing",f.listing_id);f="";null!=d&&void 0!==d[0]&&(b=d[0]);d="Listing "+h;null!=b&&(void 0!==b.unit_style_options&&void 0!==b.unit_style_description)&&(0===parseInt(b.unit_style_options)&&(f="Unit"),1===parseInt(b.unit_style_options)&&(f="Layout"),2===parseInt(b.unit_style_options)&&(f="Entire House"),d+=f,"Entire House"!==f&&
(d+=" - "+b.unit_style_description));c={icon:c,address:a,description:d,listing_id:h};c=this.ListingTemplate(c);l+=c}c={marker:m,num_listings:k.length,listing_list:l};a=this.MarkerTemplate(c);g+=a;$("#listings_list_content").append(a)}return this.uiListingsList.html(g)};b.prototype.getUniData=function(a){var c;null==a&&(a=null);null==this.ListingUniPricing[a]&&(c=new $.Deferred,$.ajax({url:"/featuredListings/getUniDataForListing/"+a,type:"GET",success:function(a){return c.resolve(JSON.parse(a))}}),
this.ListingUniPricing[a]=c.promise());return this.ListingUniPricing[a]};b.prototype.addOrderItem=function(a){var c;c=A2Cribs.UserCache.Get("listing",a);c={address:A2Cribs.UserCache.Get("marker",c.marker_id).street_address,price:0,id:c.listing_id};this.OrderStates[a]={};return this.uiOrderItemsList.append(this.OrderItemTemplate(c))};b.prototype.editOrderItem=function(a){var c,d,b,g,f=this;b=A2Cribs.UserCache.Get("listing",a);null!=this.FL_Order&&(g=this.FL_Order.listing_id,this.uiOrderItemsList.find(".orderItem[data-id="+
g+"]").removeClass("editing"),this.OrderStates[g]=this.FL_Order.getState(),this.FL_Order.reset(!1));d=null!=this.OrderStates[a]?this.OrderStates[a]:null;c=A2Cribs.UserCache.Get("marker",b.marker_id).street_address;$.when(this.getUniData(a)).then(function(a){return f.FL_Order=new A2Cribs.Order.FeaturedListing(f.uiFL_Form,b.listing_id,c,a,d)});this.uiOrderItemsList.find(".orderItem[data-id="+a+"]").addClass("editing");return this.toggleOrderDetailsUI(!0)};b.prototype.removeOrderItem=function(a){var c;
null==a&&(a=null);if(null===a)this.uiOrderItemsList.find(".orderItem").remove(),this.OrderStates={},this.FL_Order.reset(),this.FL_Order=null;else if(this.uiOrderItemsList.find(".orderItem[data-id="+a+"]").remove(),this.removeErrors(a),delete this.OrderStates[a],parseInt(null!=(c=this.FL_Order)?c.listing_id:void 0,10)===a)this.FL_Order.reset(),this.FL_Order=null;if(0===this.uiOrderItemsList.find(".orderItem").length)return this.toggleOrderDetailsUI(!1);a=this.uiOrderItemsList.find(".orderItem").first().data("id");
return this.editOrderItem(a)};b.prototype.initTemplates=function(){this.ListingTemplate=_.template("<li class = 'listing-item' data-id='<%= listing_id %>'>\n    <i class = 'icon-large <%= icon %> listing-icon'></i><strong><%= description %></strong>\n    <i class = 'pull-right feature-star icon-star-empty'></i>\n</li>");this.MarkerTemplate=_.template("<div class = 'marker-item' data-id='<%= marker.marker_id %>'>\n    <div class = 'marker-info'><i class = 'icon-plus'></i><strong><%= marker.street_address %></strong>  <%= marker.alternate_name %> (<%=num_listings%>)</div>\n    <ul><%= listing_list %></ul>\n</div>");
return this.OrderItemTemplate=_.template("<tr class = 'orderItem' data-id = '<%= id %>'>\n    <td><span  class = 'address'><%= address %></span></td>\n    <td>$<span class = 'price'?><%= price %></span></td>\n    <td class = 'actions'>\n        <a href = '#' class = 'edit' data-id = '<%= id %>'><i class = 'icon-edit'></i></a>   \n        <a href = '#' class = 'remove' data-id = '<%= id %>'><i class = 'icon-remove-circle'></i></a>\n    </td>\n</tr>\n")};b.prototype.showErrors=function(a){var c,d,b,
g,f,h,k;b="";for(g in a)if(B.call(a,g)){d=a[g];c=this.uiOrderItemsList.find(".orderItem[data-id="+g+"]");c.addClass("error");c=c.find(".address").html();b+="<dt data-id='"+g+"'>Validation Errors for "+c+"<i class = 'icon-remove'></i></dt>";c=h=0;for(k=d.length;h<k;c=++h)f=d[c],b+="<dd data-id='"+g+"' class = 'validation-error'>"+(c+1)+". "+f+"</dd>"}return this.uiErrorsList.html(b)};b.prototype.removeErrors=function(a){null==a&&(a=null);if(null!=a)return this.uiOrderItemsList.find(".orderItem[data-id="+
a+"]").removeClass("error"),this.uiErrorsList.children("[data-id="+a+"]").remove();this.uiOrderItemsList.find(".orderItem").removeClass("error");return this.uiErrorsList.html("")};b.prototype.buy=function(){var a,c,d,b=this;this.removeErrors();this.FL_Order&&(this.OrderStates[this.FL_Order.listing_id]=this.FL_Order.getState());c=[];d=this.OrderStates;for(a in d)B.call(d,a)&&c.push(this.getUniData(a));return $.when.apply($,c).then(function(){var a,c,d,k,l,m,n,p,r;d=[];k=_.zip(arguments,_.values(b.OrderStates));
m=0;for(p=k.length;m<p;m++)if(a=k[m],l=a[0],a=a[1],!(1>a.selectedDates.length)){n=0;for(r=l.length;n<r;n++)c=l[n],c.enabled&&(c=A2Cribs.Order.FeaturedListing.GenerateOrderItem(a,c),d.push(c))}if(0===d.length)A2Cribs.UIManager.Alert("You haven't select any dates to feature listings");else return A2Cribs.Order.BuyItems(d,0,function(a){if(null!=a.error_type&&"NO_LISTINGS_SELECTED"===a.error_type)A2Cribs.UIManager.Alert("You haven't selected any dates to feature your listings.");else return b.showErrors(a)},
function(){return b.removeOrderItem()})})};b.prototype.toggleOrderDetailsUI=function(a){if(a)return $("#noListingSelected").fadeOut("fast"),this.uiWidget.find(".orderingInfo").slideDown();this.uiWidget.find(".orderingInfo").slideUp();return $("#noListingSelected").fadeIn("fast")};return b}();A2Cribs.Register=function(){function b(){}b.RedirectUrl=null;b.setupUI=function(){var a=this;return $("#registerForm").submit(function(c){c.preventDefault();return a.cribspotRegister()})};b.InitRegister=function(a){$("#signupModal").modal("show");
return A2Cribs.Register.RedirectUrl="/dashboard?post_redirect=true"};b.cribspotRegister=function(){var a;a=$("#registerForm").serializeArray();a={User:{email:$.trim(a[0].value),password:$.trim(a[1].value),first_name:$.trim(a[3].value),last_name:$.trim(a[4].value)}};return $.post("/users/AjaxRegister",a,function(a){a=JSON.parse(a);console.log(a);if(void 0!==a.success&&null!==a.success)return window.location.href="/users/login?register_success=true";if("EMAIL_EXISTS"===a.error_type)return A2Cribs.UIManager.Alert(a.error),
$("#inputEmail").val("");"undefined"!==typeof a.validation.email&&($("#inputEmail").effect("highlight",{color:"#FF0000"},3E3),$("#registerStatus").append("<p>"+a.email[0]+"<p>"));"undefined"!==typeof a.validation.first_name&&($("#inputFirstName").effect("highlight",{color:"#FF0000"},3E3),$("#registerStatus").append("<p>"+a.first_name[0]+"<p>"));"undefined"!==typeof a.validation.last_name&&($("#inputLastName").effect("highlight",{color:"#FF0000"},3E3),$("#registerStatus").append("<p>"+a.last_name[0]+
"<p>"));"undefined"!==typeof a.validation.password&&($("#registerStatus").append("<p>"+a.password[0]+"<p>"),$("#inputPassword").effect("highlight",{color:"#FF0000"},3E3),$("#confirmPassword").effect("highlight",{color:"#FF0000"},3E3));return $("#loginStatus").effect("highlight",{color:"#FF0000"},3E3)})};return b}();A2Cribs.Map=function(){function b(){}b.InitializeMarkers=function(a){var c,d,e,g;if(null!=a){a=JSON.parse(a);g=[];d=0;for(e=a.length;d<e;d++)c=a[d],c=new A2Cribs.Marker(c.Marker),c.Init(),
A2Cribs.UserCache.Set(c),g.push(b.GMarkerClusterer.addMarker(c.GMarker));return g}};b.LoadMarkers=function(){this.MarkerDeferred||(this.MarkerDeferred=new $.Deferred);if(void 0===A2Cribs.Map.CurentSchoolId)this.MarkerDeferred.resolve(null);else return $.ajax({url:myBaseUrl+"Map/LoadMarkers/"+A2Cribs.Map.CurentSchoolId+"/0",type:"GET",context:this,success:function(a){return this.MarkerDeferred.resolve(a,this)},error:function(){return this.MarkerDeferred.resolve(null)}}),this.MarkerDeferred.promise()};
b.ShowMarkers=function(){return A2Cribs.Map.GMap.getBounds()};b.InitBoundaries=function(){return this.Bounds={LEFT:0,RIGHT:window.innerWidth,BOTTOM:window.innerHeight,TOP:0,CONTROL_BOX_LEFT:95}};b.Init=function(a,c,d,b,g,f,h){this.CurentSchoolId=a;mixpanel.register({preferred_university:a});A2Cribs.FilterManager.CurrentCity=b;A2Cribs.FilterManager.CurrentState=g;A2Cribs.FilterManager.CurrentSchool=f;this.ACTIVE_LISTING_TYPE=h;this.MapCenter=new google.maps.LatLng(c,d);this.MapOptions={zoom:15,center:A2Cribs.Map.MapCenter,
mapTypeId:google.maps.MapTypeId.ROADMAP,styles:this.style,panControl:!1,streetViewControl:!1,mapTypeControl:!1};A2Cribs.Map.GMap=new google.maps.Map(document.getElementById("map_canvas"),A2Cribs.Map.MapOptions);google.maps.event.addListener(A2Cribs.Map.GMap,"idle",A2Cribs.Map.ShowMarkers);google.maps.event.addListener(A2Cribs.Map.GMap,"center_changed",function(){return A2Cribs.ClickBubble.Close()});this.GMarkerClusterer=new MarkerClusterer(A2Cribs.Map.GMap,[],{gridSize:60,maxZoom:15,styles:[{height:48,
url:"/img/dots/group_dot.png",width:48,textColor:"#ffffff",textSize:13}]});this.GMarkerClusterer.ignoreHidden_=!0;A2Cribs.ClickBubble.Init(this.GMap);A2Cribs.HoverBubble.Init(this.GMap);A2Cribs.Map.InitBoundaries();this.LoadAllMapData();return A2Cribs.FilterManager.InitAddressSearch()};b.LoadBasicData=function(){var a=this;null==this.BasicDataDeferred&&(this.BasicDataDeferred=new $.Deferred);$.ajax({url:myBaseUrl+("Map/GetBasicData/"+this.ACTIVE_LISTING_TYPE+"/"+this.CurentSchoolId),type:"POST",success:function(c){return a.BasicDataDeferred.resolve(c)},
error:function(){a.BasicDataDeferred.resolve(null);return a.BasicDataCached.resolve()}});return this.BasicDataDeferred.promise()};b.LoadBasicDataCallback=function(a){var c,d,e,g,f;if(!(null===a||void 0===a)){d=JSON.parse(a);g=0;for(f=d.length;g<f;g++)for(c in a=d[g],a)e=a[c],A2Cribs.UserCache.Set(new A2Cribs[c](e));b.BasicDataCached.resolve();a=A2Cribs.UserCache.Get("marker");d=0;for(e=a.length;d<e;d++)c=a[d],c.Init(),b.GMarkerClusterer.addMarker(c.GMarker);c=A2Cribs.UserCache.Get("listings");g=[];
d=0;for(e=c.length;d<e;d++)a=c[d],g.push(a.visible=!0);return g}};b.OpenMarker=function(a,c){if(-1===a)alert("This listing either has been removed or is invalid.");else if(-2!==a)return alert(a)};b.LoadAllMapData=function(){var a;a=this.LoadBasicData();this.BasicDataCached=new $.Deferred;A2Cribs.FavoritesManager.LoadFavorites();$.when(a).then(this.LoadBasicDataCallback);return A2Cribs.FeaturedListings.InitializeSidebar(this.CurentSchoolId,this.ACTIVE_LISTING_TYPE,a,this.BasicDataCached)};b.CenterMap=
function(a,c){if(null!=this.GMap)return this.GMap.setCenter(new google.maps.LatLng(a,c))};b.style=[{featureType:"road.highway",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{elementType:"labels.text.fill",stylers:[{color:"#3b393a"}]},{featureType:"poi.sports_complex",elementType:"geometry",stylers:[{color:"#e9ddbc"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]},
{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#868080"},{lightness:55}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{color:"#808080"},{lightness:53}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road"},{featureType:"transit.station.airport",
stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"off"}]},
{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{lightness:23},{color:"#83b243"},{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.text.stroke",stylers:[{color:"#f4f6f1"},{visibility:"off"}]},{featureType:"poi.school",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.medical",stylers:[{color:"#ce979e"},
{lightness:26}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit.station.rail",elementType:"labels.icon",stylers:[{lightness:39}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#d6e0c6"}]},{featureType:"water",stylers:[{color:"#c2d6ec"}]},{featureType:"landscape.man_made",stylers:[{color:"#efece2"}]},{featureType:"poi.medical",stylers:[{color:"#edcece"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},
{featureType:"road.local",elementType:"labels.text.fill",stylers:[{lightness:16}]},{featureType:"road.arterial",stylers:[{lightness:15}]},{featureType:"landscape.man_made",elementType:"geometry.stroke",stylers:[{visibility:"on"},{lightness:78},{color:"#b8b7b8"}]},{featureType:"poi.business",elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:25},{saturation:-17}]}];return b}.call(this);A2Cribs.MarkerModal=function(){function b(){this.TriggerMarkerUpdated=z(this.TriggerMarkerUpdated,
this);this.TriggerMarkerAdded=z(this.TriggerMarkerAdded,this);this.modal=$("#marker-modal");this.setupUI();this.ListingType="Rental"}b.prototype.Clear=function(){this.modal.find("#marker_select_container").show();this.modal.find("input").val("");this.modal.find("select option:first-child").attr("selected","selected");return this.MiniMap.SetMarkerVisible(!1)};b.prototype.MarkerValidate=function(){var a,c,d,b,g,f;b=!0;a=["street_address","city","state"];c=!0;g=0;for(f=a.length;g<f;g++)if(d=a[g],null==
this.modal.find("#Marker_"+d).val()||0===this.modal.find("#Marker_"+d).val().length)this.modal.find("#Marker_"+d).parent().addClass("error"),c=!1;c||(A2Cribs.UIManager.Error("Fill in the full address please."),b=!1);0===this.modal.find("#Marker_building_type_id").val().length&&(A2Cribs.UIManager.Error("You need to select a building type."),this.modal.find("#Marker_building_type_id").parent().addClass("error"),b=!1);249<=this.modal.find("#Marker_alternate_name").val().length&&(A2Cribs.UIManager.Error("Your building name is too long."),
this.modal.find("#Marker_alternate_name").parent().addClass("error"),b=!1);return b};b.prototype.Save=function(a){var c,d,b,g=this;if(this.MarkerValidate()){if(this.modal.find("#Marker_latitude").val()){d=this.modal.find("#Marker_marker_id").val();c=this.MiniMap.GetMarkerPosition();b={alternate_name:this.modal.find("#Marker_alternate_name").val(),building_type_id:this.modal.find("#Marker_building_type_id").val(),street_address:this.modal.find("#Marker_street_address").val(),city:this.modal.find("#Marker_city").val(),
state:this.modal.find("#Marker_state").val(),zip:this.modal.find("#Marker_zip").val(),latitude:c.latitude,longitude:c.longitude};A2Cribs.MixPanel.PostListing("Marker Save",{"marker id":d,"alternate name":this.modal.find("#Marker_alternate_name").val(),"building type id":this.modal.find("#Marker_building_type_id").val(),"street address":this.modal.find("#Marker_street_address").val(),city:this.modal.find("#Marker_city").val(),state:this.modal.find("#Marker_state").val(),zip:this.modal.find("#Marker_zip").val(),
latitude:c.latitude,longitude:c.longitude});if(0!==(null!=d?d.length:void 0))b.marker_id=d;return $.ajax({url:"/Markers/Save/",type:"POST",data:b,success:function(c){if(c.error)return UIManager.Error(c.error);g.modal.modal("hide");b.marker_id=c;A2Cribs.MixPanel.PostListing("Marker Save Complete",{"marker id":b.marker_id});A2Cribs.UserCache.Set(new A2Cribs.Marker(b));return a(b.marker_id)}})}A2Cribs.UIManager.Error("Please place your street address on the map using the Place On Map button.")}};b.prototype.setupUI=
function(){var a=this;this.modal.on("shown",function(){return a.MiniMap.Resize()});this.modal.find(".required").keydown(function(){return $(this).parent().removeClass("error")});this.modal.find("#place_map_button").click(function(){var c;c=a.modal.find("#marker_select").val();A2Cribs.MixPanel.PostListing("Marker Selected",{"new marker":!1,marker_id:c});return a.FindAddress(a.modal)});this.modal.find("#marker_select").change(function(){var c;c=a.modal.find("#marker_select").val();"0"===c?a.modal.find("#continue-button").addClass("disabled"):
a.modal.find("#continue-button").removeClass("disabled");return"new_marker"===c?(a.modal.find("#marker_add").show(),a.MiniMap.Resize()):a.modal.find("#marker_add").hide()});this.modal.find("#continue-button").click(function(){var c,d;d=a.modal.find("#marker_select").val();if("new_marker"===d)return A2Cribs.MixPanel.PostListing("Marker Selected",{"new marker":!0}),a.Save();if("0"!==d)return c=A2Cribs.UserCache.Get("marker",d),A2Cribs.MixPanel.PostListing("Marker Selected",{"new marker":!1,"marker id":d,
"marker name":null!=c?c.GetName():void 0,"marker address":null!=c?c.street_address:void 0,"marker city":null!=c?c.city:void 0,"marker state":null!=c?c.state:void 0}),a.modal.modal("hide"),a.TriggerMarkerAdded(d)});return this.MiniMap=new A2Cribs.MiniMap(this.modal)};b.prototype.Open=function(){return this.modal.modal("show")};b.prototype.NewMarker=function(){var a,c,d,b,g,f=this;this.Clear();this.modal.find("#marker_add").hide();this.modal.find("#continue-button").addClass("disabled");this.modal.find("#continue-button").text("Continue");
this.modal.find(".title").text("Create a New Listing");c=A2Cribs.UserCache.Get("marker");this.modal.find("#marker_select").empty();this.modal.find("#marker_select").append('<option value="0">--</option>\t\t\t<option value="new_marker"><strong>New Location</strong></option>');this.modal.find("#continue-button").unbind("click");this.modal.find("#continue-button").click(function(){var a;a=f.modal.find("#marker_select").val();if("new_marker"===a)return f.Save(f.TriggerMarkerAdded);if("0"!==a)return f.modal.modal("hide"),
f.TriggerMarkerAdded(a)});if(null!=c){b=0;for(g=c.length;b<g;b++)a=c[b],d=null!=a.alternate_name&&a.alternate_name.length?a.alternate_name:a.street_address,a=$("<option />",{text:d,value:a.marker_id}),this.modal.find("#marker_select").append(a)}return this.modal.find("#marker_select").val("0")};b.prototype.LoadMarker=function(a){var c,d,b=this;this.Clear();this.modal.find("#marker_add").show();this.modal.find("#marker_select_container").hide();a=A2Cribs.UserCache.Get("marker",a);this.modal.find("#continue-button").removeClass("disabled");
this.modal.find("#continue-button").text("Save");this.modal.find(".title").text("Edit Listing Address");this.modal.find("#marker_select").val("new_marker");for(c in a)d=a[c],this.modal.find("#Marker_"+c).val(d);this.modal.find("#continue-button").unbind("click");this.modal.find("#continue-button").click(function(){return b.Save(b.TriggerMarkerUpdated)});c=new google.maps.LatLng(this.modal.find("#Marker_latitude").val(),this.modal.find("#Marker_longitude").val());return this.MiniMap.SetMarkerPosition(c)};
b.prototype.TriggerMarkerAdded=function(a){return $("body").trigger(""+this.ListingType+"_marker_added",[a])};b.prototype.TriggerMarkerUpdated=function(a){return $("body").trigger(""+this.ListingType+"_marker_updated",[a])};b.prototype.FindAddress=function(a){var c,d=this;if(this.MarkerValidate())return c={address:a.find("#Marker_street_address").val()+" "+a.find("#Marker_city").val()+", "+a.find("#Marker_state").val()},A2Cribs.Geocoder.geocode(c,function(c,b){var f,h,k,l,m,n,p,r,q,s;if(b===google.maps.GeocoderStatus.OK&&
2<=c[0].address_components.length){q=c[0].address_components;m=0;for(p=q.length;m<p;m++){f=q[m];s=f.types;n=0;for(r=s.length;n<r;n++)switch(l=s[n],l){case "street_number":k=f.short_name;break;case "route":h=f.short_name;break;case "locality":a.find("#Marker_city").val(f.short_name);break;case "administrative_area_level_1":a.find("#Marker_state").val(f.short_name);break;case "postal_code":a.find("#Marker_zip").val(f.short_name)}}if(null==k)A2Cribs.UIManager.Alert("Entered street address is not valid."),
$("#Marker_street_address").text("");else return d.MiniMap.SetMarkerPosition(c[0].geometry.location),a.find("#Marker_street_address").val(k+" "+h),a.find("#Marker_latitude").val(c[0].geometry.location.lat()),a.find("#Marker_longitude").val(c[0].geometry.location.lng())}})};return b}();window.A2Cribs.UILayer={};A2Cribs.UILayer.Rentals=function(){function b(){}b.rental_id=function(){return""};b.listing_id=function(){return 2};b.street_address=function(){return"521 Linden St"};b.city=function(){return"Ann Arbor"};
b.state=function(){return"MI"};b.zipcode=function(){return"48104"};b.unit_style_options=function(){return 2};b.unit_style_type=function(){return"NA"};b.unit_style_description=function(){return"NA"};b.building_name=function(){return""};b.beds=function(){return 6};b.min_occupancy=function(){return 1};b.max_occupancy=function(){return 6};b.building_type=function(){return 2};b.rent=function(){return 3600};b.rent_negotiable=function(){return 0};b.unit_count=function(){return 1};b.start_date=function(){return A2Cribs.UtilityFunctions.GetFormattedDate(new Date("09-02-2013"))};
b.alternate_start_date=function(){return""};b.end_date=function(){return A2Cribs.UtilityFunctions.GetFormattedDate(new Date("08-17-2014"))};b.available=function(){return 1};b.baths=function(){return 2};b.air=function(){return 1};b.parking_type=function(){return 1};b.parking_spots=function(){return 6};b.street_parking=function(){return 0};b.furnished_type=function(){return 0};b.pets_type=function(){return 1};b.smoking=function(){return 1};b.square_feet=function(){return 2E3};b.year_built=function(){return 1944};
b.electric=function(){return 1};b.water=function(){return 1};b.gas=function(){return 1};b.heat=function(){return 1};b.sewage=function(){return 1};b.trash=function(){return 1};b.cable=function(){return 1};b.internet=function(){return 1};b.utility_total_flat_rate=function(){return 0};b.utility_estimate_winter=function(){return 250};b.utility_estimate_summer=function(){return 200};b.deposit=function(){return 900};b.highlights=function(){return"Its a really fun place"};b.description=function(){return"This is a longer description about the place"};
b.waitlist=function(){return 1};b.waitlist_open_date=function(){return""};b.lease_office_address=function(){return"Jonah Copi's place"};b.contact_email=function(){return"email@address.com"};b.contact_phone=function(){return"5555555555"};b.website=function(){return"www.cribspot.com"};return b}();A2Cribs.UILayer.Fees=function(){function b(){}b.GetFees=function(){var a;a=[];a.push({fee_id:160,description:"Admin",amount:69});a.push({fee_id:161,description:"Parking",amount:25});a.push({fee_id:162,description:"Furniture",
amount:45});a.push({fee_id:163,description:"Pets",amount:50});a.push({fee_id:164,description:"Upper Floor",amount:66});a.push({fee_id:165,description:"Cleaning",amount:50});return a};return b}();A2Cribs.RentalSave=function(){function b(a,c,d){this.user_email=c;this.user_phone=d;this.SaveImages=z(this.SaveImages,this);this.div=$(".rentals-content");this.EditableRows=[];this.Editable=!1;this.VisibleGrid="overview_grid";this.SetupUI(a);this.NextListing}b.prototype.SetupUI=function(a){null==A2Cribs.Geocoder&&
(A2Cribs.Geocoder=new google.maps.Geocoder);$("#middle_content").height();this.div.find("grid-pane").height;this.CreateCallbacks();return this.CreateGrids(a)};b.prototype.CreateCallbacks=function(){var a=this;$("body").on("Rental_marker_added",function(c,d){var b;0===$("#rentals_list_content").find("#"+d).length&&(b=A2Cribs.UserCache.Get("marker",d).GetName(),b=$("<li />",{text:b,"class":"rentals_list_item",id:d}),$("#rentals_list_content").append(b),$("#rentals_list_content").slideDown());A2Cribs.Dashboard.Direct({classname:"rentals",
data:!0});return $.when(a.Open(d)).then(function(){return a.AddNewUnit()})});$("body").on("Rental_marker_updated",function(c,d){var b,g;if(1===$("#rentals_list_content").find("#"+d).length)return b=$("#rentals_list_content").find("#"+d),g=A2Cribs.UserCache.Get("marker",d).GetName(),b.text(g),a.CreateListingPreview(d)});$("body").on("click",".rentals_list_item",function(c){return a.Editable?A2Cribs.UIManager.ConfirmBox("By selecting a new address, all unsaved changes will be lost.",{ok:"Abort Changes",
cancel:"Return to Editor"},function(d){if(d)return a.CancelEditing(),a.Open(c.target.id)}):a.Open(c.target.id)});this.div.find(".edit_marker").click(function(){A2Cribs.MixPanel.PostListing("Started",{});A2Cribs.MarkerModal.Open();return A2Cribs.MarkerModal.LoadMarker(a.CurrentMarker)});$("#rentals_edit").click(function(c){c=a.GridMap[a.VisibleGrid].getSelectedRows();if(a.Editable)a.FinishEditing();else{if(0===(null!=c?c.length:void 0)){A2Cribs.UIManager.CloseLogs();A2Cribs.UIManager.Error("Please select the row you wish to edit!");
return}a.Edit(c)}return a.GridMap[a.VisibleGrid].setSelectedRows(c)});$("#rentals_delete").click(function(){var c,d,b,g,f,h;g=a.GridMap[a.VisibleGrid].getSelectedRows();if(g.length){a.GridMap[a.VisibleGrid].getEditorLock().isActive()&&(c=a.GridMap[a.VisibleGrid].getActiveCell().row);if(-1!==g.indexOf(c))return a.GridMap[a.VisibleGrid].getEditorLock().cancelCurrentEdit();c=[];f=0;for(h=g.length;f<h;f++)b=g[f],null!=a.GridMap[a.VisibleGrid].getDataItem(b).listing_id&&c.push(a.GridMap[a.VisibleGrid].getDataItem(b).listing_id),
-1!==(d=a.EditableRows.indexOf(b))&&a.EditableRows.splice(d,1);a.Delete(g,c);if(0===a.EditableRows.length)return a.FinishEditing()}});$(".rentals_tab").click(function(c){var d,b,g,f;if(a.CommitSlickgridChanges()){d=a.GridMap[a.VisibleGrid].getSelectedRows();a.VisibleGrid=$(c.target).attr("data-target").substring(1);A2Cribs.MixPanel.PostListing(""+a.VisibleGrid+" selected",{"marker id":a.CurrentMarker});a.GridMap[a.VisibleGrid].setSelectedRows(d);f=a.EditableRows;b=0;for(g=f.length;b<g;b++)d=f[b],
a.Validate(d);$(c.target).removeClass("highlight-tab");return $(c.delegateTarget).tab("show")}});return $(".rentals-content").on("shown",function(c){var d,b,g;b=$("#"+a.VisibleGrid).width();c=$("#add_new_unit").position().top-$("#"+a.VisibleGrid).position().top;null!=(g=a.Map)&&g.Resize();g=[];for(d in a.GridMap)$("#"+d).css("width",""+b+"px"),$("#"+d).css("height",""+c+"px"),g.push(a.GridMap[d].init());return g})};b.prototype.CommitSlickgridChanges=function(){var a;return null!=(a=this.GridMap[this.VisibleGrid].getEditorLock())?
a.commitCurrentEdit():void 0};b.prototype.Edit=function(a){var c,d,b;this.EditableRows=a;$("#rentals_edit").text("Finish Editing");d=0;for(b=a.length;d<b;d++)c=a[d],c=this.GridMap[this.VisibleGrid].getDataItem(c),null!=c&&(c.editable=!0);return this.Editable=!0};b.prototype.CancelEditing=function(){var a,c,d,b,g;null!=(a=this.GridMap[this.VisibleGrid].getEditorLock())&&a.cancelCurrentEdit();g=this.EditableRows;d=0;for(b=g.length;d<b;d++)c=g[d],a=this.GridMap[this.VisibleGrid].getDataItem(c),a.editable=
!1,null==(null!=a?a.listing_id:void 0)&&this.GridMap[this.VisibleGrid].getData().splice(c,1);this.GridMap[this.VisibleGrid].updateRowCount();this.GridMap[this.VisibleGrid].render();this.GridMap[this.VisibleGrid].getSelectionModel().setSelectedRanges([]);this.EditableRows=[];this.Editable=!1;$("#rentals_edit").text("Edit");return $(".rentals_tab").removeClass("highlight-tab")};b.prototype.FinishEditing=function(){var a,c,d,b,g;if(this.CommitSlickgridChanges()){c=!0;g=this.EditableRows;d=0;for(b=g.length;d<
b;d++)a=g[d],c=c&&this.Validate(a);if(c){$("#rentals_edit").text("Edit");$(".rentals_tab").removeClass("highlight-tab");b=this.EditableRows;c=0;for(d=b.length;c<d;c++)a=b[c],a=this.GridMap[this.VisibleGrid].getDataItem(a),a.editable=!1;this.GridMap[this.VisibleGrid].setSelectedRows(this.EditableRows);this.EditableRows=[];return this.Editable=!1}A2Cribs.UIManager.CloseLogs();return A2Cribs.UIManager.Error("Please complete all required fields to finish editing!")}};b.prototype.Open=function(a){var c,
b=this;c=new $.Deferred;$.ajax({url:myBaseUrl+"listings/GetOwnedListingsByMarkerId/"+a,type:"GET",success:function(e){var g,f,h,k,l,m,n,p;e=JSON.parse(e);l=0;for(n=e.length;l<n;l++)for(h in f=e[l],f)if(k=f[h],null!=A2Cribs[h])A2Cribs.UserCache.Set(new A2Cribs[h](k));else if(null!=A2Cribs[h]&&null!=k.length){m=0;for(p=k.length;m<p;m++)g=k[m],A2Cribs.UserCache.Set(new A2Cribs[h](g))}b.ClearGrids();b.CurrentMarker=a;b.CreateListingPreview(a);A2Cribs.Dashboard.ShowContent($(".rentals-content"),!0);b.PopulateGrid(a);
return c.resolve()}});return c.promise()};b.prototype.CreateListingPreview=function(a){var c;a=A2Cribs.UserCache.Get("marker",a);c=a.GetName();$("#rentals_address").html("<strong>"+c+"</strong><br>");null==this.Map&&(this.Map=new A2Cribs.MiniMap($("#rentals_preview")));if(null!=a.latitude&&null!=a.longitude)return this.Map.SetMarkerPosition(new google.maps.LatLng(a.latitude,a.longitude))};b.prototype.Validate=function(a){var c,b,e,g,f;g=A2Cribs.Rental.Required_Fields;a=this.GridMap[this.VisibleGrid].getDataItem(a);
c={};b=!0;for(e in g)f=g[e],null==a[e]&&(b=!1,c[f]=!0);$(".rentals_tab").removeClass("highlight-tab");for(f in c)$("a[data-target='#"+f+"']").addClass("highlight-tab");$("a[data-target='#"+this.VisibleGrid+"']").removeClass("highlight-tab");return b};b.prototype.GetObjectByRow=function(a){var c,b,e;a=this.GridMap[this.VisibleGrid].getDataItem(a);null!=a.listing_id&&(c=null!=(b=A2Cribs.UserCache.Get("image",a.listing_id))?b.GetObject():void 0);null==c&&(c=[]);c={Rental:a,Listing:null!=a.listing_id?
A2Cribs.UserCache.Get("listing",a.listing_id).GetObject():void 0,Image:c};null==c.Listing&&(c.Listing={listing_type:0,marker_id:this.CurrentMarker});if(0===(null!=(e=c.Image)?e.length:void 0)&&null!=a.Image)c.Image=a.Image;return c};b.prototype.Save=function(a){var c,b=this;if(this.Validate(a))return c=this.GetObjectByRow(a),A2Cribs.MixPanel.PostListing("Listing Save",{"save type":null!=c.listing_id?"edit":"save","marker id":this.CurrentMarker,"listing id":c.listing_id}),$.ajax({url:myBaseUrl+"listings/Save/",
type:"POST",data:c,success:function(a){var g,f,h,k,l;a=JSON.parse(a);if(null!=a.listing_id){A2Cribs.MixPanel.PostListing("Listing Save Completed",{"listing id":a.listing_id,"marker id":b.CurrentMarker});A2Cribs.UIManager.Success("Save successful!");c.Listing.listing_id=a.listing_id;c.Rental.listing_id=a.listing_id;l=c.Image;h=0;for(k=l.length;h<k;h++)g=l[h],g.listing_id=a.listing_id;for(f in c)g=c[f],null!=A2Cribs[f]&&A2Cribs.UserCache.Set(new A2Cribs[f](g))}else A2Cribs.UIManager.Error(a.error.message);
return console.log(a)}})};b.prototype.GetListing=function(a){var c;null==a&&(a=null);c=myBaseUrl+"listings/GetListing/";null!==a&&(c+=a);return $.ajax({url:c,type:"POST",success:function(a){return console.log(JSON.parse(a))}})};b.prototype.Copy=function(a){};b.prototype.Delete=function(a,c){var b=this;return $.ajax({url:myBaseUrl+"listings/Delete/"+JSON.stringify(c),type:"POST",success:function(e){var g,f,h,k,l,m,n;e=JSON.parse(e);if(null!==e.success&&void 0!==e.success){A2Cribs.UIManager.Success("Listings deleted!");
e=b.GridMap[b.VisibleGrid].getData();k=0;for(m=c.length;k<m;k++){g=c[k];h=A2Cribs.UserCache.GetAllAssociatedObjects("rental","listing",g);l=0;for(n=h.length;l<n;l++)f=h[l],A2Cribs.UserCache.Remove(f.class_name,f.GetId());A2Cribs.UserCache.Remove("listing",g)}f=0;for(h=a.length;f<h;f++)g=a[f],e.splice(g,1);b.GridMap[b.VisibleGrid].updateRowCount();return b.GridMap[b.VisibleGrid].render()}A2Cribs.UIManager.Error("Delete unsuccessful");return console.log(e)}})};b.prototype.Create=function(a){var c,b;
this.CurrentMarker=a;A2Cribs.Dashboard.ShowContent($(".rentals-content"),!0);b=this.GridMap;for(c in b)a=b[c],a.init();return this.GridMap.overview_grid.getData()};b.prototype.LoadImages=function(a){var c,b;c=this.GridMap[this.VisibleGrid].getDataItem(a);c=null!=c.listing_id?null!=(b=A2Cribs.UserCache.Get("image",c.listing_id))?b.GetImages():void 0:c.Image;A2Cribs.MixPanel.PostListing("Start Photo Editing",{"marker id":this.CurrentMarker,"number of images":null!=c?c.length:void 0});return A2Cribs.PhotoManager.LoadImages(c,
a,this.SaveImages)};b.prototype.SaveImages=function(a,c){var b,e,g,f;b=this.GridMap[this.VisibleGrid].getDataItem(a);if(null!=b.listing_id){g=0;for(f=c.length;g<f;g++)e=c[g],e.listing_id=b.listing_id;A2Cribs.UserCache.Set(new A2Cribs.Image(c))}else b.Image=c;return this.Save(a)};b.prototype.AddNewUnit=function(){var a,c,b,e;A2Cribs.MixPanel.PostListing("Add New Unit",{"marker id":this.CurrentMarker});c=this.GridMap[this.VisibleGrid].getData();b=c.length;this.EditableRows.push(b);c.push({editable:!0,
contact_email:this.user_email,contact_phone:this.user_phone,unit_style_description:b+1});this.GridMap[this.VisibleGrid].setSelectedRows(this.EditableRows);$("#rentals_edit").text("Finish Editing");this.Editable=!0;this.Validate(b);b=this.GridMap;e=[];for(a in b)c=b[a],c.updateRowCount(),e.push(c.render());return e};b.prototype.PopulateGrid=function(a){var c,b,e,g,f,h;this.GridMap[this.VisibleGrid].getSelectionModel().setSelectedRanges([]);g=A2Cribs.UserCache.Get("rental");a=[];if(g.length){f=0;for(h=
g.length;f<h;f++)e=g[f],c=A2Cribs.UserCache.Get("listing",e.listing_id),c.marker_id===this.CurrentMarker&&a.push(e.GetObject())}e=this.GridMap;g=[];for(b in e)c=e[b],c.setData(a),c.updateRowCount(),g.push(c.render());return g};b.prototype.ClearGrids=function(){var a,c,b,e,g;e=this.GridMap;g=[];for(a in e)b=e[a],c=[],b.setData(c),g.push(b.render());return g};b.prototype.CreateGrids=function(a){var c,b,e,g,f,h,k,l,m,n=this;g="overview_grid features_grid amenities_grid utilities_grid buildingamenities_grid fees_grid description_grid picture_grid contact_grid".split(" ");
this.GridMap={};h={editable:!0,enableCellNavigation:!0,asyncEditorLoading:!1,enableAddRow:!1,autoEdit:!0,forceFitColumns:!0,explicitInitialization:!0,rowHeight:35};f=[];m=[];k=0;for(l=g.length;k<l;k++)e=g[k],b=this.GetColumns(e,a),c=new Slick.CheckboxSelectColumn({cssClass:"grid_checkbox"}),b[0]=c.getColumnDefinition(),this.GridMap[e]=new Slick.Grid("#"+e,f,b,h),this.GridMap[e].setSelectionModel(new Slick.RowSelectionModel({selectActiveRow:!1})),this.GridMap[e].registerPlugin(c),new Slick.Controls.ColumnPicker(b,
this.GridMap[e],h),this.GridMap[e].onBeforeEditCell.subscribe(function(a,c){return-1!==n.EditableRows.indexOf(c.row)?!0:!1}),this.GridMap[e].onCellChange.subscribe(function(a,c){return n.Save(c.row)}),m.push(this.GridMap[e].onValidationError.subscribe(function(a,c){A2Cribs.UIManager.CloseLogs();return A2Cribs.UIManager.Error(c.validationResults.msg)}));return m};b.prototype.GetColumns=function(a,c){var b,e,g,f,h,k,l,m,n;l=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,
formatter:A2Cribs.Formatters.Unit,minWidth:185,headerCssClass:"slickgrid_header"},{id:"beds",name:"Beds",field:"beds",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.RequiredText},{id:"occupancy",name:"Occupancy",field:"occupancy",formatter:A2Cribs.Formatters.Range,editor:A2Cribs.Editors.Range},{id:"rent",name:"Total Rent",field:"rent",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.RequiredMoney},{id:"rent_negotiable",cssClass:"grid_checkbox",name:"(Neg.)",field:"rent_negotiable",
editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"start_date",name:"Start Date",field:"start_date",editor:Slick.Editors.Date,formatter:A2Cribs.Formatters.Date(!0)},{id:"alternate_start_date",name:"Alt. Start Date",field:"alternate_start_date",editor:Slick.Editors.Date,formatter:A2Cribs.Formatters.Date()},{id:"lease_length",name:"Lease Length",field:"lease_length",editor:A2Cribs.Editors.Dropdown([null,"1 month","2 months","3 months","4 months","5 months","6 months","7 months",
"8 months","9 months","10 months","11 months","12 months"]),formatter:A2Cribs.Formatters.Dropdown(";1 month;2 months;3 months;4 months;5 months;6 months;7 months;8 months;9 months;10 months;11 months;12 months".split(";"),!0)},{id:"available",name:"Availability",field:"available",editor:A2Cribs.Editors.Dropdown(["Leased","Available"]),formatter:A2Cribs.Formatters.Dropdown(["Leased","Available"],!0)},{id:"unit_count",name:"Unit Count",field:"unit_count",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Text}]};
h=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"baths",name:"Baths",field:"baths",editor:A2Cribs.Editors.Float,formatter:A2Cribs.Formatters.RequiredText},{id:"parking_type",name:"Parking",field:"parking_type",editor:A2Cribs.Editors.Dropdown(c.parking),formatter:A2Cribs.Formatters.Dropdown(c.parking)},{id:"parking_spots",name:"Spots",field:"parking_spots",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Text},
{id:"street_parking",cssClass:"grid_checkbox",name:"Street Parking",field:"street_parking",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"furnished_type",name:"Furnished",field:"furnished_type",editor:A2Cribs.Editors.Dropdown(c.furnished),formatter:A2Cribs.Formatters.Dropdown(c.furnished)},{id:"pets_type",name:"Pets",field:"pets_type",editor:A2Cribs.Editors.Dropdown(c.pets),formatter:A2Cribs.Formatters.Dropdown(c.pets)},{id:"smoking",name:"Smoking",field:"smoking",editor:A2Cribs.Editors.Dropdown(["Prohibited",
"Allowed"]),formatter:A2Cribs.Formatters.Dropdown(["Prohibited","Allowed"])},{id:"square_feet",name:"SQ Feet",field:"square_feet",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Text},{id:"year_built",name:"Year Built",field:"year_built",editor:A2Cribs.Editors.Year,formatter:A2Cribs.Formatters.Text}]};b=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"air",cssClass:"grid_checkbox",name:"A/C",
field:"air",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"washer_dryer",name:"Washer/Dryer",field:"washer_dryer",editor:A2Cribs.Editors.Dropdown(c.washer_dryer),formatter:A2Cribs.Formatters.Dropdown(c.washer_dryer)},{id:"fridge",cssClass:"grid_checkbox",name:"Fridge",field:"fridge",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"balcony",cssClass:"grid_checkbox",name:"Balcony",field:"balcony",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},
{id:"tv",cssClass:"grid_checkbox",name:"TV",field:"tv",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"storage",cssClass:"grid_checkbox",name:"Storage",field:"storage",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"security_system",cssClass:"grid_checkbox",name:"Security System",field:"security_system",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check}]};e=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,
formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"pool",cssClass:"grid_checkbox",name:"Pool",field:"pool",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"hot_tub",cssClass:"grid_checkbox",name:"Hot Tubs",field:"hot_tub",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"fitness_center",cssClass:"grid_checkbox",name:"Fitness Center",field:"fitness_center",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"game_room",cssClass:"grid_checkbox",
name:"Game Room",field:"game_room",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"front_desk",cssClass:"grid_checkbox",name:"Front Desk",field:"front_desk",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"tanning_beds",cssClass:"grid_checkbox",name:"Tanning Beds",field:"tanning_beds",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"study_lounge",cssClass:"grid_checkbox",name:"Study Lounge",field:"study_lounge",editor:Slick.Editors.Checkbox,
formatter:A2Cribs.Formatters.Check},{id:"patio_deck",cssClass:"grid_checkbox",name:"Deck/Patio",field:"patio_deck",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"yard_space",cssClass:"grid_checkbox",name:"Yard Space",field:"yard_space",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"elevator",cssClass:"grid_checkbox",name:"Elevator",field:"elevator",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check}]};n=function(){return[{},{id:"title",
name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"electric",name:"Electricity",field:"electric",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"water",name:"Water",field:"water",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"gas",name:"Gas",field:"gas",editor:A2Cribs.Editors.Dropdown(["Not Included",
"Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"heat",name:"Heat",field:"heat",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"trash",name:"Trash",field:"trash",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"cable",name:"Cable",field:"cable",editor:A2Cribs.Editors.Dropdown(["Not Included",
"Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"internet",name:"Internet",field:"internet",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"utility_total_flat_rate",name:"Total Flat Rate",field:"utility_total_flat_rate",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money}]};k=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,
formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"deposit_amount",name:"Deposit",field:"deposit_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"admin_amount",name:"Admin",field:"admin_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"parking_amount",name:"Parking",field:"parking_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"furniture_amount",name:"Furniture",field:"furniture_amount",editor:Slick.Editors.Integer,
formatter:A2Cribs.Formatters.Money},{id:"pets_amount",name:"Pets",field:"pets_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"amenity_amount",name:"Amenity",field:"amenity_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"upper_floor_amount",name:"Upper Floor",field:"upper_floor_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"extra_occupant_amount",name:"Cost for Extra Occupant",field:"extra_occupant_amount",editor:Slick.Editors.Integer,
formatter:A2Cribs.Formatters.Money}]};f=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"highlights",name:"Highlights",field:"highlights",editor:A2Cribs.Editors.LongText(160,"Highlights"),formatter:A2Cribs.Formatters.Text},{id:"description",name:"Description",field:"description",editor:A2Cribs.Editors.LongText(1E3,"Description"),formatter:A2Cribs.Formatters.Text}]};m=function(){return[{},{id:"title",
name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"pictures",name:"Pictures",formatter:A2Cribs.Formatters.Button}]};g=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"waitlist",name:"Waitlist",field:"waitlist",editor:Slick.Editors.YesNoSelect,formatter:Slick.Formatters.YesNo},{id:"waitlist_open_date",name:"Waitlist Open Date",
field:"waitlist_open_date",editor:Slick.Editors.Date,formatter:A2Cribs.Formatters.Date()},{id:"lease_office_address",name:"Leasing Office Address",field:"lease_office_address",editor:Slick.Editors.Text,formatter:A2Cribs.Formatters.Text},{id:"contact_email",name:"Contact Email",field:"contact_email",editor:A2Cribs.Editors.Email,formatter:A2Cribs.Formatters.RequiredText},{id:"contact_phone",name:"Contact Phone",field:"contact_phone",editor:A2Cribs.Editors.Phone,formatter:A2Cribs.Formatters.RequiredText},
{id:"website",name:"Website",field:"website",editor:Slick.Editors.Text,formatter:A2Cribs.Formatters.Text}]};switch(a){case "overview_grid":return l();case "features_grid":return h();case "amenities_grid":return b();case "utilities_grid":return n();case "fees_grid":return k();case "description_grid":return f();case "picture_grid":return m();case "contact_grid":return g();case "buildingamenities_grid":return e()}};return b}();A2Cribs.MiniMap=function(){function b(a,c,b,e,g){null==c&&(c=39.8282);null==
b&&(b=-98.5795);null==e&&(e=!1);null==g&&(g=!0);a=a.find("#correctLocationMap")[0];this.center=new google.maps.LatLng(c,b);this.Map=new google.maps.Map(a,{zoom:2,center:this.center,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,panControl:!1,zoomControl:!1,streetViewControl:!1,draggable:g});this.Marker=new google.maps.Marker({draggable:g,position:this.center,map:this.Map,visible:e});this.Resize()}b.prototype.CenterMap=function(a,c){this.center=new google.maps.LatLng(a,c);return this.Resize()};
b.prototype.Resize=function(){google.maps.event.trigger(this.Map,"resize");return this.Map.setCenter(this.center)};b.prototype.SetMarkerVisible=function(a){if(null!=this.Marker)return this.Marker.setVisible(!1)};b.prototype.SetMarkerPosition=function(a){this.center=a;this.Map.panTo(a);this.SetZoom(18);this.Marker.setPosition(a);return this.Marker.setVisible(!0)};b.prototype.SetZoom=function(a){return this.Map.setZoom(a)};b.prototype.GetMarkerPosition=function(){return{latitude:this.Marker.position.lat(),
longitude:this.Marker.position.lng()}};b.prototype.SetEnabled=function(a){null==a&&(a=!0);null!=this.Map&&this.Map.setOptions({draggable:a,zoomControl:a,scrollwheel:a,disableDoubleClickZoom:a});null!=this.Marker&&this.Marker.setOptions({draggable:a});return this.Enabled=a};return b}();A2Cribs.PageHeader=function(){function b(){}b.renderUnreadConversationsCount=function(){return $.get(myBaseUrl+"messages/getUnreadCount",function(a){var c,b;try{b=JSON.parse(a)}catch(e){return}a=b.unread_conversations;
c=$(".message_count");if(0===a)return c.hide();c.html(b.unread_conversations);return c.show()})};return b}();A2Cribs.ShoppingCart=function(){function b(a){var c=this;this.Widget=a;this.Widget.on("click",".edit",function(a){a=$(a.currentTarget).attr("id");return c.edit(a)}).on("click",".remove",function(a){a=$(a.currentTarget).attr("id");return c.remove(a)});this.Widget.find(".buy").click(function(){return A2Cribs.Order.BuyCart()});this.Widget.find(".hide-edit").click(function(){$(".fl-cart-item").removeClass("editing");
return $(".edit-form").fadeOut()});this.Widget.find(".save").click(function(){return c.save(c.EditingIndex)});this.Editing=!1;this.EditingIndex=-1;this.orderItem=null;this.ListItemTemplate=_.template("<tr class = 'fl-cart-item'>\n    <td><span  class = 'address'><%= address %></span></td>\n    <td><span class = 'price'?>$<%= price %></span></td>\n    <td class = 'actions'>\n        <a href = '#' class = 'edit' id = '<%= id %>'><i class = 'icon-edit'></i></a>   \n        <a href = '#' class = 'remove' id = '<%= id %>'><i class = 'icon-remove-circle'></i></a>\n    </td>\n</tr>");
this.refresh()}b.prototype.remove=function(a){var c=this;return $.post(myBaseUrl+"shoppingCart/remove",{index:a},function(b){return JSON.parse(b).success?c.refresh():alertify.error("Removing item "+(a+1)+" failed")})};b.prototype.refresh=function(){var a=this;return $.getJSON("/shoppingCart/get",function(c){var b,e,g,f,h;$(".orderItems > tbody").html("");e="";f=g=0;for(h=c.length;f<h;f++)b=c[f],b={price:b.price.toFixed(2),address:b.item.address,id:g++},e+=a.ListItemTemplate(b);$(".orderItems > tbody").html(e);
$("table.orderItems").show();return a.orderItems=c})};b.prototype.edit=function(a){var c,b;c=this.orderItems[a];null!=(b=this.orderItem)&&b.clear();this.orderItem=new A2Cribs.Order.FeaturedListing($(".featured-listing-order-item").first(),c.item.listing_id,c.item.address,{selected_dates:c.item.dates});$(".edit-form").fadeIn("fast");this.EditingIndex=a;return $(".fl-cart-item:eq("+a+")").addClass("editing").siblings().removeClass("editing")};b.prototype.save=function(){var a,c=this;if(0<=this.EditingIndex)return a=
{orderItem:JSON.stringify(this.orderItem.getOrderItem()),index:this.EditingIndex},$.post("/shoppingCart/edit",a,function(b){a=JSON.parse(b);return a.success?(alertify.success("Save Successful"),c.Widget.find(".hide-edit").click(),c.refresh()):alertify.error(a.message)})};return b}();A2Cribs.Landing=function(){function b(){}b.Init=function(a){var c,b,e,g;this.schoolList=[];e=0;for(g=a.length;e<g;e++)c=a[e],this.schoolList.push(c.University.name);b=this;$(function(){return $(".typeahead").typeahead({source:b.schoolList})});
return $(".typeahead").val("University of Michigan-Ann Arbor")};b.Submit=function(){var a;a=$("#search-text").val();return 0>y.call(this.schoolList,a)?(A2Cribs.UIManager.Error(a+" is not a valid location."),!1):window.location=$("#sublet-redirect").attr("href")+"/"+a.split(" ").join("_")};return b}();A2Cribs.Login=function(){function b(){}var a,c;b.LANDING_URL="cribspot.com";b.HTTP_PREFIX="http://";b.setupUI=function(){var a=this;this.div=$("#login_signup");this.div.find(".show_signup").click(function(){a.div.find(".login_row").hide("fade");
return a.div.find(".signup_row").show("fade")});this.div.find(".show_login").click(function(){a.div.find(".signup_row").hide("fade");return a.div.find(".login_row").show("fade")});this.div.find(".show_pm").click(function(){a.div.find(".student_icon").removeClass("active");a.div.find(".pm_icon").addClass("active");a.div.find(".fb_box").hide();a.div.find(".student_signup").hide();return a.div.find(".pm_signup").show()});this.div.find(".show_student").click(function(){a.div.find(".pm_icon").removeClass("active");
a.div.find(".student_icon").addClass("active");a.div.find(".pm_signup").hide();a.div.find(".fb_box").show();return a.div.find(".student_signup").show()});this.div.find("#login_content").submit(function(c){return a.cribspotLogin(c.delegateTarget)});this.div.find("#student_submit").click(this.CreateStudent);this.div.find("#student_signup").submit(this.CreateStudent);this.div.find("#pm_submit").click(this.CreatePropertyManager);return this.div.find("#pm_signup").submit(this.CreatePropertyManager)};b.cribspotLogin=
function(a){var c,b=this;c=myBaseUrl+"users/AjaxLogin";a={User:{email:$(a).find("#inputEmail").val(),password:$(a).find("#inputPassword").val()}};null!=a.User.email&&null!=a.User.password&&$.post(c,a,function(a){a=JSON.parse(a);if(null!=a.error){if("EMAIL_UNVERIFIED"===a.error_type)return A2Cribs.UIManager.Confirm("Your email address has not yet been confirmed. \t\t\t\t\t\t\tPlease click the link provided in your confirmation email. \t\t\t\t\t\t\tDo you want us to resend you the email?",function(a){if(a)return b.ResendConfirmationEmail()});
A2Cribs.UIManager.CloseLogs();return A2Cribs.UIManager.Error(a.error)}A2Cribs.MixPanel.AuthEvent("login",{source:"cribspot"});return window.location.reload()});return!1};b.ResendConfirmationEmail=function(){return $.ajax({url:myBaseUrl+"users/ResendConfirmationEmail",type:"POST",success:function(a){a=JSON.parse(a);return null!=a.error?A2Cribs.UIManager.Alert(a.error.message):A2Cribs.UIManager.Success("Email has been sent! Click the link to verify.")}})};c=function(a,c){var g,f,h,k,l;h=0===a?"student_":
"pm_";A2Cribs.UIManager.CloseLogs();f=!0;k=0;for(l=c.length;k<l;k++)g=c[k],0===b.div.find("#"+h+g).val().length&&(f=!1);f||A2Cribs.UIManager.Error("Please fill in all of the fields!");if(1===a&&(g=b.div.find("#"+h+"phone").val().split("-").join(""),10!==g.length||isNaN(g)))f=!1,A2Cribs.UIManager.Error("Please enter a valid phone number");6>b.div.find("#"+h+"password").val().length&&(f=!1,A2Cribs.UIManager.Error("Please enter a password of 6 or more characters"));return f};a=function(a,e,g){var f,
h,k,l;h=0===a?"student_":"pm_";if(c(a,e)){if(b.div.find("#"+h+"password").val()!==b.div.find("#"+h+"confirm_password").val())return A2Cribs.UIManager.Error("Make sure passwords match!");f={User:{user_type:a}};k=0;for(l=g.length;k<l;k++)e=g[k],0!==b.div.find("#"+h+e).val().length&&(f.User[e]=b.div.find("#"+h+e).val());return $.post("/users/AjaxRegister",f,function(c){var e;e=JSON.parse(c);if(null!=e.error)return A2Cribs.UIManager.CloseLogs(),A2Cribs.UIManager.Error(e.error);e=0===a?$("#student_email").val():
$("#pm_email").val();A2Cribs.MixPanel.AuthEvent("signup",{user_id:c.success,user_type:a,email:e,source:"cribspot",user_data:f});mixpanel.people.set({user_id:c.success,user_type:a,email:e,user_data:f});b.div.find(".show_login").click();return A2Cribs.UIManager.Alert("Check your email to validate your credentials!")})}};b.CreateStudent=function(){var c,b;b=["email","password","first_name","last_name"];c=b.slice(0);a(0,b,c);return!1};b.CreatePropertyManager=function(){var c,b;b="email password company_name street_address phone city state".split(" ");
c=b.slice(0);c.push("website");a(1,b,c);return!1};return b}.call(this);A2Cribs.FeaturedListings=function(){function b(){}var a;b.GetFlIds=function(a){var b;b=new $.Deferred;$.get("/featuredListings/cycleIds/"+a+"/"+this.FL_LIMIT,function(a){a=JSON.parse(a);return null!=a?b.resolve(a):b.resolve(null)});return b.promise()};b.FL_LIMIT=5;b.GetListingDeferred=function(a,b){var e;e=new $.Deferred;$.ajax({url:myBaseUrl+"Listings/GetListing/"+a,type:"GET",success:function(g){var f,h,k,l,m;g=JSON.parse(g);
l=0;for(m=g.length;l<m;l++)for(h in f=g[l],f)k=f[h],null!=A2Cribs[h]&&A2Cribs.UserCache.Set(new A2Cribs[h](k));A2Cribs.UserCache.Get(b,a);return e.resolve(f)},error:function(){return e.resolve(null)}});return e.promise()};b.FetchListingsByIds=function(a,b){var e,g,f,h,k;e=new $.Deferred;if(!a||1>a.length)return e.resolve(null),e;f=[];h=0;for(k=a.length;h<k;h++)g=a[h],f.push(A2Cribs.FeaturedListings.GetListingDeferred(g,b));$.when.apply($,f).then(function(){return e.resolve(arguments)});return e.promise()};
b.GetRandomListingsFromMap=function(a,b){return _.shuffle(b).slice(0,a)};b.InitializeSidebar=function(c,b,e,g){var f,h=this;null==this.SidebarListingCache&&(this.SidebarListingCache={});null==this.FLListingIds&&(this.FLListingIds=[]);f=new a($("#fl-side-bar"));c=this.GetFlIds(c);this.GetSidebarImagePathsDeferred=new $.Deferred;$.when(c,g).then(function(a){var c,b,d,e,g,q,s,v;d=A2Cribs.UserCache.Get("listing");c=[];q=0;for(g=d.length;q<g;q++)b=d[q],null!=b&&b.listing_id&&c.push(parseInt(b.listing_id));
d=null;0<c.length&&(d=h.GetRandomListingsFromMap(25,c));if(!(null==a&&null==d)){q=[];g=0;for(s=a.length;g<s;g++)c=a[g],c=parseInt(c),h.FLListingIds.push(c),q.push(c);if(null!=d){a=0;for(g=d.length;a<g;a++)c=d[a],q.push(c)}d=[];s=0;for(v=q.length;s<v;s++)c=q[s],a={},b=A2Cribs.UserCache.Get("listing",c),e=g=null,null!=b&&(e=A2Cribs.UserCache.Get("marker",b.marker_id),g=A2Cribs.UserCache.GetAllAssociatedObjects("rental","listing",c),null!=g[0]&&(g=g[0])),null!=b&&null!=e&&null!=g?(a.Listing=b,a.Marker=
e,a.Rental=g,d.push(a)):(console.log(b),console.log(e),console.log(g));f.addListings(d,"ran");h.GetSidebarImagePaths(q);q=0;for(c=d.length;q<c;q++)b=d[q],null!=b.Listing&&A2Cribs.FavoritesManager.setFavoriteButton(b.Listing.listing_id.toString(),null,A2Cribs.FavoritesManager.FavoritesListingIds);return $(".fl-sb-item").click(function(a){var c;c=parseInt($(a.currentTarget).attr("marker_id"));a=parseInt($(a.currentTarget).attr("listing_id"));e=A2Cribs.UserCache.Get("marker",c);b=A2Cribs.UserCache.Get("listing",
a);A2Cribs.Map.GMap.setZoom(16);A2Cribs.HoverBubble.Open(e);A2Cribs.MixPanel.Click(b,"sidebar listing");c=e.GMarker.getPosition();return A2Cribs.Map.CenterMap(c.lat(),c.lng())})}});return $.when(this.GetSidebarImagePathsDeferred).then(function(a){var c,b,d,e,f;a=JSON.parse(a);f=[];d=0;for(e=a.length;d<e;d++)c=a[d],null!=c&&null!=c.Image?(b=$("#sb-img"+c.Image.listing_id),f.push(b.attr("src","/"+c.Image.image_path))):f.push(void 0);return f})};b.GetSidebarImagePaths=function(a){return $.ajax({url:myBaseUrl+
"Images/GetPrimaryImages/"+JSON.stringify(a),type:"GET",success:function(a){return b.GetSidebarImagePathsDeferred.resolve(a)},error:function(){return b.GetSidebarImagePathsDeferred.resolve(null)}})};a=function(){function a(c){this.SidebarUI=c;this.ListItemTemplate=_.template(A2Cribs.FeaturedListings.ListItemHTML)}a.prototype.addListings=function(a,c,b){null==b&&(b=!0);if(null!==a)return a=this.getListHtml(a),b?this.SidebarUI.find("#"+c+"-listings").html(a):this.SidebarUI.find("#"+c+"-listings").append(a)};
a.prototype.getDateString=function(a){var c;null==this.MonthArray&&(this.MonthArray="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "));c=this.MonthArray[a.getMonth()];a=a.getFullYear();return""+c+" "+a};a.prototype.getListHtml=function(a){var c,b,f,h,k,l,m,n,p,r,q,s,v,t;h="";r=0;for(s=a.length;r<s;r++){k=a[r];n=null!=k.Rental.rent?parseFloat(k.Rental.rent).toFixed(0):" --";l=null!=k.Marker.alternate_name?k.Marker.alternate_name:k.Marker.street_address;f=null!=k.Rental.lease_length?k.Rental.lease_length:
"-- ";c=1<k.Rental.beds?""+k.Rental.beds+" beds":null!=k.Rental.beds?""+k.Rental.beds+" bed":"-- beds";null!=k.Rental.start_date?(p=k.Rental.start_date.toString().replace(" ","T"),p=this.getDateString(new Date(p))):p="Start Date --";m="/img/sidebar/no_photo_small.jpg";if(null!=k.Image){t=k.Image;q=0;for(v=t.length;q<v;q++)b=t[q],b.is_primary&&(m="/"+b.image_path)}c={rent:n,beds:c,building_type:k.Marker.building_type_id,start_date:p,lease_length:f,name:l,img:m,listing_id:k.Listing.listing_id,marker_id:k.Marker.marker_id};
h+=this.ListItemTemplate(c)}return h};return a}();b.ListItemHTML="<div class = 'fl-sb-item' listing_id=<%= listing_id %> marker_id=<%= marker_id %>>\n    <span class = 'img-wrapper'>\n        <img id='sb-img<%=listing_id %>' src = '<%=img%>'></img>\n    </span>\n    <span class = 'vert-line'></span>\n    <span class = 'info-wrapper'>\n        <div class = 'info-row'>\n            <span class = 'rent price-text'><%= \"$\" + rent %></span>\n            <span class = 'divider'>|</span>\n            <span class = 'beds'><%= beds %> </span>\n            <span class = 'favorite pull-right'><i class = 'icon-heart fav-icon share_btn favorite_listing' id='<%= listing_id %>'></i></span>    \n        </div>\n        <div class = 'row-div'></div>\n        <div class = 'info-row'>\n            <span class = 'building-type'><%= building_type %></span>\n            <span class = 'divider'>|</span>\n            <span class = 'lease-start'><%= start_date %></span> | <span class = 'lease_length'><%= lease_length %> months</span>\n        </div>\n        <div class = 'row-div'></div>\n        <div class = 'info-row'>\n            <i class = 'icon-map-marker'></i><span class = 'name'><%=name%></span>\n        </div>\n    </span>   \n</div>";
return b}.call(this);A2Cribs.Order=function(){function b(){}b.BuyItems=function(a,c,b,e,g){null==e&&(e=null);null==g&&(g=null);a={orderItems:JSON.stringify(a),order_type:c};return $.post(""+myBaseUrl+"order/buy",a,function(a){a=JSON.parse(a);if(a.success){if(null!=a.jwt)return google.payments.inapp.buy({parameters:{},jwt:a.jwt,success:function(){return alert("success")},failture:function(){return alert("fail")}});A2Cribs.UIManager.Alert(a.msg);return e()}b(a.errors)})};b.BuyCart=function(a,c){null==
a&&(a=null);null==c&&(c=null);return $.post(""+myBaseUrl+"order/buyCart",function(a){a=JSON.parse(a);a.success||console.log(a.message);return google.payments.inapp.buy({parameters:{},jwt:a.jwt,success:function(){return alert("success")},failture:function(){return alert("fail")}})})};b.AddToCart=function(a){a={orderItems:JSON.stringify(a)};return $.post(myBaseUrl+"shoppingCart/add",a,function(a){return JSON.parse(a).success?alertify.success("Added to cart",1500):alertify.error("Adding to cart failed",
1500)})};return b}();A2Cribs.FullListing=function(){function b(){}b.SetupUI=function(){var a=this;this.div=$(".full_page");this.div.find(".image_preview").click(function(c){var b;b=$(c.delegateTarget).css("background-image");a.div.find(".image_preview.active").removeClass("active");$(c.delegateTarget).addClass("active");return a.div.find("#main_photo").css("background-image",b)});this.div.find(".page_right").click(function(c){if(a.div.find(".image_preview.active").next().length)return c=a.div.find(".image_preview.active").next(),
a.div.find(".image_preview.active").removeClass("active"),c.addClass("active"),a.div.find("#main_photo").css("background-image",c.css("background-image"))});this.div.find(".page_left").click(function(c){if(a.div.find(".image_preview.active").prev().length)return c=a.div.find(".image_preview.active").prev(),a.div.find(".image_preview.active").removeClass("active"),c.addClass("active"),a.div.find("#main_photo").css("background-image",c.css("background-image"))});this.div.find("#contact_owner").click(function(){if(0===
parseInt($("#contact_owner").attr("emailexists")))a.div.find("#contact_message").show(),a.div.find("#contact_owner").hide();else return a.div.find("#contact_owner").hide(),a.div.find("#contact_message").slideDown()});this.div.find("#message_cancel").click(function(){return a.div.find("#contact_message").slideUp("fast",function(){return a.div.find("#contact_owner").show()})});return this.div.find("#message_send").click(function(){$("#message_send").button("loading");return $.ajax({url:myBaseUrl+"Messages/messageSublet",
type:"POST",data:{listing_id:1,message_body:$("#message_area").val()},success:function(a){a=JSON.parse(a);a.success?($("#message_area").val(""),A2Cribs.UIManager.Success("Message Sent!")):null!=a.message?A2Cribs.UIManager.Error(a.message):A2Cribs.UIManager.Error("Message Failed! Please Try Again.");return $("#message_send").button("reset")}})})};b.Directive=function(a){if(null!=a.contact_owner)return this.div.find("#contact_owner").click()};return b}();A2Cribs.Dashboard=function(){function b(){}b.SetupUI=
function(){var a,c=this;$(window).resize(function(){return c.SizeContent()});this.SizeContent();$(".content-header").each(function(a,b){var g,f,h;h=$(b);g=h.attr("classname");f=$("."+g+"-content");$(b).click(function(a){var b;return null!=(b=A2Cribs.RentalSave)&&b.Editable?A2Cribs.UIManager.ConfirmBox("By leaving this page, all unsaved changes will be lost.",{ok:"Abort Changes & Continue",cancel:"Return to Editor"},function(b){if(b)return A2Cribs.RentalSave.CancelEditing(),c.ContentHeaderClick(a)}):
c.ContentHeaderClick(a)});return"function"===typeof h.next?h.next(".drop-down").find(".drop-down-list").click(function(){return c.ShowContent(f)}):void 0});$("#feature-btn").click(function(a){return c.Direct({classname:"featured-listing"})});$("#create-listing").find("a").click(function(a){A2Cribs.MarkerModal.NewMarker();return A2Cribs.MarkerModal.Open()});$("body").on("click",".messages_list_item",function(a){return c.ShowContent($(".messages-content"))});a=$("#navigation-bar").parent().height()-
$("#navigation-bar").height()-68;$(".list_content").css("height",a+"px");$(".dropdown-search").keyup(function(a){var c;c=$(a.delegateTarget).attr("data-filter-list");return $(""+c+" li").show().filter(function(){return-1===$(this).text().toLowerCase().indexOf($(a.delegateTarget).val().toLowerCase())?!0:!1}).hide()});return this.GetUserMarkerData()};b.ContentHeaderClick=function(a){var c,b,e;e=$(a.delegateTarget);c=e.attr("classname");b=$("."+c+"-content");$(".list-dropdown").slideUp();$(".content-header.active").removeClass("active");
$(a.delegateTarget).addClass("active");return e.hasClass("list-dropdown-header")?$("#"+c+"_list").slideDown():this.ShowContent(b,!0)};b.GetUserMarkerData=function(){return $.ajax({url:myBaseUrl+"listings/GetMarkerDataByLoggedInUser",type:"GET",success:this.GetUserMarkerDataCallback})};b.GetUserMarkerDataCallback=function(a){var c,b,e,g,f,h,k;e=JSON.parse(a);$("#rentals_count").text(e.length);b=[];k=[];g=0;for(f=e.length;g<f;g++)if(a=e[g],null!=a.Marker&&(a=a.Marker,!(null!=a.marker_id&&(h=a.marker_id,
0<=y.call(b,h))))){c=a.alternate_name;if(!a.alternate_name||!a.alternate_name.length)c=a.street_address;c=$("<li />",{text:c,"class":"rentals_list_item",id:a.marker_id});$("#rentals_list_content").append(c);k.push(b.push(a.marker_id))}return k};b.GetListings=function(){if(null==this.DeferedListings)this.DeferedListings=new $.Deferred;else return this.DeferedListings.promise();$.ajax({url:myBaseUrl+"listings/GetListing",type:"GET",success:this.GetListingsCallback});return this.DeferedListings.promise()};
b.GetListingsCallback=function(a){var c,d,e,g,f,h,k,l,m,n,p,r,q,s;f=JSON.parse(a);q=0;for(s=f.length;q<s;q++)for(c in a=f[q],a)r=a[c],null!=A2Cribs[c]&&A2Cribs.UserCache.Set(new A2Cribs[c](r));f=A2Cribs.UserCache.Get("listing");c={};r=0;for(q=f.length;r<q;r++)a=f[r],null==c[a.listing_type]&&(c[a.listing_type]={}),c[a.listing_type][a.marker_id]=!0;b.DeferedListings.resolve();h=[0,0,0];g=["rentals","sublet","parking"];a=[];for(e in c)m=c[e],a.push(function(){var a;a=[];for(l in m)k=A2Cribs.UserCache.Get("marker",
l),n=k.GetName(),p=g[parseInt(e,10)],h[parseInt(e,10)]++,d=$("<li />",{text:n,"class":""+p+"_list_item",id:k.marker_id}),a.push($("#"+p+"_list_content").append(d));return a}());return a};b.SizeContent=function(){};b.SlideDropDown=function(a,c){var b,e;b=a.next(".drop-down");if(0!==b.length)return e=a.children("i")[0],$(e).toggleClass("icon-caret-right",!c).toggleClass("icon-caret-down",c),$(a).toggleClass("shadowed",c).toggleClass("expanded",c).toggleClass("minimized",!c),c?b.slideDown("fast"):b.slideUp("fast")};
b.ShowContent=function(a){a.siblings().addClass("hidden");a.removeClass("hidden");return a.trigger("shown")};b.HideContent=function(a){return $("."+a+"-content").addClass("hidden")};b.Direct=function(a){$("#"+a.classname+"-content-header").trigger("click");if(null!=a.data)return this.ShowContent($("."+a.classname+"-content"))};return b}.call(this);A2Cribs.Account=function(){function b(){}b.setupUI=function(){var a,c,b=this;$.get(myBaseUrl+"university/getAll/",function(a){b.UniversityData=JSON.parse(a);
b.UniversityNames=[];b.UniversityID=[];_.each(b.UniversityData,function(a,c,e){b.UniversityNames[c]=a.University.name;return b.UniversityID[c]=a.University.id});return $("#university").typeahead({source:b.UniversityNames})});a=A2Cribs.VerifyManager.getMyVerification();c=$("#my-verification-panel");a.verified_email&&c.find("#veri-email i:last-child").removeClass("unverified icon-remove-sign").addClass("verified icon-ok-sign");a.verified_edu&&c.find("#veri-edu i:last-child").removeClass("unverified icon-remove-sign").addClass("verified icon-ok-sign");
a.verified_fb?c.find("#veri-fb  i:last-child").removeClass("unverified icon-remove-sign").addClass("verified icon-ok-sign"):$("#veri-fb").append("<a href = '#'>Verify?</a>").click(this.FacebookConnect);$(".veridd").each(function(a,b){return $(b).tooltip({title:"Verify?",trigger:"hover"})});$("#changePasswordButton").click(function(){return b.ChangePassword($("#changePasswordButton"),$("#new_password").val(),$("#confirm_password").val())});$("#VerifyUniversityButton").click(function(){return b.VerifyUniversity()});
$("#changePhoneBtn").click(function(){return b.SavePhone()});$("#changeAddressBtn").click(function(){return b.SaveAddress()});$("#changeCompanyNameBtn").click(function(){return b.SaveCompanyName()});return $("#changeFirstLastNameButton").click(function(){return b.SaveFirstLastName()})};b.SaveFirstLastName=function(){var a;a={first_name:$("#first_name_input").val(),last_name:$("#last_name_input").val()};return this.SaveAccount(a,$("#changeFirstLastNameButton"))};b.SaveCompanyName=function(){var a;
a={company_name:$("#company_name_input").val()};return this.SaveAccount(a,$("#changeCompanyNameButton"))};b.SavePhone=function(){var a;a=$("#phone_input").val();return this.ValidatePhone(a)?(a={phone:a},this.SaveAccount(a,$("#changePhoneBtn"))):A2Cribs.UIManager.Error("Invalid phone number")};b.ValidatePhone=function(a){a=a.replace(/[^0-9]/g,"");return 10===a.length};b.SaveAddress=function(){var a,b;b=$("#street_address_input").val();a=$("#city_address_input").val();return this.SaveAccount({street_address:b,
city:a},$("#changeAddressBtn"))};b.Direct=function(a){};b.VerifyUniversity=function(){var a,b;$("#VerifyUniversityButton").attr("disabled","disabled");b=$("#university_email").val();a={university_email:b};return-1!==b.search(".edu")?$.post(myBaseUrl+"users/verifyUniversity",a,function(b){console.log(a);b=JSON.parse(b);1===b.success?A2Cribs.UIManager.Error("Please check your email for a verification link."):A2Cribs.UIManager.Error("Verification not successful: "+b.message);return $("#VerifyUniversityButton").removeAttr("disabled")}):
A2Cribs.UIManager.Error("Please enter a university email.")};b.ChangePassword=function(a,b,d,e,g,f){var h;null==e&&(e=null);null==g&&(g=null);null==f&&(f=null);a.attr("disabled","disabled");h={new_password:b,confirm_password:d};null!==e&&null!==g&&(h.id=e,h.reset_token=g);if(b!==d)A2Cribs.UIManager.Alert("Passwords do not match.");else return $.post(myBaseUrl+"users/AjaxChangePassword",h,function(b){b=JSON.parse(b);void 0===b.error?null===e&&null===g?(alertify.success("Password Changed",3E3),null!==
f&&(window.location.href=f)):window.location.href="/dashboard":A2Cribs.UIManager.Alert(b.error);return a.removeAttr("disabled")})};b.SaveAccount=function(a,b){null==a&&(a=null);null==b&&(b=null);return $.post(myBaseUrl+"users/AjaxEditUser",a,function(a){a=JSON.parse(a);void 0===a.error?alertify.success("Account Saved",3E3):A2Cribs.UIManager.Error("Account Failed to Save: "+a.error.message);if(null!=b)return b.removeAttr("disabled")})};b.FacebookConnect=function(){return FB.login(function(a){$.ajax({url:myBaseUrl+
"account/verifyFacebook",data:{signed_request:a.authResponse.signedRequest},type:"POST"});return document.location.href="/account"})};b.SubmitResetPassword=function(a){var b;b="email="+$("#UserEmail").val();return $.post("/users/AjaxResetPassword",b,function(a){b=JSON.parse(a);null!=b.success?A2Cribs.UIManager.Alert("Email sent to reset password!"):A2Cribs.UIManager.Error(b.error);return!1})};return b}();A2Cribs.Messages=function(){function b(){}b.setupUI=function(){var a=this;$("#send_reply").click(function(){return a.sendReply()});
$("#view_unread_cb").change(function(){return a.toggleUnreadConversations()});$("#refresh_content").click(function(){return a.refresh()});$("#current_conversation").scroll(function(b){return a.MessageScrollingHandler(b)});$("#meaning").click(function(){return $("#hidden-meaning").fadeToggle()});$("#delete_conversation").click(function(){return a.DeleteConversation()});return this.refresh()};b.ScrollMessagesTo=function(a){var b;b=$("#current_conversation");a=b.offset().top+b.innerHeight()-(a.offset().top+
a.innerHeight()+10);return b.scrollTop(b.scrollTop()-a)};b.MessageScrollingHandler=function(a){if(!(20<$("#current_conversation").scrollTop()||0===this.NumMessagePages))return this.NumMessagePages+=1,this.loadMessages(this.NumMessagePages)};b.refresh=function(){this.refreshUnreadCount();this.refreshConversations();if(-1!==this.CurrentConversation)return this.refreshParticipantInfo(),this.refreshMessages()};b.refreshUnreadCount=function(){return $.get(myBaseUrl+"messages/getUnreadCount",function(a){a=
JSON.parse(a);return $("#message_count").html(a.unread_conversations)})};b.refreshConversations=function(){var a=this;return $.get(myBaseUrl+"messages/getConversations",function(b){var d,e,g;b=JSON.parse(b);e=0;for(g=b.length;e<g;e++)d=b[e],d=$("<li />",{text:d.Conversation.title,"class":"messages_list_item",id:d.Conversation.conversation_id,"data-participant":d.Participant.id}),$("#messages_list_content").append(d);return a.attachConversationListItemHandler()})};b.toggleUnreadConversations=function(){this.ViewOnlyUnread=
$("#view_unread_cb").is(":checked");return this.refreshConversations()};b.refreshParticipantInfo=function(){var a,c;c=b.CurrentParticipantID;a=b.CurrentConversation;if(null!=b.ParticipantInfoCache[c])b.setParticipantInfoUI(b.ParticipantInfoCache[c]);else return a=a=myBaseUrl+"messages/getParticipantInfo/"+a+"/",$.ajax({url:a,type:"GET",success:function(a){a=JSON.parse(a);b.ParticipantInfoCache[a.id]=a;return b.setParticipantInfoUI(b.ParticipantInfoCache[c])}})};b.setParticipantInfoUI=function(a){var b;
b="";null!=a.first_name&&(b+=a.first_name,null!=a.last_name&&(b+=a.last_name));$(".from_participant").html(b);return A2Cribs.VerifyManager.getVerificationFor(a).then(function(a){var b;b=$("#verification-panel");a.verified_email&&b.find("#veri-email  i:last-child").removeClass("unverified icon-remove-sign").addClass("verified icon-ok-sign");if(a.verified_fb)return a="https://graph.facebook.com/"+a.fb_id+"/picture?width=480",console.log(a),$("#p_pic").attr("src",a)})};b.loadConversation=function(a){var b;
this.CurrentConversation=parseInt($(a.delegateTarget).attr("id"));this.CurrentParticipantID=$(a.delegateTarget).attr("data-participant");$("#message_reply").show();$("#participant_info_short").show();b=$("#cli_"+this.CurrentConversation).find(".conversation_title").text();a=$("#cli_"+this.CurrentConversation+" a").attr("href");$("#listing_title").text(b).attr("href",a);this.refreshParticipantInfo();this.refreshUnreadCount();return this.refreshMessages()};b.loadMessages=function(a,b){var d=this;null==
b&&(b=!1);return $.get(myBaseUrl+"messages/getMessages/"+this.CurrentConversation+"/"+a+"/",function(a,g){var f,h;a=JSON.parse(a);if(void 0===a.error)return h=$("#message_list"),f=h.innerHeight(),$(a).hide().prependTo("#message_list").fadeIn(),$(".mli").each(function(a,b){var c;c=$(this).find(".message_buble").height();return $(this).css("height",c+"px")}),b?d.ScrollMessagesTo($("#mli_0")):(f=h.innerHeight()-f,$("#current_conversation").scrollTop($("#current_conversation").scrollTop()+f)),$("#current_conversation").trigger("scroll"),
d.attachConversationListItemHandler()}).fail(function(){return d.NumMessagePages=0})};b.attachConversationListItemHandler=function(){var a=this;return $(".messages_list_item").one("click",function(b){return a.loadConversation(b)})};b.refreshMessages=function(a){this.NumMessagePages=1;$("#message_list").html("");return this.loadMessages(this.NumMessagePages,!0)};b.sendReply=function(a){var b=this;a=$("#message_text textarea").val();if(0===a.length)return A2Cribs.UIManager.Error("Message can not be empty"),
!1;$("#send_reply").attr("disabled","disabled");a=$("#message_text textarea").val();$.post(myBaseUrl+"messages/newMessage/",{message_text:a,conversation_id:this.CurrentConversation},function(a){b.refreshMessages();$("#message_text textarea").val("");JSON.parse(a);if(!1===(null!=a?a.success:void 0))return A2Cribs.UIManager.Error("Something went wrong while sending a reply, please refresh the page and try again")}).always(function(){return $("#send_reply").removeAttr("disabled")});return!1};b.DeleteConversation=
function(){var a=this;return $.post(myBaseUrl+"messages/deleteConversation/",{conv_id:this.CurrentConversation},function(b){var d;try{d=JSON.parse(b)}catch(e){A2Cribs.UIManager.Error("Failed to delete the conversation");return}return 1===d.success?(alertify.success("Conversation deleted",3E3),a.CurrentConversation=-1,a.CurrentParticipantID=-1,A2Cribs.Dashboard.HideContent("messages"),a.refresh()):A2Cribs.UIManager.Error("Failed to delete the conversation")})};b.Direct=function(a){var b;if(null!=a.data)return this.CurrentConversation=
b=parseInt(a.data.conversation_id),this.CurrentParticipantID=b=parseInt(a.data.participant_id),$("#listing_title").text(a.data.title)};b.init=function(a){this.me=a;this.ViewOnlyUnread=!1;null==this.CurrentConversation&&(this.CurrentConversation=-1);this.DropDownVisible=!1;this.NumMessagePages=-1;null==this.CurrentParticipantID&&(this.CurrentParticipantID=-1);this.ParticipantInfoCache={};return this.LoadingMessages=!1};return b}.call(this);A2Cribs.PropertyManagement=function(){function b(){}b.removeSublet=
function(a){return alertify.confirm("Are you sure you want to delete this property? This can't be undone.",function(b){if(b)return b=myBaseUrl+("sublets/remove/"+a),window.location.href=b})};return b}();A2Cribs.VerifyManager=function(){function b(){}b.init=function(a){null==a&&(a=null);this.me=a;return this.VerificationData={}};b.getVerificationFor=function(a){var b;null==this.VerificationData[a.id]&&(b=new $.Deferred,this.VerificationData[a.id]=b,$.when(this.getTotalFriends(a),this.getMutalFriends(a),
this.getTwitterFollowers(a)).done(function(d,e,g){return b.resolve({user_id:a.id,fb_id:a.facebook_id,verified_email:!0===a.verified,verified_edu:!0===a.university_verified,tw_id:a.twitter_userid,verified_fb:d,mut_friends:e,tot_friends:d,verified_tw:null!=g,tot_followers:g})}));return this.VerificationData[a.id]};b.getMutalFriends=function(a){var b,d;b=new $.Deferred;return null!=(null!=(d=this.me)?d.facebook_id:void 0)&&null!=a.facebook_id?(a="SELECT uid FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = "+
this.me.facebook_id+") AND uid IN (SELECT uid2 FROM friend WHERE uid1 = "+a.facebook_id+")",FB.api({method:"fql.query",query:a},function(a){null!=a.error_code&&(console.log("Error during verification fb error: "+a.error_code+"."),b.resolve(null));return b.resolve(a.length)}),b.promise()):b.resolve(null)};b.getTotalFriends=function(a){var b;b=new $.Deferred;return null!=a.facebook_id?(a="SELECT friend_count FROM user WHERE uid = "+a.facebook_id,FB.api({method:"fql.query",query:a},function(a){null!=
a.error_code&&(console.log("Error during verification fb error: "+a.error_code+"."),b.resolve(null));return b.resolve(parseInt(a[0].friend_count))}),b.promise()):b.resolve(null)};b.getTwitterFollowers=function(a){var b;b=new $.Deferred;return null!=a.twitter_userid?($.ajax({url:myBaseUrl+"Users/GetTwitterFollowers/"+a.id,type:"GET",success:function(a){a=JSON.parse(a);return b.resolve(a.followers_count)}}),b.promise()):b.resolve(null)};b.getMyVerification=function(){return{user_id:parseInt(this.me.id),
fb_id:parseInt(this.me.facebook_id),tw_id:this.me.twitter_userid,verified_email:!0===this.me.verified,verified_edu:!0===this.me.university_verified,verified_fb:null!=this.me.facebook_id,verified_tw:null!=this.me.twitter_userid}};return b}();A2Cribs.UserCache=function(){function b(){}var a;b.Cache={};a=function(a,b,e){var g;if("listing"===a||"rental"===a)g=myBaseUrl+"Listings/GetListing/"+b;return $.ajax({url:g,type:"GET",success:function(a){return null!=e?e.success(JSON.parse(a)):void 0},error:function(){return null!=
e?e.error():void 0}})};b.GetDiferred=function(b,d){var e,g,f=this;e=new $.Deferred;g=this.Get(b,d);return null==g||!g.IsComplete()?(a(b,d,{success:function(a){var e,l,m,n,p;n=0;for(p=a.length;n<p;n++)for(e in l=a[n],l)m=l[e],null!=A2Cribs[e]&&f.Set(new A2Cribs[e](m));return g=f.Get(b,d)},error:function(){return e.resolve(null)}}),e.promise()):e.resolve(g)};b.Set=function(a){null==this.Cache[a.class_name]&&(this.Cache[a.class_name]={});return this.Cache[a.class_name][a.GetId()]=a};b.Get=function(a,
b){var e,g;if(null!=this.Cache[a]){if(null!=b)return this.Cache[a][b];g=[];for(e in this.Cache[a])g.push(this.Cache[a][e]);return g}return null!=b?null:[]};b.Remove=function(a,b){if(null!=this.Cache[a]&&null!=b)return delete this.Cache[a][b]};b.GetAllAssociatedObjects=function(a,b,e){var g,f,h,k;if(null!=a&&null!=b&&null!=e){f={};k=[];e=parseInt(e,10);for(g in this.Cache[a])null!=this.Cache[a][g][""+b+"_id"]&&(h=parseInt(this.Cache[a][g][""+b+"_id"],10),h===e&&(f[this.Cache[a][g].GetId()]=!0));for(g in f)k.push(this.Get(a,
g));return k}};return b}();A2Cribs.Order.FeaturedListing=function(){function b(a,b,d,e,g){this.Widget=a;this.listing_id=b;this.address=d;this.UniData=e;null==g&&(g=null);this.WE_price=this.WD_price=this.Price=this.Weekends=this.Weekdays=0;this.MIN_DAY_OFFSET=3;this.initMultiDatesPicker(g);this.initTemplates();this.PrevSelectedDate=null;this.RangeSelectEnabled=!0;this.Widget.find(".address").html(this.address);this.setupHandlers();this.setupUniPriceTable(g);this.refresh()}b.prototype.getPrice=function(){return this.Price};
b.prototype.setupHandlers=function(){var a=this;this.Widget.on("click",".rst input",function(b){a.RangeSelectEnabled=!a.RangeSelectEnabled;return a.PrevSelectedDate=null}).on("click",".rst .clear-selected-dates",function(b){return a.clear()});return this.Widget.on("click","input.uni-toggle",function(b){var d;d=$(b.currentTarget).parents().eq(1).index();a.UniData[d].enabled=$(b.currentTarget).prop("checked");return a.refresh()})};b.prototype.setupUniPriceTable=function(a){var b,d,e,g,f;a="";g=this.UniData;
d=0;for(e=g.length;d<e;d++)b=g[d],null!=("undefined"!==typeof initialState&&null!==initialState?null!=(f=initialState.universities)?f[b.university_id]:void 0:void 0)?b.enabled=initialState.universities[b.university_id]:b.enabled=!0,a+=this.UniPriceRow(b);return this.Widget.find(".uniPriceTable>tbody").html(a)};b.GenerateOrderItem=function(a,b){var d;d=_.without.apply(_,[a.selectedDates].concat(b.unavailable_dates));return{listing_id:a.listing_id,university_id:b.university_id,dates:d}};b.prototype.getState=
function(){var a,b,d,e,g;b={};g=this.UniData;d=0;for(e=g.length;d<e;d++)a=g[d],b[a.university_id]=a.enabled;return{selectedDates:this.getDates("string"),universities:b,listing_id:this.listing_id}};b.prototype.clear=function(){this.datepicker.multiDatesPicker("resetDates","picked");return this.refresh()};b.prototype.reset=function(a){null==a&&(a=!0);this.datepicker.multiDatesPicker("resetDates","picked");this.datepicker.multiDatesPicker("resetDates","disabled");this.Widget.off("click",".rst input");
this.Widget.off("click",".rst .clear-selected-dates");return this.Widget.off("click","input.uni-toggle",a?this.refresh():void 0)};b.prototype.getDates=function(a){null==a&&(a="object");return this.datepicker.multiDatesPicker("getDates",a)};b.prototype.updatePrice=function(){return this.Price=this.Weekdays*this.WD_price+this.Weekends*this.WE_price};b.prototype.updateRates=function(){var a,b,d,e;this.WD_price=this.WE_price=0;e=this.UniData;b=0;for(d=e.length;b<d;b++)a=e[b],a.enabled&&(this.WD_price+=
a.weekday_price,this.WE_price+=a.weekend_price);this.Widget.find("#wd_rate").html(this.WD_price.toFixed(2));return this.Widget.find("#we_rate").html(this.WE_price.toFixed(2))};b.prototype.updateDayCounts=function(){var a,b,d,e;this.Weekdays=this.Weekends=0;e=this.getDates();b=0;for(d=e.length;b<d;b++)a=e[b],a=a.getDay(),0===a||6===a?this.Weekends++:this.Weekdays++;return[this.Weekdays,this.Weekends]};b.prototype.initMultiDatesPicker=function(a){var b,d=this;b=new Date;b={dateFormat:"yy-mm-dd",minDate:new Date(b.setDate(b.getDate()+
this.MIN_DAY_OFFSET)),onSelect:function(a,b){d.RangeSelectEnabled&&d.rangeSelect(a);return d.refresh()}};null!=a&&(b.addDates=a.selectedDates);this.datepicker=$(this.Widget).find(".mdp").first().multiDatesPicker(b);return this.datepicker.click()};b.prototype.rangeSelect=function(a){var b,d;if(null!=this.PrevSelectedDate){a=new Date(a);a=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate());this.PrevSelectedDate>a&&(a=[a,this.PrevSelectedDate],this.PrevSelectedDate=a[0],a=a[1]);this.SelectedDateRange=
A2Cribs.UtilityFunctions.getDateRange(this.PrevSelectedDate,a);for(b=d=this.SelectedDateRange.length-1;0<=d;b=d+=-1)a=this.SelectedDateRange[b],!1!==this.datepicker.multiDatesPicker("gotDate",a,"disabled")&&this.SelectedDateRange.splice(b,1);this.PrevSelectedDate=null;return this.datepicker.multiDatesPicker("addDates",this.SelectedDateRange)}null!=this.SelectedDateRange&&this.datepicker.multiDatesPicker("removeDates",this.SelectedDateRange);this.SelectedDateRange=null;a=new Date(a);this.PrevSelectedDate=
new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate());return this.datepicker.multiDatesPicker("addDates",[this.PrevSelectedDate])};b.prototype.initTemplates=function(){this.UniPriceRow=_.template("<tr data-university_id='<%= university_id %>' >\n    <td><%=name%></td>\n    <td class = 'rates'>$<%=weekday_price.toFixed(2)%></td>\n    <td class = 'rates'>$<%=weekend_price.toFixed(2)%></td>\n    <td><input class = 'uni-toggle' type='checkbox' <% if(enabled){print('checked');} %> />\n</tr>");return this.DateConflictNotice=
_.template('<li><i class = \'icon-warning-sign\'></i> Listing already featured at <%=name%> on <%\n    $.each(dates, function(index, date){\n        d = new Date(date)\n        if(index != dates.length-1)\n            print(d.getMonth()+1 + "-" + d.getDate() +"-"+ d.getFullYear() + ", ");\n        else\n            print(d.getMonth()+1 + "-" + d.getDate()+"-"+ d.getFullYear());\n    });\n    %></li>')};b.prototype.checkForDateConflicts=function(){var a,b,d,e,g,f,h,k,l,m,n,p;g=this.getDates("string");
a="";e=0;n=this.UniData;h=0;for(l=n.length;h<l;h++)if(f=n[h],f.enabled){d=[];p=f.unavailable_dates;k=0;for(m=p.length;k<m;k++)b=p[k],-1!==$.inArray(b,g)&&(d.push(b),b=new Date(b),b=b.getDay(),null!=b&&(b=(b+1)%7,e=0===b||6===b?e+f.weekend_price:e+f.weekday_price));0<d.length&&(a+=this.DateConflictNotice({name:f.name,dates:d}))}this.Widget.find(".DateConflicts").html(a);return e};b.prototype.refresh=function(){var a;this.updateDayCounts();this.updateRates();this.updatePrice();a=this.checkForDateConflicts();
this.Price-=a;$(this.Widget).find(".price").html(" $"+this.Price.toFixed(2));$(this.Widget).find(".weekdays").html(this.Weekdays);$(this.Widget).find(".weekends").html(this.Weekends);return this.Widget.trigger("orderItemChanged",this)};return b}()}).call(this);
