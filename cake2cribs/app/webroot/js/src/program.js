(function(){var y=[].indexOf||function(c){for(var a=0,b=this.length;a<b;a++)if(a in this&&this[a]===c)return a;return-1},B={}.hasOwnProperty,t=function(c,a){function b(){this.constructor=c}for(var e in a)B.call(a,e)&&(c[e]=a[e]);b.prototype=a.prototype;c.prototype=new b;c.__super__=a.prototype;return c},z=function(c,a){return function(){return c.apply(a,arguments)}};window.A2Cribs={};A2Cribs.Object=function(){function c(a,b){var e,d;this.class_name=null!=a?a:"object";for(e in b)d=b[e],null!=d&&(this[e]=
d)}c.prototype.Update=function(a){var b,e;for(b in a)e=a[b],null!=e&&(this[b]=e);return this};c.prototype.GetId=function(a){return parseInt(this[""+this.class_name+"_id"],10)};c.prototype.GetObject=function(){var a,b,e;b={};for(a in this)e=this[a],"function"!==typeof e&&("boolean"===typeof e&&(e=+e),b[a]=e);return b};c.prototype.IsComplete=function(){return!0};return c}();A2Cribs.MixPanel=function(){function c(){}var a,b;b=function(b){if(null!=b)return Math.min.apply(null,b)};a=function(b){if(null!=
b)return Math.min.apply(null,b)};c.Click=function(e,d){var c,f,h,k,l,m,n,p,r,q,s,u,x,v,A,t,N,D,H,I,E,F,C,J,K,L,w,G;if(!(void 0===e||null===e)){k=0;c=null;if("listing"===e.class_name)l=e,k=1*(r=parseInt(l.listing_id),0<=y.call(A2Cribs.FeaturedListings.FLListingIds,r)),c=l.available,m=A2Cribs.UserCache.Get("marker",l.marker_id);else if("marker"===e.class_name){m=e;c=A2Cribs.UserCache.GetAllAssociatedObjects("listing","marker",m.marker_id);r=0;for(u=c.length;r<u;r++)if(l=c[r],v=parseInt(l.listing_id),
0<=y.call(A2Cribs.FeaturedListings.FLListingIds,v)){k=1;break}c=m.available}else if("rental"===e.class_name)l=A2Cribs.UserCache.Get("listing",e.listing_id),k=1*(u=parseInt(l.listing_id),0<=y.call(A2Cribs.FeaturedListings.FLListingIds,u));else return!1;k={"listing type":null!=m?m.GetBuildingType():void 0,"display type":d,"is featured":k,listing_id:null!=l?l.GetId():void 0,marker_id:null!=m?m.GetId():void 0,available:c,university_id:null!=(F=A2Cribs.Map)?F.CurentSchoolId:void 0,"filter minimum beds":b(null!=
(C=A2Cribs.RentalFilter.FilterData)?C.Beds:void 0),"filter maximum beds":a(null!=(J=A2Cribs.RentalFilter.FilterData)?J.Beds:void 0),"filter minimum rent":null!=(K=A2Cribs.RentalFilter.FilterData)?null!=(L=K.Rent)?L.min:void 0:void 0,"filter maximum rent":null!=(w=A2Cribs.RentalFilter.FilterData)?null!=(G=w.Rent)?G.max:void 0:void 0,"filter start year":null!=(h=A2Cribs.RentalFilter.FilterData)?null!=(f=h.Dates)?f.year:void 0:void 0,"filter minimum lease length":null!=(q=A2Cribs.RentalFilter.FilterData)?
null!=(x=q.LeaseRange)?x.min:void 0:void 0,"filter maximum lease length":null!=(A=A2Cribs.RentalFilter.FilterData)?null!=(t=A.LeaseRange)?t.max:void 0:void 0,"filter building_type min":b,"filter building_type":b,"filter pets allowed":null!=(N=A2Cribs.RentalFilter.FilterData)?N.PetsAllowed:void 0,"filter parking available":null!=(D=A2Cribs.RentalFilter.FilterData)?D.ParkingAvailable:void 0,"filter air conditioning":null!=(H=A2Cribs.RentalFilter.FilterData)?H.Air:void 0,"filter utilities included":null!=
(I=A2Cribs.RentalFilter.FilterData)?I.UtilitiesIncluded:void 0};if(null!=(null!=(E=A2Cribs.RentalFilter.FilterData)?E.Beds:void 0)){A=A2Cribs.RentalFilter.FilterData.Beds;h=q=0;for(x=A.length;q<x;h=++q)f=A[h],k["filter bed "+h]=f}if(null!=(null!=(n=A2Cribs.RentalFilter.FilterData)?null!=(s=n.Dates)?s.months:void 0:void 0)){q=A2Cribs.RentalFilter.FilterData.Dates.months;h=s=0;for(f=q.length;s<f;h=++s)n=q[h],k["filter month "+h]=n}if(null!=(null!=(p=A2Cribs.RentalFilter.FilterData)?p.UnitTypes:void 0)){f=
A2Cribs.RentalFilter.FilterData.UnitTypes;h=n=0;for(s=f.length;n<s;h=++n)p=f[h],k["filter unit_type "+h]=p}return mixpanel.track("Listing Click",k)}};c.PostListing=function(b,a){return mixpanel.track("Post Listing - "+b,a)};c.AuthEvent=function(b,a){return mixpanel.track(b,a)};c.Event=function(b,a){return mixpanel.track(b,a)};return c}();A2Cribs.User=function(c){function a(b){a.__super__.constructor.call(this,"user",b)}t(a,c);a.prototype.GetId=function(){return this.id};return a}(A2Cribs.Object);
A2Cribs.Favorite=function(){return function(c,a,b){this.FavoriteId=c;this.ListingId=a;this.UserId=b}}();A2Cribs.Listing=function(c){function a(b){a.__super__.constructor.call(this,"listing",b)}t(a,c);a.prototype.IsVisible=function(b){null==b&&(b=null);"boolean"===typeof b&&(this.visible=b);return!1===this.visible?!1:!0};a.prototype.InSidebar=function(b){null==b&&(b=null);"boolean"===typeof b&&(this.in_sidebar=b);return!0===this.in_sidebar?!0:!1};a.prototype.IsFeatured=function(b){null==b&&(b=null);
"boolean"===typeof b&&(this.is_featured=b);return!0===this.is_featured?!0:!1};return a}(A2Cribs.Object);A2Cribs.Marker=function(c){function a(b){this.MarkerClicked=z(this.MarkerClicked,this);a.__super__.constructor.call(this,"marker",b)}var b,e;t(a,c);a.BuildingType=["House","Apartment","Duplex"];a.prototype.GetName=function(){return null!=this.alternate_name&&this.alternate_name.length?this.alternate_name:this.street_address};a.prototype.GetBuildingType=function(){return this.building_type_id};a.prototype.IsVisible=
function(b){var a,e;null==b&&(b=null);"boolean"===typeof b&&null!=(a=this.GMarker)&&a.setVisible(b);return null==this.GMarker?!1:null!=(e=this.GMarker)?e.getVisible():void 0};a.prototype.Init=function(b){this.available=null!=b?b:null;b=null==b?"unknown":!0===b?"available":"leased";this.GMarker=new google.maps.Marker({position:new google.maps.LatLng(this.latitude,this.longitude),icon:"/img/dots/dot_"+b+".png",id:this.GetId()});return google.maps.event.addListener(this.GMarker,"click",this.MarkerClicked)};
a.prototype.GetObject=function(){var b;b=a.__super__.GetObject.call(this);b.GMarker=null;return b};a.prototype.MarkerClicked=function(b){A2Cribs.MixPanel.Click(this,"small popup");return A2Cribs.HoverBubble.Open(this)};b=function(b){var a,e,c,k,l,m,n,p,r,q,s,u,x,v,A,t,y,D,H,I,E,F,C,J,K,L,w,G,B,z,M,O;if(void 0===b)return null;x=$("#houseCheck").is(":checked");a=$("#aptCheck").is(":checked");I=$("#otherCheck").is(":checked");A=$("#maleCheck").is(":checked");m=$("#femaleCheck").is(":checked");F=$("#studentsOnlyCheck").is(":checked");
n=$("#gradCheck").is(":checked");L=$("#undergradCheck").is(":checked");$("#acCheck").is(":checked");$("#parkingCheck").is(":checked");G=$("#utilitiesCheck").is(":checked");D=$("#noSecurityDepositCheck").is(":checked");y=A2Cribs.FilterManager.MinRent;t=A2Cribs.FilterManager.MaxRent;k=$("#bedsSelect").val();"2+"===k&&(k="2");k=parseInt(k);E=new Date(A2Cribs.FilterManager.DateBegin);l=new Date(A2Cribs.FilterManager.DateEnd);e=$("#bathSelect").val();z=[];M=0;for(O=b.length;M<O;M++)C=b[M],v=A2Cribs.Cache.IdToSubletMap[C],
w=v.BuildingType,K=new Date(v.StartDate),J=new Date(v.EndDate),p=A2Cribs.Cache.SubletIdToHousemateIdsMap[C],c=A2Cribs.Cache.IdToHousematesMap[p],u=r=p=q=!0,s=!1,void 0!==c&&null!==c&&(q="Male"===c.Gender||"Mix"===c.Gender||void 0===c.Gender||null===c.Gender,p="Female"===c.Gender||"Mix"===c.Gender||void 0===c.Gender||null===c.Gender,r="Graduate"===c.GradType||"Mix"===c.GradType||void 0===c.GradType||null===c.GradType,u="Undergraduate"===c.GradType||"Mix"===c.GradType||void 0===c.GradType||null===c.GradType,
s=!0===c.Enrolled||void 0===c.Enrolled||null===c.Enrolled),c=v.BathroomType===e||"Private"!==e&&"Shared"!==e,B=!G||G&&0===v.UtilityCost,H=!D||D&&0===v.DepositAmount,(("House"===w||null===w)&&x||("Apartment"===w||null===w)&&a||("Duplex"===w||null===w)&&I||"House"!==w&&"Duplex"!==w&&"Apartment"!==w)&&(v.PricePerBedroom>=y&&v.PricePerBedroom<=t&&v.Bedrooms>=k&&(E>=K||!A2Cribs.Marker.IsValidDate(E))&&(J>=l||!A2Cribs.Marker.IsValidDate(l))&&(m&&p||A&&q)&&(L&&u||n&&r)&&(!F||F&&s)&&c&&B&&H)&&z.push(C);return z};
e=function(b){var a,e;if(!this.Clicked){a=0;for(e=b.length;a<e;a++)A2Cribs.UserCache.Set(A2Cribs.Listing(JSON.parse(b)));b=A2Cribs.UserCache.Get("marker",this.MarkerId);b.GMarker.setIcon("/img/dots/clicked_dot.png")}this.Clicked=!0;return this.FilterVisibleListingsAndOpenPopup()};a.prototype.LoadMarkerData=function(){this.CorrectTooltipLocation();return this.Clicked?this.FilterVisibleListingsAndOpenPopup():$.ajax({url:myBaseUrl+"Listings/LoadMarkerData/"+this.MarkerId,type:"GET",context:this,success:e})};
a.prototype.FilterVisibleListingsAndOpenPopup=function(){var a;a=b(A2Cribs.Cache.MarkerIdToSubletIdsMap[this.MarkerId]);return A2Cribs.Map.ClickBubble.Open(this,a)};a.GetMarkerPixelCoordinates=function(b){var a,e,c;a=A2Cribs.Map.GMap;c=Math.pow(2,a.getZoom());e=new google.maps.LatLng(a.getBounds().getNorthEast().lat(),a.getBounds().getSouthWest().lng());e=a.getProjection().fromLatLngToPoint(e);b=a.getProjection().fromLatLngToPoint(b);return new google.maps.Point(Math.floor((b.x-e.x)*c),Math.floor((b.y-
e.y)*c))};a.prototype.CorrectTooltipLocation=function(){var b,a,e,c;e=A2Cribs.Map.Bounds.CONTROL_BOX_LEFT;c=A2Cribs.Marker.GetMarkerPixelCoordinates(this.GMarker.position);a=b=0;c.x+A2Cribs.MarkerTooltip.Width-A2Cribs.MarkerTooltip.ArrowOffset+A2Cribs.MarkerTooltip.Padding>A2Cribs.Map.Bounds.RIGHT&&(b=c.x+A2Cribs.MarkerTooltip.Width-A2Cribs.MarkerTooltip.ArrowOffset+A2Cribs.MarkerTooltip.Padding-A2Cribs.Map.Bounds.RIGHT);c.x-A2Cribs.MarkerTooltip.ArrowOffset-A2Cribs.MarkerTooltip.Padding<e&&(b=c.x-
A2Cribs.MarkerTooltip.ArrowOffset-A2Cribs.MarkerTooltip.Padding-e);0>c.y-A2Cribs.MarkerTooltip.Height-A2Cribs.MarkerTooltip.ArrowHeight&&(a=c.y-A2Cribs.MarkerTooltip.Height-A2Cribs.MarkerTooltip.ArrowHeight);c.y>A2Cribs.Map.Bounds.BOTTOM-A2Cribs.MarkerTooltip.Padding&&(a=c.y-A2Cribs.Map.Bounds.BOTTOM+A2Cribs.MarkerTooltip.Padding);return A2Cribs.Map.GMap.panBy(b,a)};a.IsValidDate=function(b){return"Invalid Date"!==b.toString()};return a}(A2Cribs.Object);A2Cribs.FavoritesManager=function(){function c(){}
c.FavoritesListingIds=[];c.FavoritesVisible=!1;c.AddFavorite=function(a,b){return $.ajax({url:myBaseUrl+"Favorites/AddFavorite/"+a,type:"POST",context:this,success:function(e){return A2Cribs.FavoritesManager.AddFavoriteCallback(e,a,b)}})};c.AddFavoriteCallback=function(a,b,e){a=JSON.parse(a);if(void 0===a.success)return void 0!==a.error.message?A2Cribs.UIManager.Alert(a.error.message):A2Cribs.UIManager.Alert("There was an error adding your favorite. Contact help@cribspot.com if the error persists.");
this.FavoritesListingIds.push(b);a=$("#fl-sb-item-"+b);1===a.length&&(a.find(".favorite").attr("onclick","A2Cribs.FavoritesManager.DeleteFavorite("+b+", this);"),a.find(".favorite").attr("title","Delete from Favorites"),a.find(".favorite").addClass("active"));null!=e&&($(e).attr("onclick","A2Cribs.FavoritesManager.DeleteFavorite("+b+", this);"),$(e).attr("title","Delete from Favorites"),$(e).addClass("active"));return this._setFavoriteCount()};c.DeleteFavorite=function(a,b){return $.ajax({url:myBaseUrl+
"Favorites/DeleteFavorite/"+a,type:"POST",context:this,success:function(e){return A2Cribs.FavoritesManager.DeleteFavoriteCallback(e,a,b)}})};c.DeleteFavoriteCallback=function(a,b,e){a=JSON.parse(a);if(void 0!==a.error)return A2Cribs.UIManager.Alert(a.error.message);a=A2Cribs.FavoritesManager.FavoritesListingIds.indexOf(b);-1!==a&&A2Cribs.FavoritesManager.FavoritesListingIds.splice(a);a=$("#fl-sb-item-"+b);1===a.length&&(a.find(".favorite").attr("onclick","A2Cribs.FavoritesManager.AddFavorite("+b+
", this);"),a.find(".favorite").attr("title","Add to Favorites"),a.find(".favorite").removeClass("active"));if(null!=e)return $(e).attr("onclick","A2Cribs.FavoritesManager.AddFavorite("+b+", this);"),$(e).attr("title","Add to Favorites"),$(e).removeClass("active"),this._setFavoriteCount()};c.InitializeFavorites=function(a){var b,e,d;e=0;for(d=a.length;e<d;e++)b=a[e],A2Cribs.FavoritesManager.FavoritesListingIds.push(parseInt(b));return this._setFavoriteCount()};c.LoadFavorites=function(){var a=this;
return $.ajax({url:myBaseUrl+"Favorites/LoadFavorites",type:"GET",context:this,success:function(b){if(null!=b)return a.InitializeFavorites(JSON.parse(b))}})};c.ToggleFavoritesVisibility=function(a){A2Cribs.Map.ToggleListingVisibility(A2Cribs.FavoritesManager.FavoritesListingIds,A2Cribs.FavoritesManager.FavoritesVisible,a);A2Cribs.FavoritesManager.FavoritesVisible=!A2Cribs.FavoritesManager.FavoritesVisible;if(A2Cribs.FavoritesManager.FavoritesVisible)return $("#FavoritesHeaderIcon").addClass("pressed"),
A2Cribs.Map.IsCluster(!1);$("#FavoritesHeaderIcon").removeClass("pressed");return A2Cribs.Map.IsCluster(!0)};c.FavoritesVisibilityIsOn=function(){return $("#FavoritesHeaderIcon").hasClass("pressed")};c.setFavoriteButton=function(a,b,e){if(-1===e.indexOf(parseInt(b,10)))return a.attr("onclick","A2Cribs.FavoritesManager.AddFavorite("+b+", this)"),a.removeClass("active");a.attr("onclick","A2Cribs.FavoritesManager.DeleteFavorite("+b+", this)");return a.addClass("active")};c._insertIntoFavoriteDiv=function(a){var b,
e;1===this.FavoritesCache.size&&$("#noFavorites").hide();b=A2Cribs.Map.IdToMarkerMap[A2Cribs.Map.IdToSubletMap[a].MarkerId];e=b.Title?b.Title:b.Address;b=$("#favoriteTemplate");b.find(".favoriteDiv").attr({id:"favoriteDiv"+a});b.find(".favoritesAddress").html(e);b.find(".removeButton").attr({onclick:"A2Cribs.FavoritesManager.DeleteFavorite("+a+")"});b.find("a").attr({href:listing.Url});b.find("#price").html(listing.Rent?"$"+listing.Rent:"???");b.find("#beds").html(listing.Beds+(1<listing.Beds?" Beds":
" Bed"));b.find("#baths").html(listing.Baths+(1<listing.Baths?" Baths":" Bath"));b.find("#payMonth").html(listing.LeaseRange);b.find("#aptType").html(listing.UnitType);b.find("#electric").find("div").addClass(listing.Electric?"electric_selected":"electric_unselected");b.find("#heat").find("div").addClass(listing.Heat?"heat_selected":"heat_unselected");b.find("#water").find("div").addClass(listing.Water?"water_selected":"water_unselected");b.find("#furnished").find("div").addClass(listing.Furnished?
"furnished_selected":"furnished_unselected");b.find("#parking").find("div").addClass(listing.Parking?"parking_selected":"parking_unselected");b.find("#ac").find("div").addClass(listing.Air?"ac_selected":"ac_unselected");a=$("#favoriteTemplate").html();return $("#personalFavoritesList").append(a)};c._setFavoriteCount=function(){return 0===this.FavoritesListingIds.length?$(".favorite_count").hide():$(".favorite_count").show().text(this.FavoritesListingIds.length)};c._removeFromFavoriteDiv=function(a){$("#personalFavoritesList").find("#favoriteDiv"+
a).remove();if(0===this.FavoritesCache.size)return $("#noFavorites").show()};c._insertFavoriteCache=function(a){this.FavoritesCache[a]=!0;++this.FavoritesCache.size;return $("#numFavorites").html(this.FavoritesCache.size)};c._removeFavoriteCache=function(a){this.FavoritesCache[a]=null;--this.FavoritesCache.size;return $("#numFavorites").html(this.FavoritesCache.size)};return c}();A2Cribs.FacebookManager=function(){function c(){}c.FacebookLogin=function(){var a;a="https://www.facebook.com/dialog/oauth?client_id=450938858319396&redirect_uri=https://www.cribspot.com/login";
a+="&scope=email";A2Cribs.MixPanel.AuthEvent("login",{source:"facebook"});return window.location.href=a};c.FacebookJSLogin=function(){return FB.getLoginStatus(function(a){return"connected"===a.status?null!=a&&null!=a.authResponse?A2Cribs.FacebookManager.AttemptLogin(a.authResponse):A2Cribs.UIManager.Error("We're having trouble logging you in with facebook, but don't worry!\t\t\t\t\tYou can still create an account with our regular login."):FB.login(function(b){return null!=b&&null!=b.authResponse?
A2Cribs.FacebookManager.AttemptLogin(b.authResponse):A2Cribs.UIManager.Error("We're having trouble logging you in with facebook, but don't worry!\t\t\t\t\t\tYou can still create an account with our regular login.")},{scope:"email"})})};c.AttemptLogin=function(a){return $.ajax({url:myBaseUrl+"Users/AttemptFacebookLogin",data:a,type:"POST",success:function(b){return console.log(b)},error:function(b){return console.log(b)}})};c.Logout=function(){alert("logging out");return $.ajax({url:myBaseUrl+"Users/Logout",
type:"GET"})};c.Login=function(){return alert("logging in")};c.JSLogin=function(){return FB.login(A2Cribs.FacebookManager.JSLoginCallback)};c.JSLoginCallback=function(a){return a.authResponse?(FB.api("/me",A2Cribs.FacebookManager.APICallback),$.ajax({url:myBaseUrl+"Verify/FacebookVerify",type:"POST"})):alert("failed")};c.FindMutualFriends=function(){var a;a="SELECT uid, first_name, last_name, pic_small FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = me()) AND uid IN (SELECT uid2 FROM friend WHERE uid1 = "+
$("#userid_input").val()+")";return FB.api({method:"fql.query",query:a},A2Cribs.FacebookManager.FindMutualFriendsCallback)};c.FindMutualFriendsCallback=function(a){return $("#numMutualFriendsVal").html(a.length)};c.APICallback=function(a){console.log(a);$(".facebook.unverified").toggleClass("unverified verified");return $(".facebook.verified").html(a.name+" is now verified.")};c.UpdateLinkedinLogin=function(a){$(".linkedin.unverified").toggleClass("unverified verified");$(".linkedin.verified").html(a.values[0].firstName+
" "+a.values[0].lastName+" is now verified.");return $.ajax({url:myBaseUrl+"Verify/LinkedinVerify",type:"POST"})};c.SubmitEmail=function(){var a,b;a=$("#emailInput").val();if(-1===a.search(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i))alert("Email address is invalid");else if(a=a.substring(a.indexOf("@")+1),b=a.substring(a.indexOf(".")+1),"edu"===b.toLowerCase())return $("#emailEduVerified").toggleClass("unverified verified"),$("#emailEduVerified").html("Verified edu email ("+a.substring(0,a.length-
4).toLowerCase()+")")};return c}();A2Cribs.UtilityFunctions=function(){function c(){}c.getPosition=function(a){var b,e;for(e=b=0;a;)b+=a.offsetLeft,e+=a.offsetTop,a=a.offsetParent;return{x:b,y:e}};c.GetFormattedDate=function(a){var b,e;e=a.getUTCFullYear();b=a.getMonth()+1;a=a.getDate();return e+"-"+b+"-"+a};c.getDateRange=function(a,b){Date.prototype.addDays=function(b){var a=new Date(this.valueOf());a.setDate(a.getDate()+b);return a};var e,d;d=[];for(e=a;e<=b;)d.push(e),e=e.addDays(1);return d};
return c}();A2Cribs.CorrectMarker=function(){function c(){}c.Map=null;c.Marker=null;c.Geocoder=null;c.Enabled=!0;c.Init=function(){var a;this.LoadUniversities();a=$("#post-sublet-modal").find("#correctLocationMap")[0];this.CreateMap(a,42.2808256,-83.7430378);return this.Geocoder=new google.maps.Geocoder};c.CreateMap=function(a,b,e,d,c){null==d&&(d=!1);null==c&&(c=!0);b=new google.maps.LatLng(b,e);this.Map=new google.maps.Map(a,{zoom:15,center:b,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,
panControl:!1,zoomControl:!1,streetViewControl:!1});this.Marker=new google.maps.Marker({draggable:c,position:b,map:A2Cribs.CorrectMarker.Map,visible:d});c||this.Disable();return google.maps.event.trigger(this.Map,"resize")};c.Disable=function(){return null!=this.Map?this.Map.setOptions({draggable:!1,zoomControl:!1,scrollwheel:!1,disableDoubleClickZoom:!0}):this.Enabled=!1};c.Enable=function(){return null!=this.Map?this.Map.setOptions({draggable:!0,zoomControl:!0,scrollwheel:!0,disableDoubleClickZoom:!1}):
this.Enabled=!0};c.UpdateLatLong=function(a){$("#updatedLat").html(a.latLng.lat());return $("#updatedLong").html(a.latLng.lng())};c.AddressSearchCallback=function(a,b){var e,d,c,f,h,k,l,m,n,p,r,q,s;console.log(a);if(b===google.maps.GeocoderStatus.OK&&2<=a[0].address_components.length){c=e=f=h=null;l="00000";q=a[0].address_components;m=0;for(p=q.length;m<p;m++){d=q[m];s=d.types;n=0;for(r=s.length;n<r;n++)k=s[n],"street_number"===k?h=d.short_name:"route"===k?f=d.short_name:"locality"===k?e=d.short_name:
"administrative_area_level_1"===k?c=d.short_name:"postal_code"===k&&(l=d.short_name)}if(null===h)A2Cribs.UIManager.Alert("Entered street address is not valid."),$("#formattedAddress").text("");else return A2Cribs.CorrectMarker.Map.panTo(a[0].geometry.location),A2Cribs.CorrectMarker.Map.setZoom(18),$("#formattedAddress").val(h+" "+f),$("#city").val(e),$("#state").val(c),$("#postal").val(l),A2Cribs.CorrectMarker.Marker.setPosition(a[0].geometry.location),A2Cribs.CorrectMarker.Marker.setVisible(!0),
google.maps.event.addListener(A2Cribs.CorrectMarker.Marker,"dragend",A2Cribs.CorrectMarker.UpdateLatLong),$("#updatedLat").val(a[0].geometry.location.lat()),$("#updatedLong").val(a[0].geometry.location.lng())}};c.CenterMap=function(a,b){return this.Map.setCenter(new google.maps.LatLng(a,b))};c.SetMarkerAtPosition=function(a){return A2Cribs.CorrectMarker.Marker.setPosition(a)};c.FindAddress=function(){var a,b;a=$("#formattedAddress").val();A2Cribs.CorrectMarker.Map.getCenter();return void 0!==A2Cribs.CorrectMarker.SelectedUniversity?
(b=A2Cribs.CorrectMarker.SelectedUniversity,A2Cribs.CorrectMarker.Geocoder.geocode({address:a+" "+b.city+", "+b.state},A2Cribs.CorrectMarker.AddressSearchCallback)):A2Cribs.UIManager.Alert("Please select a university.")};c.FindSelectedUniversity=function(){var a,b;a=$("#universityName").val();a=this.SchoolList.indexOf(a);if(0<=a)return A2Cribs.CorrectMarker.SelectedUniversity=this.universitiesMap[a].University,A2Cribs.Cache.SelectedUniversity=this.universitiesMap[a].University,b=A2Cribs.CorrectMarker.SelectedUniversity,
A2Cribs.CorrectMarker.CenterMap(b.latitude,b.longitude),$("#universityId").val(A2Cribs.CorrectMarker.SchoolIDList[a])};c.LoadUniversities=function(){return $.ajax({url:"/University/getAll",success:function(a){var b,e,d;A2Cribs.CorrectMarker.universitiesMap=JSON.parse(a);A2Cribs.CorrectMarker.SchoolList=[];A2Cribs.CorrectMarker.SchoolIDList=[];d=A2Cribs.CorrectMarker.universitiesMap;b=0;for(e=d.length;b<e;b++)a=d[b],A2Cribs.CorrectMarker.SchoolList.push(a.University.name),A2Cribs.CorrectMarker.SchoolIDList.push(a.University.id);
return $("#universityName").typeahead({source:A2Cribs.CorrectMarker.SchoolList})}})};c.ClearMarker=function(){if(null!=A2Cribs.CorrectMarker.Marker)return A2Cribs.CorrectMarker.Marker.setVisible(!1)};return c}();A2Cribs.PhotoManager=function(){function c(b){var e=this;this.div=b;this.SetupUI();this.CurrentPrimaryImage=0;this.CurrentImageLoading=this.CurrentPreviewImage=null;this.Photos=[];this.div.find(".imageContainer").each(function(b,c){return e.Photos.push(new a($(c)))});this.MAX_CAPTION_LENGTH=
25;this.BACKSPACE=8}var a;a=function(){function b(b){this._div=b;this._imageId=-1;this._isEmpty=!0;this._isPrimary=!1;this._path=this._caption="";this._preview=null}b.prototype.LoadPhoto=function(a,d,c,f){this._imageId=a;this._path=d;this._caption=c;this._isEmpty=!1;this._preview="<img src='"+b.ProcessImagePath(this._path)+"'></img>";this._div.find(".imageContent").html(this._preview);return this.SetPrimary(f)};b.prototype.CreatePreview=function(a){var d=this;this._file=a;if(b.IsAcceptableFileType(this._file.name))return this._isEmpty=
!1,a=new FileReader,a.onloadend=function(b){"object"===typeof b&&(b=b.target.result);d._preview="<img src='"+b+"'></img>";return d._div.find(".imageContent").html(d._preview)},a.readAsDataURL(this._file)};b.prototype.GetPreview=function(){return this._preview};b.prototype.SaveCaption=function(b){return this._caption=b};b.prototype.GetCaption=function(){return this._caption};b.prototype.GetImageId=function(){return this._imageId};b.prototype.IsPrimary=function(){return this._isPrimary};b.prototype.SetPrimary=
function(b){return(this._isPrimary=b)?this._div.find(".primary").addClass("cur-primary"):this._div.find(".primary").removeClass("cur-primary")};b.prototype.SetId=function(b){return this._imageId=b};b.prototype.SetPath=function(b){return this._path=b};b.prototype.SetListingId=function(b){return this._listing_id=b};b.prototype.IsEmpty=function(){return this._isEmpty};b.prototype.Reset=function(){this._isEmpty=!0;this._div.find(".imageContent").html('<div class="img-place-holder"></div>');this._div.find(".image-actions-container").hide();
this._isPrimary=!1;this._path=this._caption="";return this._preview=null};b.prototype.GetObject=function(){return{image_id:this._imageId,caption:this._caption,is_primary:+this._isPrimary,image_path:this._path,listing_id:this._listing_id}};b.ProcessImagePath=function(b){var a;a=b.substr(0,b.lastIndexOf("/"));b="med_"+b.substr(b.lastIndexOf("/")+1);return a+"/"+b};b.IsAcceptableFileType=function(b){var a;a=b.indexOf(".",b.length-4);if(-1===a)return!1;b=b.substring(a+1).toLowerCase();if("jpg"===b||"jpeg"===
b||"png"===b)return!0;A2Cribs.UIManager.Alert("Not a valid file type. Valid file types include 'jpg', jpeg', or 'png'.");return!1};return b}();c.NUM_PREVIEWS=6;c.prototype.UploadImageDefer=function(){this.UploadCompleteDeferred=new $.Deferred;return this.UploadCompletePromise=this.UploadCompleteDeferred.promise()};c.prototype.SetupUI=function(){var b=this;this.div.find(".imageContainer").hover(function(b){if(1===$(b.currentTarget).find("img").length)return"mouseenter"===b.type?$(b.currentTarget).find(".image-actions-container").show():
$(b.currentTarget).find(".image-actions-container").hide()});this.div.find("#upload_image").click(function(){return b.div.find("#real-file-input").click()});this.div.find(".imageContent").click(function(a){a=+a.currentTarget.id.match(/\d+/g)[0];return b.EditImage(a-1)});this.div.find(".edit").click(function(a){a=+a.currentTarget.id.match(/\d+/g)[0];return b.EditImage(a-1)});this.div.find(".delete").click(function(a){a=+a.currentTarget.id.match(/\d+/g)[0];return b.DeleteImage(a-1)});this.div.find(".primary").click(function(a){a=
+a.currentTarget.id.match(/\d+/g)[0];return b.MakePrimary(a-1)});this.div.find("#captionInput").keyup(function(){var a;a=b.div.find("#captionInput").val();a.length===b.MAX_CAPTION_LENGTH?b.div.find("#charactersLeft").css("color","red"):b.div.find("#charactersLeft").css("color","black");b.div.find("#charactersLeft").html(b.MAX_CAPTION_LENGTH-a.length);if(null!=b.CurrentPreviewImage)return b.Photos[b.CurrentPreviewImage].SaveCaption(b.div.find("#captionInput").val())});this.div.find(".delete").tooltip({selector:"",
placement:"bottom",title:"Delete"});this.div.find(".edit").tooltip({selector:"",placement:"bottom",title:"Edit"});this.div.find(".primary").tooltip({selector:"",placement:"bottom",title:"Make Primary"});return this.div.find("#ImageAddForm").fileupload({url:myBaseUrl+"images/AddImage",dataType:"json",acceptFileTypes:/(\.|\/)(jpeg|jpg|png)$/i,singleFileUploads:!0,maxFileSize:5E6,loadImageMaxFileSize:5E6,disableImageResize:!1,previewMaxWidth:100,previewMaxHeight:100,previewCrop:!0}).on("fileuploadsend",
function(a,d){if(-1===d.files[0].type.indexOf("image"))return A2Cribs.UIManager.Error("Sorry - Please only upload png, jpeg or jpg!"),!1;if(5E6<d.files[0].size)return A2Cribs.UIManager.Error("Sorry - the image you uploaded was too large!"),!1;if(-1===b.NextAvailablePhoto())return A2Cribs.UIManager.Error("Sorry - you can't upload more than 6 photos at this time."),!1;b.UploadImageDefer();b.div.find("#upload_image").button("loading");0<=(b.CurrentImageLoading=b.NextAvailablePhoto())&&(null!=d.files&&
null!=d.files[0])&&b.Photos[b.CurrentImageLoading].CreatePreview(d.files[0],b.div.find("#imageContent"+(b.CurrentImageLoading+1)));return!0}).on("fileuploaddone",function(a,d){b.div.find("#upload_image").button("reset");if(null!=d.result.errors&&d.result.errors.length)return A2Cribs.UIManager.Error("Failed to upload image!"),b.UploadCompleteDeferred.resolve(null),b.Photos[b.CurrentImageLoading].Reset();b.Photos[b.CurrentImageLoading].SetId(d.result.image_id);b.Photos[b.CurrentImageLoading].SetPath(d.result.image_path);
1===b.PhotoCount()&&b.MakePrimary(b.CurrentImageLoading);return b.UploadCompleteDeferred.resolve(!0)}).on("fileuploadfail",function(a,d){if(b.CurrentImageLoading)return A2Cribs.UIManager.Error("Failed to upload image!"),b.div.find("#upload_image").button("reset"),b.Photos[b.CurrentImageLoading].Reset()})};c.prototype.LoadImages=function(b,a,d){var c,f,h,k=this;this.Reset();if(null!=(null!=b?b.length:void 0)){f=0;for(h=b.length;f<h;f++)c=b[f],this.Photos[this.NextAvailablePhoto()].LoadPhoto(c.image_id,
c.image_path,c.caption,c.is_primary)}this.div.find("#finish_photo").unbind("click");return this.div.find("#finish_photo").click(function(){k.div.modal("hide");return $.when(k.UploadCompletePromise).then(function(b){if(b)return d(a,k.GetPhotos())})})};c.prototype.NextAvailablePhoto=function(){var b,a,d,c,f;f=this.Photos;b=d=0;for(c=f.length;d<c;b=++d)if(a=f[b],a.IsEmpty())return b;return-1};c.prototype.PhotoCount=function(){var b,a,d,c,f;b=0;f=this.Photos;a=d=0;for(c=f.length;d<c;a=++d)a=f[a],a.IsEmpty()||
(b+=1);return b};c.prototype.DeleteImage=function(b){var a=this;return $.ajax({url:myBaseUrl+"images/delete/"+this.Photos[b].GetImageId(),type:"GET",success:function(){var d,c,f,h,k;a.Photos[b].Reset();if(b===a.CurrentPrimaryImage){k=a.Photos;d=f=0;for(h=k.length;f<h;d=++f)c=k[d],c.IsEmpty()||a.MakePrimary(d)}if(b===a.CurrentPreviewImage)return a.div.find("#imageContent0").html('<div class="img-place-holder"></div>')}})};c.prototype.EditImage=function(b){if(!this.Photos[b].IsEmpty())return this.CurrentPreviewImage=
b,this.div.find("#imageContent0").html(this.Photos[b].GetPreview()),this.div.find("#captionInput").val(this.Photos[b].GetCaption()),this.div.find("#charactersLeft").html(this.MAX_CAPTION_LENGTH-this.Photos[b].GetCaption().length)};c.prototype.MakePrimary=function(b){this.Photos[this.CurrentPrimaryImage].SetPrimary(!1);return this.Photos[this.CurrentPrimaryImage=b].SetPrimary(!0)};c.prototype.Reset=function(){var b,a,d,c,f;this.div.find("#imageContent0").html('<div class="img-place-holder"></div>');
this.div.find("#captionInput").val("");this.div.find("#charactersLeft").html(this.MAX_CAPTION_LENGTH);c=this.Photos;f=[];a=0;for(d=c.length;a<d;a++)b=c[a],f.push(b.Reset());return f};c.prototype.GetPhotos=function(){var b,a,d,c,f;a=[];f=this.Photos;d=0;for(c=f.length;d<c;d++)b=f[d],b.IsEmpty()||a.push(b.GetObject());return 0===a.length?null:a};c.SubmitPhoto=function(b,a){return $.ajax({url:myBaseUrl+"images/AddImage/"+b+"/"+a,type:"POST",success:function(b){b=JSON.parse(b);return console.log(b)}})};
return c}.call(this);A2Cribs.ShareManager=function(){function c(){}c.GetShareUrl=function(a,b,e,d,c){if(null===a||null===b||null===e||null===d||null===c)return null;b.split(" ").join("-");e.split(" ").join("-");return"https://cribspot.com/listing/"+a};c.ShareListingOnFacebook=function(a,b,e,d,c,f,h){null==f&&(f=null);null==h&&(h=null);e=this.GetShareUrl(a,b,e,d,c);a="Check out this listing on Cribspot!";null===h?h=b:a=b;b={method:"feed",link:e,picture:"https://s3-us-west-2.amazonaws.com/cribspot-img/upright_logo.png",
name:h,caption:a};null!==f&&(b.description=f);return FB.ui(b)};c.ShareOnFacebook=function(){return FB.ui({method:"feed",link:"https://cribspot.com/",picture:"https://s3-us-west-2.amazonaws.com/cribspot-img/upright_logo.png",name:"Join Cribspot",caption:"It's a party!",description:"Make your life easier...use Cribspot. Search off-campus houses and apartments quickly."})};c.CopyListingUrl=function(a,b,e,d,c){a=this.GetShareUrl(a,b,e,d,c);return window.prompt("Copy to clipboard: Ctrl+C, Enter",a)};c.ShareListingOnTwitter=
function(a,b,e,d,c){a=this.GetTwitterShareUrl(a,b,e,d,c);return window.open(a,"winname","directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=600,height=350,top="+(screen.height/2-175)+",left="+(screen.width/2-300))};c.GetTwitterShareUrl=function(a,b,e,d,c){if(null===a||null===b||null===e||null===d||null===c)return null;a=this.GetShareUrl(a,b,e,d,c);return"https://twitter.com/share?url="+encodeURIComponent(a)+"&text="+encodeURIComponent("Check out this listing on Cribspot!")+
"&via=TheCribspot"};c.InitTweetButton=function(a,b,e,d,c){if(null===a||null===b||null===e||null===d||null===c)return null;a=this.GetShareUrl(a,b,e,d,c);$("#twitterDiv iframe").remove();a=$("<a></a>").addClass("twitter-share-button").attr("href","https://twitter.com/share").attr("data-url",a).attr("data-text","Check out this awesome property on Cribspot.com! "+a).attr("data-via","TheCribspot");$("#twitterDiv").append(a);return twttr.widgets.load()};$("#header").ready(function(){return $(".share_on_fb").click(function(){return c.ShareOnFacebook()})});
return c}.call(this);A2Cribs.HoverBubble=function(){function c(){}c.Init=function(a){this.template=$(".hover-bubble:first").parent();this.InfoBubble=new InfoBubble({map:a,arrowStyle:0,arrowPosition:20,shadowStyle:0,borderRadius:5,arrowSize:17,borderWidth:0,disableAutoPan:!0,padding:0,disableAnimation:!0});this.InfoBubble.hideCloseButton();this.InfoBubble.setBackgroundClassName("map_bubble");return this.template.find(".close_button").attr("onclick","A2Cribs.HoverBubble.Close();")};c.Open=function(a){var b;
this.Close();null!=(b=A2Cribs.ClickBubble)&&b.Close();if(null!=a)return a.IsVisible(!0),this.SetContent(a),b=A2Cribs.ClickBubble.ConvertLatLongToPixels(a.GMarker.getPosition()),b=A2Cribs.ClickBubble.GetAdjustedClickBubblePosition(b.x,b.y),A2Cribs.Map.GMap.panBy(b.x,b.y),this.InfoBubble.open(A2Cribs.Map.GMap,a.GMarker)};c.Refresh=function(){return this.InfoBubble.open()};c.Close=function(){return this.InfoBubble.close()};c.SetContent=function(a){var b,e,d,c,f,h,k,l,m,n;h=A2Cribs.UserCache.GetAllAssociatedObjects("listing",
"marker",a.GetId());this.template.find(".building_type").text(a.GetBuildingType());this.template.find(".unit_div").empty();k=h.sort(function(b,a){var e,d;e=A2Cribs.UserCache.Get(A2Cribs.Map.ACTIVE_LISTING_TYPE,b.GetId());d=A2Cribs.UserCache.Get(A2Cribs.Map.ACTIVE_LISTING_TYPE,a.GetId());return null==e.rent&&null==d.rent?0:null!=e.rent&&null==d.rent?1:null==e.rent&&null!=d.rent?-1:parseInt(e.rent,10)-parseInt(d.rent,10)});m=0;for(n=k.length;m<n;m++)if(a=k[m],a.InSidebar()||a.IsVisible())f=A2Cribs.UserCache.Get(A2Cribs.Map.ACTIVE_LISTING_TYPE,
a.GetId()),b=function(){var b;b=[];for(c in h)b.push(c);return b}(),b.sort(function(b,a){return h[a]-h[b]}),e=f.beds,d="Beds",null==f.beds?e="??":0===parseInt(f.beds,10)?(e="Studio",d=""):1===parseInt(f.beds,10)&&(d="Bed"),b="unknown",null!=a.available&&!0===a.available?b="available":null!=a.available&&!0!==a.available&&(b="leased"),l=$("<div />",{"class":"unit"}),l.attr("onclick","A2Cribs.ClickBubble.Open("+a.GetId()+")"),$("<div />",{"class":"dot "+b}).appendTo(l),$("<div />",{"class":"beds",text:e}).appendTo(l),
$("<div />",{"class":"bed_desc",text:d}).appendTo(l),$("<div />",{"class":"rent",text:null!=f.rent&&0!==parseInt(f.rent,10)?"$"+f.rent:"Contact"}).appendTo(l),this.template.find(".unit_div").append(l);return this.InfoBubble.setContent(this.template.html())};c.resolveDate=function(a,b){var e,d;d=a.split("-");e=b.split("-");return+d[1]+"/"+ +d[2]+"-"+ +e[1]+"/"+ +e[2]};return c}();A2Cribs.ClickBubble=function(){function c(){}var a;c.OFFSET={TOP:-190,LEFT:140};c.PADDING=50;c.IsOpen=!1;a=function(b){var a;
b=A2Cribs.UserCache.Get("listing",b);b=A2Cribs.UserCache.Get("marker",b.marker_id);a=null;null!=b&&null!=b.GMarker?a=b.GMarker.getPosition():null!=b&&new google.maps.LatLng(b.latitude,b.longitude);if(null!==a)return b=c.ConvertLatLongToPixels(a),c.div.css("left",b.x+c.OFFSET.LEFT),c.div.css("top",b.y+c.OFFSET.TOP)};c.ConvertLatLongToPixels=function(b){var a,d,c;d=Math.pow(2,this.map.getZoom());a=new google.maps.LatLng(this.map.getBounds().getNorthEast().lat(),this.map.getBounds().getSouthWest().lng());
a=this.map.getProjection().fromLatLngToPoint(a);c=this.map.getProjection().fromLatLngToPoint(b);b={};b.x=Math.floor((c.x-a.x)*d);b.y=Math.floor((c.y-a.y)*d);return b};c.Init=function(b){var a=this;this.map=b;this.div=$(".click-bubble:first");return this.div.find(".close_button").click(function(){return a.Close()})};c.Open=function(b){var a,d=this;this.IsOpen=!0;a=new $.Deferred;null!=b&&($("#loader").show(),A2Cribs.UserCache.GetListing(A2Cribs.Map.ACTIVE_LISTING_TYPE,b).done(function(c){A2Cribs.MixPanel.Click(c,
"large popup");d.SetContent(c.GetObject());d.Show(b);return a.resolve(b)}).fail(function(){return A2Cribs.UIManager.Error("Sorry - We could not find this listing!")}).always(function(){return $("#loader").hide()}));return a.promise()};c.Show=function(b){this.IsOpen=!0;a(b);return this.div.show("fade")};c.Refresh=function(){return this.div.show("fade")};c.Close=function(){this.IsOpen=!1;return this.div.hide("fade")};c.Clear=function(){return this.div.find(".clear_field").text("?").html("?").val("?")};
c.SetContent=function(b){var a,d,c;this.Clear();for(a in b)c=b[a],this.div.find("."+a).text(c);this.div.find(".date_range").text(this.resolveDateRange(b.start_date));d=A2Cribs.UserCache.Get("marker",A2Cribs.UserCache.Get("listing",b.listing_id).marker_id);this.div.find(".building_name").text(d.GetName());this.div.find(".unit_type").text(d.GetBuildingType());a="";null!=b.unit_style_options&&null!=b.unit_style_description?a=b.unit_style_options+"-"+b.unit_style_description:"Entire House"===b.unit_style_options&&
(a="Entire House");this.div.find(".unit_style_description").text(a);this.div.find("unit_style_description").text;this.setBeds(b.beds);this.linkWebsite(".website_link",b.website,b.listing_id);this.setRent(b.rent);this.setAvailability("available",b.available);this.setOwnerName("property_manager",b.listing_id);this.setPrimaryImage("property_image",b.listing_id);this.setFullPage("full_page_link",b.listing_id);this.setFullPageContact("full_page_contact",b.listing_id);this.div.find(".share_btn").unbind("click");
this.div.find(".facebook_share").click(function(){return A2Cribs.ShareManager.ShareListingOnFacebook(b.listing_id,d.street_address,d.city,d.state,d.zip,b.description,b.building_type_id)});this.div.find(".link_share").click(function(){return A2Cribs.ShareManager.CopyListingUrl(b.listing_id,d.street_address,d.city,d.state,d.zip)});this.div.find(".twitter_share").click(function(){return A2Cribs.ShareManager.ShareListingOnTwitter(b.listing_id,d.street_address,d.city,d.state,d.zip)});return A2Cribs.FavoritesManager.setFavoriteButton(this.div.find(".favorite_listing"),
b.listing_id,A2Cribs.FavoritesManager.FavoritesListingIds)};c.resolveDateRange=function(b){var a;a="Unknown Start Date";null!=b&&(a="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),b=b.split("-"),a=""+a[+b[1]-1]+" "+parseInt(b[2],10)+", "+b[0]);return a};c.setAvailability=function(a,e){if(null==e)return this.div.find("."+a).hide();if(e)return this.div.find("."+a).show().text("Available"),this.div.find("."+a).removeClass("leased");this.div.find("."+a).show().text("Leased");return this.div.find("."+
a).addClass("leased")};c.linkWebsite=function(a,e,d){var c,f;c=A2Cribs.UserCache.Get("listing",d);null==c&&(c={});c.logged_in=null!=(f=A2Cribs.Login)?f.logged_in:void 0;A2Cribs.MixPanel.Click(c,"go to realtor's website");return null!=e?this.div.find(a).unbind("click").click(function(){var a;if(!0===(null!=(a=A2Cribs.Login)?a.logged_in:void 0))return window.open("/listings/website/"+d,"_blank");$("#signup_modal").modal("show").find(".signup_message").text("Please signup to view this website");return A2Cribs.MixPanel.Event("login required",
{listing_id:d})}):this.div.find(a).unbind("click").click(function(){return A2Cribs.UIManager.Error("This owner does not have a website for this listing")})};c.setRent=function(a){if(null==a)return this.div.find(".rent").text("Ask for Rent"),this.div.find(".per_month").text(""),this.div.find(".price_label").text("");if(0!==parseInt(a,10))return this.div.find(".rent").text(a),this.div.find(".per_month").text("/m"),this.div.find(".price_label").text("$");this.div.find(".rent").text("Call for Rent");
this.div.find(".per_month").text("");return this.div.find(".price_label").text("")};c.setOwnerName=function(a,e){var d;d=A2Cribs.UserCache.Get("listing",e);d=A2Cribs.UserCache.Get("user",d.user_id);null!=(null!=d?d.company_name:void 0)?$("."+a).show().text(d.company_name):null!=(null!=d?d.first_name:void 0)&&d.last_name?$("."+a).show().text(""+d.first_name+" "+d.last_name):$("."+a).hide();return null!=d&&d.verified?this.div.find(".verified").show():this.div.find(".verified").hide()};c.setPrimaryImage=
function(a,e){var d;if(null!=A2Cribs.UserCache.Get("image",e)){if(d=A2Cribs.UserCache.Get("image",e).GetPrimary(),null!=d&&null!=a)return d=this._processImagePath(d),$("."+a).css("background-image","url(/"+d+")")}else if(null!=a)return $("."+a).css("background-image","url(/img/tooltip/no_photo.jpg)")};c._processImagePath=function(a){var e;e=a.substr(0,a.lastIndexOf("/"));a="med_"+a.substr(a.lastIndexOf("/")+1);return e+"/"+a};c.setFullPage=function(a,e){$("."+a).unbind("click");return $("."+a).click(function(){A2Cribs.MixPanel.Click(A2Cribs.UserCache.Get("listing",
e),"full page");return window.open("/listings/view/"+e,"_blank").focus()})};c.setFullPageContact=function(a,e){$("."+a).unbind("click");return $("."+a).click(function(){A2Cribs.MixPanel.Click(A2Cribs.UserCache.Get("listing",e),"full page contact user");return window.open("/messages/contact/"+e,"_blank").focus()})};c.setBeds=function(a){if(null==a||NaN===parseInt(a,10))return this.div.find(".beds").text("??"),this.div.find(".bed_desc").text("Beds");if(0===parseInt(a,10))return this.div.find(".beds").text("Studio"),
this.div.find(".bed_desc").text("");if(1===parseInt(a,10))return this.div.find(".bed_desc").text(a),this.div.find(".bed_desc").text("Bed");this.div.find(".bed_desc").text(a);return this.div.find(".bed_desc").text("Beds")};c.GetAdjustedClickBubblePosition=function(a,e){var d,c,f,h,k,l,m;l=e+this.OFFSET.TOP;m=e+this.OFFSET.TOP+$(".click-bubble").height();k=a+this.OFFSET.LEFT+$(".click-bubble").width();h={x:0,y:0};c=$("#map_region").width();d=$(window).height()-5;f=$("#map_filter").offset().top;l<f+
this.PADDING&&(h.y=l-(f+this.PADDING));m>d-this.PADDING&&(h.y=m-(d-this.PADDING));k>c-this.PADDING&&(h.x=k-(c-this.PADDING));return h};return c}.call(this);A2Cribs.Cache=function(){function c(){}c.IdToSubletMap=[];c.IdToMarkerMap=[];c.IdToUniversityMap=[];c.IdToHousematesMap=[];c.SubletIdToHousemateIdsMap=[];c.SubletIdToOwnerMap=[];c.SubletIdToImagesMap=[];c.MarkerIdToHoverDataMap=[];c.MarkerIdToSubletIdsMap=[];c.IdToMarkerMap=[];c.AddressToMarkerIdMap=[];c.BuildingIdToNameMap=[];c.BathroomIdToNameMap=
[];c.GenderIdToNameMap=[];c.StudentTypeIdToNameMap=[];c.FavoritesSubletIdsList=[];c.FavoritesMarkerIdsList=[];c.IdToRentalMap=[];c.IdToParkingMap=[];c.ListingIdToUserMap=[];c.SubletEditInProgress=null;c.CacheSublet=function(a){var b,e;a.id=parseInt(a.id);a.marker_id=parseInt(a.marker_id);this.MarkerIdToSubletIdsMap[parseInt(a.marker_id)].push(a.id);a.number_bedrooms=parseInt(a.number_bedrooms);a.price_per_bedroom=parseInt(a.price_per_bedroom);a.number_bedrooms=parseInt(a.number_bedrooms);a.utility_cost=
parseInt(a.utility_cost);a.deposit_amount=parseInt(a.deposit_amount);a.additional_fees_amount=parseInt(a.additional_fees_amount);a.marker_id=parseInt(a.marker_id);a.furnished_type_id=parseInt(a.furnished_type_id);e=this.IdToMarkerMap[a.marker_id].UnitType;a.bathroom_type_id=parseInt(a.bathroom_type_id);b=this.BathroomIdToNameMap[a.bathroom_type_id];a.university_id=parseInt(a.university_id);return this.IdToSubletMap[a.id]=new A2Cribs.Sublet(a.id,a.university_id,e,a.name,a.street_address,a.city,a.state,
a.date_begin,a.date_end,a.number_bedrooms,a.price_per_bedroom,a.short_description,b,a.utility_cost,a.deposit_amount,a.additional_fees_description,a.additional_fees_amount,a.marker_id,a.flexible_dates,a.furnished_type_id,a.created,a.ac,a.parking)};c.CacheMarkerIdToSubletsList=function(a){var b,e,d,c;A2Cribs.Map.MarkerIdToSubletIdsMap[parseInt(a[0].Sublet.marker_id)]=[];c=[];e=0;for(d=a.length;e<d;e++)b=a[e],void 0!==b&&c.push(this.MarkerIdToSubletIdsMap[parseInt(b.Sublet.marker_id)].push(parseInt(b.Sublets.sublet_id)));
return c};c.CacheUniversity=function(a){var b;if(null!==a)return b=parseInt(a.id),this.IdToUniversityMap[b]=new A2Cribs.University(a.city,a.domain,a.name,a.state)};c.CacheHoverData=function(a){var b,e,d,c,f,h,k,l,m,n,p,r,q,s;e=[];c=0;for(f=a.length;c<f;c++)b=a[c],d=null,null!==b&&(d=parseInt(b.Sublet.marker_id),void 0!==this.IdToMarkerMap[d]&&(void 0===e[d]&&(e[d]=[]),e[d].push(b)));for(d in e){a=e[d];n=a.length;p=a[0].Sublet;if(void 0===p||null===p)break;r=this.IdToMarkerMap[d].UnitType;k=parseInt(p.number_bedrooms);
c=parseInt(p.number_bedrooms);m=parseInt(p.price_per_bedroom);h=parseInt(p.price_per_bedroom);l=p.date_begin;f=p.date_end;q=0;for(s=a.length;q<s;q++)b=a[q],p=b.Sublet,parseInt(p.building_type_id),b=parseInt(p.number_bedrooms),p=parseInt(p.price_per_bedroom),b<k&&(k=b),b>c&&(c=b),p<m&&(m=p),p>h&&(h=p);b=new A2Cribs.HoverData(n,r,k,c,m,h,l,f);this.MarkerIdToHoverDataMap[d]=b}};c.CacheHousemates=function(a){var b,e,d,c,f;if(null!=a&&null!=a.sublet_id)return f=parseInt(a.sublet_id),this.SubletIdToHousemateIdsMap[f]=
[],d=parseInt(a.id),e=this.StudentTypeIdToNameMap[parseInt(a.student_type_id)],b=this.GenderIdToNameMap[parseInt(a.gender_type_id)],f=parseInt(a.sublet_id),c=parseInt(a.quantity),this.IdToHousematesMap[d]=new A2Cribs.Housemate(f,a.enrolled,a.major,a.seeking,e,b,c),this.SubletIdToHousemateIdsMap[f].push(d)};c.CacheImages=function(a){var b,e,d,c,f,h,k;if(!(void 0===a||null===a||void 0===a[0]))if(e=a[0],!(void 0===e||void 0===e.sublet_id)){c=parseInt(e.sublet_id);A2Cribs.Cache.SubletIdToImagesMap[c]=
[];k=[];f=0;for(h=a.length;f<h;f++)b=a[f],c=parseInt(b.sublet_id),d="/"+b.image_path,e=b.is_primary,b=b.caption,k.push(A2Cribs.Cache.SubletIdToImagesMap[c].push(new A2Cribs.Image(c,d,e,b)));return k}};c.CacheMarker=function(a,b){var e;e=this.BuildingIdToNameMap[parseInt(b.building_type_id)];return this.IdToMarkerMap[a]=new A2Cribs.Marker(parseInt(a),b.street_address,b.alternate_name,e,b.latitude,b.longitude,b.city,b.state)};c.CacheSubletOwner=function(a,b){var e;e=new A2Cribs.SubletOwner(b);return this.SubletIdToOwnerMap[a]=
e};c.CacheMarkerData=function(a){var b,e,d,c,f;void 0!==a[0]&&void 0!==a[0].Sublet&&(b=parseInt(a[0].Sublet.marker_id),this.MarkerIdToSubletIdsMap[b]=[]);f=[];d=0;for(c=a.length;d<c;d++)b=a[d],e=b.Sublet,A2Cribs.Cache.CacheSublet(e),A2Cribs.Cache.CacheHousemates(b.Housemate),A2Cribs.Cache.CacheSubletOwner(parseInt(e.id),b.User),f.push(A2Cribs.Cache.CacheImages(b.Image));return f};c.CacheSubletAddStep1=function(a){return A2Cribs.Cache.Step1Data=a};c.CacheSubletAddStep2=function(a){return A2Cribs.Cache.Step2Data=
a};c.CacheSubletAddStep3=function(a){return A2Cribs.Cache.Step3Data=a};c.AddRental=function(a){a.air=parseInt(a.air);a.beds=parseInt(a.beds);a.baths=parseInt(a.baths);a.building_type=parseInt(a.building_type);a.cable=parseInt(a.cable);a.deposit=parseInt(a.deposit);a.electric=parseInt(a.electric);a.furnished_type=parseInt(a.furnished_type);a.gas=parseInt(a.gas);a.heat=parseInt(a.heat);a.internet=parseInt(a.internet);a.listing_id=parseInt(a.listing_id);a.min_occupancy=parseInt(a.min_occupancy);a.max_occupancy=
parseInt(a.max_occupancy);a.parking_spots=parseInt(a.parking_spots);a.parking_type=parseInt(a.parking_type);a.pets_type=parseInt(a.pets_type);a.rent=parseInt(a.rent);a.rental_id=parseInt(a.rental_id);a.sewage=parseInt(a.sewage);a.square_feet=parseInt(a.square_feet);a.trash=parseInt(a.trash);a.unit_style_options=parseInt(a.unit_style_options);a.utility_estimate_summer=parseInt(a.utility_estimate_summer);a.utility_estimate_winter=parseInt(a.utility_estimate_winter);a.water=parseInt(a.water);a.year_built=
parseInt(a.year_built);return this.IdToRentalMap[a.rental_id]=a};c.AddParking=function(a){return this.IdToParkingMap[parseInt(a.parking_id)]=a};c.AddUser=function(a,b){return this.ListingIdToUserMap[a]=b};c.AddListing=function(a){if(!(void 0===a||null===a))return void 0!==a.Rental?this.AddRental(a.Rental):void 0!==a.Parking&&this.AddParking(a.Parking),this.AddUser(parseInt(a.Listing.listing_id),a.User)};c.GetListing=function(a){var b;if(0<=y.call(this.IdToRentalMap,a))return this.IdToRentalMap[a];
b=null;$.ajax({url:myBaseUrl+"Listings/GetListing/"+a,type:"GET",context:this,async:!1,success:function(a){b=JSON.parse(a);return this.AddListing(b[0])}});return null!==b?b[0]:null};c.GetListingsByLoggedInUser=function(){var a;a=null;$.ajax({url:myBaseUrl+"Listings/GetListingsByLoggedInUser",type:"GET",context:this,async:!1,success:function(b){var e,d,c;a=JSON.parse(b);c=[];e=0;for(d=a.length;e<d;e++)b=a[e],c.push(this.AddListing(b));return c}});return a};return c}();A2Cribs.Housemate=function(){return function(c,
a,b,e,d,g,f){this.SubletId=c;this.Enrolled=a;this.Major=b;this.Seeking=e;this.GradType=d;this.Gender=g;this.Quantity=f}}();A2Cribs.HoverData=function(c){function a(b){a.__super__.constructor.call(this,"hoverData",b)}t(a,c);a.prototype.GetId=function(){return null!=this[0]&&null!=this[0].Listing&&null!=this[0].Listing.marker_id?parseInt(this[0].Listing.marker_id):null};return a}(A2Cribs.Object);A2Cribs.UIManager=function(){function c(){}c.Alert=function(a){return alertify.alert(a)};c.Error=function(a){return alertify.error(a,
7E3)};c.Success=function(a){return alertify.success(a)};c.CloseLogs=function(){return $(".alertify-log").remove()};c.FlashMessage=function(){if("undefined"!==typeof flash_message&&null!==flash_message)return this[flash_message.method](flash_message.message,flash_message.callback)};c.Confirm=function(a,b){alertify.set({buttonFocus:"cancel"});return alertify.confirm(a,b)};c.ConfirmBox=function(a,b,e){alertify.set({labels:b,buttonFocus:"cancel"});return alertify.confirm(a,e)};return c}();$(document).ready(function(){return setTimeout(function(){return A2Cribs.UIManager.FlashMessage()},
2E3)});A2Cribs.Image=function(c){function a(a){var e,d,c,f;if(0!==a.length){this.class_name="image";f=this.image_array=a;a=d=0;for(c=f.length;d<c;a=++d)e=f[a],e.is_primary&&(this.primary=a);this.listing_id=this.image_array[0].listing_id}}t(a,c);a.prototype.GetId=function(){return this.listing_id};a.prototype.GetPrimary=function(a){null==a&&(a="image_path");if(null!=this.primary)return this.image_array[this.primary][a]};a.prototype.GetImages=function(){return this.image_array};a.prototype.GetObject=
function(){var a,e,d,c,f,h,k,l;c=[];l=this.image_array;h=0;for(k=l.length;h<k;h++){a=l[h];e={};for(d in a)f=a[d],"function"!==typeof f&&("boolean"===typeof f&&(f=+f),e[d]=f);c.push(e)}return c};return a}(A2Cribs.Object);A2Cribs.Rental=function(c){function a(b){var e,d,c,f;a.__super__.constructor.call(this,"rental",b);e=["start_date","end_date","alternate_start_date"];c=0;for(f=e.length;c<f;c++)if(b=e[c],this[b]&&-1!==(d=this[b].indexOf(" ")))this[b]=this[b].substring(0,d)}t(a,c);a.prototype.GetId=
function(a){return parseInt(this.listing_id,10)};a.prototype.IsComplete=function(){return null!=this.rental_id?!0:!1};a.Required_Fields={unit_style_options:"overview_grid",beds:"overview_grid",baths:"features_grid",min_occupancy:"overview_grid",max_occupancy:"overview_grid",rent:"overview_grid",start_date:"overview_grid",lease_length:"overview_grid",available:"overview_grid",contact_email:"contact_grid",contact_phone:"contact_grid"};return a}(A2Cribs.Object);A2Cribs.FilterManager=function(){function c(){}
c.MinRent=0;c.MaxRent=999999;c.MaxSliderRent=2E3;c.MinBeds=0;c.MaxBeds=999999;c.MaxSliderBeds=10;c.DateBegin="NOT_SET";c.DateEnd="NOT_SET";c.Geocoder=null;c.UpdateListings=function(a){var b,e,d,c;a=JSON.parse(a);null!=(b=A2Cribs.HoverBubble)&&b.Close();null!=(e=A2Cribs.ClickBubble)&&e.Close();b=A2Cribs.UserCache.Get("listing");d=0;for(c=b.length;d<c;d++)e=b[d],e.visible=!1;b={};d=0;for(c=a.length;d<c;d++)e=a[d],e=A2Cribs.UserCache.Get("listing",e),null!=e&&(e.visible=!0,b[+e.marker_id]=!0);a=A2Cribs.UserCache.Get("marker");
d=0;for(c=a.length;d<c;d++)e=a[d],b[+e.marker_id]?e.GMarker.setVisible(!0):e.GMarker.setVisible(!1);return A2Cribs.Map.GMarkerClusterer.repaint()};c.WheneverButtonClicked=function(a){"Whenever"===$("#startDate").datepicker().valueOf()[0].value&&(A2Cribs.FilterManager.DateBegin="NOT_SET");"Whenever"===$("#endDate").datepicker().valueOf()[0].value&&(A2Cribs.FilterManager.DateEnd="NOT_SET");return A2Cribs.FilterManager.ApplyFilter()};c.ApplyFilter=function(a,b){var e,d;A2Cribs.Map.ClickBubble.Close();
d="house="+$("#houseCheck").is(":checked");e=$("#aptCheck").is(":checked");d+="&apt="+e;e=$("#otherCheck").is(":checked");d+="&unit_type_other="+e;e=$("#maleCheck").is(":checked");d+="&male="+e;e=$("#femaleCheck").is(":checked");d+="&female="+e;e=$("#studentsOnlyCheck").is(":checked");d+="&students_only="+e;e=$("#gradCheck").is(":checked");d+="&grad="+e;e=$("#undergradCheck").is(":checked");d+="&undergrad="+e;e=$("#acCheck").is(":checked");d+="&ac="+e;e=$("#parkingCheck").is(":checked");d+="&parking="+
e;e=$("#utilitiesCheck").is(":checked");d+="&utilities_included="+e;e=$("#noSecurityDepositCheck").is(":checked");d+="&no_security_deposit="+e;e=$("#bedsSelect").val();"2+"===e&&(e="2");d+="&beds="+e;e=$("#bathSelect").val();d+="&bathroom_type="+e;void 0!==a.target&&"slider"===a.target.id&&(A2Cribs.FilterManager.MinRent=a.value[0],A2Cribs.FilterManager.MaxRent=a.value[1],A2Cribs.FilterManager.MaxRent===A2Cribs.FilterManager.MaxSliderRent&&(A2Cribs.FilterManager.MaxRent=999999));if(void 0!==a.target&&
"startDate"===a.target.id){e=a.valueOf().date;if("NOT_SET"!==A2Cribs.FilterManager.DateEnd&&"Whenever"!==A2Cribs.FilterManager.DateEnd&&e>new Date(A2Cribs.FilterManager.DateEnd)){A2Cribs.UIManager.Alert("Start Date cannot occur after End Date.");A2Cribs.FilterManager.DateBegin=new Date(A2Cribs.FilterManager.DateEnd);A2Cribs.FilterManager.StartDateObject.setValue(A2Cribs.FilterManager.DateBegin);return}A2Cribs.FilterManager.DateBegin=A2Cribs.FilterManager.GetFormattedDate(e)}if(void 0!==a.target&&
"endDate"===a.target.id){e=a.valueOf().date;if("NOT_SET"!==A2Cribs.FilterManager.DateBegin&&"Whenever"!==A2Cribs.FilterManager.DateBegin&&e<new Date(A2Cribs.FilterManager.DateBegin)){A2Cribs.UIManager.Alert("End Date cannot occur before Start Date.");A2Cribs.FilterManager.DateEnd=new Date(A2Cribs.FilterManager.DateBegin);A2Cribs.FilterManager.EndDateObject.setValue(A2Cribs.FilterManager.DateEnd);return}A2Cribs.FilterManager.DateEnd=A2Cribs.FilterManager.GetFormattedDate(a.valueOf().date)}d+="&min_rent="+
A2Cribs.FilterManager.MinRent;d+="&max_rent="+A2Cribs.FilterManager.MaxRent;d+="&start_date="+A2Cribs.FilterManager.DateBegin;d+="&end_date="+A2Cribs.FilterManager.DateEnd;return $.ajax({url:myBaseUrl+"Sublets/ApplyFilter",type:"GET",data:d,context:this,success:A2Cribs.FilterManager.UpdateMarkers})};c.GetFormattedDate=function(a){var b,e;e=a.getUTCFullYear();b=a.getMonth()+1;a=a.getDate();return e+"-"+b+"-"+a};c.GetTodaysDate=function(){var a,b,e;e=new Date;a=e.getDate();b=e.getMonth()+1;e=e.getUTCFullYear();
10>a&&(a="0"+a);10>b&&(b="0"+b);return new Date(b+"-"+a+"-"+e)};c.InitAddressSearch=function(){return A2Cribs.FilterManager.Geocoder=new google.maps.Geocoder};c.SearchForAddress=function(a){var b;null==A2Cribs.FilterManager.Geocoder&&(A2Cribs.FilterManager.Geocoder=new google.maps.Geocoder);b=$(a).val();A2Cribs.Map.GMap.getCenter();return A2Cribs.FilterManager.Geocoder.geocode({address:b+" "+A2Cribs.FilterManager.CurrentCity+", "+A2Cribs.FilterManager.CurrentState},function(b,d){return d===google.maps.GeocoderStatus.OK&&
"postal_code"!==b[0].types[0]?($(a).effect("highlight",{color:"#5858FA"},2E3),A2Cribs.Map.GMap.panTo(b[0].geometry.location),A2Cribs.Map.GMap.setZoom(18)):$(a).effect("highlight",{color:"#FF0000"},2E3)})};return c}();A2Cribs.RentalFilter=function(c){function a(){return a.__super__.constructor.apply(this,arguments)}var b;t(a,c);a.FilterData={};b=function(a,b){var c;c=$(a).closest(".filter_content").attr("data-link");return $(c).find(".filter_preview").html(b)};a.CreateListeners=function(){var a=this;
$("#filter_search_content").keyup(function(a){if(13===a.keyCode)return A2Cribs.FilterManager.SearchForAddress(a.delegateTarget),$(a.delegateTarget).select()});this.div.find(".lease_slider").on("slideStop",function(b){return a.ApplyFilter("LeaseRange",{min:parseInt(b.value[0],10),max:parseInt(b.value[1],10)})});this.div.find(".rent_slider").on("slideStop",function(b){return a.ApplyFilter("Rent",{min:parseInt(b.value[0],10),max:parseInt(b.value[1],10)})});this.div.find("#bed_filter").find(".btn").click(function(d){var c,
f,h;h=[];f=1E3;c=-1;$(d.delegateTarget).toggleClass("active");$(d.delegateTarget).parent().find(".btn.active").each(function(){var a;a=parseInt($(this).val(),10);h.push(a);f=Math.min(f,a);return c=Math.max(c,a)});if(0===h.length)return b(d.delegateTarget,""),a.ApplyFilter("Beds",null);a.ApplyFilter("Beds",h);return 1===h.length?b(d.delegateTarget,0===f?"<div class='filter_data'>Studio</div>":1===f?"<div class='filter_data'>"+f+"</div><div class='filter_label'>&nbsp;bed</div>":"<div class='filter_data'>"+
f+"</div><div class='filter_label'>&nbsp;beds</div>"):b(d.delegateTarget,"<div class='filter_data'>"+f+"-"+c+"</div><div class='filter_label'>&nbsp;beds</div>")});this.div.find("#year_filter").change(function(b){var c;c=a.FilterData.Dates;b=$(b.delegateTarget).val();return null!=c?(c.year=b,a.ApplyFilter("Dates",c)):a.ApplyFilter("Dates",{months:[],year:b})});this.div.find("#start_filter").find(".btn").click(function(d){var c,f,h;h=[];$(d.delegateTarget).toggleClass("active");c=$(d.delegateTarget).parent();
f="";c.find(".btn.active").each(function(){h.push($(this).attr("data-month"));return f=$(this).text()});if(0===h.length)return b(d.delegateTarget,""),a.ApplyFilter("Dates",null);a.ApplyFilter("Dates",{months:h,year:a.div.find("#year_filter").val()});return 1===h.length?b(d.delegateTarget,"<div class='filter_data'>"+f+"</div><div class='filter_label'>&nbsp;start</div>"):b(d.delegateTarget,"<div class='filter_data'>"+h.length+"</div><div class='filter_label'>&nbsp;starts</div>")});return this.div.find("input[type='checkbox']").change(function(d){var c,
f,h;f=$(d.target).closest(".filter_content");c=$(d.delegateTarget).attr("data-filter");h=[];f.find("input[type='checkbox']").each(function(){if(this.checked)return h.push($(this).attr("data-value"))});"UnitTypes"===c?a.ApplyFilter(c,h):a.ApplyFilter(c,+d.delegateTarget.checked);return 0===h.length?b(d.delegateTarget,""):-1===f.attr("id").indexOf("more")?1===h.length?b(d.delegateTarget,"<div class='filter_data'>"+h.length+"</div><div class='filter_label'>&nbsp;type</div>"):b(d.delegateTarget,"<div class='filter_data'>"+
h.length+"</div><div class='filter_label'>&nbsp;types</div>"):b(d.delegateTarget,"<div class='filter_data'>"+h.length+"</div><div class='filter_label'>&nbsp;more</div>")})};a.SetupUI=function(){var a=this;this.div=$("#map_filter");$("#filter_search_btn").click(function(){if($("#filter_search_content").is(":visible"))return $("#filter_search_content").hide("slide",{direction:"left"},300);$("#filter_search_content").show("slide",{direction:"left"},300);return $("#filter_search_content").focus()});this.div.find(".lease_slider").slider({min:0,
max:12,step:1,value:[0,12],tooltip:"hide"}).on("slide",function(d){var c;c=1<d.value[1]?"&nbsp;months":"&nbsp;month";a.div.find("#lease_min").text(d.value[0]);a.div.find("#lease_min_desc").html(1<d.value[0]?"&nbsp;months":"&nbsp;month");a.div.find("#lease_max").text(d.value[1]);a.div.find("#lease_max_desc").html(c);return d.value[0]===d.value[1]?b(d.delegateTarget,"<div class='filter_data'>"+d.value[0]+"</div><div class='filter_label'>"+c+"</div>"):b(d.delegateTarget,"<div class='filter_data'>"+d.value[0]+
"-"+d.value[1]+"</div><div class='filter_label'>"+c+"</div>")});this.div.find(".rent_slider").slider({min:0,max:5E3,step:100,value:[0,5E3],tooltip:"hide"}).on("slide",function(d){var c,f;f="$"+d.value[0];c=5E3===d.value[1]?"$"+d.value[1]+"+":"$"+d.value[1];a.div.find("#rent_min").text(f);a.div.find("#rent_max").text(c);return b(d.delegateTarget,"<div class='filter_data'>"+f+"-"+c+"</div>")});this.div.find(".filter_link").click(function(b){var c,f;c=$(b.delegateTarget).attr("data-filter");f=a.div.find(".filter_link.active");
a.div.find(".filter_link").removeClass("active");f.length&&f.find(".filter_preview").html().length&&(f.find(".filter_title").hide(),f.find(".filter_preview").show());$(f).attr("id")!==$(b.delegateTarget).attr("id")&&($(b.delegateTarget).addClass("active"),$(b.delegateTarget).find(".filter_preview").hide(),$(b.delegateTarget).find(".filter_title").show());return a.div.find("#filter_dropdown").slideUp("fast",function(){a.div.find(".filter_content").hide();if($(f).attr("id")!==$(b.delegateTarget).attr("id"))return a.div.find(c).show(),
a.div.find("#filter_dropdown").slideDown()})});this.div.find("#rentals-filter-label").click(function(b){b=a.div.find(".filter_link.active");a.div.find("#filter_dropdown").slideUp("fast");b.length&&b.find(".filter_preview").html().length&&(b.find(".filter_title").hide(),b.find(".filter_preview").show());return a.div.find(".filter_link").removeClass("active")});return this.CreateListeners()};a.ApplyFilter=function(a,b){var c,f,h,k;null!=b?this.FilterData[a]=b:delete this.FilterData[a];c="";f=!0;k=this.FilterData;
for(h in k)b=k[h],f||(c+="&"),f=!1,c+=h+"="+JSON.stringify(b);$("#loader").show();return $.ajax({url:myBaseUrl+"Rentals/ApplyFilter",data:c,type:"GET",context:this,success:A2Cribs.FilterManager.UpdateListings,complete:function(){return $("#loader").hide()}})};a.FilterVisibleListings=function(a){var b,c,f,h,k,l,m,n,p,r,q,s,u,x,v,t;l=A2Cribs.UserCache.GetAllAssociatedObjects("listing","marker",a);u=[];v=0;for(t=l.length;v<t;v++)k=l[v],p=FilterRent(k),c=FilterBeds(k),b=FilterBaths(k),f=FilterBuildingType(k),
h=FilterDates(k),q=FilterUnitFeatures(k),m=FilterParking(k),n=FilterPets(k),a=FilterAmenities(k),r=FilterSquareFeet(k),x=FilterYearBuilt(k),s=FilterUtilities(k),p&&(c&&b&&f&&h&&q&&m&&n&&a&&r&&x&&s)&&u.push(k);return u};a.GetBeds=function(){return JSON.stringify([3,5,6,10])};a.GetRent=function(){return this};a.GetMonths=function(){return{months:{1:1,2:0,3:1,4:0,5:1,6:0,7:1,8:0,9:1,10:0,11:1,12:0},curYear:[13,14],leaseLength:{min:2,max:4}}};a.GetUnitTypes=function(){return{house:0,apartment:1,duplex:1,
other:0}};a.GetAmenities=function(){return{elevator:1}};a.prototype.FilterRent=function(a){return!0};a.prototype.FilterBeds=function(a){return!0};a.prototype.FilterBaths=function(a){return!0};a.prototype.FilterBuildingType=function(a){return!0};a.prototype.FilterDates=function(a){return!0};a.prototype.FilterUnitFeatures=function(a){return!0};a.prototype.FilterParking=function(a){return!0};a.prototype.FilterPets=function(a){return!0};a.prototype.FilterAmenities=function(a){return!0};a.prototype.FilterSquareFeet=
function(a){return!0};a.prototype.FilterYearBuilt=function(a){return!0};a.prototype.FilterUtilities=function(a){return!0};return a}(A2Cribs.FilterManager);A2Cribs.FLDash=function(){function c(a){var b=this;this.uiWidget=a;this.OrderStates={};this.ListingUniPricing={};this.FL_Order=null;this.uiFL_Form=$(".featured-listing-order-item").first();this.uiListingsList=this.uiWidget.find("#listings_list");this.uiOrderItemsList=this.uiWidget.find("#orderItems_list");this.uiErrorsList=this.uiWidget.find("#validation-error-list");
this.initTemplates();this.setupEventHandlers();$.when(A2Cribs.Dashboard.GetListings().then(function(){return b.loadListings()}))}c.prototype.setupEventHandlers=function(){var a=this;this.uiListingsList.on("mouseenter",".listing-item",function(a){$(a.currentTarget).find(".feature-star").removeClass("icon-star-empty");return $(a.currentTarget).find(".feature-star").addClass("icon-star")}).on("mouseleave",".listing-item",function(a){$(a.currentTarget).find(".feature-star").removeClass("icon-star");return $(a.currentTarget).find(".feature-star").addClass("icon-star-empty")}).on("click",
".listing-item",function(b){b=$(b.currentTarget).data("id");null==a.OrderStates[b]&&a.addOrderItem(b);return a.editOrderItem(b)}).on("click",".marker-info",function(a){a=$(a.currentTarget);a.siblings("ul").slideToggle("fast");return a.find("i").toggleClass("icon-plus").toggleClass("icon-minus")});this.uiOrderItemsList.on("click","a",function(b){var e;e=$(b.currentTarget);b=e.data("id");if(e.hasClass("edit"))return a.editOrderItem(b);if(e.hasClass("remove"))return a.removeOrderItem(b)});this.uiErrorsList.on("click",
".icon-remove",function(b){b=$(b.currentTarget).parent().data("id");return a.removeErrors(b)});this.uiWidget.find("#buyNow").click(function(){return a.buy()});this.uiWidget.find(".feature-listing").click(function(){return a.featureListing()});this.uiFL_Form.on("orderItemChanged",function(b,e){var d;a.uiOrderItemsList.find(".orderItem[data-id="+e.listing_id+"] .price").html(""+e.getPrice().toFixed(2));d=0;a.uiOrderItemsList.find(".price").each(function(a,b){return d+=Number($(b).html())});return a.uiOrderItemsList.siblings("tfoot").find(".total").html(""+
d.toFixed(2))});return $("#fl-list-input").keyup(function(a){return $("#listings_list .marker-item").show().filter(function(){return-1===$(this).find(".marker-info").text().toLowerCase().indexOf($("#fl-list-input").val().toLowerCase())?!0:!1}).hide()})};c.prototype.loadListings=function(){var a,b,e,d,c,f,h,k,l,m,n,p,r,q;c="";n={};l=A2Cribs.UserCache.Get("listing");a=0;for(k=l.length;a<k;a++)f=l[a],null==n[f.marker_id]&&(n[f.marker_id]=[]),n[f.marker_id].push(f.listing_id);for(p in n)if(B.call(n,p)){k=
n[p];m=A2Cribs.UserCache.Get("marker",p);l="";a=m.street_address;r=0;for(q=k.length;r<q;r++){h=k[r];f=A2Cribs.UserCache.Get("listing",h);b="";switch(parseInt(f.listing_type)){case 0:b="icon-home";break;case 1:b="icon-lemon";break;case 2:b="icon-truck"}e=A2Cribs.UserCache.GetAllAssociatedObjects("rental","listing",f.listing_id);f="";null!=e&&void 0!==e[0]&&(d=e[0]);e="Listing "+h;null!=d&&(void 0!==d.unit_style_options&&void 0!==d.unit_style_description)&&(0===parseInt(d.unit_style_options)&&(f="Unit"),
1===parseInt(d.unit_style_options)&&(f="Layout"),2===parseInt(d.unit_style_options)&&(f="Entire House"),e+=f,"Entire House"!==f&&(e+=" - "+d.unit_style_description));b={icon:b,address:a,description:e,listing_id:h};b=this.ListingTemplate(b);l+=b}b={marker:m,num_listings:k.length,listing_list:l};a=this.MarkerTemplate(b);c+=a;$("#listings_list_content").append(a)}return this.uiListingsList.html(c)};c.prototype.getUniData=function(a){var b;null==a&&(a=null);null==this.ListingUniPricing[a]&&(b=new $.Deferred,
$.ajax({url:"/featuredListings/getUniDataForListing/"+a,type:"GET",success:function(a){return b.resolve(JSON.parse(a))}}),this.ListingUniPricing[a]=b.promise());return this.ListingUniPricing[a]};c.prototype.addOrderItem=function(a){var b;b=A2Cribs.UserCache.Get("listing",a);b={address:A2Cribs.UserCache.Get("marker",b.marker_id).street_address,price:0,id:b.listing_id};this.OrderStates[a]={};return this.uiOrderItemsList.append(this.OrderItemTemplate(b))};c.prototype.editOrderItem=function(a){var b,
e,d,c,f=this;d=A2Cribs.UserCache.Get("listing",a);null!=this.FL_Order&&(c=this.FL_Order.listing_id,this.uiOrderItemsList.find(".orderItem[data-id="+c+"]").removeClass("editing"),this.OrderStates[c]=this.FL_Order.getState(),this.FL_Order.reset(!1));e=null!=this.OrderStates[a]?this.OrderStates[a]:null;b=A2Cribs.UserCache.Get("marker",d.marker_id).street_address;$.when(this.getUniData(a)).then(function(a){return f.FL_Order=new A2Cribs.Order.FeaturedListing(f.uiFL_Form,d.listing_id,b,a,e)});this.uiOrderItemsList.find(".orderItem[data-id="+
a+"]").addClass("editing");return this.toggleOrderDetailsUI(!0)};c.prototype.removeOrderItem=function(a){var b;null==a&&(a=null);if(null===a)this.uiOrderItemsList.find(".orderItem").remove(),this.OrderStates={},this.FL_Order.reset(),this.FL_Order=null;else if(this.uiOrderItemsList.find(".orderItem[data-id="+a+"]").remove(),this.removeErrors(a),delete this.OrderStates[a],parseInt(null!=(b=this.FL_Order)?b.listing_id:void 0,10)===a)this.FL_Order.reset(),this.FL_Order=null;if(0===this.uiOrderItemsList.find(".orderItem").length)return this.toggleOrderDetailsUI(!1);
a=this.uiOrderItemsList.find(".orderItem").first().data("id");return this.editOrderItem(a)};c.prototype.initTemplates=function(){this.ListingTemplate=_.template("<li class = 'listing-item' data-id='<%= listing_id %>'>\n    <i class = 'icon-large <%= icon %> listing-icon'></i><strong><%= description %></strong>\n    <i class = 'pull-right feature-star icon-star-empty'></i>\n</li>");this.MarkerTemplate=_.template("<div class = 'marker-item' data-id='<%= marker.marker_id %>'>\n    <div class = 'marker-info'><i class = 'icon-plus'></i><strong><%= marker.street_address %></strong>  <%= marker.alternate_name %> (<%=num_listings%>)</div>\n    <ul><%= listing_list %></ul>\n</div>");
return this.OrderItemTemplate=_.template("<tr class = 'orderItem' data-id = '<%= id %>'>\n    <td><span  class = 'address'><%= address %></span></td>\n    <td>$<span class = 'price'?><%= price %></span></td>\n    <td class = 'actions'>\n        <a href = '#' class = 'edit' data-id = '<%= id %>'><i class = 'icon-edit'></i></a>   \n        <a href = '#' class = 'remove' data-id = '<%= id %>'><i class = 'icon-remove-circle'></i></a>\n    </td>\n</tr>\n")};c.prototype.showErrors=function(a){var b,c,d,
g,f,h,k;d="";for(g in a)if(B.call(a,g)){c=a[g];b=this.uiOrderItemsList.find(".orderItem[data-id="+g+"]");b.addClass("error");b=b.find(".address").html();d+="<dt data-id='"+g+"'>Validation Errors for "+b+"<i class = 'icon-remove'></i></dt>";b=h=0;for(k=c.length;h<k;b=++h)f=c[b],d+="<dd data-id='"+g+"' class = 'validation-error'>"+(b+1)+". "+f+"</dd>"}return this.uiErrorsList.html(d)};c.prototype.removeErrors=function(a){null==a&&(a=null);if(null!=a)return this.uiOrderItemsList.find(".orderItem[data-id="+
a+"]").removeClass("error"),this.uiErrorsList.children("[data-id="+a+"]").remove();this.uiOrderItemsList.find(".orderItem").removeClass("error");return this.uiErrorsList.html("")};c.prototype.buy=function(){var a,b,c,d=this;this.removeErrors();this.FL_Order&&(this.OrderStates[this.FL_Order.listing_id]=this.FL_Order.getState());b=[];c=this.OrderStates;for(a in c)B.call(c,a)&&b.push(this.getUniData(a));return $.when.apply($,b).then(function(){var a,b,c,e,l,m,n,p,r;c=[];e=_.zip(arguments,_.values(d.OrderStates));
m=0;for(p=e.length;m<p;m++)if(a=e[m],l=a[0],a=a[1],!(1>a.selectedDates.length)){n=0;for(r=l.length;n<r;n++)b=l[n],b.enabled&&(b=A2Cribs.Order.FeaturedListing.GenerateOrderItem(a,b),c.push(b))}if(0===c.length)A2Cribs.UIManager.Alert("You haven't select any dates to feature listings");else return A2Cribs.Order.BuyItems(c,0,function(a){if(null!=a.error_type&&"NO_LISTINGS_SELECTED"===a.error_type)A2Cribs.UIManager.Alert("You haven't selected any dates to feature your listings.");else return d.showErrors(a)},
function(){return d.removeOrderItem()})})};c.prototype.toggleOrderDetailsUI=function(a){if(a)return $("#noListingSelected").fadeOut("fast"),this.uiWidget.find(".orderingInfo").slideDown();this.uiWidget.find(".orderingInfo").slideUp();return $("#noListingSelected").fadeIn("fast")};return c}();A2Cribs.Register=function(){function c(){}c.RedirectUrl=null;c.setupUI=function(){var a=this;return $("#registerForm").submit(function(b){b.preventDefault();return a.cribspotRegister()})};c.InitRegister=function(a){$("#signupModal").modal("show");
return A2Cribs.Register.RedirectUrl="/dashboard?post_redirect=true"};c.cribspotRegister=function(){var a;a=$("#registerForm").serializeArray();a={User:{email:$.trim(a[0].value),password:$.trim(a[1].value),first_name:$.trim(a[3].value),last_name:$.trim(a[4].value)}};return $.post("/users/AjaxRegister",a,function(a){a=JSON.parse(a);console.log(a);if(void 0!==a.success&&null!==a.success)return window.location.href="/users/login?register_success=true";if("EMAIL_EXISTS"===a.error_type)return A2Cribs.UIManager.Alert(a.error),
$("#inputEmail").val("");"undefined"!==typeof a.validation.email&&($("#inputEmail").effect("highlight",{color:"#FF0000"},3E3),$("#registerStatus").append("<p>"+a.email[0]+"<p>"));"undefined"!==typeof a.validation.first_name&&($("#inputFirstName").effect("highlight",{color:"#FF0000"},3E3),$("#registerStatus").append("<p>"+a.first_name[0]+"<p>"));"undefined"!==typeof a.validation.last_name&&($("#inputLastName").effect("highlight",{color:"#FF0000"},3E3),$("#registerStatus").append("<p>"+a.last_name[0]+
"<p>"));"undefined"!==typeof a.validation.password&&($("#registerStatus").append("<p>"+a.password[0]+"<p>"),$("#inputPassword").effect("highlight",{color:"#FF0000"},3E3),$("#confirmPassword").effect("highlight",{color:"#FF0000"},3E3));return $("#loginStatus").effect("highlight",{color:"#FF0000"},3E3)})};return c}();A2Cribs.Map=function(){function c(){}c.CLUSTER_SIZE=2;c.InitializeMarkers=function(a){var b,e,d,g;if(null!=a){a=JSON.parse(a);g=[];e=0;for(d=a.length;e<d;e++)b=a[e],b=new A2Cribs.Marker(b.Marker),
b.Init(),A2Cribs.UserCache.Set(b),g.push(c.GMarkerClusterer.addMarker(b.GMarker));return g}};c.LoadMarkers=function(){this.MarkerDeferred||(this.MarkerDeferred=new $.Deferred);if(void 0===A2Cribs.Map.CurentSchoolId)this.MarkerDeferred.resolve(null);else return $.ajax({url:myBaseUrl+"Map/LoadMarkers/"+A2Cribs.Map.CurentSchoolId+"/0",type:"GET",context:this,success:function(a){return this.MarkerDeferred.resolve(a,this)},error:function(){return this.MarkerDeferred.resolve(null)}}),this.MarkerDeferred.promise()};
c.ShowMarkers=function(){return A2Cribs.Map.GMap.getBounds()};c.InitBoundaries=function(){return this.Bounds={LEFT:0,RIGHT:window.innerWidth,BOTTOM:window.innerHeight,TOP:0,CONTROL_BOX_LEFT:95}};c.Init=function(a,b,c,d,g,f,h){this.CurentSchoolId=a;mixpanel.register({preferred_university:a});A2Cribs.FilterManager.CurrentCity=d;A2Cribs.FilterManager.CurrentState=g;A2Cribs.FilterManager.CurrentSchool=f;this.ACTIVE_LISTING_TYPE=h;this.MapCenter=new google.maps.LatLng(b,c);this.MapOptions={zoom:14,center:A2Cribs.Map.MapCenter,
mapTypeId:google.maps.MapTypeId.ROADMAP,styles:this.style,panControl:!1,streetViewControl:!1,mapTypeControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.TOP_RIGHT}};A2Cribs.Map.GMap=new google.maps.Map(document.getElementById("map_canvas"),A2Cribs.Map.MapOptions);google.maps.event.addListener(A2Cribs.Map.GMap,"idle",A2Cribs.Map.ShowMarkers);google.maps.event.addListener(A2Cribs.Map.GMap,"center_changed",function(){return A2Cribs.ClickBubble.Close()});
this.GMarkerClusterer=new MarkerClusterer(A2Cribs.Map.GMap,[],{gridSize:60,maxZoom:15,styles:[{height:39,url:"/img/dots/dot_group.png",width:39,textColor:"#ffffff",textSize:13}]});this.GMarkerClusterer.setIgnoreHidden(!0);A2Cribs.ClickBubble.Init(this.GMap);A2Cribs.HoverBubble.Init(this.GMap);A2Cribs.Map.InitBoundaries();this.LoadAllMapData();return A2Cribs.FilterManager.InitAddressSearch()};c.LoadBasicData=function(){var a=this;null==this.BasicDataDeferred&&(this.BasicDataDeferred=new $.Deferred);
$.ajax({url:myBaseUrl+("Map/GetBasicData/"+this.ACTIVE_LISTING_TYPE+"/"+this.CurentSchoolId),type:"POST",success:function(b){return a.BasicDataDeferred.resolve(b)},error:function(){a.BasicDataDeferred.resolve(null);return a.BasicDataCached.resolve()}});return this.BasicDataDeferred.promise()};c.LoadBasicDataCallback=function(a){var b,e,d,g,f,h,k,l;if(!(null===a||void 0===a)){b=JSON.parse(a);g=0;for(f=b.length;g<f;g++)for(e in a=b[g],a)d=a[e],A2Cribs.UserCache.Set(new A2Cribs[e](d));c.BasicDataCached.resolve();
e=A2Cribs.UserCache.Get("marker");f=0;for(k=e.length;f<k;f++){g=e[f];b=A2Cribs.UserCache.GetAllAssociatedObjects("listing","marker",g.GetId());d=!1;h=0;for(l=b.length;h<l;h++)a=b[h],null==a.available&&!0!==d?d=null:null!=a.available&&!0===a.available&&(d=!0);g.Init(d);c.GMarkerClusterer.addMarker(g.GMarker)}b=A2Cribs.UserCache.Get("listings");g=[];e=0;for(d=b.length;e<d;e++)a=b[e],g.push(a.visible=!0);return g}};c.OpenMarker=function(a,b){if(-1===a)alert("This listing either has been removed or is invalid.");
else if(-2!==a)return alert(a)};c.LoadAllMapData=function(){var a;$("#loader").show();a=this.LoadBasicData();this.BasicDataCached=new $.Deferred;A2Cribs.FavoritesManager.LoadFavorites();A2Cribs.FeaturedListings.LoadFeaturedPMListings();a.done(this.LoadBasicDataCallback).always(function(){return $("#loader").hide()});return A2Cribs.FeaturedListings.InitializeSidebar(this.CurentSchoolId,this.ACTIVE_LISTING_TYPE,a,this.BasicDataCached)};c.CenterMap=function(a,b){if(null!=this.GMap)return this.GMap.setCenter(new google.maps.LatLng(a,
b))};c.ToggleListingVisibility=function(a,b,c){var d,g,f;null==c&&(c=void 0);null!=c&&$(c).toggleClass("active");null!=(d=A2Cribs.HoverBubble)&&d.Close();null!=(g=A2Cribs.ClickBubble)&&g.Close();d=A2Cribs.UserCache.Get("marker");c=A2Cribs.UserCache.Get("listing");if(b){a=0;for(g=d.length;a<g;a++)b=d[a],null!=b&&b.IsVisible(!0);b=0;for(a=c.length;b<a;b++)d=c[b],d.IsVisible(!0)}else{g=0;for(f=d.length;g<f;g++)b=d[g],b.IsVisible(!1);b=0;for(g=c.length;b<g;b++)d=c[b],d.IsVisible(!1);c=0;for(g=a.length;c<
g;c++)b=a[c],d=A2Cribs.UserCache.Get("listing",b),b=A2Cribs.UserCache.Get("marker",d.marker_id),b.IsVisible(!0),d.IsVisible(!0)}return this.Repaint()};c.IsCluster=function(a){null==a&&(a=null);"boolean"===typeof a&&(!0===a?this.GMarkerClusterer.setMinimumClusterSize(this.CLUSTER_SIZE):this.GMarkerClusterer.setMinimumClusterSize(Number.MAX_VALUE),this.Repaint());return this.GMarkerClusterer.getMinimumClusterSize()===this.CLUSTER_SIZE};c.Repaint=function(){return this.GMarkerClusterer.repaint()};c.style=
[{featureType:"road.highway",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{elementType:"labels.text.fill",stylers:[{color:"#3b393a"}]},{featureType:"poi.sports_complex",elementType:"geometry",stylers:[{color:"#e9ddbc"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#868080"},
{lightness:55}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{color:"#808080"},{lightness:53}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road"},{featureType:"transit.station.airport",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",
stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{lightness:23},
{color:"#83b243"},{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.text.stroke",stylers:[{color:"#f4f6f1"},{visibility:"off"}]},{featureType:"poi.school",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.medical",stylers:[{color:"#ce979e"},{lightness:26}]},{featureType:"road.arterial",elementType:"labels.icon",
stylers:[{visibility:"off"}]},{featureType:"transit.station.rail",elementType:"labels.icon",stylers:[{lightness:39}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#d6e0c6"}]},{featureType:"water",stylers:[{color:"#c2d6ec"}]},{featureType:"landscape.man_made",stylers:[{color:"#efece2"}]},{featureType:"poi.medical",stylers:[{color:"#edcece"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels.text.fill",
stylers:[{lightness:16}]},{featureType:"road.arterial",stylers:[{lightness:15}]},{featureType:"landscape.man_made",elementType:"geometry.stroke",stylers:[{visibility:"on"},{lightness:78},{color:"#b8b7b8"}]},{featureType:"poi.business",elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:25},{saturation:-17}]}];return c}.call(this);A2Cribs.MarkerModal=function(){function c(){this.TriggerMarkerUpdated=z(this.TriggerMarkerUpdated,this);this.TriggerMarkerAdded=z(this.TriggerMarkerAdded,this);
this.modal=$("#marker-modal");this.setupUI();this.ListingType="Rental"}c.prototype.Clear=function(){this.modal.find("#marker_select_container").show();this.modal.find("input").val("");this.modal.find("select option:first-child").attr("selected","selected");return this.MiniMap.SetMarkerVisible(!1)};c.prototype.MarkerValidate=function(){var a,b,c,d,g,f;d=!0;a=["street_address","city","state"];b=!0;g=0;for(f=a.length;g<f;g++)if(c=a[g],null==this.modal.find("#Marker_"+c).val()||0===this.modal.find("#Marker_"+
c).val().length)this.modal.find("#Marker_"+c).parent().addClass("error"),b=!1;b||(A2Cribs.UIManager.Error("Fill in the full address please."),d=!1);0===this.modal.find("#Marker_building_type_id").val().length&&(A2Cribs.UIManager.Error("You need to select a building type."),this.modal.find("#Marker_building_type_id").parent().addClass("error"),d=!1);249<=this.modal.find("#Marker_alternate_name").val().length&&(A2Cribs.UIManager.Error("Your building name is too long."),this.modal.find("#Marker_alternate_name").parent().addClass("error"),
d=!1);return d};c.prototype.Save=function(a){var b,c,d,g=this;if(this.MarkerValidate()){if(this.modal.find("#Marker_latitude").val()){c=this.modal.find("#Marker_marker_id").val();b=this.MiniMap.GetMarkerPosition();d={alternate_name:this.modal.find("#Marker_alternate_name").val(),building_type_id:this.modal.find("#Marker_building_type_id").val(),street_address:this.modal.find("#Marker_street_address").val(),city:this.modal.find("#Marker_city").val(),state:this.modal.find("#Marker_state").val(),zip:this.modal.find("#Marker_zip").val(),
latitude:b.latitude,longitude:b.longitude};A2Cribs.MixPanel.PostListing("Marker Save",{"marker id":c,"alternate name":this.modal.find("#Marker_alternate_name").val(),"building type id":this.modal.find("#Marker_building_type_id").val(),"street address":this.modal.find("#Marker_street_address").val(),city:this.modal.find("#Marker_city").val(),state:this.modal.find("#Marker_state").val(),zip:this.modal.find("#Marker_zip").val(),latitude:b.latitude,longitude:b.longitude});if(0!==(null!=c?c.length:void 0))d.marker_id=
c;return $.ajax({url:"/Markers/Save/",type:"POST",data:d,success:function(b){if(b.error)return UIManager.Error(b.error);g.modal.modal("hide");d.marker_id=b;A2Cribs.MixPanel.PostListing("Marker Save Complete",{"marker id":d.marker_id});A2Cribs.UserCache.Set(new A2Cribs.Marker(d));return a(d.marker_id)}})}A2Cribs.UIManager.Error("Please place your street address on the map using the Place On Map button.")}};c.prototype.setupUI=function(){var a=this;this.modal.on("shown",function(){return a.MiniMap.Resize()});
this.modal.find(".required").keydown(function(){return $(this).parent().removeClass("error")});this.modal.find("#place_map_button").click(function(){var b;b=a.modal.find("#marker_select").val();A2Cribs.MixPanel.PostListing("Marker Selected",{"new marker":!1,marker_id:b});return a.FindAddress(a.modal)});this.modal.find("#marker_select").change(function(){var b;b=a.modal.find("#marker_select").val();"0"===b?a.modal.find("#continue-button").addClass("disabled"):a.modal.find("#continue-button").removeClass("disabled");
return"new_marker"===b?(a.modal.find("#marker_add").show(),a.MiniMap.Resize()):a.modal.find("#marker_add").hide()});this.modal.find("#continue-button").click(function(){var b,c;c=a.modal.find("#marker_select").val();if("new_marker"===c)return A2Cribs.MixPanel.PostListing("Marker Selected",{"new marker":!0}),a.Save();if("0"!==c)return b=A2Cribs.UserCache.Get("marker",c),A2Cribs.MixPanel.PostListing("Marker Selected",{"new marker":!1,"marker id":c,"marker name":null!=b?b.GetName():void 0,"marker address":null!=
b?b.street_address:void 0,"marker city":null!=b?b.city:void 0,"marker state":null!=b?b.state:void 0}),a.modal.modal("hide"),a.TriggerMarkerAdded(c)});return this.MiniMap=new A2Cribs.MiniMap(this.modal)};c.prototype.Open=function(){return this.modal.modal("show")};c.prototype.NewMarker=function(){var a,b,c,d,g,f=this;this.Clear();this.modal.find("#marker_add").hide();this.modal.find("#continue-button").addClass("disabled");this.modal.find("#continue-button").text("Continue");this.modal.find(".title").text("Create a New Listing");
b=A2Cribs.UserCache.Get("marker");this.modal.find("#marker_select").empty();this.modal.find("#marker_select").append('<option value="0">--</option>\t\t\t<option value="new_marker"><strong>New Location</strong></option>');this.modal.find("#continue-button").unbind("click");this.modal.find("#continue-button").click(function(){var a;a=f.modal.find("#marker_select").val();if("new_marker"===a)return f.Save(f.TriggerMarkerAdded);if("0"!==a)return f.modal.modal("hide"),f.TriggerMarkerAdded(a)});if(null!=
b){d=0;for(g=b.length;d<g;d++)a=b[d],c=null!=a.alternate_name&&a.alternate_name.length?a.alternate_name:a.street_address,a=$("<option />",{text:c,value:a.marker_id}),this.modal.find("#marker_select").append(a)}return this.modal.find("#marker_select").val("0")};c.prototype.LoadMarker=function(a){var b,c,d=this;this.Clear();this.modal.find("#marker_add").show();this.modal.find("#marker_select_container").hide();a=A2Cribs.UserCache.Get("marker",a);this.modal.find("#continue-button").removeClass("disabled");
this.modal.find("#continue-button").text("Save");this.modal.find(".title").text("Edit Listing Address");this.modal.find("#marker_select").val("new_marker");for(b in a)c=a[b],this.modal.find("#Marker_"+b).val(c);this.modal.find("#continue-button").unbind("click");this.modal.find("#continue-button").click(function(){return d.Save(d.TriggerMarkerUpdated)});b=new google.maps.LatLng(this.modal.find("#Marker_latitude").val(),this.modal.find("#Marker_longitude").val());return this.MiniMap.SetMarkerPosition(b)};
c.prototype.TriggerMarkerAdded=function(a){return $("body").trigger(""+this.ListingType+"_marker_added",[a])};c.prototype.TriggerMarkerUpdated=function(a){return $("body").trigger(""+this.ListingType+"_marker_updated",[a])};c.prototype.FindAddress=function(a){var b,c=this;if(this.MarkerValidate())return b={address:a.find("#Marker_street_address").val()+" "+a.find("#Marker_city").val()+", "+a.find("#Marker_state").val()},A2Cribs.Geocoder.geocode(b,function(b,g){var f,h,k,l,m,n,p,r,q,s;if(g===google.maps.GeocoderStatus.OK&&
2<=b[0].address_components.length){q=b[0].address_components;m=0;for(p=q.length;m<p;m++){f=q[m];s=f.types;n=0;for(r=s.length;n<r;n++)switch(l=s[n],l){case "street_number":k=f.short_name;break;case "route":h=f.short_name;break;case "locality":a.find("#Marker_city").val(f.short_name);break;case "administrative_area_level_1":a.find("#Marker_state").val(f.short_name);break;case "postal_code":a.find("#Marker_zip").val(f.short_name)}}if(null==k)A2Cribs.UIManager.Alert("Entered street address is not valid."),
$("#Marker_street_address").text("");else return c.MiniMap.SetMarkerPosition(b[0].geometry.location),a.find("#Marker_street_address").val(k+" "+h),a.find("#Marker_latitude").val(b[0].geometry.location.lat()),a.find("#Marker_longitude").val(b[0].geometry.location.lng())}})};return c}();window.A2Cribs.UILayer={};A2Cribs.UILayer.Rentals=function(){function c(){}c.rental_id=function(){return""};c.listing_id=function(){return 2};c.street_address=function(){return"521 Linden St"};c.city=function(){return"Ann Arbor"};
c.state=function(){return"MI"};c.zipcode=function(){return"48104"};c.unit_style_options=function(){return 2};c.unit_style_type=function(){return"NA"};c.unit_style_description=function(){return"NA"};c.building_name=function(){return""};c.beds=function(){return 6};c.min_occupancy=function(){return 1};c.max_occupancy=function(){return 6};c.building_type=function(){return 2};c.rent=function(){return 3600};c.rent_negotiable=function(){return 0};c.unit_count=function(){return 1};c.start_date=function(){return A2Cribs.UtilityFunctions.GetFormattedDate(new Date("09-02-2013"))};
c.alternate_start_date=function(){return""};c.end_date=function(){return A2Cribs.UtilityFunctions.GetFormattedDate(new Date("08-17-2014"))};c.available=function(){return 1};c.baths=function(){return 2};c.air=function(){return 1};c.parking_type=function(){return 1};c.parking_spots=function(){return 6};c.street_parking=function(){return 0};c.furnished_type=function(){return 0};c.pets_type=function(){return 1};c.smoking=function(){return 1};c.square_feet=function(){return 2E3};c.year_built=function(){return 1944};
c.electric=function(){return 1};c.water=function(){return 1};c.gas=function(){return 1};c.heat=function(){return 1};c.sewage=function(){return 1};c.trash=function(){return 1};c.cable=function(){return 1};c.internet=function(){return 1};c.utility_total_flat_rate=function(){return 0};c.utility_estimate_winter=function(){return 250};c.utility_estimate_summer=function(){return 200};c.deposit=function(){return 900};c.highlights=function(){return"Its a really fun place"};c.description=function(){return"This is a longer description about the place"};
c.waitlist=function(){return 1};c.waitlist_open_date=function(){return""};c.lease_office_address=function(){return"Jonah Copi's place"};c.contact_email=function(){return"email@address.com"};c.contact_phone=function(){return"5555555555"};c.website=function(){return"www.cribspot.com"};return c}();A2Cribs.UILayer.Fees=function(){function c(){}c.GetFees=function(){var a;a=[];a.push({fee_id:160,description:"Admin",amount:69});a.push({fee_id:161,description:"Parking",amount:25});a.push({fee_id:162,description:"Furniture",
amount:45});a.push({fee_id:163,description:"Pets",amount:50});a.push({fee_id:164,description:"Upper Floor",amount:66});a.push({fee_id:165,description:"Cleaning",amount:50});return a};return c}();A2Cribs.RentalSave=function(){function c(a,b,c){this.user_email=b;this.user_phone=c;this.SaveImages=z(this.SaveImages,this);this.div=$(".rentals-content");this.EditableRows=[];this.Editable=!1;this.VisibleGrid="overview_grid";this.SetupUI(a);this.NextListing}c.prototype.SetupUI=function(a){null==A2Cribs.Geocoder&&
(A2Cribs.Geocoder=new google.maps.Geocoder);$("#middle_content").height();this.div.find("grid-pane").height;this.CreateCallbacks();return this.CreateGrids(a)};c.prototype.CreateCallbacks=function(){var a=this;$("body").on("Rental_marker_added",function(b,c){var d;0===$("#rentals_list_content").find("#"+c).length&&(d=A2Cribs.UserCache.Get("marker",c).GetName(),d=$("<li />",{text:d,"class":"rentals_list_item",id:c}),$("#rentals_list_content").append(d),$("#rentals_list_content").slideDown());A2Cribs.Dashboard.Direct({classname:"rentals",
data:!0});return $.when(a.Open(c)).then(function(){return a.AddNewUnit()})});$("body").on("Rental_marker_updated",function(b,c){var d,g;if(1===$("#rentals_list_content").find("#"+c).length)return d=$("#rentals_list_content").find("#"+c),g=A2Cribs.UserCache.Get("marker",c).GetName(),d.text(g),a.CreateListingPreview(c)});$("body").on("click",".rentals_list_item",function(b){return a.Editable?A2Cribs.UIManager.ConfirmBox("By selecting a new address, all unsaved changes will be lost.",{ok:"Abort Changes",
cancel:"Return to Editor"},function(c){if(c)return a.CancelEditing(),a.Open(b.target.id)}):a.Open(b.target.id)});this.div.find(".edit_marker").click(function(){A2Cribs.MixPanel.PostListing("Started",{});A2Cribs.MarkerModal.Open();return A2Cribs.MarkerModal.LoadMarker(a.CurrentMarker)});$("#rentals_edit").click(function(b){b=a.GridMap[a.VisibleGrid].getSelectedRows();if(a.Editable)a.FinishEditing();else{if(0===(null!=b?b.length:void 0)){A2Cribs.UIManager.CloseLogs();A2Cribs.UIManager.Error("Please select the row you wish to edit!");
return}a.Edit(b)}return a.GridMap[a.VisibleGrid].setSelectedRows(b)});$("#rentals_delete").click(function(){var b,c,d,g,f,h;g=a.GridMap[a.VisibleGrid].getSelectedRows();if(g.length){a.GridMap[a.VisibleGrid].getEditorLock().isActive()&&(b=a.GridMap[a.VisibleGrid].getActiveCell().row);if(-1!==g.indexOf(b))return a.GridMap[a.VisibleGrid].getEditorLock().cancelCurrentEdit();b=[];f=0;for(h=g.length;f<h;f++)d=g[f],null!=a.GridMap[a.VisibleGrid].getDataItem(d).listing_id&&b.push(a.GridMap[a.VisibleGrid].getDataItem(d).listing_id),
-1!==(c=a.EditableRows.indexOf(d))&&a.EditableRows.splice(c,1);a.Delete(g,b);if(0===a.EditableRows.length)return a.FinishEditing()}});$(".rentals_tab").click(function(b){var c,d,g,f;if(a.CommitSlickgridChanges()){c=a.GridMap[a.VisibleGrid].getSelectedRows();a.VisibleGrid=$(b.target).attr("data-target").substring(1);A2Cribs.MixPanel.PostListing(""+a.VisibleGrid+" selected",{"marker id":a.CurrentMarker});a.GridMap[a.VisibleGrid].setSelectedRows(c);f=a.EditableRows;d=0;for(g=f.length;d<g;d++)c=f[d],
a.Validate(c);$(b.target).removeClass("highlight-tab");return $(b.delegateTarget).tab("show")}});return $(".rentals-content").on("shown",function(b){var c,d,g;d=$("#"+a.VisibleGrid).width();b=$("#add_new_unit").position().top-$("#"+a.VisibleGrid).position().top;null!=(g=a.Map)&&g.Resize();g=[];for(c in a.GridMap)$("#"+c).css("width",""+d+"px"),$("#"+c).css("height",""+b+"px"),g.push(a.GridMap[c].init());return g})};c.prototype.CommitSlickgridChanges=function(){var a;return null!=(a=this.GridMap[this.VisibleGrid].getEditorLock())?
a.commitCurrentEdit():void 0};c.prototype.Edit=function(a){var b,c,d;this.EditableRows=a;$("#rentals_edit").text("Finish Editing");c=0;for(d=a.length;c<d;c++)b=a[c],b=this.GridMap[this.VisibleGrid].getDataItem(b),null!=b&&(b.editable=!0);return this.Editable=!0};c.prototype.CancelEditing=function(){var a,b,c,d,g;null!=(a=this.GridMap[this.VisibleGrid].getEditorLock())&&a.cancelCurrentEdit();g=this.EditableRows;c=0;for(d=g.length;c<d;c++)b=g[c],a=this.GridMap[this.VisibleGrid].getDataItem(b),a.editable=
!1,null==(null!=a?a.listing_id:void 0)&&this.GridMap[this.VisibleGrid].getData().splice(b,1);this.GridMap[this.VisibleGrid].updateRowCount();this.GridMap[this.VisibleGrid].render();this.GridMap[this.VisibleGrid].getSelectionModel().setSelectedRanges([]);this.EditableRows=[];this.Editable=!1;$("#rentals_edit").text("Edit");return $(".rentals_tab").removeClass("highlight-tab")};c.prototype.FinishEditing=function(){var a,b,c,d,g;if(this.CommitSlickgridChanges()){b=!0;g=this.EditableRows;c=0;for(d=g.length;c<
d;c++)a=g[c],b=b&&this.Validate(a);if(b){$("#rentals_edit").text("Edit");$(".rentals_tab").removeClass("highlight-tab");d=this.EditableRows;b=0;for(c=d.length;b<c;b++)a=d[b],a=this.GridMap[this.VisibleGrid].getDataItem(a),a.editable=!1;this.GridMap[this.VisibleGrid].setSelectedRows(this.EditableRows);this.EditableRows=[];return this.Editable=!1}A2Cribs.UIManager.CloseLogs();return A2Cribs.UIManager.Error("Please complete all required fields to finish editing!")}};c.prototype.Open=function(a){var b,
c=this;$("#loader").show();b=new $.Deferred;$.ajax({url:myBaseUrl+"listings/GetOwnedListingsByMarkerId/"+a,type:"GET",success:function(d){var g,f,h,k,l,m,n,p;d=JSON.parse(d);l=0;for(n=d.length;l<n;l++)for(h in f=d[l],f)if(k=f[h],null!=A2Cribs[h])A2Cribs.UserCache.Set(new A2Cribs[h](k));else if(null!=A2Cribs[h]&&null!=k.length){m=0;for(p=k.length;m<p;m++)g=k[m],A2Cribs.UserCache.Set(new A2Cribs[h](g))}c.ClearGrids();c.CurrentMarker=a;c.CreateListingPreview(a);A2Cribs.Dashboard.ShowContent($(".rentals-content"),
!0);c.PopulateGrid(a);b.resolve();return $("#loader").hide()}});return b.promise()};c.prototype.CreateListingPreview=function(a){var b;a=A2Cribs.UserCache.Get("marker",a);b=a.GetName();$("#rentals_address").html("<strong>"+b+"</strong><br>");null==this.Map&&(this.Map=new A2Cribs.MiniMap($("#rentals_preview")));if(null!=a.latitude&&null!=a.longitude)return this.Map.SetMarkerPosition(new google.maps.LatLng(a.latitude,a.longitude))};c.prototype.Validate=function(a){var b,c,d,g,f;g=A2Cribs.Rental.Required_Fields;
a=this.GridMap[this.VisibleGrid].getDataItem(a);b={};c=!0;for(d in g)f=g[d],null==a[d]&&(c=!1,b[f]=!0);$(".rentals_tab").removeClass("highlight-tab");for(f in b)$("a[data-target='#"+f+"']").addClass("highlight-tab");$("a[data-target='#"+this.VisibleGrid+"']").removeClass("highlight-tab");return c};c.prototype.GetObjectByRow=function(a){var b,c,d;a=this.GridMap[this.VisibleGrid].getDataItem(a);null!=a.listing_id&&(b=null!=(c=A2Cribs.UserCache.Get("image",a.listing_id))?c.GetObject():void 0);null==
b&&(b=[]);b={Rental:a,Listing:null!=a.listing_id?A2Cribs.UserCache.Get("listing",a.listing_id).GetObject():void 0,Image:b};null==b.Listing&&(b.Listing={listing_type:0,marker_id:this.CurrentMarker});b.Listing.available=a.available;if(0===(null!=(d=b.Image)?d.length:void 0)&&null!=a.Image)b.Image=a.Image;return b};c.prototype.Save=function(a){var b,c=this;if(this.Validate(a))return b=this.GetObjectByRow(a),A2Cribs.MixPanel.PostListing("Listing Save",{"save type":null!=b.listing_id?"edit":"save","marker id":this.CurrentMarker,
"listing id":b.listing_id}),$("#loader").show(),$.ajax({url:myBaseUrl+"listings/Save/",type:"POST",data:b,success:function(a){var g,f,h,k,l;a=JSON.parse(a);if(null!=a.listing_id){A2Cribs.MixPanel.PostListing("Listing Save Completed",{"listing id":a.listing_id,"marker id":c.CurrentMarker});A2Cribs.UIManager.Success("Save successful!");b.Listing.listing_id=a.listing_id;b.Rental.listing_id=a.listing_id;l=b.Image;h=0;for(k=l.length;h<k;h++)g=l[h],g.listing_id=a.listing_id;for(f in b)g=b[f],null!=A2Cribs[f]&&
A2Cribs.UserCache.Set(new A2Cribs[f](g))}else A2Cribs.UIManager.Error(a.error.message);console.log(a);return $("#loader").hide()}})};c.prototype.GetListing=function(a){var b;null==a&&(a=null);b=myBaseUrl+"listings/GetListing/";null!==a&&(b+=a);return $.ajax({url:b,type:"POST",success:function(a){return console.log(JSON.parse(a))}})};c.prototype.Copy=function(a){};c.prototype.Delete=function(a,b){var c=this;return $.ajax({url:myBaseUrl+"listings/Delete/"+JSON.stringify(b),type:"POST",success:function(d){var g,
f,h,k,l,m,n;d=JSON.parse(d);if(null!==d.success&&void 0!==d.success){A2Cribs.UIManager.Success("Listings deleted!");d=c.GridMap[c.VisibleGrid].getData();k=0;for(m=b.length;k<m;k++){g=b[k];h=A2Cribs.UserCache.GetAllAssociatedObjects("rental","listing",g);l=0;for(n=h.length;l<n;l++)f=h[l],A2Cribs.UserCache.Remove(f.class_name,f.GetId());A2Cribs.UserCache.Remove("listing",g)}f=0;for(h=a.length;f<h;f++)g=a[f],d.splice(g,1);c.GridMap[c.VisibleGrid].updateRowCount();return c.GridMap[c.VisibleGrid].render()}A2Cribs.UIManager.Error("Delete unsuccessful");
return console.log(d)}})};c.prototype.Create=function(a){var b,c;this.CurrentMarker=a;A2Cribs.Dashboard.ShowContent($(".rentals-content"),!0);c=this.GridMap;for(b in c)a=c[b],a.init();return this.GridMap.overview_grid.getData()};c.prototype.LoadImages=function(a){var b,c;b=this.GridMap[this.VisibleGrid].getDataItem(a);b=null!=b.listing_id?null!=(c=A2Cribs.UserCache.Get("image",b.listing_id))?c.GetImages():void 0:b.Image;A2Cribs.MixPanel.PostListing("Start Photo Editing",{"marker id":this.CurrentMarker,
"number of images":null!=b?b.length:void 0});return A2Cribs.PhotoManager.LoadImages(b,a,this.SaveImages)};c.prototype.SaveImages=function(a,b){var c,d,g,f;c=this.GridMap[this.VisibleGrid].getDataItem(a);if(null!=c.listing_id){g=0;for(f=b.length;g<f;g++)d=b[g],d.listing_id=c.listing_id;A2Cribs.UserCache.Set(new A2Cribs.Image(b))}else c.Image=b;return this.Save(a)};c.prototype.AddNewUnit=function(){var a,b,c,d;A2Cribs.MixPanel.PostListing("Add New Unit",{"marker id":this.CurrentMarker});b=this.GridMap[this.VisibleGrid].getData();
c=b.length;this.EditableRows.push(c);b.push({editable:!0,contact_email:this.user_email,contact_phone:this.user_phone,unit_style_description:c+1});this.GridMap[this.VisibleGrid].setSelectedRows(this.EditableRows);$("#rentals_edit").text("Finish Editing");this.Editable=!0;this.Validate(c);c=this.GridMap;d=[];for(a in c)b=c[a],b.updateRowCount(),d.push(b.render());return d};c.prototype.PopulateGrid=function(a){var b,c,d,g,f,h;this.GridMap[this.VisibleGrid].getSelectionModel().setSelectedRanges([]);g=
A2Cribs.UserCache.Get("rental");a=[];if(g.length){f=0;for(h=g.length;f<h;f++)d=g[f],b=A2Cribs.UserCache.Get("listing",d.listing_id),b.marker_id===this.CurrentMarker&&a.push(d.GetObject())}d=this.GridMap;g=[];for(c in d)b=d[c],b.setData(a),b.updateRowCount(),g.push(b.render());return g};c.prototype.ClearGrids=function(){var a,b,c,d,g;d=this.GridMap;g=[];for(a in d)c=d[a],b=[],c.setData(b),g.push(c.render());return g};c.prototype.CreateGrids=function(a){var b,c,d,g,f,h,k,l,m,n=this;g="overview_grid features_grid amenities_grid utilities_grid buildingamenities_grid fees_grid description_grid picture_grid contact_grid".split(" ");
this.GridMap={};h={editable:!0,enableCellNavigation:!0,asyncEditorLoading:!1,enableAddRow:!1,autoEdit:!0,forceFitColumns:!0,explicitInitialization:!0,rowHeight:35};f=[];m=[];k=0;for(l=g.length;k<l;k++)d=g[k],c=this.GetColumns(d,a),b=new Slick.CheckboxSelectColumn({cssClass:"grid_checkbox"}),c[0]=b.getColumnDefinition(),this.GridMap[d]=new Slick.Grid("#"+d,f,c,h),this.GridMap[d].setSelectionModel(new Slick.RowSelectionModel({selectActiveRow:!1})),this.GridMap[d].registerPlugin(b),new Slick.Controls.ColumnPicker(c,
this.GridMap[d],h),this.GridMap[d].onBeforeEditCell.subscribe(function(a,b){return-1!==n.EditableRows.indexOf(b.row)?!0:!1}),this.GridMap[d].onCellChange.subscribe(function(a,b){return n.Save(b.row)}),m.push(this.GridMap[d].onValidationError.subscribe(function(a,b){A2Cribs.UIManager.CloseLogs();return A2Cribs.UIManager.Error(b.validationResults.msg)}));return m};c.prototype.GetColumns=function(a,b){var c,d,g,f,h,k,l,m,n;l=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,
formatter:A2Cribs.Formatters.Unit,minWidth:185,headerCssClass:"slickgrid_header"},{id:"beds",name:"Beds",field:"beds",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.RequiredText},{id:"occupancy",name:"Occupancy",field:"occupancy",formatter:A2Cribs.Formatters.Range,editor:A2Cribs.Editors.Range},{id:"rent",name:"Total Rent",field:"rent",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.RequiredMoney},{id:"rent_negotiable",cssClass:"grid_checkbox",name:"(Neg.)",field:"rent_negotiable",
editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"start_date",name:"Start Date",field:"start_date",editor:Slick.Editors.Date,formatter:A2Cribs.Formatters.Date(!0)},{id:"alternate_start_date",name:"Alt. Start Date",field:"alternate_start_date",editor:Slick.Editors.Date,formatter:A2Cribs.Formatters.Date()},{id:"lease_length",name:"Lease Length",field:"lease_length",editor:A2Cribs.Editors.Dropdown([null,"1 month","2 months","3 months","4 months","5 months","6 months","7 months",
"8 months","9 months","10 months","11 months","12 months"]),formatter:A2Cribs.Formatters.Dropdown(";1 month;2 months;3 months;4 months;5 months;6 months;7 months;8 months;9 months;10 months;11 months;12 months".split(";"),!0)},{id:"available",name:"Availability",field:"available",editor:A2Cribs.Editors.Dropdown(["Leased","Available"]),formatter:A2Cribs.Formatters.Dropdown(["Leased","Available"],!0)},{id:"unit_count",name:"Unit Count",field:"unit_count",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Text}]};
h=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"baths",name:"Baths",field:"baths",editor:A2Cribs.Editors.Float,formatter:A2Cribs.Formatters.RequiredText},{id:"parking_type",name:"Parking",field:"parking_type",editor:A2Cribs.Editors.Dropdown(b.parking),formatter:A2Cribs.Formatters.Dropdown(b.parking)},{id:"parking_spots",name:"Spots",field:"parking_spots",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Text},
{id:"street_parking",cssClass:"grid_checkbox",name:"Street Parking",field:"street_parking",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"furnished_type",name:"Furnished",field:"furnished_type",editor:A2Cribs.Editors.Dropdown(b.furnished),formatter:A2Cribs.Formatters.Dropdown(b.furnished)},{id:"pets_type",name:"Pets",field:"pets_type",editor:A2Cribs.Editors.Dropdown(b.pets),formatter:A2Cribs.Formatters.Dropdown(b.pets)},{id:"smoking",name:"Smoking",field:"smoking",editor:A2Cribs.Editors.Dropdown(["Prohibited",
"Allowed"]),formatter:A2Cribs.Formatters.Dropdown(["Prohibited","Allowed"])},{id:"square_feet",name:"SQ Feet",field:"square_feet",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Text},{id:"year_built",name:"Year Built",field:"year_built",editor:A2Cribs.Editors.Year,formatter:A2Cribs.Formatters.Text}]};c=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"air",cssClass:"grid_checkbox",name:"A/C",
field:"air",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"washer_dryer",name:"Washer/Dryer",field:"washer_dryer",editor:A2Cribs.Editors.Dropdown(b.washer_dryer),formatter:A2Cribs.Formatters.Dropdown(b.washer_dryer)},{id:"fridge",cssClass:"grid_checkbox",name:"Fridge",field:"fridge",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"balcony",cssClass:"grid_checkbox",name:"Balcony",field:"balcony",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},
{id:"tv",cssClass:"grid_checkbox",name:"TV",field:"tv",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"storage",cssClass:"grid_checkbox",name:"Storage",field:"storage",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"security_system",cssClass:"grid_checkbox",name:"Security System",field:"security_system",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check}]};d=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,
formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"pool",cssClass:"grid_checkbox",name:"Pool",field:"pool",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"hot_tub",cssClass:"grid_checkbox",name:"Hot Tubs",field:"hot_tub",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"fitness_center",cssClass:"grid_checkbox",name:"Fitness Center",field:"fitness_center",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"game_room",cssClass:"grid_checkbox",
name:"Game Room",field:"game_room",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"front_desk",cssClass:"grid_checkbox",name:"Front Desk",field:"front_desk",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"tanning_beds",cssClass:"grid_checkbox",name:"Tanning Beds",field:"tanning_beds",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"study_lounge",cssClass:"grid_checkbox",name:"Study Lounge",field:"study_lounge",editor:Slick.Editors.Checkbox,
formatter:A2Cribs.Formatters.Check},{id:"patio_deck",cssClass:"grid_checkbox",name:"Deck/Patio",field:"patio_deck",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"yard_space",cssClass:"grid_checkbox",name:"Yard Space",field:"yard_space",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check},{id:"elevator",cssClass:"grid_checkbox",name:"Elevator",field:"elevator",editor:Slick.Editors.Checkbox,formatter:A2Cribs.Formatters.Check}]};n=function(){return[{},{id:"title",
name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"electric",name:"Electricity",field:"electric",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"water",name:"Water",field:"water",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"gas",name:"Gas",field:"gas",editor:A2Cribs.Editors.Dropdown(["Not Included",
"Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"heat",name:"Heat",field:"heat",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"trash",name:"Trash",field:"trash",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"cable",name:"Cable",field:"cable",editor:A2Cribs.Editors.Dropdown(["Not Included",
"Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"internet",name:"Internet",field:"internet",editor:A2Cribs.Editors.Dropdown(["Not Included","Included"]),formatter:A2Cribs.Formatters.Dropdown(["Not Included","Included"])},{id:"utility_total_flat_rate",name:"Total Flat Rate",field:"utility_total_flat_rate",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money}]};k=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,
formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"deposit_amount",name:"Deposit",field:"deposit_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"admin_amount",name:"Admin",field:"admin_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"parking_amount",name:"Parking",field:"parking_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"furniture_amount",name:"Furniture",field:"furniture_amount",editor:Slick.Editors.Integer,
formatter:A2Cribs.Formatters.Money},{id:"pets_amount",name:"Pets",field:"pets_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"amenity_amount",name:"Amenity",field:"amenity_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"upper_floor_amount",name:"Upper Floor",field:"upper_floor_amount",editor:Slick.Editors.Integer,formatter:A2Cribs.Formatters.Money},{id:"extra_occupant_amount",name:"Cost for Extra Occupant",field:"extra_occupant_amount",editor:Slick.Editors.Integer,
formatter:A2Cribs.Formatters.Money}]};f=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"highlights",name:"Highlights",field:"highlights",editor:A2Cribs.Editors.LongText(160,"Highlights"),formatter:A2Cribs.Formatters.Text},{id:"description",name:"Description",field:"description",editor:A2Cribs.Editors.LongText(1E3,"Description"),formatter:A2Cribs.Formatters.Text}]};m=function(){return[{},{id:"title",
name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"pictures",name:"Pictures",formatter:A2Cribs.Formatters.Button}]};g=function(){return[{},{id:"title",name:"Unit/Style - Name",field:"title",editor:A2Cribs.Editors.Unit,formatter:A2Cribs.Formatters.Unit,minWidth:185},{id:"waitlist",name:"Waitlist",field:"waitlist",editor:Slick.Editors.YesNoSelect,formatter:Slick.Formatters.YesNo},{id:"waitlist_open_date",name:"Waitlist Open Date",
field:"waitlist_open_date",editor:Slick.Editors.Date,formatter:A2Cribs.Formatters.Date()},{id:"lease_office_address",name:"Leasing Office Address",field:"lease_office_address",editor:Slick.Editors.Text,formatter:A2Cribs.Formatters.Text},{id:"contact_email",name:"Contact Email",field:"contact_email",editor:A2Cribs.Editors.Email,formatter:A2Cribs.Formatters.RequiredText},{id:"contact_phone",name:"Contact Phone",field:"contact_phone",editor:A2Cribs.Editors.Phone,formatter:A2Cribs.Formatters.RequiredText},
{id:"website",name:"Website",field:"website",editor:Slick.Editors.Text,formatter:A2Cribs.Formatters.Text}]};switch(a){case "overview_grid":return l();case "features_grid":return h();case "amenities_grid":return c();case "utilities_grid":return n();case "fees_grid":return k();case "description_grid":return f();case "picture_grid":return m();case "contact_grid":return g();case "buildingamenities_grid":return d()}};return c}();A2Cribs.MiniMap=function(){function c(a,b,c,d,g){null==b&&(b=39.8282);null==
c&&(c=-98.5795);null==d&&(d=!1);null==g&&(g=!0);a=a.find("#correctLocationMap")[0];this.center=new google.maps.LatLng(b,c);this.Map=new google.maps.Map(a,{zoom:2,center:this.center,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,panControl:!1,zoomControl:!1,streetViewControl:!1,draggable:g});this.Marker=new google.maps.Marker({draggable:g,position:this.center,map:this.Map,visible:d});this.Resize()}c.prototype.CenterMap=function(a,b){this.center=new google.maps.LatLng(a,b);return this.Resize()};
c.prototype.Resize=function(){google.maps.event.trigger(this.Map,"resize");return this.Map.setCenter(this.center)};c.prototype.SetMarkerVisible=function(a){if(null!=this.Marker)return this.Marker.setVisible(!1)};c.prototype.SetMarkerPosition=function(a){this.center=a;this.Map.panTo(a);this.SetZoom(18);this.Marker.setPosition(a);return this.Marker.setVisible(!0)};c.prototype.SetZoom=function(a){return this.Map.setZoom(a)};c.prototype.GetMarkerPosition=function(){return{latitude:this.Marker.position.lat(),
longitude:this.Marker.position.lng()}};c.prototype.SetEnabled=function(a){null==a&&(a=!0);null!=this.Map&&this.Map.setOptions({draggable:a,zoomControl:a,scrollwheel:a,disableDoubleClickZoom:a});null!=this.Marker&&this.Marker.setOptions({draggable:a});return this.Enabled=a};return c}();A2Cribs.PageHeader=function(){function c(){}c.renderUnreadConversationsCount=function(){return $.get(myBaseUrl+"messages/getUnreadCount",function(a){var b,c;try{c=JSON.parse(a)}catch(d){return}a=c.unread_conversations;
b=$(".message_count");if(0===a)return b.hide();b.html(c.unread_conversations);return b.show()})};return c}();A2Cribs.ShoppingCart=function(){function c(a){var b=this;this.Widget=a;this.Widget.on("click",".edit",function(a){a=$(a.currentTarget).attr("id");return b.edit(a)}).on("click",".remove",function(a){a=$(a.currentTarget).attr("id");return b.remove(a)});this.Widget.find(".buy").click(function(){return A2Cribs.Order.BuyCart()});this.Widget.find(".hide-edit").click(function(){$(".fl-cart-item").removeClass("editing");
return $(".edit-form").fadeOut()});this.Widget.find(".save").click(function(){return b.save(b.EditingIndex)});this.Editing=!1;this.EditingIndex=-1;this.orderItem=null;this.ListItemTemplate=_.template("<tr class = 'fl-cart-item'>\n    <td><span  class = 'address'><%= address %></span></td>\n    <td><span class = 'price'?>$<%= price %></span></td>\n    <td class = 'actions'>\n        <a href = '#' class = 'edit' id = '<%= id %>'><i class = 'icon-edit'></i></a>   \n        <a href = '#' class = 'remove' id = '<%= id %>'><i class = 'icon-remove-circle'></i></a>\n    </td>\n</tr>");
this.refresh()}c.prototype.remove=function(a){var b=this;return $.post(myBaseUrl+"shoppingCart/remove",{index:a},function(c){return JSON.parse(c).success?b.refresh():alertify.error("Removing item "+(a+1)+" failed")})};c.prototype.refresh=function(){var a=this;return $.getJSON("/shoppingCart/get",function(b){var c,d,g,f,h;$(".orderItems > tbody").html("");d="";f=g=0;for(h=b.length;f<h;f++)c=b[f],c={price:c.price.toFixed(2),address:c.item.address,id:g++},d+=a.ListItemTemplate(c);$(".orderItems > tbody").html(d);
$("table.orderItems").show();return a.orderItems=b})};c.prototype.edit=function(a){var b,c;b=this.orderItems[a];null!=(c=this.orderItem)&&c.clear();this.orderItem=new A2Cribs.Order.FeaturedListing($(".featured-listing-order-item").first(),b.item.listing_id,b.item.address,{selected_dates:b.item.dates});$(".edit-form").fadeIn("fast");this.EditingIndex=a;return $(".fl-cart-item:eq("+a+")").addClass("editing").siblings().removeClass("editing")};c.prototype.save=function(){var a,b=this;if(0<=this.EditingIndex)return a=
{orderItem:JSON.stringify(this.orderItem.getOrderItem()),index:this.EditingIndex},$.post("/shoppingCart/edit",a,function(c){a=JSON.parse(c);return a.success?(alertify.success("Save Successful"),b.Widget.find(".hide-edit").click(),b.refresh()):alertify.error(a.message)})};return c}();A2Cribs.Landing=function(){function c(){}var a,b;b=function(a){var b;b=$(".current_background");if(b.attr("data-university")!==a)return a=$("img[data-university='"+a+"'].school_background"),a.css("opacity","0.0").zIndex(-1).addClass("current_background"),
b.zIndex(-2).removeClass("current_background"),a.animate({opacity:1},1200,function(){return b.zIndex(-3)})};a=function(a){var c,g,f;f=a.University;for(c in f)g=f[c],$("#school_page").find("."+c).hide().text(g).fadeIn();b(a.University.id);c=a.University.name.split(" ").join("_");$("#map_link").attr("href","/rental/"+c);$(".background_source").attr("href",a.University.background_source);$(".school_logo").css("background-image","url("+a.University.logo_path+")");$(".founder_photo").attr("src",a.University.founder_image);
return $(".founder_title").text(""+a.University.name+" Founder")};c.Init=function(b){var c,g=this;this.locations=b;$(window).scroll(function(){var a;a=$(window).scrollTop();return $(".current_background").css("top",0-0.25*a+"px")});$("#friends_invite").click(function(){A2Cribs.MixPanel.Event("Invite Friends",null);return"undefined"!==typeof FB&&null!==FB?FB.ui({method:"apprequests",message:"Join the Movement. All the College Rentals. All in One Spot."}):void 0});if(null!=(null!=(c=this.locations)?
c.length:void 0))b=Math.floor(Math.random()*this.locations.length),a(this.locations[b]);return $(".university_link").click(function(b){var c,d,e,m;c=$(b.delegateTarget).attr("data-university");m=g.locations;d=0;for(e=m.length;d<e;d++)if(b=m[d],b.University.id===c){g.Current_University=b;break}null!=g.Current_University&&a(g.Current_University);return $("html, body").animate({scrollTop:$("#school_page").offset().top},1200)})};return c}();A2Cribs.Login=function(){function c(){}var a,b,e;c.LANDING_URL=
"cribspot.com";c.HTTP_PREFIX="https://";$(document).ready(function(){return c.CheckLoggedIn()});b=function(a){$(".fb-name").text(a.first_name);$(".fb-image").attr("src",a.img_url);$("#signup_modal").find(".login-separator").fadeOut();$("#signup_modal").find(".fb-login").fadeOut("slow",function(){return $(".fb-signup-welcome").fadeIn()});$("#student_first_name").val(a.first_name);$("#student_last_name").val(a.last_name);return $("#student_email").focus()};c.CheckLoggedIn=function(){var a,b=this;a=
new $.Deferred;$.ajax({url:myBaseUrl+"Users/IsLoggedIn",success:function(c){c=JSON.parse(c);if(null!=c.error)return a.reject();"LOGGED_IN"===c.success?(b.logged_in=!0,b.PopulateHeader(c.data)):"NOT_LOGGED_IN"===c.success&&(b.logged_in=!1,b.ResetHeader());return a.resolve(c)},error:function(b){console.log(b);return a.reject()}});return a.promise()};c.SignupModalSetupUI=function(){var a=this;$(".show_signup_modal").click(function(){$("#login_modal").modal("hide");return $("#signup_modal").modal("show").find(".signup_message").text("Signup for Cribspot.")});
$("#signup_modal").find("form").submit(function(b){$("#signup_modal").find(".signup-button").button("loading");a.CreateStudent(b.delegateTarget).always(function(){return $("#signup_modal").find(".signup-button").button("reset")});return!1});return $("#signup_modal").find(".fb-login").click(function(){$(".fb-login").button("loading");return a.FacebookJSLogin().done(function(c){if("NOT_LOGGED_IN"===c.success)return b(c.data);if("LOGGED_IN"===c.success)return $(".modal").modal("hide"),a.logged_in=!0,
A2Cribs.MixPanel.Event("Logged In",null),a.PopulateHeader(c.data)}).always(function(){return $(".fb-login").button("reset")})})};c.LoginModalSetupUI=function(){var a=this;$(".show_login_modal").click(function(){$("#signup_modal").modal("hide");return $("#login_modal").modal("show")});$("#login_modal").find("form").submit(function(b){$("#login_modal").find(".signup-button").button("loading");a.cribspotLogin(b.delegateTarget).always(function(){return $("#login_modal").find(".signup-button").button("reset")});
return!1});return $("#login_modal").find(".fb-login").click(function(){$(".fb-login").button("loading");return a.FacebookJSLogin().done(function(c){if("NOT_LOGGED_IN"===c.success)return $("#login_modal").modal("hide"),$("#signup_modal").modal("show"),b(c.data);if("LOGGED_IN"===c.success)return $(".modal").modal("hide"),a.logged_in=!0,A2Cribs.MixPanel.Event("Logged In",null),a.PopulateHeader(c.data)}).always(function(){return $(".fb-login").button("reset")})})};c.LoginPageSetupUI=function(){var a=
this;this.div=$("#login_signup");this.div.find(".show_signup").click(function(){a.div.find(".login_row").hide("fade");return a.div.find(".signup_row").show("fade")});this.div.find(".show_login").click(function(){a.div.find(".signup_row").hide("fade");return a.div.find(".login_row").show("fade")});this.div.find(".show_pm").click(function(){a.div.find(".student_icon").removeClass("active");a.div.find(".pm_icon").addClass("active");a.div.find(".fb_box").hide();a.div.find(".student_signup").hide();return a.div.find(".pm_signup").show()});
this.div.find(".show_student").click(function(){a.div.find(".pm_icon").removeClass("active");a.div.find(".student_icon").addClass("active");a.div.find(".pm_signup").hide();a.div.find(".fb_box").show();return a.div.find(".student_signup").show()});this.div.find(".fb_login_btn").click(function(){$(".fb-login").button("loading");return a.FacebookJSLogin().done(function(b){if("NOT_LOGGED_IN"===b.success)return a.div.find("#student_first_name").val(b.data.first_name),a.div.find("#student_last_name").val(b.data.last_name),
a.div.find(".fb-image").attr("src",b.data.img_url),$(".fb-name").text(b.data.first_name),a.div.find(".show_signup").first().click(),a.div.find(".show_student").first().click(),a.div.find(".email_login_message").fadeOut("slow",function(){return a.div.find(".fb-signup-welcome").fadeIn()}),a.div.find("#student_email").focus();if("LOGGED_IN"===b.success)return a.logged_in=!0,A2Cribs.MixPanel.Event("Logged In",null),location.reload()}).always(function(){return $(".fb-login").button("reset")})});this.div.find("#login_content").submit(function(b){a.cribspotLogin(b.delegateTarget).done(function(){return location.reload()});
return!1});this.div.find("#student_signup").submit(function(){a.CreateStudent().done(function(){return location.reload()});return!1});return this.div.find("#pm_signup").submit(function(){a.CreatePropertyManager().done(function(){return location.reload()});return!1})};c.ResetHeader=function(){$(".personal_menu").hide();$(".personal_buttons").hide();$(".signup_btn").show();return $(".nav-text").show()};c.PopulateHeader=function(a){$(".signup_btn").hide();$(".nav-text").hide();$(".personal_buttons").show();
A2Cribs.FavoritesManager.InitializeFavorites(a.favorites);$(".personal_menu").find(".user_name").text(a.name);$(".personal_menu").find("img").attr("src",a.img_url);0!==a.num_messages&&$(".personal_buttons").find(".message_count").show().text(a.num_messages);return $(".personal_menu_"+a.user_type).show()};c.FacebookJSLogin=function(){var a=this;this.fb_login_deferred=new $.Deferred;FB.getLoginStatus(function(b){if("connected"===b.status){if(null!=b&&null!=b.authResponse)return a.AttemptFacebookLogin(b.authResponse);
A2Cribs.UIManager.Error("We're having trouble logging you in with facebook, but don't worry!\t\t\t\t\tYou can still create an account with our regular login.");return a.fb_login_deferred.reject()}return FB.login(function(b){if(null!=b&&null!=b.authResponse)return a.AttemptFacebookLogin(b.authResponse);A2Cribs.UIManager.Error("We're having trouble logging you in with facebook, but don't worry!\t\t\t\t\t\tYou can still create an account with our regular login.");return a.fb_login_deferred.reject()},
{scope:"email"})});return this.fb_login_deferred.promise()};c.AttemptFacebookLogin=function(a){var b=this;return $.ajax({url:myBaseUrl+"Users/AttemptFacebookLogin",data:a,type:"POST",success:function(a){a=JSON.parse(a);return null!=a.error?b.fb_login_deferred.reject():b.fb_login_deferred.resolve(a)},error:function(a){console.log(a);return b.fb_login_deferred.reject()}})};c.cribspotLogin=function(a){var b,c=this;this._login_deferred=new $.Deferred;b=myBaseUrl+"users/AjaxLogin";a={User:{email:$(a).find("#inputEmail").val(),
password:$(a).find("#inputPassword").val()}};null!=a.User.email&&null!=a.User.password&&$.post(b,a,function(a){a=JSON.parse(a);console.log(a);if(null!=a.error)return"EMAIL_UNVERIFIED"===a.error_type?A2Cribs.UIManager.Confirm("Your email address has not yet been confirmed. \t\t\t\t\t\t\tPlease click the link provided in your confirmation email. \t\t\t\t\t\t\tDo you want us to resend you the email?",function(a){if(a)return c.ResendConfirmationEmail()}):(A2Cribs.UIManager.CloseLogs(),A2Cribs.UIManager.Error(a.error)),
c._login_deferred.reject();A2Cribs.MixPanel.AuthEvent("login",{source:"cribspot"});$(".modal").modal("hide");c.PopulateHeader(a.data);c.logged_in=!0;A2Cribs.MixPanel.Event("Logged In",null);return c._login_deferred.resolve()});return this._login_deferred.promise()};c.ResendConfirmationEmail=function(a){null==a&&(a=!1);if(!a)return $.ajax({url:myBaseUrl+"users/ResendConfirmationEmail",type:"POST",success:function(a){a=JSON.parse(a);return null!=a.error?A2Cribs.UIManager.Alert(a.error.message):A2Cribs.UIManager.Success("Email has been sent! Click the link to verify.")}})};
e=function(a,b,c){var e,k,l,m,n;l=0===a?"student_":"pm_";A2Cribs.UIManager.CloseLogs();k=!0;m=0;for(n=b.length;m<n;m++)e=b[m],0===c.find("#"+l+e).val().length&&(k=!1);k||A2Cribs.UIManager.Error("Please fill in all of the fields!");if(1===a&&(a=c.find("#"+l+"phone").val().split("-").join(""),10!==a.length||isNaN(a)))k=!1,A2Cribs.UIManager.Error("Please enter a valid phone number");6>c.find("#"+l+"password").val().length&&(k=!1,A2Cribs.UIManager.Error("Please enter a password of 6 or more characters"));
return k};a=function(a,b,f,h){var k,l,m,n;c._create_user_deferred=new $.Deferred;l=0===a?"student_":"pm_";if(e(a,b,h)){if(null!=h.find("#"+l+"confirm_password").val()&&h.find("#"+l+"password").val()!==h.find("#"+l+"confirm_password").val()){A2Cribs.UIManager.Error("Make sure passwords match!");return}k={User:{user_type:a}};m=0;for(n=f.length;m<n;m++)b=f[m],0!==h.find("#"+l+b).val().length&&(k.User[b]=h.find("#"+l+b).val());$.post("/users/AjaxRegister",k,function(b){var e,f;e=JSON.parse(b);if(null!=
e.error)return A2Cribs.UIManager.CloseLogs(),A2Cribs.UIManager.Error(e.error),c._create_user_deferred.reject();f=0===a?$("#student_email").val():$("#pm_email").val();A2Cribs.MixPanel.AuthEvent("signup",{user_id:b.success,user_type:a,email:f,source:"cribspot",user_data:k});mixpanel.people.set({user_id:b.success,user_type:a,email:f,user_data:k});c.PopulateHeader(e.data);c.logged_in=!0;A2Cribs.MixPanel.Event("Logged In",null);$(".modal").modal("hide");return c._create_user_deferred.resolve()});return c._create_user_deferred.promise()}return c._create_user_deferred.reject()};
c.CreateStudent=function(b){var c,e;b=null==b?this.div:$(b);e="email password first_name last_name university year".split(" ");c=e.slice(0);return a(0,e,c,b)};c.CreatePropertyManager=function(){var b,c;c="email password company_name street_address phone city state".split(" ");b=c.slice(0);b.push("website");return a(1,c,b,this.div)};return c}.call(this);A2Cribs.FeaturedListings=function(){function c(){}var a;c.FeaturedPMIdToListingIdsMap=[];c.FeaturedPMListingsVisible=!1;c.GetFlIds=function(a){var c;
c=new $.Deferred;$.get("/featuredListings/cycleIds/"+a+"/"+this.FL_LIMIT,function(a){a=JSON.parse(a);return null!=a?c.resolve(a):c.resolve(null)});return c.promise()};c.FL_LIMIT=5;c.GetListingDeferred=function(a,c){var d;d=new $.Deferred;$.ajax({url:myBaseUrl+"Listings/GetListing/"+a,type:"GET",success:function(g){var f,h,k,l,m;g=JSON.parse(g);l=0;for(m=g.length;l<m;l++)for(h in f=g[l],f)k=f[h],null!=A2Cribs[h]&&A2Cribs.UserCache.Set(new A2Cribs[h](k));A2Cribs.UserCache.Get(c,a);return d.resolve(f)},
error:function(){return d.resolve(null)}});return d.promise()};c.FetchListingsByIds=function(a,c){var d,g,f,h,k;d=new $.Deferred;if(!a||1>a.length)return d.resolve(null),d;f=[];h=0;for(k=a.length;h<k;h++)g=a[h],f.push(A2Cribs.FeaturedListings.GetListingDeferred(g,c));$.when.apply($,f).then(function(){return d.resolve(arguments)});return d.promise()};c.GetRandomListingsFromMap=function(a,c){return _.shuffle(c).slice(0,a)};c.InitializeSidebar=function(b,c,d,g){var f,h=this;null==this.SidebarListingCache&&
(this.SidebarListingCache={});null==this.FLListingIds&&(this.FLListingIds=[]);f=new a($("#fl-side-bar"));b=this.GetFlIds(b);this.GetSidebarImagePathsDeferred=new $.Deferred;$.when(b,g).then(function(a){var b,c,d,e,g,q,s,u;d=A2Cribs.UserCache.Get("listing");b=[];q=0;for(g=d.length;q<g;q++)c=d[q],null!=c&&c.listing_id&&b.push(parseInt(c.listing_id));d=null;0<b.length&&(d=h.GetRandomListingsFromMap(25,b));if(!(null==a&&null==d)){q=[];g=0;for(s=a.length;g<s;g++)b=a[g],b=parseInt(b),h.FLListingIds.push(b),
q.push(b);if(null!=d){a=0;for(g=d.length;a<g;a++)b=d[a],q.push(b)}d=[];s=0;for(u=q.length;s<u;s++)b=q[s],a={},c=A2Cribs.UserCache.Get("listing",b),e=g=null,null!=c&&(c.InSidebar(!0),e=A2Cribs.UserCache.Get("marker",c.marker_id),g=A2Cribs.UserCache.GetAllAssociatedObjects("rental","listing",b),null!=g[0]&&(g=g[0])),null!=c&&null!=e&&null!=g?(a.Listing=c,a.Marker=e,a.Rental=g,d.push(a)):(console.log(c),console.log(e),console.log(g));f.addListings(d,"ran");h.GetSidebarImagePaths(q);return $(".fl-sb-item").click(function(a){var b;
b=parseInt($(a.currentTarget).attr("marker_id"));a=parseInt($(a.currentTarget).attr("listing_id"));e=A2Cribs.UserCache.Get("marker",b);c=A2Cribs.UserCache.Get("listing",a);A2Cribs.Map.GMap.setZoom(16);A2Cribs.HoverBubble.Open(e);A2Cribs.MixPanel.Click(c,"sidebar listing");b=e.GMarker.getPosition();return A2Cribs.Map.CenterMap(b.lat(),b.lng())})}});return $.when(this.GetSidebarImagePathsDeferred).then(function(a){var b,c,d,e,f;a=JSON.parse(a);f=[];d=0;for(e=a.length;d<e;d++)b=a[d],null!=b&&null!=b.Image?
(c=$("#sb-img"+b.Image.listing_id),f.push(c.attr("src","/"+b.Image.image_path))):f.push(void 0);return f})};c.GetSidebarImagePaths=function(a){return $.ajax({url:myBaseUrl+"Images/GetPrimaryImages/"+JSON.stringify(a),type:"GET",success:function(a){return c.GetSidebarImagePathsDeferred.resolve(a)},error:function(){return c.GetSidebarImagePathsDeferred.resolve(null)}})};c.LoadFeaturedPMListings=function(){return $.ajax({url:myBaseUrl+"Listings/GetFeaturedPMListings/"+A2Cribs.Map.CurentSchoolId,type:"GET",
success:function(a){c.FeaturedPMIdToListingIdsMap=JSON.parse(a);return $("#featured_pm").click(function(){var a,b,g,f;g=c.FeaturedPMIdToListingIdsMap;f=[];for(b in g)a=g[b],A2Cribs.Map.ToggleListingVisibility(a,c.FeaturedPMListingsVisible),c.FeaturedPMListingsVisible=!c.FeaturedPMListingsVisible,c.FeaturedPMListingsVisible?(A2Cribs.Map.IsCluster(!1),f.push(A2Cribs.MixPanel.Event("Sidebar Featured PM",{pm_id:b}))):f.push(A2Cribs.Map.IsCluster(!0));return f})},error:function(){return c.FeaturedPMIdToListingIdsMap=
[]}})};a=function(){function a(b){this.SidebarUI=b;this.ListItemTemplate=_.template(A2Cribs.FeaturedListings.ListItemHTML)}a.prototype.addListings=function(a,b,c){if(null!==a)return a=this.getListHtml(a),this.SidebarUI.find("#"+b+"-listings").append(a)};a.prototype.getDateString=function(a){var b;null==this.MonthArray&&(this.MonthArray="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "));b=this.MonthArray[a.getMonth()];a=a.getFullYear();return""+b+" "+a};a.prototype.getListHtml=function(a){var b,
c,f,h,k,l,m,n,p,r,q,s,u,t;h=$("<div />");r=0;for(s=a.length;r<s;r++){k=a[r];n=null!=k.Rental.rent?parseFloat(k.Rental.rent).toFixed(0):" --";l=null!=k.Marker.alternate_name?k.Marker.alternate_name:k.Marker.street_address;f=null!=k.Rental.lease_length?k.Rental.lease_length:"-- ";b=1<k.Rental.beds?""+k.Rental.beds+" beds":null!=k.Rental.beds?""+k.Rental.beds+" bed":"?? beds";null!=k.Rental.start_date?(p=k.Rental.start_date.toString().replace(" ","T"),p=this.getDateString(new Date(p))):p="Start Date --";
m="/img/sidebar/no_photo_small.jpg";if(null!=k.Image){t=k.Image;q=0;for(u=t.length;q<u;q++)c=t[q],c.is_primary&&(m="/"+c.image_path)}b={rent:n,beds:b,building_type:k.Marker.building_type_id,start_date:p,lease_length:f,name:l,img:m,listing_id:k.Listing.listing_id,marker_id:k.Marker.marker_id};b=$(this.ListItemTemplate(b));A2Cribs.FavoritesManager.setFavoriteButton(b.find(".favorite"),k.Listing.listing_id,A2Cribs.FavoritesManager.FavoritesListingIds);h.append(b)}return h};return a}();c.ListItemHTML=
"<div id = 'fl-sb-item-<%= listing_id %>' class = 'fl-sb-item' listing_id=<%= listing_id %> marker_id=<%= marker_id %>>\n    <span class = 'img-wrapper'>\n        <img id='sb-img<%=listing_id %>' src = '<%=img%>'></img>\n    </span>\n    <span class = 'vert-line'></span>\n    <span class = 'info-wrapper'>\n        <div class = 'info-row'>\n            <span class = 'rent price-text'><%= \"$\" + rent %></span>\n            <span class = 'divider'>|</span>\n            <span class = 'beds'><%= beds %> </span>\n            <span class = 'favorite pull-right'><i class = 'icon-heart fav-icon share_btn favorite_listing' id='<%= listing_id %>'></i></span>    \n        </div>\n        <div class = 'row-div'></div>\n        <div class = 'info-row'>\n            <span class = 'building-type'><%= building_type %></span>\n            <span class = 'divider'>|</span>\n            <span class = 'lease-start'><%= start_date %></span> | <span class = 'lease_length'><%= lease_length %> months</span>\n        </div>\n        <div class = 'row-div'></div>\n        <div class = 'info-row'>\n            <i class = 'icon-map-marker'></i><span class = 'name'><%=name%></span>\n        </div>\n    </span>   \n</div>";
return c}.call(this);A2Cribs.Order=function(){function c(){}c.BuyItems=function(a,b,c,d,g){null==d&&(d=null);null==g&&(g=null);a={orderItems:JSON.stringify(a),order_type:b};return $.post(""+myBaseUrl+"order/buy",a,function(a){a=JSON.parse(a);if(a.success){if(null!=a.jwt)return google.payments.inapp.buy({parameters:{},jwt:a.jwt,success:function(){return alert("success")},failture:function(){return alert("fail")}});A2Cribs.UIManager.Alert(a.msg);return d()}c(a.errors)})};c.BuyCart=function(a,b){null==
a&&(a=null);null==b&&(b=null);return $.post(""+myBaseUrl+"order/buyCart",function(a){a=JSON.parse(a);a.success||console.log(a.message);return google.payments.inapp.buy({parameters:{},jwt:a.jwt,success:function(){return alert("success")},failture:function(){return alert("fail")}})})};c.AddToCart=function(a){a={orderItems:JSON.stringify(a)};return $.post(myBaseUrl+"shoppingCart/add",a,function(a){return JSON.parse(a).success?alertify.success("Added to cart",1500):alertify.error("Adding to cart failed",
1500)})};return c}();A2Cribs.FullListing=function(){function c(){}c.SetupUI=function(a){var b=this;this.listing_id=a;this.div=$(".full_page");this.div.find(".image_preview").click(function(a){var c;c=$(a.delegateTarget).css("background-image");b.div.find(".image_preview.active").removeClass("active");$(a.delegateTarget).addClass("active");return b.div.find("#main_photo").css("background-image",c)});this.div.find(".page_right").click(function(a){if(b.div.find(".image_preview.active").next().length)return a=
b.div.find(".image_preview.active").next(),b.div.find(".image_preview.active").removeClass("active"),a.addClass("active"),b.div.find("#main_photo").css("background-image",a.css("background-image"))});this.div.find(".page_left").click(function(a){if(b.div.find(".image_preview.active").prev().length)return a=b.div.find(".image_preview.active").prev(),b.div.find(".image_preview.active").removeClass("active"),a.addClass("active"),b.div.find("#main_photo").css("background-image",a.css("background-image"))});
this.div.find("#contact_owner").click(function(){var a;A2Cribs.MixPanel.Event("Contact PM",{listing_id:b.listing_id});if(!0===(null!=(a=A2Cribs.Login)?a.logged_in:void 0))return b.div.find("#contact_owner").hide(),b.div.find("#contact_message").slideDown();$("#signup_modal").modal("show").find(".signup_message").text("Please sign in to contact the owner.");return A2Cribs.MixPanel.Event("login required",{listing_id:b.listing_id})});this.div.find("#message_cancel").click(function(){return b.div.find("#contact_message").slideUp("fast",
function(){return b.div.find("#contact_owner").show()})});return this.div.find("#message_send").click(function(){$("#message_send").button("loading");$("#loader").show();return $.ajax({url:myBaseUrl+"Messages/messageSublet",type:"POST",data:{listing_id:b.listing_id,message_body:$("#message_area").val()},success:function(a){a=JSON.parse(a);a.success?($("#message_area").val(""),A2Cribs.UIManager.Success("Message Sent!"),A2Cribs.MixPanel.Event("message sent",{listing_id:b.listing_id})):null!=a.message?
A2Cribs.UIManager.Error(a.message):A2Cribs.UIManager.Error("Message Failed! Please Try Again.");return $("#message_send").button("reset")},complete:function(){return $("#loader").hide()}})})};c.Directive=function(a){if(null!=a.contact_owner)return this.div.find("#contact_owner").click()};return c}();A2Cribs.Dashboard=function(){function c(){}c.SetupUI=function(){var a,b=this;$(window).resize(function(){return b.SizeContent()});this.SizeContent();$(".content-header").each(function(a,c){var g,f,h;h=
$(c);g=h.attr("classname");f=$("."+g+"-content");$(c).click(function(a){var c;return null!=(c=A2Cribs.RentalSave)&&c.Editable?A2Cribs.UIManager.ConfirmBox("By leaving this page, all unsaved changes will be lost.",{ok:"Abort Changes & Continue",cancel:"Return to Editor"},function(c){if(c)return A2Cribs.RentalSave.CancelEditing(),b.ContentHeaderClick(a)}):b.ContentHeaderClick(a)});return"function"===typeof h.next?h.next(".drop-down").find(".drop-down-list").click(function(){return b.ShowContent(f)}):
void 0});$("#feature-btn").click(function(a){return b.Direct({classname:"featured-listing"})});$("#create-listing").find("a").click(function(a){A2Cribs.MarkerModal.NewMarker();return A2Cribs.MarkerModal.Open()});$("body").on("click",".messages_list_item",function(a){return b.ShowContent($(".messages-content"))});a=$("#navigation-bar").parent().height()-$("#navigation-bar").height()-68;$(".list_content").css("height",a+"px");$(".dropdown-search").keyup(function(a){var b;b=$(a.delegateTarget).attr("data-filter-list");
return $(""+b+" li").show().filter(function(){return-1===$(this).text().toLowerCase().indexOf($(a.delegateTarget).val().toLowerCase())?!0:!1}).hide()});return this.GetUserMarkerData()};c.ContentHeaderClick=function(a){var b,c,d;d=$(a.delegateTarget);b=d.attr("classname");c=$("."+b+"-content");$(".list-dropdown").slideUp();$(".content-header.active").removeClass("active");$(a.delegateTarget).addClass("active");return d.hasClass("list-dropdown-header")?$("#"+b+"_list").slideDown():this.ShowContent(c,
!0)};c.GetUserMarkerData=function(){return $.ajax({url:myBaseUrl+"listings/GetMarkerDataByLoggedInUser",type:"GET",success:this.GetUserMarkerDataCallback})};c.GetUserMarkerDataCallback=function(a){var b,c,d,g,f,h,k;d=JSON.parse(a);$("#rentals_count").text(d.length);c=[];k=[];g=0;for(f=d.length;g<f;g++)if(a=d[g],null!=a.Marker&&(a=a.Marker,!(null!=a.marker_id&&(h=a.marker_id,0<=y.call(c,h))))){b=a.alternate_name;if(!a.alternate_name||!a.alternate_name.length)b=a.street_address;b=$("<li />",{text:b,
"class":"rentals_list_item",id:a.marker_id});$("#rentals_list_content").append(b);k.push(c.push(a.marker_id))}return k};c.GetListings=function(){if(null==this.DeferedListings)this.DeferedListings=new $.Deferred;else return this.DeferedListings.promise();$.ajax({url:myBaseUrl+"listings/GetListing",type:"GET",success:this.GetListingsCallback});return this.DeferedListings.promise()};c.GetListingsCallback=function(a){var b,e,d,g,f,h,k,l,m,n,p,r,q,s;f=JSON.parse(a);q=0;for(s=f.length;q<s;q++)for(b in a=
f[q],a)r=a[b],null!=A2Cribs[b]&&A2Cribs.UserCache.Set(new A2Cribs[b](r));f=A2Cribs.UserCache.Get("listing");b={};r=0;for(q=f.length;r<q;r++)a=f[r],null==b[a.listing_type]&&(b[a.listing_type]={}),b[a.listing_type][a.marker_id]=!0;c.DeferedListings.resolve();h=[0,0,0];g=["rentals","sublet","parking"];a=[];for(d in b)m=b[d],a.push(function(){var a;a=[];for(l in m)k=A2Cribs.UserCache.Get("marker",l),n=k.GetName(),p=g[parseInt(d,10)],h[parseInt(d,10)]++,e=$("<li />",{text:n,"class":""+p+"_list_item",id:k.marker_id}),
a.push($("#"+p+"_list_content").append(e));return a}());return a};c.SizeContent=function(){};c.SlideDropDown=function(a,b){var c,d;c=a.next(".drop-down");if(0!==c.length)return d=a.children("i")[0],$(d).toggleClass("icon-caret-right",!b).toggleClass("icon-caret-down",b),$(a).toggleClass("shadowed",b).toggleClass("expanded",b).toggleClass("minimized",!b),b?c.slideDown("fast"):c.slideUp("fast")};c.ShowContent=function(a){a.siblings().addClass("hidden");a.removeClass("hidden");return a.trigger("shown")};
c.HideContent=function(a){return $("."+a+"-content").addClass("hidden")};c.Direct=function(a){$("#"+a.classname+"-content-header").trigger("click");if(null!=a.data)return this.ShowContent($("."+a.classname+"-content"))};return c}.call(this);A2Cribs.Account=function(){function c(){}c.setupUI=function(){var a,b,c=this;$.get(myBaseUrl+"university/getAll/",function(a){c.UniversityData=JSON.parse(a);c.UniversityNames=[];c.UniversityID=[];_.each(c.UniversityData,function(a,b,d){c.UniversityNames[b]=a.University.name;
return c.UniversityID[b]=a.University.id});return $("#university").typeahead({source:c.UniversityNames})});a=A2Cribs.VerifyManager.getMyVerification();b=$("#my-verification-panel");a.verified_email&&b.find("#veri-email i:last-child").removeClass("unverified icon-remove-sign").addClass("verified icon-ok-sign");a.verified_edu&&b.find("#veri-edu i:last-child").removeClass("unverified icon-remove-sign").addClass("verified icon-ok-sign");a.verified_fb?b.find("#veri-fb  i:last-child").removeClass("unverified icon-remove-sign").addClass("verified icon-ok-sign"):
$("#veri-fb").append("<a href = '#'>Verify?</a>").click(this.FacebookConnect);$(".veridd").each(function(a,b){return $(b).tooltip({title:"Verify?",trigger:"hover"})});$("#changePasswordButton").click(function(a){$(a.delegateTarget).button("loading");return c.ChangePassword($("#changePasswordButton"),$("#new_password").val(),$("#confirm_password").val()).always(function(){return $(a.delegateTarget).button("reset")})});$("#VerifyUniversityButton").click(function(a){return c.VerifyUniversity()});$("#changePhoneBtn").click(function(a){$(a.delegateTarget).button("loading");
return c.SavePhone().always(function(){return $(a.delegateTarget).button("reset")})});$("#changeAddressBtn").click(function(a){$(a.delegateTarget).button("loading");return c.SaveAddress().always(function(){return $(a.delegateTarget).button("reset")})});$("#changeCompanyNameBtn").click(function(a){$(a.delegateTarget).button("loading");return c.SaveCompanyName().always(function(){return $(a.delegateTarget).button("reset")})});return $("#changeFirstLastNameButton").click(function(a){$(a.delegateTarget).button("loading");
return c.SaveFirstLastName().always(function(){return $(a.delegateTarget).button("reset")})})};c.SaveFirstLastName=function(){var a;a={first_name:$("#first_name_input").val(),last_name:$("#last_name_input").val()};return this.SaveAccount(a,$("#changeFirstLastNameButton"))};c.SaveCompanyName=function(){var a;a={company_name:$("#company_name_input").val()};return this.SaveAccount(a,$("#changeCompanyNameButton"))};c.SavePhone=function(){var a;a=$("#phone_input").val();if(this.ValidatePhone(a))return a=
{phone:a},this.SaveAccount(a,$("#changePhoneBtn"));A2Cribs.UIManager.Error("Invalid phone number");return(new $.Deferred).reject()};c.ValidatePhone=function(a){a=a.replace(/[^0-9]/g,"");return 10===a.length};c.SaveAddress=function(){var a,b;b=$("#street_address_input").val();a=$("#city_address_input").val();return this.SaveAccount({street_address:b,city:a},$("#changeAddressBtn"))};c.Direct=function(a){};c.VerifyUniversity=function(){var a,b;$("#VerifyUniversityButton").attr("disabled","disabled");
b=$("#university_email").val();a={university_email:b};return-1!==b.search(".edu")?$.post(myBaseUrl+"users/verifyUniversity",a,function(b){console.log(a);b=JSON.parse(b);1===b.success?A2Cribs.UIManager.Error("Please check your email for a verification link."):A2Cribs.UIManager.Error("Verification not successful: "+b.message);return $("#VerifyUniversityButton").removeAttr("disabled")}):A2Cribs.UIManager.Error("Please enter a university email.")};c.ChangePassword=function(a,b,c,d,g,f){var h=this;null==
d&&(d=null);null==g&&(g=null);null==f&&(f=null);this._change_password_deferred=new $.Deferred;a={new_password:b,confirm_password:c};null!==d&&null!==g&&(a.id=d,a.reset_token=g);if(5>b.length)return A2Cribs.UIManager.Alert("Password must be at least 6 characters long."),this._change_password_deferred.reject();if(b!==c)return A2Cribs.UIManager.Alert("Passwords do not match."),this._change_password_deferred.reject();$.ajax({url:myBaseUrl+"users/AjaxChangePassword",data:a,type:"POST",success:function(a){a=
JSON.parse(a);if(null!=a.error)return A2Cribs.UIManager.Alert(a.error),h._change_password_deferred.reject();null===d&&null===g?(alertify.success("Password Changed",3E3),null!==f&&(window.location.href=f)):window.location.href="/dashboard";return h._change_password_deferred.resolve()},error:function(){return h._change_password_deferred.reject()}});return this._change_password_deferred.promise()};c.SaveAccount=function(a,b){null==a&&(a=null);null==b&&(b=null);return $.post(myBaseUrl+"users/AjaxEditUser",
a,function(a){a=JSON.parse(a);void 0===a.error?alertify.success("Account Saved",3E3):A2Cribs.UIManager.Error("Account Failed to Save: "+a.error.message);if(null!=b)return b.removeAttr("disabled")})};c.FacebookConnect=function(){return FB.login(function(a){$.ajax({url:myBaseUrl+"account/verifyFacebook",data:{signed_request:a.authResponse.signedRequest},type:"POST"});return document.location.href="/account"})};c.SubmitResetPassword=function(a){var b;b="email="+$("#UserEmail").val();return $.post("/users/AjaxResetPassword",
b,function(a){b=JSON.parse(a);null!=b.success?A2Cribs.UIManager.Alert("Email sent to reset password!"):A2Cribs.UIManager.Error(b.error);return!1})};return c}();A2Cribs.Messages=function(){function c(){}var a;c.setupUI=function(){var a=this;$("#send_reply").click(function(){return a.sendReply()});$("#view_unread_cb").change(function(){return a.toggleUnreadConversations()});$("#refresh_content").click(function(){return a.refresh()});$("#current_conversation").scroll(function(c){return a.MessageScrollingHandler(c)});
$("#meaning").click(function(){return $("#hidden-meaning").fadeToggle()});$("#delete_conversation").click(function(){return a.DeleteConversation()});return this.refresh()};c.ScrollMessagesTo=function(a){var c;c=$("#current_conversation");a=c.offset().top+c.innerHeight()-(a.offset().top+a.innerHeight()+10);return c.scrollTop(c.scrollTop()-a)};c.MessageScrollingHandler=function(a){if(!(20<$("#current_conversation").scrollTop()||0===this.NumMessagePages))return this.loadMessages(this.NumMessagePages+
1)};c.refresh=function(){this.refreshUnreadCount();this.refreshConversations();if(-1!==this.CurrentConversation)return this.refreshParticipantInfo(),this.refreshMessages()};c.refreshUnreadCount=function(){return $.get(myBaseUrl+"messages/getUnreadCount",function(a){a=JSON.parse(a);return $("#message_count").html(a.unread_messages)})};c.refreshConversations=function(){var a=this;return $.get(myBaseUrl+"messages/getConversations",function(c){var d,g,f,h,k;$("#messages_list_content").empty();c=JSON.parse(c);
k=[];f=0;for(h=c.length;f<h;f++)d=c[f],g=$("<div />",{"class":"notification_count pull-right",text:d.Conversation.unread_message_count}),g=$("<li />",{text:d.Conversation.title,"class":"messages_list_item",id:d.Conversation.conversation_id,"data-participant":d.Participant.id,"data-listing":d.Conversation.listing_id,"data-title":d.Conversation.title}).append(g),0<parseInt(d.Conversation.unread_message_count,10)&&g.addClass("unread"),$("#messages_list_content").append(g),k.push(a.attachConversationListItemHandler(g));
return k})};c.toggleUnreadConversations=function(){this.ViewOnlyUnread=$("#view_unread_cb").is(":checked");return this.refreshConversations()};c.refreshParticipantInfo=function(){var a,e;e=c.CurrentParticipantID;a=c.CurrentConversation;if(null!=c.ParticipantInfoCache[e])c.setParticipantInfoUI(c.ParticipantInfoCache[e]);else return a=a=myBaseUrl+"messages/getParticipantInfo/"+a+"/",$.ajax({url:a,type:"GET",success:function(a){a=JSON.parse(a);c.ParticipantInfoCache[a.id]=a;return c.setParticipantInfoUI(c.ParticipantInfoCache[e])}})};
c.setParticipantInfoUI=function(a){var c;c="";null!=a.first_name&&(c+=a.first_name,null!=a.last_name&&(c+=" "+a.last_name));$(".from_participant").html(c);c="img/head_large.jpg";null!=a.profile_img?c="/"+a.profile_img:null!=a.facebook_id&&(c="https://graph.facebook.com/"+a.facebook_id+"/picture?width=480");return $("#p_pic").attr("src",c)};c.loadConversation=function(a){var c,d;$(".messages_list_item").removeClass("selected");$(a.currentTarget).addClass("selected").removeClass("unread");d=parseInt($(a.currentTarget).find(".notification_count").text(),
10);0<d&&(c=parseInt($("#message_count").text(),10),$(a.currentTarget).find(".notification_count").text("0"),$("#message_count").text(c-d));this.CurrentConversation=parseInt($(a.delegateTarget).attr("id"));this.CurrentParticipantID=$(a.delegateTarget).attr("data-participant");$("#message_reply").show();$("#participant_info_short").show();d=$(a.delegateTarget).attr("data-title");c=$(a.delegateTarget).attr("data-listing");$("#listing_title").text(d).attr("href","/listings/view/"+c);this.refreshParticipantInfo();
this.refreshUnreadCount();return this.refreshMessages(a)};c.loadMessages=function(b,c,d){var g,f=this;null==c&&(c=!1);null==d&&(d=null);if("pending"!==(null!=(g=this.DeferredLoadMessages)?g.state():void 0))return this.DeferredLoadMessages=new $.Deferred,g=myBaseUrl+"messages/getMessages/"+this.CurrentConversation+"/"+b+"/",$.get(g,function(g,k){var l,m,n,p,r,q,s;r=JSON.parse(g);if(void 0!==r.error)f.DeferredLoadMessages.resolve();else{p=$("#message_list");l=p.innerHeight();n="";q=0;for(s=r.length;q<
s;q++)m=r[q],n+=a(m);$(n).hide().prependTo("#message_list").fadeIn();$(".mli").each(function(a,b){var c;c=$(this).find(".message_buble").height();return $(this).css("height",c+"px")});c?f.ScrollMessagesTo($("#mli_0")):(l=p.innerHeight()-l,$("#current_conversation").scrollTop($("#current_conversation").scrollTop()+l));$("#current_conversation").trigger("scroll");null!=d&&f.attachConversationListItemHandler(d.delegateTarget);f.NumMessagePages=b;return f.DeferredLoadMessages.resolve()}}).fail(function(){return f.NumMessagePages=
0}),this.DeferredLoadMessages.promise()};c.attachConversationListItemHandler=function(a){var c=this;return $(a).one("click",function(a){return c.loadConversation(a)})};c.refreshMessages=function(a){this.NumMessagePages=1;$("#message_list").empty();$("#loader").show();return this.loadMessages(this.NumMessagePages,!0,a).always(function(){return $("#loader").hide()})};c.sendReply=function(a){var c=this;a=$("#message_text textarea").val();if(0===a.length)return A2Cribs.UIManager.Error("Message can not be empty"),
!1;$("#send_reply").button("loading");a=$("#message_text textarea").val();$.post(myBaseUrl+"messages/newMessage/",{message_text:a,conversation_id:this.CurrentConversation},function(a){c.refreshMessages();$("#message_text textarea").val("");JSON.parse(a);if(!1===(null!=a?a.success:void 0))return A2Cribs.UIManager.Error("Something went wrong while sending a reply, please refresh the page and try again")}).always(function(){return $("#send_reply").button("reset")});return!1};c.DeleteConversation=function(){var a=
this;return $.post(myBaseUrl+"messages/deleteConversation/",{conv_id:this.CurrentConversation},function(c){var d;try{d=JSON.parse(c)}catch(g){A2Cribs.UIManager.Error("Failed to delete the conversation");return}return 1===d.success?(alertify.success("Conversation deleted",3E3),a.CurrentConversation=-1,a.CurrentParticipantID=-1,A2Cribs.Dashboard.HideContent("messages"),a.refresh()):A2Cribs.UIManager.Error("Failed to delete the conversation")})};a=function(a){return"<div class = 'mli mli-"+a.side+"-side row-fluid' id = 'mli_"+
a.count+"' meta = '"+a.id+"'>\t\t\t<div class = 'span12'>\t\t\t\t<div class = 'participant_message_pic'>\t\t\t\t\t\t<img src = '"+a.pic+"'></img>\t\t\t\t</div>\t\t\t\t<img src = '/img/messages/arrow-"+a.side+".png' class = 'arrow-"+a.side+"'></img>\t\t\t\t<div class = 'message_bubble'>\t\t\t\t\t<div>\t\t\t\t\t\t<span class = 'bubble-top-row'>\t\t\t\t\t\t\t<strong>"+a.name+":</strong>\t\t\t\t\t\t\t<span class = 'time-ago'>"+a.time_ago+"</span>\t\t\t\t\t\t</span>\t\t\t\t\t\t<p class = 'message_body'>"+
a.body+"</p>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t</div>\t\t</div>"};c.Direct=function(a){var c;if(null!=a.data)return this.CurrentConversation=c=parseInt(a.data.conversation_id),this.CurrentParticipantID=c=parseInt(a.data.participant_id),$("#listing_title").text(a.data.title)};c.init=function(a){this.me=a;this.ViewOnlyUnread=!1;null==this.CurrentConversation&&(this.CurrentConversation=-1);this.DropDownVisible=!1;this.NumMessagePages=-1;null==this.CurrentParticipantID&&(this.CurrentParticipantID=-1);
this.ParticipantInfoCache={};return this.LoadingMessages=!1};return c}.call(this);A2Cribs.PropertyManagement=function(){function c(){}c.removeSublet=function(a){return alertify.confirm("Are you sure you want to delete this property? This can't be undone.",function(b){if(b)return b=myBaseUrl+("sublets/remove/"+a),window.location.href=b})};return c}();A2Cribs.VerifyManager=function(){function c(){}c.init=function(a){null==a&&(a=null);this.me=a;return this.VerificationData={}};c.getVerificationFor=function(a){var b;
null==this.VerificationData[a.id]&&(b=new $.Deferred,this.VerificationData[a.id]=b,$.when(this.getTotalFriends(a),this.getMutalFriends(a),this.getTwitterFollowers(a)).done(function(c,d,g){return b.resolve({user_id:a.id,fb_id:a.facebook_id,verified_email:!0===a.verified,verified_edu:!0===a.university_verified,tw_id:a.twitter_userid,verified_fb:c,mut_friends:d,tot_friends:c,verified_tw:null!=g,tot_followers:g})}));return this.VerificationData[a.id]};c.getMutalFriends=function(a){var b,c;b=new $.Deferred;
return null!=(null!=(c=this.me)?c.facebook_id:void 0)&&null!=a.facebook_id?(a="SELECT uid FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = "+this.me.facebook_id+") AND uid IN (SELECT uid2 FROM friend WHERE uid1 = "+a.facebook_id+")",FB.api({method:"fql.query",query:a},function(a){null!=a.error_code&&(console.log("Error during verification fb error: "+a.error_code+"."),b.resolve(null));return b.resolve(a.length)}),b.promise()):b.resolve(null)};c.getTotalFriends=function(a){var b;b=new $.Deferred;
return null!=a.facebook_id?(a="SELECT friend_count FROM user WHERE uid = "+a.facebook_id,FB.api({method:"fql.query",query:a},function(a){null!=a.error_code&&(console.log("Error during verification fb error: "+a.error_code+"."),b.resolve(null));return b.resolve(parseInt(a[0].friend_count))}),b.promise()):b.resolve(null)};c.getTwitterFollowers=function(a){var b;b=new $.Deferred;return null!=a.twitter_userid?($.ajax({url:myBaseUrl+"Users/GetTwitterFollowers/"+a.id,type:"GET",success:function(a){a=JSON.parse(a);
return b.resolve(a.followers_count)}}),b.promise()):b.resolve(null)};c.getMyVerification=function(){return{user_id:parseInt(this.me.id),fb_id:parseInt(this.me.facebook_id),tw_id:this.me.twitter_userid,verified_email:!0===this.me.verified,verified_edu:!0===this.me.university_verified,verified_fb:null!=this.me.facebook_id,verified_tw:null!=this.me.twitter_userid}};return c}();A2Cribs.UserCache=function(){function c(){}var a;c.Cache={};a=function(a,c,d){var g;if("listing"===a||"rental"===a)g=myBaseUrl+
"Listings/GetListing/"+c;return $.ajax({url:g,type:"GET",success:function(a){return null!=d?d.success(JSON.parse(a)):void 0},error:function(){return null!=d?d.error():void 0}})};c.GetListing=function(a,c){var d,g,f=this;d=new $.Deferred;if(null==a||null==c)return d.reject();g=A2Cribs.UserCache.Get(a,c);if(null!=g&&g.IsComplete())return d.resolve(g);$.ajax({url:myBaseUrl+"Listings/GetListing/"+c,type:"GET",success:function(a){var b,l,m,n,p,r,q;n=JSON.parse(a);r=0;for(q=n.length;r<q;r++)for(l in b=
n[r],b)p=b[l],"Marker"!==l&&null!=A2Cribs[l]&&(a=new A2Cribs[l](p),m=f.Get(l.toLowerCase(),a.GetId()),null!=m&&0!==m.length&&(a=m.Update(p)),f.Set(a));g=f.Get(A2Cribs.Map.ACTIVE_LISTING_TYPE,c);return d.resolve(g)},error:function(){return d.reject()}});return d.promise()};c.GetDiferred=function(b,c){var d,g,f=this;d=new $.Deferred;g=this.Get(b,c);return null==g||!g.IsComplete()?(a(b,c,{success:function(a){var d,l,m,n,p;n=0;for(p=a.length;n<p;n++)for(d in l=a[n],l)m=l[d],null!=A2Cribs[d]&&f.Set(new A2Cribs[d](m));
return g=f.Get(b,c)},error:function(){return d.resolve(null)}}),d.promise()):d.resolve(g)};c.Set=function(a){null==this.Cache[a.class_name]&&(this.Cache[a.class_name]={});return this.Cache[a.class_name][a.GetId()]=a};c.Get=function(a,c){var d,g;if(null!=this.Cache[a]){if(null!=c)return this.Cache[a][c];g=[];for(d in this.Cache[a])g.push(this.Cache[a][d]);return g}return null!=c?null:[]};c.Remove=function(a,c){if(null!=this.Cache[a]&&null!=c)return delete this.Cache[a][c]};c.GetAllAssociatedObjects=
function(a,c,d){var g,f,h,k;if(null!=a&&null!=c&&null!=d){f={};k=[];d=parseInt(d,10);for(g in this.Cache[a])null!=this.Cache[a][g][""+c+"_id"]&&(h=parseInt(this.Cache[a][g][""+c+"_id"],10),h===d&&(f[this.Cache[a][g].GetId()]=!0));for(g in f)k.push(this.Get(a,g));return k}};return c}();A2Cribs.Order.FeaturedListing=function(){function c(a,b,c,d,g){this.Widget=a;this.listing_id=b;this.address=c;this.UniData=d;null==g&&(g=null);this.WE_price=this.WD_price=this.Price=this.Weekends=this.Weekdays=0;this.MIN_DAY_OFFSET=
3;this.initMultiDatesPicker(g);this.initTemplates();this.PrevSelectedDate=null;this.RangeSelectEnabled=!0;this.Widget.find(".address").html(this.address);this.setupHandlers();this.setupUniPriceTable(g);this.refresh()}c.prototype.getPrice=function(){return this.Price};c.prototype.setupHandlers=function(){var a=this;this.Widget.on("click",".rst input",function(b){a.RangeSelectEnabled=!a.RangeSelectEnabled;return a.PrevSelectedDate=null}).on("click",".rst .clear-selected-dates",function(b){return a.clear()});
return this.Widget.on("click","input.uni-toggle",function(b){var c;c=$(b.currentTarget).parents().eq(1).index();a.UniData[c].enabled=$(b.currentTarget).prop("checked");return a.refresh()})};c.prototype.setupUniPriceTable=function(a){var b,c,d,g,f;a="";g=this.UniData;c=0;for(d=g.length;c<d;c++)b=g[c],null!=("undefined"!==typeof initialState&&null!==initialState?null!=(f=initialState.universities)?f[b.university_id]:void 0:void 0)?b.enabled=initialState.universities[b.university_id]:b.enabled=!0,a+=
this.UniPriceRow(b);return this.Widget.find(".uniPriceTable>tbody").html(a)};c.GenerateOrderItem=function(a,b){var c;c=_.without.apply(_,[a.selectedDates].concat(b.unavailable_dates));return{listing_id:a.listing_id,university_id:b.university_id,dates:c}};c.prototype.getState=function(){var a,b,c,d,g;b={};g=this.UniData;c=0;for(d=g.length;c<d;c++)a=g[c],b[a.university_id]=a.enabled;return{selectedDates:this.getDates("string"),universities:b,listing_id:this.listing_id}};c.prototype.clear=function(){this.datepicker.multiDatesPicker("resetDates",
"picked");return this.refresh()};c.prototype.reset=function(a){null==a&&(a=!0);this.datepicker.multiDatesPicker("resetDates","picked");this.datepicker.multiDatesPicker("resetDates","disabled");this.Widget.off("click",".rst input");this.Widget.off("click",".rst .clear-selected-dates");return this.Widget.off("click","input.uni-toggle",a?this.refresh():void 0)};c.prototype.getDates=function(a){null==a&&(a="object");return this.datepicker.multiDatesPicker("getDates",a)};c.prototype.updatePrice=function(){return this.Price=
this.Weekdays*this.WD_price+this.Weekends*this.WE_price};c.prototype.updateRates=function(){var a,b,c,d;this.WD_price=this.WE_price=0;d=this.UniData;b=0;for(c=d.length;b<c;b++)a=d[b],a.enabled&&(this.WD_price+=a.weekday_price,this.WE_price+=a.weekend_price);this.Widget.find("#wd_rate").html(this.WD_price.toFixed(2));return this.Widget.find("#we_rate").html(this.WE_price.toFixed(2))};c.prototype.updateDayCounts=function(){var a,b,c,d;this.Weekdays=this.Weekends=0;d=this.getDates();b=0;for(c=d.length;b<
c;b++)a=d[b],a=a.getDay(),0===a||6===a?this.Weekends++:this.Weekdays++;return[this.Weekdays,this.Weekends]};c.prototype.initMultiDatesPicker=function(a){var b,c=this;b=new Date;b={dateFormat:"yy-mm-dd",minDate:new Date(b.setDate(b.getDate()+this.MIN_DAY_OFFSET)),onSelect:function(a,b){c.RangeSelectEnabled&&c.rangeSelect(a);return c.refresh()}};null!=a&&(b.addDates=a.selectedDates);this.datepicker=$(this.Widget).find(".mdp").first().multiDatesPicker(b);return this.datepicker.click()};c.prototype.rangeSelect=
function(a){var b,c;if(null!=this.PrevSelectedDate){a=new Date(a);a=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate());this.PrevSelectedDate>a&&(a=[a,this.PrevSelectedDate],this.PrevSelectedDate=a[0],a=a[1]);this.SelectedDateRange=A2Cribs.UtilityFunctions.getDateRange(this.PrevSelectedDate,a);for(b=c=this.SelectedDateRange.length-1;0<=c;b=c+=-1)a=this.SelectedDateRange[b],!1!==this.datepicker.multiDatesPicker("gotDate",a,"disabled")&&this.SelectedDateRange.splice(b,1);this.PrevSelectedDate=
null;return this.datepicker.multiDatesPicker("addDates",this.SelectedDateRange)}null!=this.SelectedDateRange&&this.datepicker.multiDatesPicker("removeDates",this.SelectedDateRange);this.SelectedDateRange=null;a=new Date(a);this.PrevSelectedDate=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate());return this.datepicker.multiDatesPicker("addDates",[this.PrevSelectedDate])};c.prototype.initTemplates=function(){this.UniPriceRow=_.template("<tr data-university_id='<%= university_id %>' >\n    <td><%=name%></td>\n    <td class = 'rates'>$<%=weekday_price.toFixed(2)%></td>\n    <td class = 'rates'>$<%=weekend_price.toFixed(2)%></td>\n    <td><input class = 'uni-toggle' type='checkbox' <% if(enabled){print('checked');} %> />\n</tr>");
return this.DateConflictNotice=_.template('<li><i class = \'icon-warning-sign\'></i> Listing already featured at <%=name%> on <%\n    $.each(dates, function(index, date){\n        d = new Date(date)\n        if(index != dates.length-1)\n            print(d.getMonth()+1 + "-" + d.getDate() +"-"+ d.getFullYear() + ", ");\n        else\n            print(d.getMonth()+1 + "-" + d.getDate()+"-"+ d.getFullYear());\n    });\n    %></li>')};c.prototype.checkForDateConflicts=function(){var a,b,c,d,g,f,h,k,
l,m,n,p;g=this.getDates("string");a="";d=0;n=this.UniData;h=0;for(l=n.length;h<l;h++)if(f=n[h],f.enabled){c=[];p=f.unavailable_dates;k=0;for(m=p.length;k<m;k++)b=p[k],-1!==$.inArray(b,g)&&(c.push(b),b=new Date(b),b=b.getDay(),null!=b&&(b=(b+1)%7,d=0===b||6===b?d+f.weekend_price:d+f.weekday_price));0<c.length&&(a+=this.DateConflictNotice({name:f.name,dates:c}))}this.Widget.find(".DateConflicts").html(a);return d};c.prototype.refresh=function(){var a;this.updateDayCounts();this.updateRates();this.updatePrice();
a=this.checkForDateConflicts();this.Price-=a;$(this.Widget).find(".price").html(" $"+this.Price.toFixed(2));$(this.Widget).find(".weekdays").html(this.Weekdays);$(this.Widget).find(".weekends").html(this.Weekends);return this.Widget.trigger("orderItemChanged",this)};return c}()}).call(this);
