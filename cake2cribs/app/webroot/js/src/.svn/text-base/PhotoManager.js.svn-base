// Generated by CoffeeScript 1.4.0
(function() {

  A2Cribs.PhotoManager = (function() {

    function PhotoManager() {}

    PhotoManager.CurrentPhotoTarget = "none";

    PhotoManager.CurrentPreviewId = 0;

    PhotoManager.IdToPathMap = [];

    PhotoManager.MAX_CAPTION_LENGTH = 25;

    PhotoManager.BACKSPACE = 8;

    PhotoManager.LoadImages = function() {
      return $.ajax({
        url: myBaseUrl + "Images/LoadImages/" + jsVars.edit_listing_id,
        type: "GET",
        success: A2Cribs.PhotoManager.UpdateImageSources
      });
    };

    PhotoManager.DeleteImageCallback = function(id) {
      $('#imageContent' + id).html('');
      $('#imageContent' + id).css('background-image', '');
      $("#" + id).css("visibility", "hidden");
      $("#add" + id).css("visibility", "visible");
      if (id === A2Cribs.PhotoManager.CurrentPreviewId) {
        $('#imageContent0').html('');
        return $('#imageContent0').css('background-image', '');
      }
    };

    PhotoManager.DeleteImage = function(obj) {
      var photoNumber;
      photoNumber = parseInt(obj.id.substring(obj.id.length - 1));
      return $.ajax({
        url: myBaseUrl + "Images/DeleteImage",
        type: "GET",
        data: "listing_id=" + jsVars.edit_listing_id + "&path=" + A2Cribs.PhotoManager.IdToPathMap[photoNumber],
        success: A2Cribs.PhotoManager.DeleteImageCallback(photoNumber)
      });
    };

    PhotoManager.ConfirmAddImage = function(obj) {
      return $("#EditPrimaryForm").submit();
    };

    PhotoManager.ConfirmAddImageCallback = function(response) {
      return alert(response);
    };

    PhotoManager.UpdateImageSources = function(imageSources) {
      var cssSettings, i, imageContentDiv, _i, _j, _ref, _ref1, _results;
      imageSources = JSON.parse(imageSources);
      for (i = _i = 0, _ref = imageSources[1].length - 1; _i <= _ref; i = _i += 1) {
        A2Cribs.PhotoManager.IdToPathMap[0] = imageSources[0];
      }
      if (imageSources[0] !== null) {
        A2Cribs.PhotoManager.IdToPathMap[0] = imageSources[0];
        cssSettings = {
          "background-size": "256px 256px",
          "background-image": "url(" + imageSources[0] + ")"
        };
        imageContentDiv = "#imageContent1";
        $(imageContentDiv).html("");
        $(imageContentDiv).css(cssSettings);
        $("#add1").css("visibility", "hidden");
        $("#1").css("visibility", "visible");
      } else {
        $("#1").css("visibility", "hidden");
        $("#add1").css("visibility", "visibile");
      }
      _results = [];
      for (i = _j = 0, _ref1 = imageSources[1].length - 1; _j <= _ref1; i = _j += 1) {
        if (imageSources[1][i] === null || imageSources[1][i] === void 0) {
          continue;
        }
        A2Cribs.PhotoManager.IdToPathMap[i + 1] = imageSources[1][i];
        cssSettings = {
          "background-size": "256px 256px",
          "background-image": "url(" + imageSources[1][i] + ")"
        };
        imageContentDiv = "#imageContent" + (i + 2);
        $(imageContentDiv).html("");
        $(imageContentDiv).css(cssSettings);
        $("#add" + (i + 2)).css("visibility", "hidden");
        _results.push($("#" + (i + 2)).css("visibility", "visible"));
      }
      return _results;
    };

    PhotoManager.SubmitPhoto = function() {
      return $("#ImageAddForm").submit();
    };

    PhotoManager.PreviewImage = function(obj) {
      var file, fr;
      file = $("#" + obj.id)[0];
      if (obj.id === "0") {
        A2Cribs.PhotoManager.CurrentPhotoTarget = "previewDiv";
      } else {
        A2Cribs.PhotoManager.CurrentPhotoTarget = "secondary";
      }
      if (file.files) {
        file = file.files[0];
        fr = new FileReader;
        A2Cribs.PhotoManager.CurrentFileNumber = parseInt(obj.id.substring(obj.id.length - 1));
        fr.onloadend = A2Cribs.PhotoManager.SetImage;
        return fr.readAsDataURL(file);
      } else {
        file = file.value;
        return A2Cribs.PhotoManager.SetImage(file);
      }
    };

    PhotoManager.SetImage = function(img) {
      var backgroundImg, candidateDiv, cssSettings, foundFreeDiv, freeDivId, i, imageContentDiv, imageDivPrefix, _i;
      if (typeof img === "object") {
        img = img.target.result;
      }
      cssSettings = {
        "background-size": "160px 150px",
        "background-image": "url(" + img + ")"
      };
      imageContentDiv = "";
      imageDivPrefix = "#imageContent";
      foundFreeDiv = false;
      freeDivId = 0;
      if (A2Cribs.PhotoManager.CurrentPhotoTarget === "secondary") {
        for (i = _i = 1; _i <= 6; i = _i += 1) {
          candidateDiv = imageDivPrefix + i;
          backgroundImg = $(candidateDiv).css("background-image");
          if (backgroundImg === "none" || backgroundImg === void 0) {
            imageContentDiv = candidateDiv;
            foundFreeDiv = true;
            A2Cribs.PhotoManager.IdToPathMap[i] = img;
            freeDivId = i;
            break;
          }
        }
        if (!foundFreeDiv) {
          alert("You have already uploaded a maximum of 6 images. Please delete an image before uploading another.");
          return;
        }
      } else {
        imageContentDiv = "#imageContent0";
        cssSettings = {
          "background-size": "271px 280px",
          "background-image": "url(" + img + ")"
        };
      }
      $(imageContentDiv).html("");
      return $(imageContentDiv).css(cssSettings);
    };

    PhotoManager.ShowRequest = function(formData, jqForm, options) {
      alert(formData);
      /*fileToUploadValue = $('input[@name=fileToUpload]').fieldValue()
      		if !fileToUploadValue[0]
      			return false
      */

      return true;
    };

    PhotoManager.ShowResponse = function(data, statusText) {
      return alert(data);
    };

    PhotoManager.EditImage = function(obj) {
      var photoNumber;
      photoNumber = parseInt(obj.id.substring(obj.id.length - 1));
      A2Cribs.PhotoManager.CurrentPhotoTarget = "previewDiv";
      A2Cribs.PhotoManager.CurrentPreviewId = photoNumber;
      return A2Cribs.PhotoManager.SetImage(A2Cribs.PhotoManager.IdToPathMap[photoNumber]);
    };

    PhotoManager.CaptionKeyUp = function() {
      var curString;
      curString = $("#captionInput").val();
      if (curString.length === A2Cribs.PhotoManager.MAX_CAPTION_LENGTH) {
        $("#charactersLeft").html("0");
        return $("#charactersLeft").css("color", "red");
      } else {
        $("#charactersLeft").html(A2Cribs.PhotoManager.MAX_CAPTION_LENGTH - curString.length);
        return $("#charactersLeft").css("color", "black");
      }
    };

    PhotoManager.SubmitCaption = function() {
      var caption;
      caption = $("#captionInput").val();
      return alert("submitting " + caption);
    };

    /*
    	if statusText == 'success'
    		if data.img != ''
    			document.getElementById('result').innerHTML = '<img src="/upload/thumb/'+data.img+'" />';
    			document.getElementById('message').innerHTML = data.error;
    		else
    			document.getElementById('message').innerHTML = data.error;
    	else
    		document.getElementById('message').innerHTML = 'Unknown error!';
    */


    return PhotoManager;

  })();

}).call(this);
