// Generated by CoffeeScript 1.6.3
(function() {
  A2Cribs.Hotlist = (function() {
    Hotlist.Initialize = function() {
      var el;
      el = $('#friends-list');
      return A2Cribs.HotlistObj = new A2Cribs.Hotlist(el);
    };

    Hotlist.call = function(friend, action) {
      var data, deferred, url,
        _this = this;
      url = myBaseUrl + ("friends/hotlist/" + action);
      deferred = new $.Deferred();
      data = {
        friend_id: friend
      };
      $.ajax({
        url: url,
        data: data,
        type: "POST",
        success: function(response) {
          return deferred.resolve(JSON.parse(response));
        },
        error: function() {
          return deferred.reject();
        }
      });
      return deferred.promise();
    };

    function Hotlist(DOMRoot) {
      this.DOMRoot = DOMRoot;
      this.template = _.template(A2Cribs.Hotlist.templateHTML);
      this.setup();
    }

    Hotlist.prototype.setup = function() {
      var _this = this;
      $.when(this.get()).then((function(data, status, jqXHR) {
        data = {
          friends: data
        };
        return _this.render(data);
      }), (function(data, status, jqXHR) {
        return alert(data);
      }));
      return this;
    };

    Hotlist.prototype.render = function(data) {
      return this.DOMRoot.html(this.template(data));
    };

    Hotlist.prototype.get = function() {
      var deferred,
        _this = this;
      deferred = new $.Deferred();
      $.ajax({
        url: myBaseUrl + "friends/hotlist/",
        type: "GET",
        success: function(data) {
          return deferred.resolve(JSON.parse(data));
        },
        error: function() {
          return deferred.reject();
        }
      });
      return deferred.promise();
    };

    Hotlist.prototype.remove = function(friend) {
      var _this = this;
      return $.when(A2Cribs.Hotlist.call(friend, 'remove')).then((function(data, status, jqXHR) {
        data = {
          friends: data
        };
        return _this.render(data);
      }));
    };

    Hotlist.prototype.add = function(friend) {
      var _this = this;
      return $.when(A2Cribs.Hotlist.call(friend, 'add')).then((function(data, status, jqXHR) {
        data = {
          friends: data
        };
        return _this.render(data);
      }));
    };

    Hotlist.templateHTML = "<div id='share-all'></div>\n<ul class='friends'>\n  <% _.each(friends, function(elem, idx, list) { %>\n    <li class='friend'>\n      <%=elem.first_name%> <%=elem.last_name%> <a href = '#' onClick='A2Cribs.HotlistObj.remove(<%=elem.id%>)'>x</a>\n    </li>\n  <% }); %>\n</ul>";

    return Hotlist;

  })();

}).call(this);
